{"version":3,"sources":["app.js","controllers.js","datetime.js","directives.js","filters.js","services.js","wechat.js","activity/activity.js","activity/controllers.js","activity/services.js","assignment/assignment.js","assignment/controllers.js","assignment/services.js","cabinet/cabinet.js","cabinet/controllers.js","cabinet/filters.js","cabinet/services.js","calendar/calendar.js","calendar/controllers.js","calendar/filters.js","calendar/services.js","contacts/contacts.js","contacts/controllers.js","contacts/services.js","crm/controllers.js","crm/crm.js","crm/services.js","diary/controllers.js","diary/diary.js","diary/filters.js","diary/services.js","docs/controllers.js","docs/docs.js","docs/filters.js","docs/services.js","email/controllers.js","email/email.js","email/services.js","news/controllers.js","news/filters.js","news/news.js","news/services.js","report/controllers.js","report/report.js","report/services.js","thread/controllers.js","thread/services.js","thread/thread.js","vote/controllers.js","vote/services.js","vote/vote.js","workflow/controllers.js","workflow/directives.js","workflow/filters.js","workflow/services.js","workflow/workflow.js"],"names":["getProvider","name","angular","element","document","body","injector","get","module","controller","$scope","$state","Settings","User","user","username","password","submitLogin","logining","login","success","res","go","mainState","$ionicModal","$localstorage","$timeout","Utils","Apps","orderFilter","key","a","b","as","localPortalSettings","bs","LOCAL_SETTINGS_KEY","getObject","apps","all","moduleDisabled","icon","panel","forEach","value","settings","ins","isDisabled","app","indexOf","getApps","this","filter","isShow","bind","sort","toggleShow","$event","target","checked","setObject","reorder","$fromIndex","$toIndex","splice","index","refresh","$broadcast","fromTemplateUrl","scope","animation","then","modal","setModal","$on","remove","hide","orderModal","$http","personal","url","rootUrl","loading","load","that","list","data","datas","review","diary","follow","tabOn","tab","tabName","todo","done","Calendar","CalendarUtil","getData","calendar","params","getDateRange","parseEvents","events","isInterDay","cal","endtime","starttime","unfinished","chargeData","finished","isOverdue","item","Date","now","haveRemind","remindtime","unsigned","published","unread","inbox","activity","console","log","factory","dateFilter","DAYTIME","floorDate","date","isDate","setHours","setMinutes","setSeconds","setMilliseconds","ceilDate","setTime","isToday","relative","isTomorrow","tomorrow","isYesterday","yesterday","inThisWeek","today","timestamp","getTime","weekStartTime","getDay","weekEndTime","inThisYear","getFullYear","format","postfix","fromNow","Math","abs","floor","day","DateUtils","defaultFormats","thisWeek","thisYear","default","formats","type","extend","directive","restrict","require","link","$element","$attrs","$ngModelCtrl","dateStrInput","$parsers","push","val","$formatters","template","replace","$rootScope","$el","hideTabs","ImgViewer","map","Array","prototype","priority","compile","attr","$elem","attrs","srcs","tagName","toLowerCase","groupName","imgPreview","on","src","getAttribute","siblings","querySelectorAll","call","sibling","view","evt","toUpperCase","imgs","img","$location","$document","$ionicLoading","$ionicScrollDelegate","$ionicLoadingConfig","createTemplate","split","join","addClass","getPos","find","anchor","top","offsetTop","bottom","clientHeight","flag","getFlag","pos","length","i","_mousemove","cancel","timer","ionic","off","clientY","touches","elemTop","scrollTo","stopPropagation","preventDefault","hash","elem","show","noBackdrop","prefix","getElementById","style","display","anchorScroll","_mousedown","oldIonicLoadingConfig","getBoundingClientRect","_mouseup","removeClass","letter","parentScope","$watch","$hasHeader","$hasSubheader","$hasFooter","$hasSubfooter","className","oldClassName","$filter","removeFilter","userInfoFilter","departmentInfoFilter","positionInfoFilter","input","ng-value","ngValue","ng-model","ngModel","ng-disabled","ngDisabled","ng-change","ngChange","required","isDefined","selectType","getName","disabledRemove","collection","$setViewValue","$render","isString","$viewValue","UserSelector","$attr","osSelect","selected","userSelector","showUserSelector","enabled","options","enabledUsers","$eval","values","createOptions","maxSelection","create","outRemoveMode","removeMode","toRemoveMode","transclude","max","isNaN","countdown","count","valCount","getCharLength","$setValidity","Downloader","prelink","down","ibDownload","pre","isDateTimeLocalSupport","placeholder","onChangeFunc","fileOnChange","apply","arguments","$parse","testFileType","file","reg","test","alert","fileImageData","maxLength","fileImageMaxlength","files","images","isArray","error","currentLength","getImagePreviewUrl","$apply","_stopPropagation","eventList","eventName","focusOn","shouldFocus","focus","focusDelay","size","avatarDefaultSize","defaultUrl","avatarDefaultUrl","avatar","fullUrlFilter","retrict","templateUrl","attach","download","att","entireattachurl","officereadurl","toggleHeaderClass","status","toggleClass","onScroll","detail","scrollTop","$ionContent","getScrollPosition","$ionicHistory","$ionicConfig","$ionicPlatform","DefaultBack","backTitle","defaultBack","backButton","previousTitleText","title","goBack","$arr","e","nodeName","toLocaleLowerCase","parentNode","querySelector","click","createGetProp","id","prop","idArr","text","String","unit","digit","pow","toFixed","source","start","lastIndexOf","end","substring","FileUtils","getFileIconByExtname","fileIconByExtnameFilter","filename","pop","httpReg","hostUrl","uid","users","uids","removePrefix","positionData","departmentData","$sce","html","trustAsHtml","str","currencyToNumber","currency","ret","Number","constant","notempty","chinese","num","idcard","mobile","money","tel","zipcode","email","provider","resolvers","qqmap","$ocLazyLoad","canvasPainter","nameArr","$get","$window","$ionicPopup","getOrigin","result","location","href","match","requestError","headers","config","errorMsg","toJson","appName","searchParams","parseSearch","search","host","corptoken","window","$q","$ionicViewSwitcher","IbPopup","isFile","obj","toString","isBlob","isFormTypeSupported","createElement","setAttribute","decodeURIComponent","searchField","kt","capitalize","charAt","slice","commasInclude","pick","keys","hasOwnProperty","eliminate","arr","toggle","idx","concatTo","arr1","arr2","unique","removeFrom","promptNoPermission","nextDirection","containsArray","byteLength","sChar","opt","surl","p","trim","total","m","len","o","ceil","serverWarning","serverError","postJsonData","httpConf","method","Content-type","transformRequest","d","isObject","postFormData","formData","Content-Type","undefined","identity","callback","isFunction","URL","createObjectURL","webkitURL","readFile","setDocumentTitle","Platform","isIOS","$iframe","setTimeout","append","httpPromise","promise","fn","disableBack","nextViewOptions","triggerScrollViewPullToRefresh","scrollView","__publish","__scrollLeft","__refreshHeight","__zoomLevel","refreshStartTime","__refreshActive","__refreshHidden","__refreshShow","__refreshActivate","__refreshStart","triggerScrollViewPullToRefreshByHandle","delegateHandle","$getByHandle","getScrollView","clearStateCacheAndGo","state","clearCache","checkFormDirtyBeforeLeave","formCtrlKey","tip","to","toParams","formCtrl","$dirty","history","pushState","confirm","content","back","localStorage","set","setItem","defaultValue","getItem","removeItem","JSON","stringify","parse","noop","onEvent","evtId","label","mapKv","TDAPP","install","conf","userResolve","TalkingData","API_SERVER","isLogin","_promise","resolve","loginFailed","msg","getUserInfo","loginData","responseType","formhash","userData","group","getServerInfo","jsonp","getRedirectUri","redirect","pathArr","loginByCorptoken","_corptoken","defer","code","systemurl","isSuccess","reject","message","setDocumentTitleWithCorpName","shortname","$$addPrefix","$$removePrefix","_id","RegExp","logout","getAuthority","getUser","groupUidByLetter","_uids","_uid","Prefix","PositionPrefix","DepartmentPrefix","prefx","Department","getDepartments","getSubDepartments","deptId","depts","departments","dept","pid","getUserByDepartment","deptid","getUidGroupByDepartment","getPositions","getUserByPosition","posId","positionid","getUidGroupByPosition","$ionicSlideBoxDelegate","WeixinJSBridge","invoke","current","urls","viewerModal","$new","hideDelay","closeModal","$evt","instance","slide","zoomImg","width","zoomFlag","isOfficeFile","officeFileTypes","isImage","imageTypes","getExtname","dotIndex","extname","pathnameOrigin","pathname","pathnameArr","safePathname","concat","protocol","filtIconMap","unknown","showDownloadTip","getTrustedHtml","isWeiXin","zip","7z","ai","exe","fla","pdf","psd","rar","swf","txt","php","js","asp","aspx","jsp","xls","xlsx","doc","docx","ppt","pptx","pps","ppsx","mp3","wav","wma","flac","ape","png","jpg","jpeg","gif","mp4","rmvb","rm","avi","flv","mkv","wmv","WX_SUPPORT_FILETYPE","DOWNLOAD_PAGE","frags","filetype","downloadInWx","encodeURIComponent","IS_WEIXIN","getLocation","onsuccess","onerror","wx","ready","fail","navigator","geolocation","getCurrentPosition","latitude","coords","longitude","openLocation","opts","open","isEmptyFilter","toArrayFilter","Position","filterGroup","disabled","ids","enabledIds","$$create","lastSelected","usid","positions","groups","getSelected","Object","getSelectedCount","setGroup","toggleSelect","toggleSelectAll","isSelected","isSelectAllShow","$watchCollection","scrollBottom","_show","_options","save","updateDeparmentsAndPositions","getAllUserGroups","userGroups","sliceUserGroup","letters","offset","limit","paths","newPaths","oldPaths","last","reduce","loadMore","hasLoadMore","openDepartment","openPosition","createPosition","createDepartment","$ionicBackdrop","okText","cancelText","prompt","timeout","popup","cssClass","release","close","IbList","hasMore","items","idAttr","showLoading","hideLoading","fetch","reset","_this","req","hasItems","getOffset","keyword","checkNoData","SearchModal","lastKey","searchFunc","send","debounce","canceler","searching","defaultParams","showModal","hideModal","removeModal","$stateParams","getDefaultBack","goDefaultBack","historyRoot","getStateParams","backView","uploadAttach","uploadBase64Img","base64","post","service","This","encodeURI","upload","xhr","XMLHttpRequest","addEventListener","onProgress","loaded","onTimeout","onreadystatechange","readyState","onSuccess","responseText","fromJson","onFail","useXDomain","withCredentials","setRequestHeader","API_APP_URL","WECHAT_PUBLIC_APPID","WECHAT_API_URL","WechatApi","when","getInfo","openid","_res","cleanAuthParams","$0","$1","getJsSdkSign","getOAuthUrl","redirectUri","getAuth","initJsSdk","debug","jsApiList","appId","nonceStr","noncestr","signature","initShareConfig","onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","run","route","$stateProvider","$urlRouterProvider","UserProvider","abstract","views","cache","ActivityList","stateName","$current","resize","reload","Activity","activityId","toggleOpen","toggleView","openMap","address","fields","form","note","formField","formdata","formdataid","field","fieldtype","fieldname","realname","moduleid","signUpList","infos","info","ok","deleteSignUp","arrangeList","moduleUrl","createSignUp","updateSignUp","page","hasmore","REGEXP_ENUM","phone","talkingDataLabel","assignment","Assignment","getSubordinates","subordinates","openSubordinateModal","backSubordinateModal","closeSubordinateModal","$ionicActionSheet","AssignmentUnfinished","createMenuOptions","roleText","getRoleText","titleText","buttons","buttonClicked","handler","ops","getEnableOperation","op","destructiveText","destructiveButtonClicked","userName","getSubList","myself","delayModal","cancelModal","openDelayApplyModal","delayApplySubmitting","delayData","assignmentid","delayReason","isDesignee","designeeuid","applyDelay","func","delay","formatDatetime","openCancelApplyModal","cancelApplySubmitting","cancelData","cancelReason","applyCancel","edit","isRemove","urge","restart","remindModal","openRemingModal","remindSubmitting","remindData","remindContent","getRemindData","remindTime","convertDateTime","reminddate","remind","showMenu","hideMenu","AssignmentFinished","init","groupByFinishTime","finishDate","finishtime","groupedItems","getStampPath","stamps","resetForm","chargeuid","submitting","isDisabledSubmit","assignmentForm","$valid","correctFormData","update","subject","participantuid","description","_confirm","onresolve","onreject","onTap","confirmDelayApply","dealDelayApply","agree","reloadInfo","confirmCancelApply","dealCancelApply","loadInfo","getFullInfo","isCharge","applyData","startTime","stampModal","selectStamp","stamp","DATETIME_FORMAT","operation","designee","0","1","2","3","4","charge","getRole","task","participant","path","stampPath","getTimezoneOffset","toJSON","correctDateTime","dateStr","addPrefix","attachmentid","assignmentId","assignmentFinished","param","statusMap","cabinet-personal","cabinet-company","cabinet-received","Cabinet","cb","pDir","ACCESS","openFolder","fid","_showMenu","access","WRITABLE","CabinetReceived","normal_search","breadCrumbs","READABLE","FOLDER","FILE","FILETYPE","removeFile","f","thumb","openImage","fileurl","handlers","share","fids","calendars","groupEvents","DAY_MILLISECOND","resetSubmit","isSubmiting","doSubmit","getCurrentDateTime","isalldayevent","editable","category","startDate","endDate","endTime","newStartDate","submit","formatSubmitData","calendarId","parseTime","removeOne","calendarid","finish","parsed","unfinish","themeSeries","DATE_FORMAT","formatDate","dayOffset","TIME_FORMAT","$cacheFactory","transformResponse","defaults","fromCache","parseEvent","startDatetime","formatTime","endDatetime","CalendarTitle","Subject","Category","IsAllDayEvent","CalendarStartTime","CalendarStartTimeed","CalendarEndTime","CalendarEndTimeed","doption","parseDateStr","results","dateReg","exec","cEvts","cEvt","substr","instancetype","allDay","dayFormToday","getMonth","getDate","timeOffset","dateField","isDateField","minuteOffset","calendarData","year","month","modalTemplate","fromTemplate","ngModelController","colors","colorpickerModal","showColorPicker","hideColorPicker","selectColor","$ionicPosition","position","contacts","Contact","getDeptList","deptInfo","categories","currentCategory","categorys","crumb","popupPromise","$$state","getUserList","distance","$applyAsync","showsearchbar","enterCategory","toCategory","breadcrumbScrollInstance","getDeptInfo","corp","getCorpInfo","userid","CRM","CRM_REPORT_TIMETYPES","crm","stage","todayReport","newModal","TIME_TODAY","getReport","time","setReportTimeType","timeType","reportTimeType","report","getTarget","getOppSurvey","oppSurver","showTargetSetupTip","groupByFilter","orderByFilter","CRMContact","addOrderFieldToList","firstCase","formattedDate","createtime","company","tabs","onTab","contactList","queryParams","range","confirmFilters","orderType","orderDesc","tagList","tagGroups","order","CRMUtils","CRM_CONTACT_EXTEND","extends","isContactInfoShowed","initTagsToForm","selectClient","openClientModal","cid","client","showContactInfo","addContactWay","removeContactWay","contactWays","contactWayModal","onSubmitSuccess","contactid","contactForm","$setPristine","$controller","gender","buildContactFormData","formValidateError","birthday","setTagsToForm","tags","removeContact","confirmRemoveContact","contact","CRMClient","filterGroups","groupKey","selectFilterItem","clientList","lasteventtime","mapFilter","getContactIds","sessionStorage","attachContact","openContactModal","detachContact","submitAttachContact","related","submitPromise","clientForm","isClientInfoShowed","addMoreInfo","likefullnames","likeFullNamesShowValue","checkLikeFullName","clearTimeout","fullname","likeFullNamesShow","likeFullNamesNotShow","removeClient","confirmRemoveClient","CRMEvent","CRMOpportunity","loadRelatedEvent","eventListLoaded","loadRelatedOpportunity","oppListLoaded","oppList","activeTab","setClientTab","openAttachModal","__attachOpts","selectContact","selectContactToClient","updatetime","tag","groupid","tagid","oid","opp","newOpp","newContact","opportunity","setActiveTab","dealchance","isOppFormMoreShowed","showOppFormMore","attachClient","oppForm","buildOpportunityFormData","currencyToNumberFilter","expectendtime","expectincome","removeOpp","confirmRemoveOpportunity","selectOpportunity","openOpportunityModal","eventForm","aid","removeEvent","confirmRemoveEvent","ev","ResolversProvider","weibo","qq","weixin","FormData","select","wrapRemovePromise","clearState","clientScope","clients","firstLetter","opps","oppScope","restoreSelected","contactScope","selectedIds","newEvent","clientAttachModal","tagGroup","taglist","groupBy","grouped","multi","mode","onRemove","angle","ele","percent","plus","searchModal","tabTo","$index","activeIndex","$tab","$compile","$ionicTemplateLoader","onSelect","filterShown","color","min","$locale","reformat","active","$options","updateOn","$$rawModelValue","revalidate","$validate","keepInRange","fraction","$commitViewValue","hardCap","decimalRex","dChar","clearRex","clearValue","dSeparator","NUMBER_FORMATS","DECIMAL_SEP","cleared","neg_dummy","getCurrencySymbol","neg_regexp","GROUP_SEP","neg_dummy_txt","value_dummy_txt","currencySymbol","CURRENCY_SYM","ngRequired","$observe","$validators","groupRegex","triggerHandler","hasSelectedGroups","g","Diary","openSettingModel","settingModel","defaultShareList","direct","attentionList","setting","dashboardConfig","savesetting","$ionicListDelegate","mine","pages","groupByYearMonth","diarytime","closeOptionButtons","diaryid","allsubs","isfavor","groupByTime","other","loadDiary","imgReg","nextDay","nextDiarytime","planned","originalPlanList","unplanned","outsidePlanList","plans","tomorrowPlanList","originalPlan","next","prevAndNextPK","nextPK","prev","prevPK","readers","readeruid","isShare","isSup","comment","allStamps","commentList","cm","user_info","avatar_middle","stampUrl","toDiary","showMore","hideMore","showCommentModal","commentModel","touid","commentType","rowid","tocid","addComment","DiaryUtils","SCHEDULE","planOutside","plan","uploadImagesPreviews","diaryContent","todayDate","plantime","shareuid","isSubmitting","addUnplanned","schedule","removeUnplanned","addPlan","removePlan","allowSubmit","fd","planfromschedule","c","selectedStartDate","selectedEndDate","setRemind","delRemind","openSharingModel","sharingModel","equals","handleFormData","oldDate","add","isInstallCalendar","workStart","recordid","todayWeekday","weekday","tomorrowWeekday","isattention","groupByMonth","attention","unattention","fillZero","hour","minute","numToHHmmFilter","timeremind","timeArr","diaryids","from","diaryDate","auid","popupContinueTime","remindConf","continueTime","getStartHours","getContinueTimes","DocsPublished","$root","docs","n","docid","hasDocs","catid","DocsUnsigned","DocsSigned","rootDir","news","Docs","signing","sign","issign","docs-published","docs-unsigned","docs-signed","docs-category","DocsList","pageCount","Email","hasMails","mail","emailid","reply","forward","actionButtons","sref","EmailList","EmailInbox","EmailTodo","EmailOutbox","removeCompletelyConfirm","removeOutbox","EmailTrash","recovery","removeCompletely","EmailUtils","goBackOrHome","toggleMark","mark","ismark","replyAll","setSource","toids","fromid","concatToids","copytoids","ccids","mcids","showOther","isShowOther","emailForm","innerHTML","showSendedPopup","argu","tomark","mails","lastid","getLastId","isread","outbox","trash","NewsIndex","News","hasNews","NewsUnread","markRead","readall","loadNewsList","getCategories","categoryList","_category","histories","getCommentParams","articleid","isDesc","getComments","istop","articleids","topEndTime","moveModel","categoryTree","temp","showChildrenList","childrenList","currentPid","selectCategory","move","openComment","commentModal","openCommentDetail","commentTetailModal","openReaderDetail","readerTetailModal","getReaders","checkNews","verify","currentView","stateId","reason","read","detailState","readstatus","delete","NewsList","NEWS_APT_URL","uniqueFilter","Report","filterItem","originTempArr","localTempArr","localTids","tid","orderTpl","originTemp","localTemp","diffArr","updateUnreadCount","getUnreadCount","unreadCount","updateUserTemplate","getUserTemplate","localReportSettings","templates","isSet","closeMode","openManageModel","manageModel","settingTpls","openOrderList","moveTpl","tpl","fromIndex","toIndex","orderFinish","manageTypes","uptype","getcharge","managers","outRemoveTypeMode","removeTypeMode","toRemoveTypeMode","openSelectManagerModal","chargeModel","addManager","manageTypeids","removeType","settemplate","defaultReceiveList","upuid","setTemplate","openAddModal","addModel","getShopList","templateData","isAdd","addTemplate","External","CommonApi","fileSizeFilter","ReportUtils","changeDataType","merge","fieldvalue","repid","getTemplateData","toid","remark","place","templateField","defaultuid","accessories","annex","saveReport","saveDraft","reportForm","addImage","uploading","uploadedImage","err","uploadingAccessories","removeImage","addtime","readReport","isreview","setTab","getList","addRead","allRead","currentUserUid","showReport","getCommentList","commentData","lists","reader","isStampsBoxShow","getStamp","moduleuid","stampid","setStamp","operateMore","delReport","getSortTemplate","getManagerTemplate","repids","Thread","ThreadUtils","ThreadProgress","thread","isAttention","th","getDayLeft","isInCharge","refreshing","ThreadFinished","setChargeFirstInMembers","members","unshift","ThreadRalatedList","more","dayLeft","slideChanged","feed","flow","VoteUtils","Vote","statusTab","setParticipationTab","voteList","setStatusTab","isOpenMore","openMore","openCrewModal","crewModal","showvoteusers","voteUsers","joined","showVote","checkMaxSelected","topicid","currentItemid","topic","topics","checkedNum","isChecked","itemid","lastItemid","voteid","validForm","mainConvert","vote","arrayToObject","convertSubItem","topicsObj","itemIds","itemids","workflow","Flow","FlowTodo","del","confirmRemove","FlowTrans","takeback","confirmTakeback","rollback","FlowDone","FlowFollow","processes","flowid","cateModal","cateModalScope","openCate","cate","getProcess","common","FlowUtils","icFactory","FlowUpload","validateTitle","imageAttach","fileAttach","serialize","enableArr","saveFlow","saveRollback","showRollBackModel","backlist","rollbackData","stepId","rollbackModal","classifyAttach","attachData","safeImgTypes","obj2Arr","isReadonly","readonly","viewSource","handover","topflag","rp","process","allowback","signFlow","opflag","safeSize","isSafeFile","isSafeSize","processid","isIos","checkIos","addFile","hasEmptyFile","safeFileTypes","downloadFile","workflowDownload","getFlow","feedback","hidden","fbattachmentid","saveflag","enablefiled","ics","valueArr","prcs_user_op","prcs_user","prcs_choose","notAllFinished","turnpriv","runid","flowprocess","processto","prcsback","v","isover","prcs_user_op0","prcs_user0","topflag0","onHandoverSuccess","initStep","step","selectStep","syncdeal","s","notChildFlow","childflow","validate","prcs","getNext","valiStep","prcsUserOp","prcsUser","preset","addPreset","removePreset","getPresetIndex","topflagOld","freeItemOld","tmpCount","lineCount","handoverFree","getFreeNext","runName","icPatternByTypeFilter","addPattern","patternType","icPatternValidator","validaty","$error","icModelCtrls","absUrl","ic","getIc","icId","_ic","setValue","getValue","$content","prepend","getStyle","text-align","font-weight","font-size","font-style","text-decoration","ROW_SPLITTER","COL_SPLITTER","VAL_SPLITTER","raw","splitter","splitRaws","rawRows","rawRow","rows","lvTitles","lvColtypes","lvColvalues","lvSums","scrollDeletage","sv","container","__container","removeEventListener","touchStart","mouseDown","touchMove","mouseMove","originalHandler","getDefaultValue","colIndex","colType","colValue","getRowDefalutValue","updateViewValue","viewValue","joinRows","edittingRow","edittingRowIndex","row","splitValue","addRow","editRow","copy","removeRow","onRowClick","exp","rowData","__parseInt","parseInt","Error","watchExp","isUndefined","checkedArr","newValue","attrFromTemplateFilter","setSizeAdjustWidth","parentElem","dataWidth","dataHeight","clientWidth","height","initAutoSizeAdjust","hasSrc","localSrc","originSrc","File","updateFile","dataset","selectFile","iseditable","getDrawImageRect","cvs","rgba","offsetLeft","offsetRight","offsetBottom","getContext","getImageData","x","y","cr","cg","ca","getDataURI","PADDING","dataURL","rect","tempCvs","tempCtx","drawImage","toDataURL","customCanvasId","pwCanvas","undo","innerWidth","innerHeight","lineWidth","version","dataURI","hasExec","script","appendChild","hiddenField","isHidden","emptyFieldShown","toggleFieldShown","HorizontalScrollFix","mainScrollID","horizontalScrollFix","scrollID","getEventTouches","pageX","pageY","fixHorizontalAndVerticalScroll","mainScroll","scroll","startY","startCoordinates","tap","pointerCoord","ignoreScrollStart","__isDown","containsOrIsTextInput","__hasStarted","__isSelectable","__enableScrollY","doTouchStart","timeStamp","__scrollTop","animate","yMovement","__isDragging","__isTracking","doTouchEnd","flagMap","5","6","filters","removeDepartmentPrefix","removePositionPrefix","dataType","getCheckItemMap","parts","icTitle","checkItem","checkItemMap","icPatternTypeFilter","htmlDecode","$","$2","fromCharCode","strArr","ext","filenameWithoutExt","arrs","indexArr","backViewStateId","currentViewStateId","removeByKey","flowTodo","FlowListUtil","flowTrans","flowDone","flowFollow","UploadFile","types","maxSize","closeLoading","tmp","uploaded","filesize","progress","errMsg","removeStyle","modelName","textarea","radio","radios","checkbox","dateFormat","dateArr","isDateType","isDatetimeType","single","auto","calc","setPrec","getVal","targetIc","parseFloat","sum","mod","firstNum","secondNum","avg","rmb","currencyDigits","integral","decimal","outputCharacters","digits","radices","bigRadices","decimals","zeroCount","quotient","modulus","MAXIMUM_NUMBER","output","_item","_index","icIds","evalExp","eval","imgupload","listview","progressbar","qrcode","pattern","serializes","addPositionPrefix","addDepartmentPrefix","installed","$injector","allServices","r","inj","requires","_invokeQueue","$httpProvider","$httpParamSerializerJQLikeProvider","$httpParamSerializer","ISCORS","interceptors","response","responseError","rejection","$animateProvider","classNameFilter","$compileProvider","imgSrcSanitizationWhitelist","otherwise","$ionicConfigProvider","navBar","alignTitle","positionPrimaryButtons","positionSecondaryButtons","transition","spinner","$provide","decorator","$delegate","removeBackView","self","viewHistory","currentHistory","currentHistoryId","currentCursor","cursor","stack","replacementView","viewId","backViewId","forwardViewId","userAgent","hasBackView","isBackView","toState","toStateParams","fromState","talkingDataParams","bootstrap"],"mappings":"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","file":"all.js","sourcesContent":["// Test Function\nfunction getProvider(name){\n  return angular.element(document.body).injector().get(name);\n}\n\ntry {\n  angular.module('ibosApp.templates');\n} catch(e) {\n  angular.module('ibosApp.templates', []);\n}\n\nvar installed = [\n  'calendar',\n  'cabinet',\n  'diary',\n  'news',\n  'docs',\n  'contacts',\n  'email',\n  'workflow',\n  'assignment',\n  'thread',\n  'activity',\n  'vote',\n  'crm',\n  'report'\n];\n\n/**\n * @ngdoc module\n * @name ibosApp\n * @module ibosApp\n * @description\n *   Ibos app 入口模块\n */\nangular.module('ibosApp', [\n  'ionic',\n  'oc.lazyLoad',\n  'angular.filter',\n  'datetime',\n  'ibosApp.templates',\n  'ibosApp.services',\n  'ibosApp.filters',\n  'ibosApp.directives',\n  'ibosApp.controllers'\n].concat(installed))\n\n// @Debug: 调试用，将所有服务指向 window.sv \n.run(function($window, $injector) {\n  $window.addEventListener('load', function() {\n    var inj;\n    function allServices(mod, r) {\n      if (!r) {\n        r = {};\n        inj = angular.element(document.body).injector().get;\n      }\n      angular.forEach(angular.module(mod).requires, function(m) {allServices(m,r)});\n      angular.forEach(angular.module(mod)._invokeQueue, function(a) {\n        try { r[a[2][0]] = inj(a[2][0]); } catch (e) {}\n      });\n      return r;\n    }\n\n    $window.sv = allServices('ibosApp');\n  }, false);\n})\n\n.run(function($rootScope, Utils) {\n  // Set the document title when a new view is shown\n  $rootScope.$on('$ionicView.afterEnter', function(ev, data) {\n    if (data && data.title) {\n      Utils.setDocumentTitle(data.title);\n    }\n  });\n})\n\n.config(function($httpProvider, $httpParamSerializerJQLikeProvider) {\n  var $httpParamSerializer = $httpParamSerializerJQLikeProvider.$get();\n\n  //Enable cross domain calls\n  $httpProvider.defaults.useXDomain = true;\n  $httpProvider.defaults.withCredentials = true;\n\n  // 此参数作为后端判断请求是否来自 cors 的依据\n  $httpProvider.defaults.headers.common.ISCORS = true;\n\n  // delete $httpProvider.defaults.headers.common['X-Requested-With'];\n  // $httpProvider.defaults.transformResponse.push(function(data){})\n\n  // 由于 $http 默认的数据格式为 application/json，但目前后端使用的是 form data\n  // 所以此处做数据格式转换\n  // Use x-www-form-urlencoded Content-Type\n  // http://victorblog.com/2012/12/20/make-angularjs-http-service-behave-like-jquery-ajax/\n  $httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';\n\n  // Override $http service's default transformRequest\n  $httpProvider.defaults.transformRequest = [function(data) {\n    return angular.isObject(data) && String(data) !== '[object File]' ? $httpParamSerializer(data) : data;\n  }];\n\n  // 使用 TalkData 报错\n  $httpProvider.interceptors.push(['$q', function($q) {\n    return {\n      response: function(response) {\n        var res = response.data\n\n        if(angular.isDefined(res.isSuccess) && !res.isSuccess) {\n          if (typeof TDAPP !== 'undefined') {\n            TDAPP.onEvent('response warn', 'api', {\n              response: response              \n            });\n          }\n        }\n\n        return response\n      },\n\n      responseError: function(rejection) {\n        if (typeof TDAPP !== 'undefined') {\n          TDAPP.onEvent('response error', 'api', {\n            response: rejection              \n          });\n        }\n        return $q.reject(rejection)\n      }\n    }\n  }])\n})\n\n.config(function($animateProvider) {\n  // $animateProvider.classNameFilter(/angular-animate/);\n  $animateProvider.classNameFilter(/^(?:(?!no-animation).)*$/);\n})\n\n.config(function($compileProvider) {\n  // Default /^\\s*((https?|ftp|file):|data:image\\/)/\n  // 添加 blob 协议进 angular 模板解析的白名单\n  $compileProvider.imgSrcSanitizationWhitelist(/^\\s*((https?|ftp|file|blob):|data:image\\/)/);\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n  // Ionic uses AngularUI Router which uses the concept of states\n  // Learn more here: https://github.com/angular-ui/ui-router\n  // Set up the various states which the app can be in.\n  // Each state's controller can be found in controllers.js\n  \n\n  $stateProvider\n    .state('login', {\n      url: '/login',\n      templateUrl: 'templates/login.html',\n      controller: 'LoginCtrl'\n    })\n\n    .state('portal', {\n      url: '/portal',\n      templateUrl: 'templates/tab-apps.html',\n      controller: 'AppsCtrl',\n      resolve: UserProvider.resolve\n    })\n\n  // if none of the above states are matched, use this as the fallback\n  $urlRouterProvider.otherwise('/portal');\n})\n\n.constant('$ionicLoadingConfig', {\n  noBackdrop: true,\n  template: '<ion-spinner></ion-spinner>'\n})\n\n// ionic 框架一些基本配置\n.config(function($ionicConfigProvider) {\n\n  // $ionicConfigProvider.platform.ios.backButton.text('返回');\n\n  $ionicConfigProvider.backButton.text('返回').icon('ion-ios-arrow-back').previousTitleText(true);\n  $ionicConfigProvider.tabs.style('standard').position('bottom');\n  $ionicConfigProvider.navBar.alignTitle('center').positionPrimaryButtons('left').positionSecondaryButtons('right');\n  $ionicConfigProvider.views.transition('ios');\n\n  // 加载中动画风格\n  // android, ios, ios-small, bubbles, circles, crescent, dots, lines, ripple, or spiral.\n  $ionicConfigProvider.spinner.icon('android');\n})\n\n.config(function($provide) {\n\n  $provide.decorator('$ionicHistory', function ($delegate) {\n\n    /**\n     * @ngdoc method\n     * @name $ionicHistory#removeBackView\n     * @description Remove the previous view from the history completely, including the \n     * cached element and scope (if they exist).\n     */\n    $delegate.removeBackView = function(){\n      var self = this;\n      var viewHistory = self.viewHistory();\n      var currentHistory = viewHistory.histories[this.currentHistoryId()];\n      var currentCursor = currentHistory.cursor;\n\n      var currentView = currentHistory.stack[currentCursor];\n      var backView = currentHistory.stack[currentCursor - 1];\n      var replacementView = currentHistory.stack[currentCursor - 2];\n\n      // fail if we dont have enough views in the history\n      if (!backView || !replacementView) {\n        return;\n      }\n\n      // remove the old backView and the cached element/scope\n      currentHistory.stack.splice(currentCursor - 1, 1);\n      self.clearCache([backView.viewId]);\n      // make the replacementView and currentView point to each other (bypass the old backView)\n      currentView.backViewId = replacementView.viewId;\n      currentView.index = currentView.index - 1;\n      replacementView.forwardViewId = currentView.viewId;\n      // update the cursor and set new backView\n      viewHistory.backView = replacementView;\n      currentHistory.currentCursor += -1;\n    };\n\n    return $delegate;\n  })\n})\n\n.run(function($document, $rootScope, $ionicHistory, Settings){\n  $rootScope.isWeiXin = /micromessenger/.test(window.navigator.userAgent.toLowerCase());\n\n  $rootScope.hasBackView = function() {\n    return !!$ionicHistory.backView();\n  };\n\n  $rootScope.isBackView = function(stateId) {\n    var backView = $ionicHistory.backView();\n    if(backView) {\n      if(angular.isString(stateId)) {\n        return backView.stateId == stateId;\n      } else if(angular.isArray(stateId)) {\n        return stateId.indexOf(backView.stateId) !== -1;\n      }\n    }\n    return false;\n  };\n})\n\n.run(function($rootScope, TalkingData) {\n\n  $rootScope.$on('$stateChangeSuccess', function($event, toState, toStateParams, fromState) {\n    if(toState.talkingDataLabel) {\n      if(toState.talkingDataParams) {\n        TalkingData.onEvent(toState.talkingDataLabel, '', toStateParams);\n      } else {\n        TalkingData.onEvent(toState.talkingDataLabel, '');\n      }\n    }\n  });\n})\n\nangular.bootstrap(document.body, ['ibosApp']);","\nangular.module('ibosApp.controllers', [])\n\n  .controller('LoginCtrl', function($scope, $state, Settings, User) {\n    $scope.user = {\n      username: \"\",\n      password: \"\"\n    };\n\n    $scope.submitLogin = function() {\n      $scope.logining = true;\n      User.login($scope.user)\n        .success(function(res) {\n          res.login && $state.go(Settings.mainState);\n        })\n        .finally(function() {\n          $scope.logining = false;\n        });\n    };\n  })\n\n// Apps 应用列表页\n  .controller('AppsCtrl', function($scope, $ionicModal, $localstorage, $timeout,Utils, User, Apps) {\n\n    var LOCAL_SETTINGS_KEY = 'portal.settings';\n    var localPortalSettings = $localstorage.getObject(LOCAL_SETTINGS_KEY) || {};\n\n    $scope.apps = Apps.all();\n    $scope.user = User.user;\n\n    function orderFilter(key) {\n      return function(a, b) {\n        var as = localPortalSettings[a.name];\n        var bs = localPortalSettings[b.name];\n\n        if(as && typeof as[key] !== 'undefined') {\n          if(bs && typeof bs[key] !== 'undefined') {\n            return as[key] > bs[key] ? 1 : -1;\n          } else {\n            return 1;\n          }\n        }\n      };\n    }\n\n    var moduleDisabled = {\n      icon: [],\n      panel: ['cabinet', 'contacts', 'thread']\n    };\n\n    ['icon', 'panel'].forEach(function(value) {\n      $scope.settings = $scope.settings || {};\n\n      var ins = $scope.settings[value] = {\n        apps: [],\n\n        isDisabled: function(app) {\n          return moduleDisabled[value].indexOf(app.name) !== -1;\n        },\n\n        getApps: function() {\n          this.apps = $scope.apps.filter(this.isShow.bind(this)).sort(orderFilter(value + 'Index'));\n          return this.apps;\n        },\n\n        // 检查设置模块图标、面板是否在快速入口显示\n        // 只有用户明确设置为 false 才不显示，默认则显示\n        // 判断 icon、panel 是否显示\n        isShow: function(app) {\n          if(this.isDisabled(app)) return false;\n          if(localPortalSettings && localPortalSettings[app.name] && localPortalSettings[app.name][value] === false) return false;\n          return true;\n        },\n\n        // 切换 icon、panel 显示状态\n        toggleShow: function($event, app) {\n          localPortalSettings[app.name] = localPortalSettings[app.name] || {};\n          // 设置 icon、panel 的显示状态\n          localPortalSettings[app.name][value] = $event.target.checked;\n\n          // 删除排序序号\n          delete localPortalSettings[app.name][value + 'Index'];\n\n          // 保存显示状态到本地\n          $localstorage.setObject(LOCAL_SETTINGS_KEY, localPortalSettings);\n\n          this.getApps();\n        },\n\n        reorder: function(app, $fromIndex, $toIndex) {\n          this.apps.splice($fromIndex, 1);\n          this.apps.splice($toIndex, 0, app);\n\n          this.apps.forEach(function(app, index) {\n            localPortalSettings[app.name] = localPortalSettings[app.name] || {};\n            localPortalSettings[app.name][value + 'Index'] = index;\n          });\n\n          $localstorage.setObject(LOCAL_SETTINGS_KEY, localPortalSettings);\n        }\n      };\n\n      ins.getApps();\n      $scope.refresh = function() {\n        $scope.$broadcast('portal');\n        $timeout(function() {\n          $scope.$broadcast('scroll.refreshComplete')\n        }, 1000);\n      };\n    });\n\n    // 设置显示/隐藏窗口\n    $ionicModal.fromTemplateUrl('templates/portal-setting.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal){\n      $scope.setModal = modal;\n      $scope.$on('$destroy', function() {\n        modal.remove();\n      });\n      $scope.$on('$ionicView.leave', function() {\n        modal.hide();\n      });\n    });\n\n    // 排序窗口\n    $ionicModal.fromTemplateUrl('templates/portal-order.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal){\n      $scope.orderModal = modal;\n      $scope.$on('$destroy', function() {\n        modal.remove();\n      });\n      $scope.$on('$ionicView.leave', function() {\n        modal.hide();\n      });\n    });\n  })\n\n// 工作日志控制器\n  .controller('AppsDiaryCtrl', function($scope, $http, Settings) {\n\n    $scope.personal = {\n      url: Settings.rootUrl + '/diary',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.review = {\n      url: Settings.rootUrl + '/diary/allsubs',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.diary;\n          });\n      }\n    };\n\n    $scope.follow = {\n      url: Settings.rootUrl + '/diary/attention',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.diary;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('personal');\n\n    $scope.$on('portal', function(){\n      $scope.tab('personal')\n    });\n  })\n\n// 工作流控制器\n  .controller('AppsWorkflowCtrl', function($scope, $http, Settings) {\n\n    $scope.todo = {\n      loading: false,\n      url: Settings.rootUrl + '/work&type=todo'\n    };\n    $scope.follow = {\n      loading: false,\n      url: Settings.rootUrl + '/work/follow'\n    };\n    $scope.done = {\n      loading: false,\n      url: Settings.rootUrl + '/work&type=done'\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n\n      $http.get($scope[tabName].url)\n        .success(function(res) {\n          $scope[tabName].list = res.data || res.datas;\n        })\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('todo');\n    $scope.$on('portal', function(){\n      $scope.tab('todo')\n    });\n  })\n\n// 日程控制器\n  .controller('AppsCalendarCtrl', function($scope, $http, Settings, Calendar, CalendarUtil) {\n    $scope.calendar = {\n      loading: true,\n      url: Settings.rootUrl + '/calendar'\n    };\n\n    // 初始化控制器时，自动获取数据, 自动获取下月和本月的日程\n    function getData(){\n      $http.get($scope.calendar.url, {\n        params: CalendarUtil.getDateRange(),\n      })\n        .success(function(data){\n          $scope.calendar.list = CalendarUtil.parseEvents(data.events);\n        })\n        .finally(function() {\n          $scope.calendar.loading = false;\n        })\n    }\n    getData();\n\n    // 判断日程是否跨天\n    $scope.isInterDay = function(cal) {\n      return cal.endtime - cal.starttime > 86400000;\n    };\n    $scope.$on('portal', getData);\n  })\n\n// 任务指派控制器\n  .controller('AppsAssignmentCtrl', function($scope, $http, Settings) {\n\n    $scope.unfinished = {\n      url: Settings.rootUrl + '/assignmentunfinished',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.chargeData;\n          });\n      }\n    };\n\n    $scope.finished = {\n      url: Settings.rootUrl + '/assignmentfinished',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('unfinished');\n\n    // 是否已过期\n    $scope.isOverdue = function(item) {\n      return item &&\n        item.endtime &&\n        Date.now() > item.endtime * 1000;\n    };\n\n    // 是否设置了提醒\n    $scope.haveRemind = function(item) {\n      return item &&\n          // 过期时不显示提醒\n        !$scope.isOverdue(item) &&\n        item.remindtime > 0;\n    };\n\n    $scope.$on('portal', function(){\n      $scope.tab('unfinished')\n    });\n  })\n\n// 公文控制器\n  .controller('AppsDocsCtrl', function($scope, $http, Settings) {\n    $scope.unsigned = {\n      url: Settings.rootUrl + '/docs&type=nosign',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.published = {\n      url: Settings.rootUrl + '/docs',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('unsigned');\n    $scope.$on('portal', function(){\n      $scope.tab('unsigned')\n    });\n  })\n\n// 信息中心控制器\n  .controller('AppsNewsCtrl', function($scope, $http, Settings) {\n    $scope.unread = {\n      url: Settings.rootUrl + '/news&type=new',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.published = {\n      url: Settings.rootUrl + '/news',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('unread');\n    $scope.$on('portal', function() {\n      $scope.tab('unread');\n    });\n  })\n\n// 邮件控制器\n  .controller('AppsEmailCtrl', function($scope, $http, Settings) {\n    $scope.inbox = {\n      url: Settings.rootUrl + '/mail&type=inbox',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.todo = {\n      url: Settings.rootUrl + '/mail&type=todo',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n          });\n      }\n    };\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('inbox');\n    $scope.$on('portal', function(){\n      $scope.tab('inbox');\n    });\n  })\n\n//活动控制器\n  .controller('AppsActivityCtrl', function($scope, $http, Settings) {\n    $scope.activity = {\n      url: Settings.rootUrl + '/activity',\n      loading: false,\n      load: function() {\n        var that = this;\n        return $http.get(this.url)\n          .success(function(res) {\n            that.list = res.data || res.datas;\n            console.log(that.list,\"活动\")\n          });\n      }\n    };\n\n    //$scope.todo = {\n    //  url: Settings.rootUrl + '/mail&type=todo',\n    //  loading: false,\n    //  load: function() {\n    //    var that = this;\n    //    return $http.get(this.url)\n    //      .success(function(res) {\n    //        that.list = res.data || res.datas;\n    //      });\n    //  }\n    //};\n\n    $scope.tabOn = '';\n    $scope.tab = function(tabName) {\n      $scope.tabOn = tabName;\n\n      $scope[tabName].loading = true;\n      $scope[tabName].load()\n        .finally(function() {\n          $scope[tabName].loading = false;\n        });\n    };\n\n    $scope.tab('inbox');\n    $scope.$on('portal',function(){\n      $scope.tab('inbox');\n    });\n  });","angular.module('datetime', [])\n\n/**\n * @ngdoc service\n * @name datetime.DateUtils\n * @description\n *   日期时间相关的工具函数\n */\n.factory('DateUtils', function(dateFilter) {\n\n  var DAYTIME = 86400000;\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#floorDate\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 设置日期到该日起始点，即 0 时 0 分 0 秒 0 毫秒\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Date}    日期\n     */\n    floorDate: function(date) {\n      date = angular.isDate(date) ? date : typeof date !== 'undefined' ? new Date(date) : new Date();\n      date.setHours(0);\n      date.setMinutes(0);\n      date.setSeconds(0);\n      date.setMilliseconds(0);\n      return date;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#ceilDate\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 设置日期到该日结束点\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Date}    日期\n     */\n    ceilDate: function(date) {\n      date = angular.isDate(date) ? date : typeof date !== 'undefined' ? new Date(date) : new Date();\n      date.setTime(+this.floorDate(date) + DAYTIME - 1);\n      return date;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#isToday\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在今日范围内\n     *\n     * @param     {Date|String|Number}     date       日期类型，或可转化为日期的值\n     * @param     {Date|String|Number}     relative   用于作为对比的日期\n     * @returns   {Boolean}    指定日期在今日范围内为 true\n     */\n    isToday: function(date, relative) {\n      date = new Date(date);\n      relative = relative ? new Date(relative) : new Date();\n\n      return date >= this.floorDate(relative) &&\n        date <= this.ceilDate(relative);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#isTomorrow\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在明日范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @param     {Date|String|Number}     relative   用于作为对比的日期\n     * @returns   {Boolean}    指定日期在明日范围内为 true\n     */\n    isTomorrow: function(date, relative) {\n      date = new Date(date);\n      relative = relative ? new Date(relative) : new Date();\n\n      var tomorrow = new Date(+relative + DAYTIME);\n\n      return date >= this.floorDate(tomorrow) &&\n        date <= this.ceilDate(tomorrow);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#isYesterday\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在昨日范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @param     {Date|String|Number}     relative   用于作为对比的日期\n     * @returns   {Boolean}    指定日期在昨日范围内为 true\n     */\n    isYesterday: function(date, relative) {\n      date = new Date(date);\n      relative = relative ? new Date(relative) : new Date();\n\n      var yesterday = new Date(+relative - DAYTIME);\n\n      return date >= this.floorDate(yesterday) &&\n        date <= this.ceilDate(yesterday);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#inThisWeek\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在本周范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Boolean}    指定日期在本周范围内为 true\n     */\n    inThisWeek: function(date) {\n      date = new Date(date);\n      var today = new Date();\n      var timestamp = date.getTime();\n\n      var weekStartTime = +this.floorDate(today) - today.getDay() * DAYTIME;\n      var weekEndTime = +this.ceilDate(today) + (6 - today.getDay()) * DAYTIME;\n\n      return timestamp >= weekStartTime &&\n        timestamp <= weekEndTime;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      datetime.DateUtils#inThisYear\n     * @methodOf  datetime.DateUtils\n     * @description\n     * 指定日期是否在今年范围内\n     *\n     * @param     {Date|String|Number}     date     日期类型，或可转化为日期的值\n     * @returns   {Boolean}    指定日期在今年范围内为 true\n     */\n    inThisYear: function(date) {\n      date = new Date(date);\n      var today = new Date();\n      return today.getFullYear() === date.getFullYear();\n    }\n  };\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:humanizedTime\n * @function\n * @description\n *   计算给出时间与当前时间的差，并以人性化的格式显示\n *   \n * @param   {date|number}  date  日期或时间戳\n * @returns {string}       人性化格式的时间\n */\n.filter('humanizedTime', function(dateFilter) {\n\n  return function(date, format) {\n    date = +date;\n    format = format || 'yyyy-MM-dd';\n    var now = +new Date();\n\n    var postfix = now >= date ? \n      ['秒前', '分钟前', '小时前', '天前'] : \n      ['秒后', '分钟后', '小时后', '天后'];\n\n    var fromNow = Math.abs(now - date) / 1000;\n    if(fromNow < 60) {\n      return Math.floor(fromNow) + postfix[0];\n    }\n\n    fromNow = fromNow / 60;\n    if(fromNow < 60) {\n      return Math.floor(fromNow) + postfix[1];\n    }\n\n    fromNow = fromNow / 60;\n    if(fromNow < 24) {\n      return Math.floor(fromNow) + postfix[2];\n    }\n\n    fromNow = fromNow / 24;\n    if(fromNow < 7) {\n      return Math.floor(fromNow) + postfix[3];\n    }\n\n    return dateFilter(date, format);\n  }\n\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:humanizedDate\n * @function\n * @description\n *   以人性化的格式显示日期\n *   \n * @param   {date|number}  date    日期或时间戳\n * @param   {string}       format  默认的日期格式\n * @returns {string}       人性化格式的时间\n */\n.filter('humanizedDate', function(dateFilter) {\n\n  return function(date, format) {\n    date = +date;\n    format = format || 'yyyy-MM-dd';\n    var now = new Date();\n    now.setHours(0);\n    now.setMinutes(0);\n    now.setSeconds(0);\n    now.setMilliseconds(0);\n    var day = (date - now) / 86400000;\n\n    switch(Math.floor(day)) {\n      case -2:\n        return '前天';\n      case -1:\n        return '昨天';\n      case 0:\n        return '今天';\n      case 1:\n        return '明天';\n      case 2:\n        return '后天';\n      default:\n        return dateFilter(date, format);\n    }\n  };\n})\n\n\n/**\n * @ngdoc filter\n * @name datetime.filter:humanizedDateTime\n * @function\n * @description\n *   以人性化的格式显示日期\n *   同一天内显示格式如 10:30\n *   昨天、明天分别以文字显示\n *   同一年内显示格式如 01-01\n *   其他显示格式如 2016-01-01\n *   \n * @param   {date|number}  date    日期或时间戳\n * @returns {string}       人性化格式的时间\n */\n.filter('humanizedDateTime', function(dateFilter, DateUtils) {\n\n  var defaultFormats = {\n    'today': 'HH:mm',\n    'yesterday': '昨天',\n    'tomorrow': '明天',\n    'thisWeek': 'EEE',\n    'thisYear': 'MM-dd',\n    'default': 'yyyy-MM-dd'\n  };\n\n  return function(date, formats) {\n    var type = 'default';\n    formats = angular.extend({}, defaultFormats, formats);\n\n    if(DateUtils.isToday(date)) {\n      type = 'today';\n    } else if(DateUtils.isYesterday(date)){\n      type = 'yesterday';\n    } else if(DateUtils.isTomorrow(date)){\n      type = 'tomorrow';\n    } else if(DateUtils.inThisWeek(date)) {\n      type = 'thisWeek';\n    } else if(DateUtils.inThisYear(date)) {\n      type = 'thisYear';\n    }\n\n    return dateFilter(date, formats[type]);\n  };\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:isToday\n * @function\n * @description\n *   判断一个时间戳是否是今天\n *    \n * @param  {String|Number}  timestampe  时间戳\n * @return {Boolean}        是否今天\n */\n.filter('isToday', function(dateFilter) {\n  return function(timestamp) {\n    return dateFilter(new Date(), 'yyyyMMdd') === dateFilter(timestamp, 'yyyyMMdd');\n  }\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:isAfterThanNow\n * @function\n * @description\n *   时间是否在现在之后\n *     \n * @param   {string|number}       timestamp    时间戳\n * @returns {boolean}             true 表示时间在现在之后\n */\n.filter('isAfterThanNow', function() {\n  return function(timestamp) {\n    return timestamp > +new Date();\n  };\n})\n\n/**\n * @ngdoc filter\n * @name datetime.filter:isBeforeThanNow\n * @function\n * @description\n *   时间是否在现在之前\n *     \n * @param   {string|number}       timestamp    时间戳\n * @returns {boolean}             true 表示时间在现在之前\n */\n.filter('isBeforeThanNow', function() {\n  return function(timestamp) {\n    return timestamp < +new Date();\n  };\n})\n\n/**\n * @ngdoc filter\n * @name  datetime.directive:dateStrInput\n * @restrict A\n * @element input[type=\"date\"]\n * @require ngModel\n * @description\n *   使日期控件能接收字符串格式的日期\n *     \n * @param   {string}       dateStrInput    日期格式\n */\n.directive('dateStrInput', function(dateFilter) {\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function($scope, $element, $attrs, $ngModelCtrl) {\n      var format = $attrs.dateStrInput || 'yyyy-MM-dd'\n      $ngModelCtrl.$parsers.push(function(val) {\n        return dateFilter(val, format)\n      })\n      $ngModelCtrl.$formatters.push(function(val) {\n        return new Date(val)\n      })\n    }\n  }\n})","/**\n * @ngdoc overview\n * @name  ibosApp.directives\n * @description\n *   通用指令\n */\nangular.module('ibosApp.directives', [])\n\n.directive('copyright', function() {\n  return {\n    restrict: 'E',\n    template: '<p>Copyright © 2009-2017 IBOS 深圳市博思协创网络科技有限公司</p>',\n    replace: true\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:hideTabs\n * @element  ANY\n * @function\n * @restrict A\n *\n * @description\n *  是否隐藏当前面板的 tab 栏\n */\n.directive('hideTabs', function($rootScope, $timeout) {\n  return {\n    restrict: 'A',\n    link: function($scope, $el) {\n      $rootScope.hideTabs = true;\n\n      // $scope.$on('$ionicView.beforeLeave', function() {\n      $scope.$on('$destroy', function() {\n        $rootScope.hideTabs = false;\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:imgPreview\n * @element  ANY\n * @restrict A\n *\n * @description\n *   为编辑器内容里的图片添加预览功能\n *   img-preview 的值用以分组，同一组图片在微信图片查看器内\n *   可通过上下张查看\n *   img-preview-src 用于指定查看大图时的大图地址，没有时默认取 src 的值\n */\n.directive('imgPreview', function(ImgViewer) {\n    var map = Array.prototype.map;\n\n    return {\n      restrict: 'AC',\n      priority: 1,\n      compile: function(element, attr) {\n        return function(scope, $elem, attrs) {\n          var src, srcs;\n          var tagName = $elem[0].tagName.toLowerCase();\n\n          // 如果指令绑定在 img 节点，则处理单个节点\n          // img-preivew\n          if (tagName === 'img') {\n            var groupName = attrs.imgPreview || '';\n\n            $elem.on('click', function() {\n              var src = this.getAttribute('img-preview-src') || this.src;\n              var siblings = document.querySelectorAll('img[img-preview=\"' + groupName + '\"]');\n\n              var srcs = map.call(siblings, function(sibling) {\n                return sibling.getAttribute('img-preview-src') || sibling.src;\n              });\n\n              ImgViewer.view(src, srcs);\n            });\n            // 否则，以该节点下找到的所有 img 为一组\n          } else {\n            element.on('click', function(evt) {\n              if (evt.target.tagName.toUpperCase() === 'IMG') {\n                var imgs = $elem[0].querySelectorAll('img');\n                srcs = map.call(imgs, function(img) {\n                  return img.src;\n                });\n                ImgViewer.view(evt.target.src, srcs);\n              }\n            });\n          }\n        }\n      }\n    }\n  })\n  /**\n   * @ngdoc    directive\n   * @name     ibosApp.directives.directive:letter\n   * @element  ANY\n   * @restrict A\n   * @todo 需要完善，监控 $hasHeader 等变量状态，为节点加上相关的class\n   *  以自适应不同视图下的高度\n   * @description\n   *   生成字母索引工具条\n   * @param  {string}  letter 索引 id 前缀\n   */\n  .directive('letter', function($location, $document, $timeout, $ionicLoading, $ionicScrollDelegate, $ionicLoadingConfig) {\n    var map = Array.prototype.map;\n\n    function createTemplate() {\n      return '#ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map(function(value, key) {\n        return '<a flag=\"' + value + '\">' + value + '</a>';\n      }).join('');\n    }\n\n    return {\n      restrict: 'A',\n\n      template: createTemplate(),\n\n      compile: function(element, attr) {\n        element.addClass(\"letter-bar\");\n\n        return function($scope, $elem, attrs) {\n          var prefix = attrs.letter;\n          var elemTop;\n          var pos = getPos();\n          var timer;\n\n          // 获取所有字母索引的位置\n          function getPos() {\n            return map.call($elem.find('a'), function(anchor) {\n              return {\n                top: anchor.offsetTop,\n                bottom: anchor.offsetTop + anchor.clientHeight,\n                flag: anchor.getAttribute('flag')\n              }\n            });\n          }\n\n          // 根据触摸点与 letterBar 的距离获取此时对应的字母索引\n          function getFlag(offsetTop) {\n            if (offsetTop < pos[0].top) {\n              return pos[0].flag;\n            }\n            if (offsetTop > pos[pos.length - 1].bottom) {\n              return pos[pos.length - 1].flag;\n            }\n\n            for (var i = 0; i < pos.length; i++) {\n              if (pos[i].top <= offsetTop && pos[i].bottom >= offsetTop) {\n                return pos[i].flag;\n              }\n            }\n          }\n\n          // 延时至每 50 ms 执行一次\n          function _mousemove(evt) {\n            $timeout.cancel(timer);\n\n            ionic.off('touchmove', _mousemove, $document[0]);\n\n            var top = (evt.clientY || evt.touches[0].clientY) - elemTop;\n\n            scrollTo(getFlag(top));\n\n            timer = $timeout(function() {\n              ionic.on('touchmove', _mousemove, $document[0]);\n            }, 50);\n\n            evt.stopPropagation();\n            evt.preventDefault();\n          }\n\n          function scrollTo(flag) {\n            var hash;\n            var elem;\n\n            flag = flag || \"\";\n            $ionicLoading.show({\n              noBackdrop: true,\n              template: '<div class=\"letter-text\">' + flag + '</div>'\n            });\n\n            hash = prefix + '_' + flag;\n            // 对应节点存在时且处于显示状态时，才触发定位，否则会引发 anchorScroll 错误\n            elem = document.getElementById(hash);\n            if (elem && elem.style.display !== 'none') {\n              // $anchorScroll(hash);\n              $location.replace().hash(hash);\n              $ionicScrollDelegate.anchorScroll();\n            }\n          }\n\n          var oldIonicLoadingConfig;\n\n          function _mousedown(evt) {\n            var flag = this.getAttribute('flag');\n            oldIonicLoadingConfig = angular.extend({}, $ionicLoadingConfig);\n            elemTop = $elem[0].getBoundingClientRect().top;\n\n            $elem.addClass('active');\n\n            pos = getPos();\n\n            scrollTo(flag);\n\n            ionic.on('touchmove', _mousemove, $document[0]);\n            ionic.on('touchend', _mouseup, $document[0]);\n            ionic.on('touchcancel', _mouseup, $document[0]);\n\n            evt.stopPropagation();\n          }\n\n          function _mouseup() {\n            $timeout.cancel(timer);\n            $elem.removeClass('active');\n            $ionicLoading.hide();\n            // 由于 $ionicLoading.show 方法传入 template 属性会影响到 $ionicLoadingConfig\n            // 所以在 hide 之后，要还原回之前的值\n            $ionicLoadingConfig.template = oldIonicLoadingConfig.template;\n\n            ionic.off('touchmove', _mousemove, $document[0]);\n            ionic.off('touchend', _mousemove, $document[0]);\n            ionic.off('touchcancel', _mousemove, $document[0]);\n          }\n\n          angular.forEach($elem.find('a'), function(elem, index) {\n            ionic.on('touchstart', _mousedown, elem);\n          });\n\n          var parentScope = $scope;\n          $scope.$watch(function() {\n            return (parentScope.$hasHeader ? ' has-header' : '') +\n              (parentScope.$hasSubheader ? ' has-subheader' : '') +\n              (parentScope.$hasFooter ? ' has-footer' : '') +\n              (parentScope.$hasSubfooter ? ' has-subfooter' : '')\n          }, function(className, oldClassName) {\n            element.removeClass(oldClassName);\n            element.addClass(className);\n          });\n        }\n      }\n    };\n  })\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:userSelector\n * @element   INPUT\n * @restrict  E\n * @requires  ngModel\n *\n * @description\n *   人员选择显示区\n * @param     {String}  selectType             选择的数据类型\n * @param     {String}  userInfoFilter         数据过滤，过滤出要在列表项显示的数据\n */\n.directive('userSelector', function($filter, removeFilter, userInfoFilter, departmentInfoFilter, positionInfoFilter) {\n\n  return {\n    restrict: 'E',\n    replace: true,\n    require: 'ngModel',\n    scope: true,\n    // transclude: true,\n    template: '<div>' +\n      '<div class=\"user-selector\">' +\n      '<span ng-repeat=\"val in collection\" ng-click=\"remove(val)\">{{ getName(val) }}</span>' +\n      '</div>' +\n      '<input type=\"hidden\">' +\n      '</div>',\n\n    compile: function(element, attr) {\n      // 过继各种有效属性到内部的 input\n      var input = element.find('input');\n\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange,\n        'required': attr.required\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          input.attr(name, value);\n        }\n      });\n\n      // Link\n      return function($scope, $elem, attrs, $ngModelCtrl) {\n        var selectType = attrs.selectType || 'user';\n\n        $scope.getName = function(val) {\n          if (selectType == 'user') {\n            return userInfoFilter(val, 'realname');\n          } else if (selectType == 'position') {\n            return positionInfoFilter(val, 'posname');\n          } else if (selectType == 'department') {\n            return departmentInfoFilter(val, 'deptname');\n          }\n        };\n\n        $scope.remove = function(val) {\n          console.log('disabledRemove');\n          // 如果初始已经选择了人员,不可删除 传值之间类型转换为\n          if (attrs.disabledRemove === 'true') return\n          var index = $scope.collection.indexOf(val);\n\n          if (index !== -1) {\n            $scope.collection.splice(index, 1);\n            $ngModelCtrl.$setViewValue($scope.collection.join(','));\n          }\n        };\n\n        $ngModelCtrl.$render = function() {\n          if (angular.isString($ngModelCtrl.$viewValue)) {\n            // 过滤空值\n            $scope.collection = removeFilter($ngModelCtrl.$viewValue ? $ngModelCtrl.$viewValue.split(',') : [], '');\n          } else {\n            $scope.collection = [];\n          }\n        };\n      }\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:userSelectorTrigger\n * @element   INPUT\n * @restrict  E\n * @requires  ngModel\n * @description\n *   人员选择控件触发器\n * @param     {string|number}  maxSelection    最大可选数\n * @param     {expression}     enabledUsers     可选 uid 数组或以 ',' 分隔的字符串\n */\n.directive('userSelectorTrigger', function(UserSelector) {\n\n  return {\n    restrict: 'A',\n    require: 'ngModel',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var userSelector;\n\n      function osSelect(selected) {\n        $ngModelCtrl.$setViewValue(selected.join(','));\n        userSelector.hide();\n      }\n\n      function showUserSelector() {\n        var enabled;\n        var options;\n\n        if ($attr.enabledUsers) {\n          enabled = $scope.$eval($attr.enabledUsers);\n          if (angular.isString(enabled)) {\n            enabled = enabled.split(',');\n          }\n        }\n\n        options = {\n          values: $ngModelCtrl.$viewValue ? $ngModelCtrl.$viewValue.split(',') : [],\n        };\n\n        if (userSelector) {\n          userSelector.show(options, osSelect);\n        } else {\n          var createOptions = {};\n          if ($attr.maxSelection) {\n            createOptions.maxSelection = $attr.maxSelection;\n          }\n          if (enabled) {\n            createOptions.enabled = enabled;\n          }\n\n          UserSelector.create(createOptions).then(function(modal) {\n            userSelector = modal;\n            userSelector.show(options, osSelect);\n          });\n        }\n      }\n\n      $element.on('click', showUserSelector);\n\n      $scope.$on('$destroy', function() {\n        userSelector && userSelector.remove();\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:userAvatarSelector\n * @element   INPUT\n * @restrict  E\n * @requires  ngModel\n *\n * @description\n *   选择用户，以头像的方式呈现；\n * @param     {String}  selectType             选择的数据类型\n * @param     {String}  userInfoFilter         数据过滤，过滤出要在列表项显示的数据\n */\n.directive('userAvatarSelector', function($filter, removeFilter, userInfoFilter, departmentInfoFilter, positionInfoFilter) {\n  return {\n    restrict: 'E',\n    //replace: true,\n    require: 'ngModel',\n    scope: {\n      ngModel: '='\n    },\n    // transclude: true,\n    template: '<div class=\"cslist\" ng-click=\"outRemoveMode()\">' +\n      '<li ng-repeat=\"val in collection track by $index\">' +\n      '<i class=\"o40-minus-assertive-so\" ng-show=\"removeMode\" ng-click=\"remove($event, val)\"></i>' +\n      '<img avatar=\"{{ val | userInfo:\\'avatar_middle\\' | fullUrl }}\" alt=\"{{ uid | userInfo:\\'realname\\' }}\"/>' +\n      '<div class=\"cslist-desc ellipsis\">{{ val | userInfo: \\'realname\\'}} </div>' +\n      '</li>' +\n      '<li class=\"cslist-plus\">' +\n      '<div class=\"cslist-plus-icon\">' +\n      '<i class=\"ion-ios-plus-empty\" user-selector-trigger ng-model=\"ngModel\"></i>' +\n      '</div>' +\n      '</li>' +\n      '<li class=\"cslist-plus\" ng-show=\"!removeMode && collection.length\" ng-click=\"toRemoveMode($event)\">' +\n      '<div class=\"cslist-plus-icon\">' +\n      '<i class=\"ion-ios-minus-empty\"></i>' +\n      '</div>' +\n      '</li>' +\n      '</div>',\n\n    compile: function(element, attr) {\n      // 过继各种有效属性到内部的 input\n      var input = element.find('input');\n\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange,\n        'required': attr.required\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          input.attr(name, value);\n        }\n      });\n\n      // Link\n      return function($scope, $elem, attrs, $ngModelCtrl) {\n        var selectType = attrs.selectType || 'user';\n\n        $scope.getName = function(val) {\n          if (selectType == 'user') {\n            return userInfoFilter(val, 'realname');\n          } else if (selectType == 'position') {\n            return positionInfoFilter(val, 'posname');\n          } else if (selectType == 'department') {\n            return departmentInfoFilter(val, 'deptname');\n          }\n        };\n\n        $scope.outRemoveMode = function(evt) {\n          $scope.removeMode = false\n        }\n\n        $scope.removeMode = false;\n        $scope.toRemoveMode = function($event) {\n          $scope.removeMode = true;\n          $event.stopPropagation();\n        };\n\n        $scope.remove = function($event, val) {\n          var index = $scope.collection.indexOf(val);\n          if (index !== -1) {\n            $scope.collection.splice(index, 1);\n            $ngModelCtrl.$setViewValue($scope.collection.join(','));\n          }\n          if (!$scope.collection.length) $scope.removeMode = false;\n          $event.stopPropagation();\n        };\n\n        $ngModelCtrl.$render = function() {\n          if (angular.isString($ngModelCtrl.$viewValue)) {\n            // 过滤空值\n            $scope.collection = removeFilter($ngModelCtrl.$viewValue ? $ngModelCtrl.$viewValue.split(',') : [], '');\n          } else {\n            $scope.collection = [];\n          }\n        };\n      }\n    }\n  };\n})\n\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:charcount\n * @element  ANY\n * @restrict E\n *\n * @description\n *   输入字数统计\n *\n * @param     {Number}   max           字数允许的最大值\n * @param     {Boolean}  countdown     是否倒数\n */\n.directive('charcount', function(Utils) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    replace: true,\n    scope: true,\n    transclude: true, // 允许内嵌内容\n    template: '<span class=\"charcount\"> <em>{{count}}</em> <span ng-transclude></span> </span>',\n    link: function($scope, elem, attrs, $ngModelCtrl) {\n      // 字数允许的最大值\n      var max = isNaN(+attrs.max) ? 0 : +attrs.max;\n      // 是否倒数\n      var countdown = attrs.countdown == 'true';\n      $scope.count = countdown ? max : 0;\n\n      $ngModelCtrl.$render = function() {\n        var valCount = Utils.getCharLength($ngModelCtrl.$viewValue || '');\n        $scope.count = countdown ?\n          max - valCount :\n          valCount;\n        $ngModelCtrl.$setValidity('charcount', valCount <= max);\n      };\n    }\n  }\n})\n\n.directive('ibDownload', function(Downloader) {\n\n  return {\n    restrict: 'A',\n    compile: function($elem) {\n      function prelink($scope, $element, $attrs) {\n        $element.on('click', function() {\n          Downloader.down($attrs.ibDownload);\n        });\n      }\n\n      return {\n        pre: prelink\n      };\n    }\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:datetimeLocal\n * @element   ANY\n * @restrict  E\n * @requires  ngModel\n * @todo\n *   text 类型时，做格式验证，并同步到 ng-valid 状态\n * @description\n *   对于不支持 datetime-local 类型表单控件的浏览器，使用 text 代替\n */\n.directive('datetimeLocal', function(Utils) {\n  return {\n    restrict: 'E',\n    replace: true,\n    require: 'ngModel',\n    template: function() {\n      return Utils.isDateTimeLocalSupport ? '<input type=\"datetime-local\" />' : '<input type=\"text\" />';\n    },\n    compile: function(element, attr) {\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange,\n        'required': attr.required,\n        'placeholder': attr.placeholder\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          element.attr(name, value);\n        }\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:fileOnChange\n * @element   INPUT\n * @restrict  A\n * @description\n *   input[type=\"file\"] 发生变化时触发相应回调\n *\n * @param     {expression}  fileOnChange  回调函数\n */\n.directive('fileOnChange', function() {\n  return {\n    restrict: 'A',\n    link: function(scope, element, attrs) {\n      element.bind('change', function() {\n        var onChangeFunc = scope.$eval(attrs.fileOnChange);\n        onChangeFunc.apply(element, arguments);\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:fileImageData\n * @element   INPUT\n * @restrict  A\n * @todo      迁移至 file-util 模块\n * @description\n *   input[type=\"file\"] 发生变化时，将选择的文件以 dataURL 的形式赋值到指定变量\n *\n * @param     {String}   fileImageData         用于保存 dataURL 的属性\n * @param     {Number}   fileImageMaxlength    最多允许选择的文件数\n */\n.directive('fileImageData', function($parse, Utils) {\n  var reg = /image\\/(jpg|jpeg|png|bmp|gif)/;\n\n  function testFileType(file) {\n    if (!reg.test(file.type)) {\n      alert('“' + file.name + '” 为不支持的文件格式 ' + file.type);\n      return false;\n    }\n    return true;\n  }\n\n  return {\n    restrict: 'A',\n    link: function(scope, element, attrs) {\n      var key = attrs.fileImageData;\n      var maxLength = attrs.fileImageMaxlength;\n\n      element.on('change', function($event) {\n        var files = $event.target.files;\n        var file;\n        if (!files.length) {\n          return;\n        }\n\n        // 单选时\n        if (!maxLength) {\n          file = files[0];\n\n          if (!testFileType(file)) return;\n\n          Utils.getImagePreviewUrl(file, function(url) {\n              scope.$eval(key + ' = \"' + url + '\"');\n              scope.$apply(key);\n            })\n            // 多选时，绑定模型必须为数组，否则报错\n        } else {\n          var images = $parse(key)(scope);\n\n          if (!angular.isArray(images)) {\n            console.error(key + ' 不是一个数组！');\n            return;\n          }\n\n          var currentLength = images.length;\n\n          for (var i = 0; i < files.length; i++) {\n            file = files[i];\n            if (!testFileType(file)) continue;\n            // 判断最大选择数\n            if (maxLength && currentLength >= maxLength) {\n              alert('已达到最大选择数 ' + maxLength);\n              break;\n            }\n            currentLength++;\n            Utils.getImagePreviewUrl(file, function(url) {\n              images.push(url);\n              scope.$apply(key);\n            });\n          }\n        }\n      });\n    }\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:stopPropagation\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  阻止指定节点上的指定事件冒泡\n *  stop-propagation=\"click,touch,tap\"\n * @param    {String}   stopPropagation   以事件名组成的字符串，用“,”分隔\n */\n.directive('stopPropagation', function() {\n  function _stopPropagation(evt) {\n    evt.stopPropagation();\n  }\n\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attrs) {\n      var eventList = $attrs.stopPropagation;\n      angular.forEach(eventList.split(','), function(eventName) {\n        $element.on(eventName, _stopPropagation);\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:focusOn\n * @element   input|textarea|select|element[contenteditable]\n * @restrict  A\n *\n * @description\n *  自动焦点到表单控件上\n *\n * @param     {expression}   focusOn    当此值为 true 时，表单控件将获得焦点\n */\n.directive('focusOn', function($timeout) {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attr) {\n      $scope.$watch($attr.focusOn, function(shouldFocus) {\n        $timeout(function() {\n          if(shouldFocus) {\n            $element[0].focus()\n          }\n        }, $scope.$eval($attr.focusDelay) || 0);\n      });\n    }\n  };\n})\n\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:avatar\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  头像，一开始设置为默认头像，读取真实头像成功后再替换\n *\n * @param    {string}   avatar                真实头像地址\n * @param    {string}   avatar-default-size   默认头像尺寸\n * @param    {string}   avatar-default-url    默认头像地址\n */\n.directive('avatar', function() {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attr) {\n      // 默认头像尺寸\n      var size = ['big', 'middle', 'small'].indexOf($attr.avatarDefaultSize) !== -1 ? $attr.avatarDefaultSize : 'middle';\n      // 默认图像地址，有设置此值时，不使用默认头像\n      var defaultUrl = $attr.avatarDefaultUrl || './img/noavatar_' + size + '.png';\n\n      if ($element[0].tagName.toLowerCase() === 'img') {\n        $scope.$watch(function() {\n          return $attr.avatar;\n        }, function(url) {\n          $element.attr('src', defaultUrl);\n          if (url) {\n            angular.element('<img />').on('load', function() {\n                $element.attr('src', url);\n              })\n              .attr('src', url);\n          }\n        });\n      }\n    }\n  };\n})\n\n.directive('attachList', function(fullUrlFilter, Downloader) {\n  return {\n    retrict: 'E',\n    templateUrl: 'templates/attach.html',\n    replace: true,\n    scope: {\n      'attach': '='\n    },\n    link: function($scope, $element, $attr) {\n      $scope.download = function(att) {\n        Downloader.down(fullUrlFilter(att.entireattachurl || att.officereadurl));\n      };\n    }\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:transheader\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  设置头部条为透明，并随着滚动位置变换颜色\n *\n */\n.directive('transheader', function($ionicScrollDelegate) {\n\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attrs) {\n      var $ionContent = $element.find('ion-content');\n\n      function toggleHeaderClass(status) {\n        angular.forEach(document.querySelectorAll('ion-header-bar'), function(elem) {\n          angular.element(elem).toggleClass('trans-header', status);\n        });\n      }\n\n      function onScroll(evt) {\n        toggleHeaderClass(evt.detail.scrollTop <= 0);\n      }\n\n      $scope.$on('$ionicView.enter', function() {\n        toggleHeaderClass($ionicScrollDelegate.getScrollPosition().top <= 0);\n        $ionContent.on('scroll', onScroll);\n      });\n\n      $scope.$on('$ionicView.leave', function() {\n        toggleHeaderClass(false);\n        $ionContent.off('scroll', onScroll);\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:backState\n * @element   ANY\n * @restrict  A\n *\n * @description\n *  当没有历史时设置默认返回按钮\n *  `method:goBack()`    触发返回\n *  `method:getTitle()`  获取默认文本\n *\n */\n.directive('defaultNavBackButton', function($ionicHistory, $ionicConfig, $ionicPlatform, DefaultBack) {\n\n  return {\n    link: link,\n    restrict: 'EA'\n  };\n\n  function link(scope, element, attrs) {\n\n    scope.backTitle = function() {\n      var defaultBack = DefaultBack.get();\n      if ($ionicConfig.backButton.previousTitleText() && defaultBack) {\n        return $ionicHistory.backTitle() || defaultBack.title;\n      }\n    };\n\n    scope.goBack = DefaultBack.goBack;\n\n    scope.$on('$stateChangeSuccess', function() {\n      element.toggleClass('hide', !DefaultBack.get());\n    });\n\n    // $ionicPlatform.registerBackButtonAction(function() {\n    //   if ($ionicHistory.backView()) {\n    //     $ionicHistory.goBack();\n    //   } else if (DefaultBack.get()) {\n    //     goDefaultBack();\n    //   } else {\n    //     navigator.app.exitApp();\n    //   }\n    // }, 100);\n\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     ibosApp.directives.directive:clickInput\n * @element  DIV\n * @function\n * @restrict A\n * @description\n * 给input节点添加点击事件\n */\n.directive('clickInput', function() {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $arr) {\n      $element.on('click', function(e) {\n        var nodeName = e.target.nodeName.toLocaleLowerCase();\n        // if (nodeName !== 'div' && nodeName === 'i') {\n        //   e.target.parentNode.querySelector('input').click();\n        // } else {\n        //   e.target.parentNode.querySelector('input').click();\n        // }\n        e.target.parentNode.querySelector('input').click();\n      });\n    }\n  };\n})\n","/**\n * @ngdoc overview\n * @name  ibosApp.filters\n * @description\n *   通用过滤器\n */\n;(function() {\n\nvar appFilter = angular.module('ibosApp.filters', [])\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:htmlToPlaintext\n * @function\n * @description\n *  清理内容中包含的 html 标签\n *\n * @param   {string}  text 源文本内容\n * @returns {string}  清理后的内容\n */\n.filter('htmlToPlaintext', function() {\n  return function(text) {\n        return text ? String(text).replace(/<[^>]+>/gm, '') : '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:fileSize\n * @function\n * @description\n *  将文件大小转化成带单位的更易阅读的格式\n * @param   {number}  size 文件大小\n * @param   {number=} digit 保留的小数位数\n * @returns {string}  带单位的文件大小\n */\n.filter('fileSize', function() {\n\n  var unit = ['B', 'KB', 'MB', 'GB'];\n\n  return function(size, digit){\n    size = +size || 0;\n    digit = digit == null ?  2 : digit;\n    \n    var pow = 1;\n\n    while(size > 1024){\n      size = size / 1024;\n      pow++;\n    }\n\n    return digit ? \n      size.toFixed(digit) + unit[pow - 1] :\n      size + unit[pow - 1]\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:filetypeIcon\n * @function\n * @description\n *  根据服务器端返回的文件类型图标路径解析出在 app 中的图标路径\n *\n * @param   {string}  source 服务器端文件类型图标\n * @returns {string}  文件类型图标路径\n */\n.filter('filetypeIcon', function() {\n  return function(source, size){\n\n    if(!source) return '';\n\n    var start = source.lastIndexOf('/');\n    var end = source.lastIndexOf('.');\n\n    if(start !== -1){\n      source = source.substring(start + 1, end);\n    }\n\n    if(size) {\n      source += '_' + size;\n    }\n\n    return 'img/filetype/' + source + '.png';\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:fileIconByExtname\n * @function\n * @description\n *   根据后缀名获取对应图标地址\n *\n * @param   {string}  extname  后缀名\n * @param   {string}  size     尺寸\n * @returns {string}  文件类型图标路径\n */\n.filter('fileIconByExtname', function(FileUtils) {\n  return FileUtils.getFileIconByExtname;\n})\n\n.filter('fileIconByFilename', function(fileIconByExtnameFilter) {\n  return function(filename, size) {\n    if(typeof filename === 'string') {\n      return fileIconByExtnameFilter(filename.split('.').pop(), size)\n    }\n    return ''\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:fullUrl\n * @function\n * @description\n *   由于部分后端输出的文件路径是相对服务器的\n *   此 filter 用于将其拼接为完整路径\n *\n * @param   {string}  source 原文件路径\n * @returns {string}  完整路径\n */\n.filter('fullUrl', function(Settings) {\n  var httpReg = /^https?:\\/\\//;\n  return function(source) {\n    source = source || '';\n    if(httpReg.test(source)) {\n      return source\n    }\n    return Settings.hostUrl + source;\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:editorContent\n * @function\n * @description\n *   编辑器文本，可能包括图片等资源地址，此处需要对这些地址做处理以指向正确资源\n *\n * @returns {string}  编辑器文本\n */\n.filter('editorContent', function($filter) {\n  return function(source) {\n    if(!source) return source;\n\n    var reg = /src\\s*=\\s*['\"]\\/?((data|static).*?)['\"]/g;\n    return source.replace(reg, function(a, b) {\n      return 'src=\"' + $filter('fullUrl')(b) + '\"';\n    });\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:avatar\n * @function\n * @description\n *   根据 uid 从 User[service] 里获取头像\n *\n * @param   {string} uid   用于标识用户的唯一id\n * @param   {string} size  头像的尺寸，有大中小三种尺寸\n * @returns {string} 头像地址\n */\n.filter('avatar', function($filter, User) {\n  return function(uid, size) {\n    size = size || 'middle';\n\n    return uid && User.users[uid] ?\n      $filter('fullUrl')(User.users[uid]['avatar_' + size]) :\n      'img/noavatar_' + size + '.png';\n  }\n})\n\n/**\n * @ngdoc filter\n *  @name ibosApp.filters.filter:userInfo\n * @function\n * @description\n *   根据 uid 获取用户某项信息\n *\n * @param   {string} uid   用于标识用户的唯一id; 格式为 '1,2,3,4...'\n * @param   {string} prop  需要获取的属性\n * @returns {string} 属性值\n */\n.filter('userInfo', function(User) {\n  return createGetProp(User.users);\n})\n\n.filter('removeUserPrefix', function(User) {\n  return function(uids) {\n    return User.removePrefix(uids);\n  };\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:positionInfo\n * @function\n * @description\n *   根据 pid 获取岗位某项信息\n *\n * @param   {string} pid   用于标识岗位的唯一id; 格式为 '1,2,3,4...'\n * @param   {string} prop  需要获取的属性\n * @returns {string} 属性值\n */\n.filter('positionInfo', function(User) {\n  return createGetProp(User.positionData.datas);\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:departmentInfo\n * @function\n * @description\n *   根据 did 获取部门某项信息\n *\n * @param   {string} did   用于标识部门的唯一id; 格式为 '1,2,3,4...'\n * @param   {string} prop  需要获取的属性\n * @returns {string} 属性值\n */\n.filter('departmentInfo', function(User) {\n  return createGetProp(User.departmentData.datas);\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:asHtml\n * @function\n * @description\n *   作为安全的html显示\n *   angular会自动将不安全的 html 过滤，此 filter 用于保留所有 html 内容\n *   \n * @param   {string}       html  源 html\n * @returns {object}       生成 sce 对象\n */\n.filter('asHtml', function($sce) {\n  return function(html){\n    return $sce.trustAsHtml(html);\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:httpPrefix\n * @function\n * @description\n *   补全网址的 http:// 前缀\n *   \n * @param   {string}       str  网址\n * @returns {string}       补全后的网址\n */\n.filter('httpPrefix', function() {\n  return function(str) {\n    if(!str) return '';\n    if(/^https?:\\/\\//i.test(str)) {\n      return str;\n    } else {\n      return 'http://' + str;\n    }\n  };\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:defaultAvatar\n * @function\n * @description\n *   没有头像时获取默认头像\n *     \n * @param   {string}       src    头像地址\n * @param   {string}       size   默认头像尺寸 small, middle, big\n * @returns {string}       最终应显示的头像\n */\n.filter('defaultAvatar', function() {\n  return function(src, size) {\n    size = size || 'middle';\n    return src ? src : 'img/noavatar_' + size + '.png';\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:attachUrl\n * @function\n * @description\n *   附件真实地址\n *     \n * @param   {string}       url    原始地址\n * @returns {string}       预览地址\n */\n.filter('attachUrl', function(Settings) {\n  return function(url) {\n    // @Todo: 此处希望后端统一一下数据格式 \n    return url.indexOf('data/attachment/') === 0 ? Settings.hostUrl + url : url;\n  }\n})\n\n/**\n * @ngdoc filter\n * @name ibosApp.filters.filter:currencyToNumber\n * @function\n * @description\n *   将货币格式的字符串转为数字\n *   主要作用是去除千分号\n * @param   {string}       currency    货币\n * @returns {number}       数字\n */\n.filter('currencyToNumber', function() {\n  function currencyToNumber(currency) {\n    var ret = Number(currency)\n\n    if(isNaN(ret)) {\n      if(typeof currency === 'string') {\n        return currencyToNumber(currency.replace(/,/g, ''))\n      }\n      return 0\n    }\n\n    return ret\n  }\n\n  return currencyToNumber  \n})\n\nfunction createGetProp(data) {\n  return function(id, prop) {\n    if(id == null) {\n      return '';\n    }\n    // 转为字符串\n    id = id + '';\n\n    var idArr = id.split(',');\n\n    if(idArr.length > 1) {\n      \n      return idArr.map(function(i) {\n        return data[i] ? (prop ? data[i][prop] : data[i]) : '';\n      }).join(',');\n\n    } else {\n      return data[id] ? (prop ? data[id][prop] : data[id]) : '';\n    }\n  }\n}\n\n})();\n","/**\n * @ngdoc overview\n * @name  ibosApp.services\n * @description\n *   通用服务\n */\n\nangular.module('ibosApp.services', [])\n\n.constant('REGEXP_ENUM', {\n  notempty: '\\\\S+', //非空\n  chinese: '^[\\\\u4E00-\\\\u9FA5\\\\uF900-\\\\uFA2D]+$', //仅中文\n  letter: '^[A-Za-z]+$', //字母\n  num: '^([+-]?)\\\\d*\\\\.?\\\\d+$', //数字\n  idcard: '^[1-9]([0-9]{14}|[0-9]{17})$', //身份证\n  mobile: '^1\\\\d{10}$', //手机\n  money: '^(-)?(([1-9]{1}\\d*)|([0]{1}))(\\.(\\d){1,2})?$', //精确到小数点两位的金额格式\n  tel: '^(([0\\\\+]\\\\d{2,3}-)?(0\\\\d{2,3})-)?(\\\\d{7,8})(-(\\\\d{3,}))?$', //电话号码的函数(包括验证国内区号,国际区号,分机号)\n  zipcode: '^\\\\d{6}$', //邮编\n  email: '^\\\\w+((-\\\\w+)|(\\\\.\\\\w+))*\\\\@[A-Za-z0-9]+((\\\\.|-)[A-Za-z0-9]+)*\\\\.[A-Za-z0-9]+$', //邮件\n})\n\n.constant('API_SERVER', 'https://api.ibos.cn/v1')\n\n.provider('Resolvers', function() {\n\n  var resolvers = {\n    qqmap: ['$ocLazyLoad', function($ocLazyLoad) {\n      return $ocLazyLoad.load('components/qqmap/qqmap.js')\n    }],\n\n    canvasPainter: ['$ocLazyLoad', function($ocLazyLoad) {\n      return $ocLazyLoad.load('components/angular-canvas-painter/angular-canvas-painter.min.js')\n    }],\n  }\n\n  return {\n    get: function(nameArr) {\n      var ret = {}\n      if(nameArr && nameArr.length) {\n        angular.forEach(nameArr, function(name) {\n          ret[name] = resolvers[name]\n        })\n      }\n      return ret\n    },\n\n    $get: function() {\n      return {}\n    }\n  }\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Settings\n * @todo 企业令牌放在此服务不合适\n *\n * @property {String}  appName    程序名\n * @property {String}  corptoken  企业令牌\n * @property {String}  hostUrl    服务器 URL\n * @property {String}  rootUrl    接口基本 URL\n * @property {String}  mainState  初始状态state\n *\n * @description\n *   程序基础设置\n */\n.factory('Settings', function($location, $window, $ionicPopup, Utils) {\n  var appName = '微办公';\n  var searchParams = Utils.parseSearch($window.location.search);\n\n  function getOrigin() {\n    var result = $window.location.href.match(/(^.*\\/)mobile/);\n    return result ? result[1] : '';\n  }\n\n  var hostUrl = searchParams && searchParams.host ?\n    searchParams.host.replace(/\\/*$/, '/') :\n    getOrigin();\n\n  var rootUrl = hostUrl + '?r=mobile';\n\n  var corptoken = window.corptoken ? window.corptoken :\n    ($location.search().corptoken ?\n      $location.search().corptoken :\n      searchParams && searchParams.corptoken || '');\n\n  var mainState = 'portal';\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.Settings#requestError\n   * @methodOf  ibosApp.services.Settings\n   * @description\n   *    jsonp 出现错误弹出提示消息，由于 $ionicPopup 是一个promise\n   *    可以使用相关功能进行后续处理\n   *    参数是一个 HttpPromise 的返回结果\n   *\n   * @returns   {Promise}    Promise\n   */\n  function requestError(data, status, headers, config) {\n    data = data || {};\n    config = config || {};\n\n    var errorMsg = (status == 0 && data == null) ? 'CORS 跨域请求失败，请参考 <a href=\"http://doc.ibos.com.cn/article/detail/id/268\">http://doc.ibos.com.cn/article/detail/id/268</a> 配置服务器' : (typeof data == 'string' ? data : angular.toJson(data))\n\n    return $ionicPopup.alert({\n      title: '服务器连接失败',\n      template: '<strong>url</strong>: ' + config.url +\n        '<br> <strong>status</strong>: ' + status +\n        '<br> <strong>msg</strong>: ' + errorMsg\n    });\n  }\n\n  return {\n    appName: appName,\n    corptoken: corptoken,\n    hostUrl: hostUrl,\n    rootUrl: rootUrl,\n    mainState: mainState,\n    requestError: requestError\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Utils\n * @description\n *   一些工具函数\n */\n.factory('Utils', function($http, $q, $window, $timeout, $state, $ionicHistory, $ionicScrollDelegate, $ionicViewSwitcher, IbPopup) {\n  function isFile(obj) {\n    return toString.call(obj) === '[object File]';\n  }\n\n  function isBlob(obj) {\n    return toString.call(obj) === '[object Blob]';\n  }\n\n  var ret = {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#isFormTypeSupported\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    表单支持类型检测\n     * @param   {String}    type   表单控件类型\n     * @returns {Boolean}   支持情况\n     */\n    isFormTypeSupported: function(type) {\n      var elem = document.createElement(\"input\");\n      elem.setAttribute(\"type\", type);\n      return elem.type == type;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#parseSearch\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    将url查询参数解析成对象\n     *\n     * @param   {String}   search   url查询参数\n     * @returns {Object}   参数对象\n     */\n    parseSearch: function(search) {\n      search = decodeURIComponent(search).replace(/^\\?/, '');\n      var searchField = search.split('&');\n      var ret = {};\n\n      for (var i = 0; i < searchField.length; i++) {\n        var kt = searchField[i].split('=');\n        ret[kt[0]] = kt[1]\n      }\n\n      return ret;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#capitalize\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    把字符串转化首字母大写\n     *\n     * @param   {String} str  要操作的字符串\n     * @returns {String}      首字母大写的字符串\n     */\n    capitalize: function(str) {\n      str = str == null ? '' : String(str);\n      return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#commasInclude\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    判断格式如“1,2,3,4”的字符串中，是否包含某个值\n     *\n     * @param   {String} str  以“,”分隔的字符串\n     * @param   {String} key  要检查的值\n     * @returns {Boolean}     是否包含\n     */\n    commasInclude: function(str, key) {\n      return str.split(',').indexOf(key) !== -1;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#pick\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    从对象中获取需要的属性组合成新对象\n     *\n     * @param   {Object}   obj    源对象\n     * @param   {Array}    keys   属性名数组\n     *\n     * @returns {Object}   由指定属性组成的新对象\n     */\n    pick: function(obj, keys) {\n      var ret = {};\n      if (!obj || !keys) {\n        return obj;\n      } else {\n        angular.forEach(keys, function(key) {\n          if (obj.hasOwnProperty(key)) {\n            ret[key] = obj[key];\n          }\n        });\n      }\n      return ret;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#eliminate\n     * @methodOf  ibosApp.services.Utils\n     * @todo      支持剔除多个相同值\n     * @description\n     *    从数组中剔除指定元素，此方法直接操作源数组，且只会剔除查找到的第一个值\n     *\n     * @param   {Array}     arr    要操作的数组\n     * @param   {*}         item    要剔除的值\n     * @returns {Number}    被剔除值的索引\n     */\n    eliminate: function(arr, item) {\n      var index = arr.indexOf(item);\n      if (index !== -1) {\n        arr.splice(index, 1);\n      }\n      return index;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#toggle\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    数组里有目标项时，剔除该项，没有则增加\n     *\n     * @param   {Array}     arr    要操作的数组\n     * @param   {*}         item   目标项\n     * @returns {Array}     源数组\n     */\n    toggle: function(arr, item) {\n      var idx = arr.indexOf(item);\n\n      if (idx > -1) {\n        arr.splice(idx, 1);\n      } else {\n        arr.push(item);\n      }\n\n      return arr;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#concatTo\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    合并目标数组到源数组，这里会直接修改源数组\n     *\n     * @param   {Array}     arr1    源数组\n     * @param   {Array}     arr2    目标数组\n     * @param   {Boolean}   unique  是否不添加源数组中已有的元素\n     * @returns {Array}     源数组\n     */\n    concatTo: function(arr1, arr2, unique) {\n      angular.forEach(arr2, function(val) {\n        if (unique && arr1.indexOf(val) !== -1) {\n          return;\n        }\n        arr1.push(val);\n      });\n      return arr1;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#removeFrom\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    剔除目标数组与源数组相同的元素，这里会直接修改源数组\n     *\n     * @param   {Array}     arr1    源数组\n     * @param   {Array}     arr2    目标数组\n     * @returns {Array}     源数组\n     */\n    removeFrom: function(arr1, arr2) {\n      angular.forEach(arr2, function(val) {\n        var idx = arr1.indexOf(val);\n        if (idx !== -1) {\n          arr1.splice(idx, 1);\n        }\n      });\n      return arr1;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#promptNoPermission\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    提示无权限使用模块并返回门户页\n     */\n    promptNoPermission: function() {\n      IbPopup.alert({\n        title: \"权限错误,请检查您有无相应的权限进行操作\"\n      }).then(function() {\n        $ionicViewSwitcher.nextDirection('back')\n        $state.go('portal')\n      })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#containsArray\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    判断源数组是否包含目标数组\n     *\n     * @param   {Array}     arr1    源数组\n     * @param   {Array}     arr2    目标数组\n     * @returns {Boolean}   源数组是否包含目标数组\n     */\n    containsArray: function(arr1, arr2) {\n      for (var i = 0; i < arr2.length; i++) {\n        if (arr1.indexOf(arr2[i]) === -1) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#getCharLength\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    获取字符串长度\n     *    计算方式为字母长度为0.5，中文长度为1，对url会做特殊处理\n     *\n     * @param   {String}   str   要计算长度的字符串\n     * @returns {Number}         长度\n     */\n    getCharLength: (function() {\n      var byteLength = function(str) {\n        if (typeof str == \"undefined\") {\n          return 0\n        }\n\n        var sChar = str.match(/[^\\x00-\\x80]/g);\n        // 匹配出中文字符的数目并再次加上，这样子每个中文字符占位为2\n        return (str.length + (!sChar ? 0 : sChar.length))\n      };\n\n      return function(str, opt) {\n        opt = opt || {};\n        opt.max = opt.max || 140;\n        // opt.min = opt.min || 41;\n        opt.surl = opt.surl || 20;\n        var p = str.trim().length;\n        if (p > 0) {\n          // 下面这段正则用于匹配URL\n          var result = str.match(/(http|https):\\/\\/[a-zA-Z0-9]+(\\.[a-zA-Z0-9]+)+([-A-Z0-9a-z\\$\\.\\+\\!\\_\\*\\(\\)\\/\\,\\:;@&=\\?~#%]*)*/gi) || [];\n          var total = 0;\n          for (var m = 0,\n              len = result.length; m < len; m++) {\n            var o = byteLength(result[m]);\n\n            total += o <= opt.max ? opt.surl : (o - opt.max + opt.surl)\n\n            str = str.replace(result[m], \"\")\n          }\n          return Math.ceil((total + byteLength(str)) / 2)\n        } else {\n          return 0\n        }\n      }\n    })(),\n\n    serverWarning: function(res) {\n    },\n\n    serverError: function(res) {\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#postJsonData\n     * @methodOf  ibosApp.services.Utils\n     * @todo：(ノ=Д=)ノ┻━┻  现在又说要改回默认用 json\n     * @description\n     *    使用 json 格式提交表单\n     *\n     *    本来 angular 默认是使用 json 格式提交数据的\n     *    但由于之前后端规范使用了 FormData，所以默认修改成了 json 格式\n     *    此方法用于临时需要使用 json 格式的情形\n     *\n     * @param     {String}    url         要提交的地址\n     * @param     {Object}    data        要提交的数据\n     * @param     {Object}    httpConf    ajax配置\n     * @returns   {Promise}   Promise\n     */\n    postJsonData: function(url, data, httpConf) {\n      return $http(angular.extend({\n        method: 'POST',\n        url: url,\n        // headers: { 'Content-Type': undefined },\n        headers: {\n          'Content-type': 'application/json'\n        },\n        data: data,\n        transformRequest: [function(d) {\n          return angular.isObject(d) && !isFile(d) && !isBlob(d) ? angular.toJson(d) : d;\n        }]\n      }, httpConf));\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#postFormData\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     * 提交 FormData 类型的数据\n     *\n     * @param     {String}    url         提交地址\n     * @param     {FormData}  formData    FormData 类型的数据\n     * @returns   {Promise}   Promise\n     */\n    postFormData: function(url, formData, config) {\n      // 此处由于使用了 FormData 对象提交，需要配置 header 跟 transformRequest 方法\n      return $http(angular.extend({\n        method: 'POST',\n        url: url,\n        headers: {\n          'Content-Type': undefined\n        },\n        data: formData,\n        transformRequest: angular.identity\n      }, config));\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#getImagePreviewUrl\n     * @methodOf  ibosApp.services.Utils\n     * @todo      迁移至 file-util 模块\n     * @description\n     * 获取图片预览地址，先尝试创建 Blob 地址，没有时使用 fileReader\n     *\n     * @param     {File|Blob}      file       File 对象或 Blob 对象\n     * @param     {Function}       callback   回调函数\n     * @returns   {FileReader}     FileReader 对象\n     */\n    getImagePreviewUrl: function(file, callback) {\n      if (!angular.isFunction(callback)) return;\n      if ($window.URL) {\n        callback($window.URL.createObjectURL(file));\n      } else if ($window.webkitURL) {\n        callback($window.webkitURL.createObjectURL(file));\n      } else {\n        this.readFile(file, function(evt) {\n          callback(evt.target.result);\n        })\n      }\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#setDocumentTitle\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *   设置文档标题\n     *   微信下 iOS 的 document title 在页面加载完成后再设置不起效\n     *   于是有了这个 hack 方法\n     *\n     * @param     {String}    title    文档标题\n     */\n    setDocumentTitle: function(title) {\n      document.title = title;\n\n      if (ionic.Platform.isIOS()) {\n        var $iframe = angular.element('<iframe src=\"/favicon.ico\" style=\"display: none;\"></iframe>').on('load', function() {\n          setTimeout(function() {\n            $iframe.off('load').remove();\n          }, 0);\n        });\n        angular.element(document.body).append($iframe);\n      }\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#httpPromise\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *   angular 的 http 请求继承于 $q.defer，但比普通的defer.promise 多了success和error方法\n     *     此方法将普通的 defer.promise 封装类似 http 返回的 promise\n     *\n     * @param     {Promise}      promise    promise对象\n     * @returns   {HttpPromise}  HttpPromise\n     */\n    httpPromise: function(promise) {\n      promise.success = function(fn) {\n        promise.then(fn);\n        return promise;\n      };\n\n      promise.error = function(fn) {\n        promise.then(null, fn);\n        return promise;\n      };\n      return promise;\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#disableBack\n     * @methodOf  ibosApp.services.Utils\n     * @deprecated\n     * @description\n     *   禁止下一个视图的后退功能（即不允许下一个视图返回当前这个视图）\n     *\n     * @param     {Object}   options   视图选项\n     */\n    disableBack: function(options) {\n      return $ionicHistory.nextViewOptions(angular.extend({\n        disableBack: true\n      }, options));\n    },\n\n    triggerScrollViewPullToRefresh: function(scrollView) {\n      $timeout(function() {\n        scrollView.__publish(\n          scrollView.__scrollLeft, -scrollView.__refreshHeight,\n          scrollView.__zoomLevel, true);\n\n        var d = new Date();\n\n        scrollView.refreshStartTime = d.getTime();\n\n        scrollView.__refreshActive = true;\n        scrollView.__refreshHidden = false;\n        if (scrollView.__refreshShow) {\n          scrollView.__refreshShow();\n        }\n        if (scrollView.__refreshActivate) {\n          scrollView.__refreshActivate();\n        }\n        if (scrollView.__refreshStart) {\n          scrollView.__refreshStart();\n        }\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#triggerScrollViewPullToRefreshByHandle\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    手动触发面板的下拉刷新功能\n     *\n     * @param     {String}      delegateHandle    指定某个具体的滚动对象\n     */\n    triggerScrollViewPullToRefreshByHandle: function(delegateHandle) {\n      var scrollView = $ionicScrollDelegate.$getByHandle(delegateHandle).getScrollView();\n      if (!scrollView) return;\n      this.triggerScrollViewPullToRefresh(scrollView);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#clearStateCacheAndGo\n     * @methodOf  ibosApp.services.Utils\n     * @description\n     *    清除指定 state 的缓存及跳转至该 state\n     *\n     * @param     {String}      state    页面 state\n     * @returns   {Promise}     Promise\n     */\n    clearStateCacheAndGo: function(state) {\n      return $ionicHistory.clearCache([state]).then(function() {\n        $state.go(state);\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.Utils#checkFormDirtyBeforeLeave\n     * @methodOf  ibosApp.services.Utils\n     * @param     {Object} $scope       Scope\n     * @param     {String} formCtrlKey  表单控制器字段\n     * @param     {String} tip          提示文本\n     */\n    checkFormDirtyBeforeLeave: function($scope, formCtrlKey, tip) {\n      var off\n      tip = tip || '还有未保留的修改，是否确定离开'\n      off = $scope.$on('$stateChangeStart', function(e, to, toParams) {\n        var formCtrl = $scope[formCtrlKey]\n\n        // 表单发生了修改时\n        if(formCtrl && formCtrl.$dirty) {\n          e.preventDefault()\n          // 后退时历史记录会少一，这里加一个以保持历史纪录正确\n          $window.history.pushState(null, '', $window.location.href)\n    \n          IbPopup.confirm({\n            title: '提示',\n            content: tip\n          })\n          .then(function(res) {\n            if(res) {\n              off()\n              $window.history.back()\n            }\n          })\n        }\n      })\n    }\n  };\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.Utils#isDateTimeLocalSupport\n   * @methodOf  ibosApp.services.Utils\n   * @description\n   *    是否支持 input[type=\"datetime\"]\n   *\n   * @returns {boolean}   支持情况\n   */\n  ret.isDateTimeLocalSupport = ret.isFormTypeSupported('datetime-local');\n\n  return ret;\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.$localstorage\n * @description\n *   本地储存操作\n */\n.factory('$localstorage', ['$window', function($window) {\n  if ($window.localStorage) {\n    return {\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#set\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    写入本地存储，针对基本类型\n       *\n       * @param   {String}    key      键名\n       * @param   {*}         value    键值\n       */\n      set: function(key, value) {\n        $window.localStorage.setItem(key, value);\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#get\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    获取指定本地存储\n       *\n       * @param   {String}    key            键名\n       * @param   {*}         defaultValue   无结果时的默认值\n       * @returns {*}         对应键名的值\n       */\n      get: function(key, defaultValue) {\n        return $window.localStorage.getItem(key) || defaultValue;\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#remove\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    删除指定本地存储\n       *\n       * @param   {String}    key            键名\n       */\n      remove: function(key) {\n        $window.localStorage.removeItem(key);\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#setObject\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    写入本地存储，针对引入类型，会先转为JSON\n       *\n       * @param   {String}    key      键名\n       * @param   {*}         value    键值\n       */\n      setObject: function(key, value) {\n        $window.localStorage.setItem(key, JSON.stringify(value));\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.$localstorage#getObject\n       * @methodOf  ibosApp.services.$localstorage\n       * @description\n       *    获取指定本地存储，针对引入类型，获取后会从 JSON 转为对象\n       *\n       * @param   {String}    key      键名\n       * @returns {*}         经过JSON解析的对应键名的值\n       */\n      getObject: function(key) {\n        return JSON.parse($window.localStorage.getItem(key));\n      }\n    };\n  } else {\n    return {\n      set: angular.noop,\n      get: function(key, defaultValue) {\n        return defaultValue;\n      },\n      remove: angular.noop,\n      setObject: angular.noop,\n      getObject: angular.noop\n    };\n  }\n}])\n\n/**\n * @ngdoc service\n * @name ibosApp.services.TalkingData\n * @description\n *   TalkingData 统计\n */\n.factory('TalkingData', function(User, Settings) {\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.TalkingData#onEvent\n     * @methodOf  ibosApp.services.TalkingData\n     * @description\n     *   触发统计事件\n     *\n     * @param     {String}  evtId     事件标识\n     * @returns   {String}  [label]   标签\n     * @returns   {Object}  [mapKv]   其他参数\n     */\n    onEvent: function(evtId, label, mapKv) {\n      if (typeof TDAPP !== 'undefined') {\n\n        mapKv = angular.extend({}, mapKv, {\n          uid: User.uid,\n          hostUrl: Settings.hostUrl\n        });\n\n        return TDAPP.onEvent(evtId, label, mapKv);\n      }\n    }\n  };\n})\n\n// App 数据\n.factory('Apps', function() {\n\n  var apps = [];\n\n  return {\n    install: function(conf) {\n      apps.push(conf);\n    },\n\n    all: function() {\n      return apps;\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.User\n * @description\n *   用户数据服务\n */\n.provider('User', function() {\n\n  var userResolve = [\n    '$rootScope',\n    '$state',\n    '$ionicModal',\n    'TalkingData',\n    'Settings',\n    'User',\n    'IbPopup',\n    'API_SERVER',\n\n    function($rootScope, $state, $ionicModal, TalkingData, Settings, User, IbPopup, API_SERVER) {\n      if (!User.isLogin) {\n        var _promise = User.login()\n          .success(function(res) {\n            if (res.login) {\n              TalkingData.onEvent('登录成功', '', {\n                hostUrl: Settings.hostUrl\n              });\n            } else {\n              TalkingData.onEvent('登录失败', '', {\n                hostUrl: Settings.hostUrl,\n                res: res\n              });\n            }\n          })\n          .error(function(res) {\n            console.log(res)\n            TalkingData.onEvent('登录出错', '', {\n              res: res,\n              hostUrl: Settings.hostUrl\n            });\n            $state.go('login');\n          })\n        return _promise;\n      }\n    }\n  ];\n\n  return {\n    // 所有数据的加载都要在用户登录之后才执行\n    resolve: {\n      user: userResolve\n    },\n\n    $get: function($http, $state, $rootScope, $q, $window, $ionicPopup, Settings, IbPopup, Utils, API_SERVER) {\n      var ret = {\n        uid: '',\n        user: {},\n        users: {},\n        group: {},\n        isLogin: false\n      };\n\n      function loginFailed(res) {\n        $ionicPopup.alert({\n          title: '登录失败',\n          template: res.msg || '未知错误'\n        });\n        $state.go('login');\n      }\n\n      // 登录\n      function getUserInfo(loginData) {\n        var promise = $http.get(Settings.rootUrl + '/default/login&issetuser=true', {\n          params: loginData,\n          responseType: \"json\"\n        })\n\n        .success(function(res) {\n          if (res.login) {\n            ret.uid = res.uid;\n            ret.user = res.user;\n\n            ret.formhash = res.formhash;\n            ret.isLogin = true;\n\n            // 用户、部门、岗位数据，分别带有字母分组信息\n            // ret.userData = res.userData;\n            ret.departmentData = res.departmentData;\n            ret.positionData = res.positionData;\n\n            // 延迟加载用户数据\n            $http.get(Settings.rootUrl + '/default/login')\n            .success(function(res) {\n              ret.userData = res.userData;\n              angular.extend(ret.users, res.userData.datas)\n              angular.extend(ret.group, res.userData.group)\n            })\n\n            // 将用户信息绑定到 $rootScope，方便后续使用\n            $rootScope.user = res.user;\n          } else {\n            loginFailed(res);\n          }\n        })\n\n        .error(Settings.requestError)\n\n        return promise;\n      }\n\n      function getServerInfo(corptoken) {\n        return $http.jsonp(API_SERVER + '/oauth/connect', {\n          params: {\n            corptoken: corptoken,\n            callback: 'JSON_CALLBACK'\n          }\n        });\n      }\n\n      function getRedirectUri() {\n        var redirect;\n        if (/[?&]corptoken=/.test($window.location.search)) {\n          redirect = $window.location.href;\n        } else {\n          var pathArr = $window.location.href.split(/(?=#)/);\n\n          pathArr.splice(1, 0, (pathArr[0].indexOf('?') !== -1 ? '&' : '?') + 'corptoken=' + Settings.corptoken);\n          redirect = pathArr.join('');\n        }\n        return redirect;\n      }\n\n      // 以 corptoken 方式登录\n      function loginByCorptoken(_corptoken) {\n\n        var defer = $q.defer();\n\n        getServerInfo(_corptoken)\n          .success(function(res) {\n            if (res.code === 0) {\n              Settings.hostUrl = res.data.systemurl + (res.data.systemurl.charAt(res.data.systemurl.length - 1) === '/' ? '' : '/');\n              Settings.rootUrl = Settings.hostUrl + '?r=mobile';\n\n              delete res.data.systemurl;\n\n              var promise = $http.get(Settings.hostUrl + \"api/co/oauth/\", {\n                  params: res.data,\n                  responseType: \"json\"\n                })\n                .success(function(res) {\n                  if (res.isSuccess) {\n                    getUserInfo().success(function(res) {\n                        defer.resolve(res);\n                      })\n                      .error(function(res) {\n                        defer.reject(res);\n                      });\n                  } else {\n                    IbPopup.alert({\n                      title: '请先绑定IBOS账号！'\n                    }).then(function() {\n                      $window.location.href = API_SERVER + '/oauth/connect?corptoken=' + _corptoken + '&redirect_uri=' + getRedirectUri();\n                    });\n                  }\n                })\n                .error(Settings.requestError)\n\n              return promise;\n            } else {\n              alert(res.message || '登录失败：corptoken: ' + _corptoken);\n            }\n          });\n\n        return Utils.httpPromise(defer.promise);\n      }\n\n      function setDocumentTitleWithCorpName(res) {\n        if (res.login && res.unit) {\n          Utils.setDocumentTitle(res.unit.shortname);\n        }\n      }\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.User#login\n       * @methodOf  ibosApp.services.User\n       * @description\n       *    登录用户\n       *\n       * @param     {Object}      loginData     登录用数据\n       * @returns   {HttpPromise} HttpPromise\n       */\n      ret.login = function(loginData) {\n        if (Settings.corptoken) {\n          return loginByCorptoken(Settings.corptoken).success(setDocumentTitleWithCorpName);\n        } else if (Settings.hostUrl) {\n          return getUserInfo(loginData).success(setDocumentTitleWithCorpName)\n        } else {\n          return Utils.httpPromise($q.reject());\n        }\n      };\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.User#logout\n       * @methodOf  ibosApp.services.User\n       * @description\n       *    登出用户\n       * @returns   {HttpPromise}  HttpPromise\n       */\n      ret.logout = function() {\n        return $http.get(Settings.rootUrl + '/default/logout')\n          .success(function() {\n            $state.go('login');\n          });\n      };\n\n      /**\n       * @ngdoc     method\n       * @name       services.#authority\n       * @methodOf  services.\n       * @param；\n       *\n       * @description\n       *   用户是否有权限使用模块\n       *\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      ret.getAuthority = function() {\n        return $http.get(Settings.hostUrl + '?r=mobile/authority/index')\n      };\n\n      /**\n       * @ngdoc     method\n       * @name      ibosApp.services.User#getUser\n       * @methodOf  ibosApp.services.User\n       * @description\n       *    获取单个用户的数据\n       *\n       * @param     {String}      uid     用户id\n       * @returns   {Object}      用户数据\n       */\n      ret.getUser = function(uid) {\n        return ret.users[uid || ret.uid] || null;\n      };\n\n      /**\n       * @ngdoc method\n       * @name      ibosApp.services.User#groupUidByLetter\n       * @methodOf  ibosApp.services.User\n       * @todo 太绕太浪费性能了，有必要修改数据源格式\n       * @description\n       *   将 uid 按字母索引分组\n       *\n       * @param   {Array}    uids    用户数组 id\n       * @returns {Object}     用户分组\n       */\n      ret.groupUidByLetter = function(uids) {\n        var ret = {};\n        var group = this.group;\n\n        angular.forEach(group, function(_uids, letter) {\n          angular.forEach(_uids, function(_uid) {\n            if (uids.indexOf(+_uid) !== -1 || uids.indexOf('' + _uid) !== -1) {\n              ret[letter] = ret[letter] || [];\n              ret[letter].push(_uid);\n            }\n          });\n        });\n\n        return ret;\n      };\n\n      function $$addPrefix(id, prefix) {\n        if (!id) {\n          return id;\n        }\n        return (prefix + id).replace(/,/g, ',' + prefix);\n      }\n\n      function $$removePrefix(id, prefix) {\n        if (angular.isArray(id)) {\n          return id.map(function(_id) {\n            return _id.replace(new RegExp('^' + prefix), '');\n          });\n        }\n\n        if (angular.isString(id)) {\n          var reg = new RegExp(',' + prefix, 'g');\n          return id.replace(reg, ',').slice(2);\n        }\n\n        return id;\n      }\n      /**\n       * @ngdoc method\n       * @name      ibosApp.services.User#addPrefix\n       * @methodOf  ibosApp.services.User\n       * @description\n       *   给 uid 添加 u_ 前缀\n       *   某些情况下为了与后端数据一致会需要用到\n       *\n       * @param   {String}    [uid]    单个 uid 或以 ',' 作为分隔符的一组 uid\n       * @returns {String}             形如 'u_1,u_2...' 的字符串\n       */\n\n      /**\n       * @ngdoc method\n       * @name      ibosApp.services.User#removePrefix\n       * @methodOf  ibosApp.services.User\n       * @description\n       *   去掉 uid 的 u_ 前缀\n       *\n       * @param   {String}    [uid]    有前缀的 uid\n       * @returns {String}    形如 '1,2...' 的字符串\n       */\n      angular.forEach({\n        'Prefix': 'u_',\n        'PositionPrefix': 'p_',\n        'DepartmentPrefix': 'd_'\n      }, function(prefx, key) {\n        ret['add' + key] = function(id) {\n          return $$addPrefix(id, prefx);\n        };\n        ret['remove' + key] = function(id) {\n          return $$removePrefix(id, prefx);\n        };\n      });\n\n      return ret;\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Department\n * @description\n *   部门数据服务\n */\n.factory('Department', function(Utils, User) {\n\n  var Department = {\n    getDepartments: function() {\n      return User.departmentData.datas;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Corp#getSubDepartments\n     * @methodOf  ibosApp.services.Corp\n     * @description\n     *   获取指定部门的子部门，若不传参数，则获取第一级部门\n     *\n     * @param   {String}    [deptId='0']   部门 id\n     * @returns {Array}     子部门数组\n     */\n    getSubDepartments: function(deptId) {\n      var depts = [];\n      var departments = this.getDepartments();\n\n      deptId = deptId || '0';\n      angular.forEach(departments, function(dept) {\n        if (dept.pid == deptId) {\n          depts.push(dept);\n        }\n      });\n      return depts;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Department#getUserByDepartment\n     * @methodOf  ibosApp.services.Department\n     * @description\n     *   获取指定部门的用户\n     *\n     * @param   {String}    [deptId='0']   部门 id\n     * @returns {Array}     用户数组\n     */\n    getUserByDepartment: function(deptId) {\n      var ret = [];\n      var users = User.userData.datas;\n\n      deptId = deptId || '0';\n      angular.forEach(users, function(user) {\n        // 由于用户可能同时属于多个部门，此处判断是否包含目标部门\n        if (Utils.commasInclude(user.deptid, deptId)) {\n          ret.push(user);\n        }\n      });\n\n      return ret;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Department#getUidGroupByDepartment\n     * @methodOf  ibosApp.services.Department\n     * @description\n     *   获取指定部门的用户分组\n     *\n     * @param   {String}    [deptId='0']   部门 id\n     * @returns {Object}     用户分组\n     */\n    getUidGroupByDepartment: function(deptId) {\n      var users = this.getUserByDepartment(deptId);\n      var uids = users.map(function(user) {\n        return user.uid\n      });\n\n      return User.groupUidByLetter(uids);\n    }\n  };\n\n  return Department;\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.Position\n * @description\n *   岗位数据服务\n */\n.factory('Position', function(Utils, User) {\n\n  function includeId(str, id) {\n    return str.split(',').indexOf(id) !== -1;\n  }\n\n  return {\n    getPositions: function() {\n      return User.positionData.datas;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Position#getUserByPosition\n     * @methodOf  ibosApp.services.Position\n     * @description\n     *   获取指定岗位的用户\n     *\n     * @param   {String}    [posId]   岗位 id\n     * @returns {Array}     用户数组\n     */\n    getUserByPosition: function(posId) {\n      var ret = [];\n      var users = User.users;\n\n      angular.forEach(users, function(user) {\n        // 由于用户可能同时属于多个部门，此处判断是否包含目标部门\n        if (Utils.commasInclude(user.positionid, posId)) {\n          ret.push(user);\n        }\n      });\n\n      return ret;\n    },\n\n    /**\n     * @ngdoc method\n     * @name      ibosApp.services.Position#getUidGroupByPosition\n     * @methodOf  ibosApp.services.Position\n     * @description\n     *   获取指定岗位的用户分组\n     *\n     * @param   {String}    posId   岗位 id\n     * @returns {Object}     用户分组\n     */\n    getUidGroupByPosition: function(posId) {\n      var users = this.getUserByPosition(posId);\n      var uids = users.map(function(user) {\n        return user.uid\n      });\n\n      return User.groupUidByLetter(uids);\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.ImgViewer\n * @description\n *   提供兼容多个平台的图片预览功能\n *   微信端调用微信提供的接口，其他（如PC端）暂时只做新窗口打开\n *\n */\n.factory('ImgViewer', function(Settings, $window, $timeout, $rootScope, $ionicModal, $ionicSlideBoxDelegate) {\n  var viewerModal;\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.ImgViewer#view\n   * @methodOf  ibosApp.services.ImgViewer\n   * @todo\n   *   此方法对非微信端的交互需要优化\n   * @description\n   *   预览一组图片，目前此功能调用微信 JSSDK\n   *   非微信端则直接打开在新窗口该图片\n   * @param     {String}    src      当前要查看的图片的 src\n   * @param     {Array}     srcs     提供一组图片的 srcs，src 参数也在此数组之中\n   */\n  function view(src, srcs) {\n    // 微信平台\n    if (typeof WeixinJSBridge !== \"undefined\") {\n      WeixinJSBridge.invoke(\"imagePreview\", {\n        \"current\": src,\n        \"urls\": srcs\n      });\n      // 其他情况，如 PC 端\n    } else {\n      // 如果已经存在查看器 Modal 实例\n      if (viewerModal) {\n        viewerModal.scope.urls = srcs;\n        viewerModal.scope.current = srcs.indexOf(src);\n        $timeout(function() {\n          viewerModal.show();\n        }, 50);\n        // 否则，新建 Modal\n      } else {\n        var scope = $rootScope.$new();\n        scope.urls = srcs;\n        scope.current = srcs.indexOf(src);\n\n        $ionicModal.fromTemplateUrl('templates/img-preview.html', {\n          scope: scope,\n          animation: 'none'\n        }).then(function(modal) {\n          viewerModal = modal;\n          modal.show();\n          modal.hideDelay = 1;\n          scope.closeModal = function() {\n            modal.hide();\n          };\n        });\n\n        scope.$on('modal.shown', function($evt, modal) {\n          var instance = $ionicSlideBoxDelegate.$getByHandle('imgPreviewSlide');\n          if (instance) {\n            instance.slide(modal.scope.current, -1);\n          }\n        });\n\n        scope.$on('modal.hidden', function($evt, modal) {\n          modal.scope.urls = [];\n          modal.scope.current = 0;\n        });\n\n        scope.zoomImg = function($event) {\n          $event.target.style.width = !$event.target.zoomFlag ? '100%' : 'auto';\n          $event.target.zoomFlag = !$event.target.zoomFlag;\n        }\n      }\n    }\n  }\n\n  return {\n    view: view\n  }\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.FileUtils\n * @description\n *   文件相关工具方法\n */\n.factory('FileUtils', function($window, $rootScope, $sce, IbPopup) {\n  var officeFileTypes = ['doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'pdf'];\n  var imageTypes = ['jpg', 'jpeg', 'png', 'bmp', 'gif'];\n  var filtIconMap = {\n    'zip': 'zip',\n    '7z': '7z',\n    'ai': 'ai',\n    'exe': 'exe',\n    'fla': 'fla',\n    'html': 'html',\n    'pdf': 'pdf',\n    'psd': 'psd',\n    'rar': 'rar',\n    'swf': 'swf',\n    'txt': 'txt',\n\n    'php': 'code',\n    'js': 'code',\n    'asp': 'code',\n    'aspx': 'code',\n    'jsp': 'code',\n\n    'xls': 'excel',\n    'xlsx': 'excel',\n\n    'doc': 'word',\n    'docx': 'word',\n\n    'ppt': 'ppt',\n    'pptx': 'ppt',\n    'pps': 'ppt',\n    'ppsx': 'ppt',\n\n    'mp3': 'music',\n    'wav': 'music',\n    'wma': 'music',\n    'flac': 'music',\n    'ape': 'music',\n\n    'png': 'photo',\n    'jpg': 'photo',\n    'jpeg': 'photo',\n    'gif': 'photo',\n\n    'mp4': 'video',\n    'rmvb': 'video',\n    'rm': 'video',\n    'avi': 'video',\n    'flv': 'video',\n    'mkv': 'video',\n    'wmv': 'video',\n\n    'unknown': 'unknown'\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#isOfficeFile\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   判断是否是支持的文档类型\n   *\n   * @param     {String}    type      文件类型\n   * @returns   {Boolean}   是否支持\n   */\n  function isOfficeFile(type) {\n    type = ('' + type).toLowerCase();\n    return officeFileTypes.indexOf(type) !== -1;\n  }\n\n  function isImage(type) {\n    type = ('' + type).toLowerCase();\n    return imageTypes.indexOf(type) !== -1;\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#download\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   获取文件后缀名\n   *\n   * @param     {String}    url      文件地址\n   * @returns   {String}    文件后缀名\n   */\n  function getExtname(url) {\n    url = url.split('?')[0];\n    var dotIndex = url.lastIndexOf('.');\n    var extname = dotIndex !== -1 ? url.slice(dotIndex + 1) : url;\n    return typeof extname == 'string' ? extname.toLowerCase() : '';\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#getFileIconByExtname\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   根据文件后缀名获取对应的图标地址\n   *\n   * @param     {String}    extname      文件后缀名\n   * @param     {String}    [size]       尺寸，不传为默认大小，传 'lt' 时为小图标\n   * @returns   {String}    图标地址\n   */\n  function getFileIconByExtname(extname, size) {\n    extname = typeof extname == 'string' ? extname.toLowerCase() : '';\n    var pathnameOrigin = $window.location.pathname;\n    var pathnameArr = pathnameOrigin.split('/');\n    pathnameArr.pop();\n    var safePathname = pathnameArr.concat(['']).join('/');\n    return $window.location.protocol +\n      '//' +\n      $window.location.host +\n      safePathname +\n      '/img/filetype/' +\n      (filtIconMap[extname] || filtIconMap.unknown) +\n      (size ? '_' + size : '') + '.png';\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#showDownloadTip\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   显示文件下载提示弹窗\n   *\n   * @param     {String}    url      文件地址\n   * @returns   {String}    文件后缀名\n   */\n  function showDownloadTip(url) {\n    var conf = {\n        title: '复制地址在浏览器中访问即可下载',\n        template: '<div class=\"selectable\">' + $sce.getTrustedHtml(url) + '</div>',\n      }\n      // 在微信里貌似使用不了 copy 命令，目前只能让用户手动复制了\n      // if($rootScope.isWeiXin) {\n    return IbPopup.alert(conf);\n    // } else {\n    //   conf.okText = '复制地址';\n    //   return IbPopup.confirm(conf).then(function(ok) {\n    //     if(ok) {\n    //       var selection = window.getSelection();\n    //       var range = document.createRange();\n    //       range.selectNodeContents(document.querySelector('.popup .selectable'));\n    //       selection.removeAllRanges();\n    //       selection.addRange(range);\n\n    //       if(document.execCommand('copy'));\n    //     }\n    //   });\n    // }\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      ibosApp.services.FileUtils#download\n   * @methodOf  ibosApp.services.FileUtils\n   * @description\n   *   下载文件\n   *\n   * @param     {String}    url      文件地址\n   */\n  function download(url) {\n    if (!url) return;\n    // 在微信中时，按文件类型处理\n    if ($rootScope.isWeiXin) {\n      var extname = getExtname(url);\n      // 微信只支持打开下载 office 相关文档格式\n      if (isOfficeFile(extname) || isImage(extname) || extname == 'html' || extname == 'htm') {\n        window.location = url;\n      } else {\n        showDownloadTip(url);\n      }\n      // 其他浏览直接打开下载\n    } else {\n      window.location = url;\n    }\n  }\n\n  return {\n    isOfficeFile: isOfficeFile,\n    isImage: isImage,\n    getExtname: getExtname,\n    showDownloadTip: showDownloadTip,\n    download: download,\n    getFileIconByExtname: getFileIconByExtname\n  }\n})\n\n.factory('Downloader', function($window, $rootScope, IbPopup) {\n\n  // 微信支持打开及下载的格式\n  var WX_SUPPORT_FILETYPE = [\n    'doc', 'docx',\n    'xls', 'xlsx',\n    'ppt', 'pptx',\n    'pdf', 'txt',\n    'png', 'gif', 'jpg', 'jpeg'\n  ];\n  var DOWNLOAD_PAGE = 'wxdownload.html';\n\n  return {\n    down: function(url) {\n      // 微信内置浏览器有格式限制\n      if ($rootScope.isWeiXin) {\n        var frags = url.split('.');\n        var filetype = frags[frags.length - 1];\n        if (WX_SUPPORT_FILETYPE.indexOf(filetype) === -1) {\n          // return IbPopup.alert({\n          //   title: '复制地址在浏览器中访问即可下载',\n          //   template: '<div class=\"selectable\">' + url + '</div>'\n          // });\n          this.downloadInWx(url);\n          return;\n        }\n      }\n      $window.location.href = url;\n    },\n    downloadInWx: function(url) {\n      $window.location.href = DOWNLOAD_PAGE + '?url=' + encodeURIComponent(url);\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.External\n * @description\n *   外部插口调用\n */\n.factory('External', function($rootScope, $window) {\n  var IS_WEIXIN = $rootScope.isWeiXin;\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.External#getLocation\n     * @methodOf  ibosApp.services.External\n     * @description\n     * 获取地理位置\n     *   onsuccess 回调参数（一些多端不一的参数在使用时要注意）\n     *   res.latitude    {Number}  纬度\n     *   res.longitude   {Number}  经度\n     *\n     * @param     {Function}     onsuccess    成功回调\n     * @param     {Function}     onsuccess    错误回调\n     */\n    getLocation: function(onsuccess, onerror) {\n      if (IS_WEIXIN) {\n        wx.ready(function() {\n          wx.getLocation({\n            success: function(res) {\n              onsuccess(res);\n            },\n            fail: onerror\n          });\n        });\n\n        // 使用浏览器自带的定位功能\n      } else {\n        if (navigator.geolocation) {\n          navigator.geolocation.getCurrentPosition(function(res) {\n            onsuccess({\n              latitude: res.coords.latitude,\n              longitude: res.coords.longitude\n            });\n          }, onerror);\n        }\n      }\n    },\n\n    openLocation: function(opts) {\n      // 在微信环境下直接使用微信自带的地图\n      if (IS_WEIXIN) {\n        wx.openLocation(opts);\n\n        // 否则，使用腾讯地图web/wap版\n      } else {\n        var url = 'http://apis.map.qq.com/uri/v1/geocoder?coord=' + opts.latitude + ',' + opts.longitude + '&referer=酷办公';\n        $window.open(url);\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.UserSelector\n * @description\n *   人员选择控件\n */\n.factory('UserSelector', function($rootScope, $q, $ionicModal, $ionicScrollDelegate, Utils, isEmptyFilter, toArrayFilter, User, Department, Position) {\n\n  var usid = 0;\n\n  // 根据可用 id 数组和禁用 id 数组，过滤掉不可用的 id\n  function filterGroup(group, enabled, disabled) {\n    var ret = {};\n\n    // 如果配置了可用 id 数组，则不在数组内的 id 不可用\n    if (enabled) {\n      if (enabled.length) {\n        angular.forEach(group, function(ids, letter) {\n          var enabledIds = ids.filter(function(id) {\n            return enabled.indexOf(+id) !== -1 || enabled.indexOf('' + id) !== -1;\n          });\n          if (enabledIds.length) {\n            ret[letter] = enabledIds;\n          }\n        });\n      }\n\n      return ret;\n      // 如果配置了禁用 id 数组，则不在数组内的 id 可用\n    } else if (disabled) {\n      if (disabled.length) {\n        angular.forEach(group, function(ids, letter) {\n          var enabledIds = ids.filter(function(id) {\n            return disabled.indexOf(+id) === -1 || disabled.indexOf('' + id) === -1;\n          });\n          if (enabledIds.length) {\n            ret[letter] = enabledIds;\n          }\n        });\n      } else {\n        ret = group;\n      }\n\n      return ret;\n\n    } else {\n      return group;\n    }\n  }\n\n  /**\n   * @ngdoc method\n   * @name       ibosApp.services.UserSelector#create\n   * @methodOf   ibosApp.services.UserSelector\n   * @description\n   *   创建人员选择器\n   *\n   * @param      {Obejct}   options   配置\n   *    groups        {object}          分组数据\n   *    tempateUrl    {String}          模板地址\n   *    maxSelection  {Number}          最大可选数\n   * @example\n   * ```js\n   * UserSelector.create().then(function(modal) {\n   *   $scope.userSelectorModal = modal;\n   *\n   *   modal.userSelector.then(function(selected) {\n   *     console.log('selected: ', selected);\n   *   });\n   * });\n   * @returns {Promise}     Promise\n   */\n  function $$create(options) {\n\n    options = options || {};\n\n    var scope = $rootScope.$new(true);\n    var promise = $ionicModal.fromTemplateUrl(options.template, {\n      scope: scope,\n      animation: 'slide-in-up'\n    });\n    var lastSelected;\n\n    scope.usid = usid++;\n    scope.selected = scope.selected || [];\n    scope.departments = {};\n    scope.positions = {};\n    scope.groups = {};\n\n    scope.getSelected = function() {\n      return Object.keys(scope.selected).filter(function(key) {\n        return scope.selected[key]\n      })\n    }\n\n    // 统计已选择用户数\n    scope.getSelectedCount = function() {\n      if (!options.maxSelection) {\n        return scope.selected.length || 0;\n        // 设置了最大可选人数时\n      } else {\n        return (scope.selected.length || 0) + '/' + options.maxSelection;\n      }\n    };\n\n    scope.setGroup = function(groups) {\n      scope.groups = filterGroup(groups, options.enabled, options.disabled);\n    };\n\n    scope.toggleSelect = function(id) {\n      id = '' + id;\n      // 移除\n      if (scope.selected.indexOf(id) !== -1) {\n        Utils.eliminate(scope.selected, id);\n        // 移除时，如果移除了记录着的 lastSelected，则更新 lastSelected 为选中数组的最后一个值\n        if (id === lastSelected) {\n          lastSelected = scope.selected[scope.selected.length - 1];\n        }\n        // 添加\n      } else {\n        scope.selected.push(id);\n        // 添加时，超过最大选择数，则剔除上一个选中项\n        if (scope.selected.length > options.maxSelection) {\n          Utils.eliminate(scope.selected, lastSelected);\n        }\n        lastSelected = id;\n      }\n    };\n\n    // 选中当前所有项\n    scope.toggleSelectAll = function($event) {\n      var ids = Array.prototype.concat.apply([], toArrayFilter(scope.groups));\n      ids = ids.map(function(id) {\n        return '' + id\n      });\n\n      if ($event.target.checked) {\n        Utils.concatTo(scope.selected, ids, true);\n      } else {\n        Utils.removeFrom(scope.selected, ids);\n      }\n    };\n\n    scope.isSelected = function(id) {\n      id = '' + id;\n      return scope.selected.indexOf(id) !== -1;\n    };\n\n    scope.isSelectAllShow = function() {\n      return !options.maxSelection && !isEmptyFilter(scope.groups);\n    };\n\n    // 监控选中项，有变化时滚动至最右侧\n    scope.$watchCollection('selected', function(val) {\n      $ionicScrollDelegate.$getByHandle('us-scroll').scrollBottom(true);\n    });\n\n    promise.then(function(modal) {\n      var _show = modal.show;\n\n      modal.show = function(_options, callback) {\n\n        _options = _options || {};\n\n        scope.group = {};\n        scope.selected = _options.values || [];\n\n        lastSelected = scope.selected[scope.selected.length - 1];\n\n        // 保存，触发回调函数\n        scope.save = function() {\n          angular.isFunction(callback) && callback.call(modal, scope.selected);\n        };\n        scope.setGroup(options.groups || {});\n\n        return _show.apply(modal);\n      };\n\n      scope.modal = modal;\n    });\n\n    return promise;\n  }\n\n  function create(options) {\n    \n    return $$create(angular.extend({\n      // groups,\n      template: 'templates/user-select-modal.html'\n    }, options)).then(function(modal) {\n\n      var scope = modal.scope;\n      var offset = 0\n      var limit = 20\n      var total = 0\n      // 用于存放当前部门、岗位下所有用户分组数据\n      var userGroups = {}\n\n      // 用于放面包屑\n      scope.paths = []\n      scope.$watchCollection('paths', function(newPaths, oldPaths) {\n        var last = newPaths[newPaths.length - 1]\n\n        offset = 0\n        userGroups = getAllUserGroups(last)\n        total = Object.keys(userGroups).map(function(key) {\n          return userGroups[key].length\n        }).reduce(function(a, b) {\n          return a + b\n        }, 0)\n        \n        updateDeparmentsAndPositions(last)\n\n        scope.loadMore()\n        \n        $ionicScrollDelegate.$getByHandle('us-modal').scrollTop()\n      })\n\n      function updateDeparmentsAndPositions(conf) {\n        var departments = [];\n        var positions = [];\n\n        if (conf) {\n          // 部门\n          if (conf.type === 'department') {\n            departments = Department.getSubDepartments(conf.id);\n            // 岗位列表\n          } else if (conf.type === 'position' && !conf.id) {\n            positions = Position.getPositions();\n          }\n        }\n\n        scope.departments = departments;\n        scope.positions = positions;\n      }\n\n      /**\n       * 获取当前部门、岗位下的所有用户分组\n       */\n      function getAllUserGroups(conf) {\n        var userGroups = User.group;\n\n        if (conf) {\n          // 部门\n          if (conf.type === 'department') {\n            userGroups = Department.getUidGroupByDepartment(conf.id)\n            // 岗位\n          } else if (conf.type === 'position' && conf.id) {\n            userGroups = Position.getUidGroupByPosition(conf.id)\n          }\n        }\n\n        return userGroups\n      }\n\n      /**\n       * 将用户分组按一定长度截取出来\n       * sliceUserGroup({ 'A': [1, 2, 3], 'B': [4, 5, 6] }, 5)\n       *   =>\n       * { 'A': [1, 2, 3], 'B': [4, 5] }\n       */\n      function sliceUserGroup(userGroups, len) {\n        var ret = {}\n        var letters = Object.keys(userGroups).sort()\n        var count = 0\n\n        for(var i = 0; i < letters.length; i++) {\n          var letter = letters[i]\n          var uids = userGroups[letter]\n\n          if(count + uids.length < len) {\n            ret[letter] = [].concat(uids)\n            count += uids.length\n          } else {\n            ret[letter] = [].concat(uids.slice(0, len - count))\n            break;\n          }\n        }\n\n        return ret\n      }\n\n      scope.loadMore = function() {\n        scope.setGroup(sliceUserGroup(userGroups, offset + limit))\n        offset += limit\n        scope.$broadcast('scroll.infiniteScrollComplete')\n      }\n\n      scope.hasLoadMore = function () {\n        return total > offset\n      }\n      \n      scope.back = function() {\n        scope.paths.pop();\n      };\n\n      // 打开部门\n      scope.openDepartment = function(deptId) {\n        scope.paths.push({\n          type: 'department',\n          id: deptId\n        });\n      };\n\n      // 打开岗位\n      scope.openPosition = function(posId) {\n        scope.paths.push({\n          type: 'position',\n          id: posId\n        });\n      };\n\n      // 弹窗打开时，重置数据\n      scope.$on('modal.shown', function() {\n        if(!scope.paths.length) {\n          scope.loadMore()\n        } else {\n          scope.paths = [];\n        }\n      });\n\n      return modal;\n    });\n  }\n\n  function createPosition(options) {\n    return $$create(angular.extend({\n      groups: User.positionData.group,\n      template: 'templates/user-select-position-modal.html'\n    }, options));\n  }\n\n  function createDepartment(options) {\n    return $$create(angular.extend({\n      groups: User.departmentData.group,\n      template: 'templates/user-select-department-modal.html'\n    }, options));\n  }\n\n  return {\n    create: create,\n    createPosition: createPosition,\n    createDepartment: createDepartment\n  };\n})\n\n.factory('IbPopup', function($timeout, $ionicPopup, $ionicBackdrop) {\n  var extend = angular.extend;\n\n  return {\n    confirm: function(opts) {\n      return $ionicPopup.confirm(extend({\n        title: '提示',\n        okText: '确定',\n        cancelText: '取消'\n      }, opts));\n    },\n\n    alert: function(opts) {\n      return $ionicPopup.alert(extend({\n        okText: '确定',\n      }, opts));\n    },\n\n    prompt: $ionicPopup.prompt,\n\n    show: $ionicPopup.show,\n\n    tip: function(msg, type, timeout) {\n      timeout = timeout || 1500;\n      type = type || 'info';\n\n      var popup = this.show({\n        // title: msg || '',\n        cssClass: 'ib-tip ib-tip-' + type,\n        content: msg\n      });\n\n      $ionicBackdrop.release();\n\n      $timeout(popup.close, timeout);\n      return popup;\n    },\n  };\n})\n\n/**\n * @ngdoc service\n * @name ibosApp.services.IbList\n * @description\n *   基本列表构造器\n */\n.factory('IbList', function($http, $ionicLoading, Settings) {\n\n  function IbList(url, options) {\n    this.url = url;\n    this.options = options || {};\n\n    this.hasMore = true;\n    this.items = [];\n\n    this.params = {};\n\n    this.idAttr = this.options.idAttr || 'id';\n  }\n\n  angular.extend(IbList.prototype, {\n    parse: function(res) {\n      return res;\n    },\n\n    showLoading: function() {\n      $ionicLoading.show();\n    },\n\n    hideLoading: function() {\n      $ionicLoading.hide();\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.IbList#fetch\n     * @methodOf  ibosApp.services.IbList\n     * @description\n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { id:.. name:... }\n     *       ...\n     *     ],\n     *     hasMore: true\n     *   }\n     * @param {Obejct} param 查询条件\n     *    offset     {Number}         查询起始位置\n     * @returns {Object} promise\n     */\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if (reset) {\n        this.reset();\n      }\n\n      if (extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n\n      this.loading = true;\n      this.showLoading();\n\n      var req = $http.get(this.url, {\n          params: this.params\n        })\n        .success(function(res) {\n          _this.items = _this.items.concat(_this.parse(res.data || res.datas));\n          // 判断是否还能加载更多\n          _this.hasMore = res.hasMore;\n        });\n\n      req.finally(function() {\n        _this.loading = false;\n        _this.hideLoading();\n      });\n\n      return req\n    },\n\n    get: function(id) {\n      var ret = null;\n      var idAttr = this.idAttr;\n\n      angular.forEach(this.items, function(item) {\n        if (item[idAttr] == id) {\n          ret = item;\n          return false;\n        }\n      });\n\n      return ret;\n    },\n\n    hasItems: function() {\n      return !!this.items.length;\n    },\n\n    getOffset: function() {\n      return this.items.length;\n      // return this.items.length ?\n      //   this.items[this.items.length - 1][this.idAttr] || '' :\n      //   '';\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        offset: 0,\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        offset: this.getOffset()\n      });\n    },\n\n    checkNoData: function() {\n      return !this.items.length && !this.hasMore;\n    },\n\n    remove: function(id) {\n      var _this = this;\n      var idAttr = this.idAttr;\n\n      if (!this.items.length) {\n        return;\n      }\n\n      angular.forEach(this.items, function(item, i) {\n        if (item[idAttr] == id) {\n          _this.items.splice(i, 1);\n          return false;\n        }\n      });\n    },\n\n    reset: function() {\n      this.items = [];\n      this.hasMore = true;\n      this.params = {};\n    },\n\n    refresh: function() {\n      return this.fetch({\n        offset: 0\n      }, true);\n    }\n  });\n\n  return IbList;\n})\n\n/**\n * @ngdoc service\n * @name  ibosApp.services.SearchModal\n * @description\n *   搜索 Modal 控件\n */\n.factory('SearchModal', function($q, $ionicModal) {\n  // 生成搜索功能 modal 实例\n  function SearchModal(options) {\n    var that = this;\n\n    this.key = this.lastKey = '';\n    this.result = [];\n\n    var scope = options.scope;\n    var search = angular.isFunction(options.searchFunc) ? options.searchFunc : angular.noop;\n\n    // 向服务器发送搜索请求\n    this.send = ionic.debounce(function(key) {\n      that.canceler && that.canceler.resolve();\n\n      if (!key) {\n        that.reset();\n        return;\n      }\n      // 再次查询的关键字一样时，不处理\n      if (key === that.lastKey) return;\n\n      that.canceler = $q.defer();\n      that.searching = true;\n\n      search(angular.extend({}, options.defaultParams, {\n          key: key\n        }), {\n          timeout: that.canceler.promise\n        }).success(function(res) {\n          if (res.isSuccess) {\n            that.lastKey = key;\n            that.result = res.data;\n          }\n        })\n        .finally(function() {\n          that.searching = false;\n        })\n    }, 200);\n\n    // 重置搜索状态\n    this.reset = function() {\n      this.searching = false;\n      this.lastKey = '';\n      this.key = '';\n      this.result = [];\n    };\n\n    // 打开搜索 modal\n    this.showModal = function() {\n      if (this.modal) {\n        this.modal.show();\n      } else {\n        // 创建搜索窗口\n        $ionicModal.fromTemplateUrl(options.templateUrl, {\n          scope: scope,\n          animation: 'none'\n        }).then(function(modal) {\n          modal.hideDelay = 10;\n          modal.show();\n\n          that.modal = modal;\n\n          // 关闭搜索窗口时，清空搜索相关数据\n          scope.$on('modal.hidden', function() {\n            that.reset();\n          });\n\n          scope.$on('$ionicView.leave', function() {\n            that.modal.hide();\n          });\n\n          scope.$on('$destroy', function() {\n            that.modal.remove();\n          });\n        });\n      }\n    };\n\n    this.hideModal = function() {\n      if (this.modal) this.modal.hide();\n    };\n\n    this.removeModal = function() {\n      if (this.modal) this.modal.remove();\n    };\n\n    scope.$watch(function() {\n      return that.key\n    }, function(key) {\n      if (key) that.searching = true;\n      that.send(key);\n    });\n  }\n\n  return SearchModal;\n})\n\n/**\n * @ngdoc service\n * @name  ibosApp.services.DefaultBack\n * @description\n *   默认返回行为控制\n */\n.factory('DefaultBack', function($ionicHistory, $window, $state, $stateParams, $ionicViewSwitcher) {\n\n    function getDefaultBack() {\n      return ($state.current || {}).defaultBack;\n    }\n\n    function goDefaultBack() {\n      $ionicViewSwitcher.nextDirection('back');\n      $ionicHistory.nextViewOptions({\n        disableBack: true,\n        historyRoot: true\n      });\n\n      var params = {};\n      var defaultBack = getDefaultBack() || {};\n\n      if (defaultBack.state) {\n        if (defaultBack.getStateParams) {\n          params = defaultBack.getStateParams($stateParams);\n        }\n        $state.go(defaultBack.state, params);\n      }\n    }\n\n    return {\n      get: getDefaultBack,\n      goBack: function() {\n        if ($ionicHistory.backView()) {\n          $window.history.back()\n            // $ionicHistory.goBack();\n        } else {\n          goDefaultBack();\n        }\n      }\n    }\n  })\n\n/**\n * @ngdoc service\n * @name  ibosApp.services.CommonApi\n * @description\n *   通用接口\n */\n.factory('CommonApi', function($http, Settings, Utils) {\n  return {\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.CommonApi#uploadAttach\n     * @methodOf  ibosApp.services.CommonApi\n     * @description\n     *   上传附件\n     * @returns {HttpPromise}  HttpPromise\n     */\n    uploadAttach: function(data, config) {\n      return Utils.postFormData(Settings.hostUrl + '?r=main/upload/upload', data, config)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      ibosApp.services.CommonApi#uploadBase64Img\n     * @methodOf  ibosApp.services.CommonApi\n     * @description\n     *   上传base64图片数据\n     * @returns {HttpPromise}  HttpPromise\n     */\n    uploadBase64Img: function(base64) {\n      return $http.post(Settings.hostUrl + '?r=main/attach/uploadbase', {\n        img: base64\n      })\n    }\n  }\n})\n\n.service('UploadFile', function(Settings) {\n  var This = this;\n\n  this.encodeURI = function(obj) {\n    var str = [];\n    for (var p in obj) {\n      str.push(encodeURIComponent(p) + '=' + encodeURIComponent(obj[p]));\n    }\n    return str.join('&');\n  }\n\n  this.upload = function(opts) {\n    var url = opts.url || Settings.hostUrl + '?r=main/upload/upload';\n    if (!opts.url && opts.params) {\n      url = url + '&' + this.encodeURI(opts.params);\n    }\n    var xhr = new XMLHttpRequest();\n    if (xhr.upload) {\n      xhr.upload.addEventListener('progress', function(e) {\n        opts.onProgress && opts.onProgress(Math.ceil(e.loaded / e.total * 100));\n      }, false);\n      xhr.addEventListener('timeout', This.onTimeout, false);\n      xhr.onreadystatechange = function(e) {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200) {\n              opts.onSuccess && opts.onSuccess(xhr.responseText && angular.fromJson(xhr.responseText));\n            } else {\n              opts.onFail && opts.onFail(xhr.responseText && angular.fromJson(xhr.responseText));\n            }\n          }\n        }\n        // 开始上传\n      xhr.open('POST', url, true);\n      xhr.useXDomain = true;\n      xhr.withCredentials = true;\n      xhr.setRequestHeader('ISCORS', true);\n      xhr.send(opts.data);\n    }\n    return xhr;\n  }\n})","/**\n * @ngdoc overview\n * @name  wechat\n * @description\n *   微信对接模块\n */\nangular.module('wechat', ['co'])\n\n.constant('WECHAT_PUBLIC_APPID', 'wx4a2205ee65d28309')\n\n/**\n * @ngdoc service\n * @name  wechat.WechatApi\n * @description\n *   微信相关接口服务\n */\n.factory('WechatApi', function($http, $q, $window, Utils, API_APP_URL, WECHAT_PUBLIC_APPID) {\n\n  var WECHAT_API_URL = API_APP_URL + '/wechat';\n\n  var WechatApi = {\n    getData: function() {\n      if(this.data) {\n        return $q.when(this.data);\n      } else {\n        return this.getInfo(this.openid).then(function(_res) {\n          var res = _res.data;\n          if(res.code === 0) {\n            return $q.when(res.data);\n          } else {\n            return $q.reject();\n          }\n        });\n      }\n    },\n\n    // 清理微信授权用参数\n    cleanAuthParams: function(url) {\n      var ret = url.replace(/([?&])code=([^&]*)(&?)/, function($0, $1) {\n        return $1;\n      });\n\n      return ret.replace(/([?&])state=([^&]*)(&?)/, function($0, $1) {\n        return $1;\n      })\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getJsSdkSign\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取JS-SDK 签名参数\n     *    res.data.noncestr\n     *    res.data.timestamp\n     *    res.data.signature\n     * @param   {String}    url  用于生成签名的地址\n     * @returns {Object}    $q.defer.promise\n     */\n    getJsSdkSign: function(url) {\n      url = encodeURIComponent((url || $window.location.href).split('#')[0]);\n      return $http.get(WECHAT_API_URL + '/getjssdksign?url=' + url);\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getOAuthUrl\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取授权地址\n     *    res.data.url\n     * @param   {String}    redirectUri  授权完后要跳转的地址，跳转时，会自动加上 code 和 state 参数\n     * @param   {Boolean}   state         值等于 1 时原样返回 redirect_uri\n     * @returns {Object}    $q.defer.promise\n     */\n    getOAuthUrl: function(redirectUri, state) {\n      var url = WechatApi.cleanAuthParams(redirectUri);\n      return $http.get(WECHAT_API_URL + '/getoauthurl?redirect_uri=' + encodeURIComponent(redirectUri) + '&state=' + (state || ''));\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getAuth\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取微信用户授权信息\n     *    res.data.openid\n     * @param   {String}    code          授权成功后返回的地址带过来的参数。\n     * @returns {Object}    $q.defer.promise\n     */\n    getAuth: function(code) {\n      return $http.get(WECHAT_API_URL + '/getauth?code=' + code);\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#getInfo\n     * @methodOf wechat.WechatApi\n     * @description \n     *    获取微信用户资料\n     *    res.data.openid\n     * @param   {String}    openid            授权成功后返回的地址带过来的参数。\n     * @returns {Object}    $q.defer.promise\n     */\n    getInfo: function(openid) {\n      return $http.get(WECHAT_API_URL + '/getinfo?openid=' + openid);\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApi#initJsSdk\n     * @methodOf wechat.WechatApi\n     * @description \n     *    初始化微信 JSSDK \n     * @param   {Object}    conf     配置\n     */\n    initJsSdk: function(conf) {\n    \treturn WechatApi.getJsSdkSign().success(function(res) {\n    \t  if(res.code === 0) {\n          if(typeof wx !== 'undefined') {\n      \t    wx.config(angular.extend({\n              // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\n              debug: false,\n              // 必填，需要使用的JS接口列表，所有JS接口列表见附录2\n              jsApiList: [\n                'onMenuShareTimeline',\n                'onMenuShareAppMessage',\n                'onMenuShareQQ',\n                'onMenuShareWeibo',\n                // 'startRecord',\n                // 'stopRecord',\n                // 'onVoiceRecordEnd',\n                // 'playVoice',\n                // 'pauseVoice',\n                // 'stopVoice',\n                // 'onVoicePlayEnd',\n                // 'uploadVoice',\n                // 'downloadVoice',\n                'chooseImage',\n                'previewImage',\n                // 'uploadImage',\n                // 'downloadImage',\n                // 'translateVoice',\n                // 'getNetworkType',\n                'openLocation',\n                'getLocation',\n                // 'hideOptionMenu',\n                // 'showOptionMenu',\n                // 'hideMenuItems',\n                // 'showMenuItems',\n                // 'hideAllNonBaseMenuItem',\n                // 'showAllNonBaseMenuItem',\n                // 'closeWindow',\n                // 'scanQRCode',\n                // 'chooseWXPay',\n                // 'openProductSpecificView',\n                // 'addCard',\n                // 'chooseCard',\n                // 'openCard'\n              ] \n            }, conf, {\n      \t      appId: WECHAT_PUBLIC_APPID, // 必填，公众号的唯一标识\n      \t      timestamp: res.data.timestamp, // 必填，生成签名的时间戳\n      \t      nonceStr: res.data.noncestr, // 必填，生成签名的随机串\n      \t      signature: res.data.signature,// 必填，签名，见附录1\n      \t    }));\n          }\n    \t  }  \n    \t})\n    },\n\n    /**\n     * @ngdoc    method\n     * @name     wechat.WechatApiinitShareConfig\n     * @methodOf wechat.WechatApi\n     * @description \n     *    初始化微信分享功能 \n     * @param   {Object}    config     配置\n     */\n    initShareConfig: function(config) {\n      wx.ready(function() {\n        wx.onMenuShareAppMessage(config);\n        wx.onMenuShareTimeline(config);\n        wx.onMenuShareQQ(config);\n        wx.onMenuShareWeibo(config);\n      });\n    }\n  };\n\n  return WechatApi;\n})\n","/**\n * @ngdoc overview\n * @name  activity\n * @description\n *   活动模块入口及配置\n */\nangular.module('activity', ['ionic', 'activity.controllers', 'activity.services'])\n\n.run(function(Apps) {\n  Apps.install({\n    name: 'activity',\n    title: '活动',\n    route: '#/activity',\n    state: 'activity.index',\n    icon: 'img/modicon/activity.png'\n  })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/activity', '/activity/index');\n\n  $stateProvider\n  .state('activity', {\n    url: '/activity',\n    abstract: true,\n    template: '<ion-nav-view name=\"activity\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  // 全部活动\n  .state('activity.index', {\n    url: '/index',\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-index.html',\n        controller: 'ActivityIndexCtrl'\n      }\n    }\n  })\n\n  // 我参加的\n  .state('activity.join', {\n    url: '/join',\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-index.html',\n        controller: 'ActivityJoinCtrl'\n      }\n    }\n  })\n\n  // 活动创建页\n  .state('activity.create', {\n    url: '/create/:id?formdataid',\n    cache: false,\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-create.html',\n        controller: 'ActivityCreateCtrl'\n      }\n    }\n  })\n\n  // 活动详情页\n  .state('activity.view', {\n    url: '/view/:id',\n    cache: false,\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-view.html',\n        controller: 'ActivityViewCtrl'\n      }\n    }\n  })\n\n  //活动安排页\n  .state('activity.info', {\n    url: '/info/:id',\n    cache: false,\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-info.html',\n        controller: 'ActivityInfoCtrl'\n      }\n    }\n  })\n\n  //活动安排页\n  .state('activity.arrange', {\n    url: '/arrange/:id',\n    views: {\n      'activity': {\n        templateUrl: 'templates/activity/activity-arrange.html',\n        controller: 'ActivityArrangeCtrl'\n      }\n    }\n  })\n\n})","/**\n * @ngdoc overview\n * @name  activity.controllers\n * @description\n *  活动模板控制器\n */\nangular.module('activity.controllers', [])\n\n// 全部活动\n.controller('ActivityIndexCtrl', function($scope, $state, $ionicScrollDelegate, ActivityList ) {\n  $scope.stateName = $state.$current.name;\n\n  $scope.activity = new ActivityList({\n    type: 'all'\n  });\n\n  $scope.load = function() {\n    $scope.activity.load()\n    .success(function() {\n      $ionicScrollDelegate.resize();\n    });\n  };\n\n  $scope.reload = function() {\n    $scope.activity.reload()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n    });\n  };\n\n  $scope.load();\n})\n\n// 我参加的\n.controller('ActivityJoinCtrl', function($scope, $state, $ionicScrollDelegate, ActivityList) {\n  $scope.stateName = $state.$current.name;\n\n  $scope.activity = new ActivityList({\n    type: 'me'\n  });\n\n  $scope.load = function() {\n    $scope.activity.load()\n    .success(function() {\n      $ionicScrollDelegate.resize();\n    });\n  };\n\n  $scope.reload = function() {\n    $scope.activity.reload()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n    });\n  };\n\n  $scope.load();\n})\n\n// 活动详情\n.controller('ActivityViewCtrl', function($scope, $timeout, $stateParams, $ionicScrollDelegate, $ionicLoading, Activity) {\n  $scope.activityId = $stateParams.id;\n\n  // 获取活动数据\n  $ionicLoading.show();\n  Activity.view($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.item = res.data;\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  $scope.toggleOpen = true;\n  $scope.toggleView = function() {\n    $scope.toggleOpen = !$scope.toggleOpen;\n    $timeout(function() {\n      $ionicScrollDelegate.resize();\n    }, 100)\n  };\n\n  // 打开地图\n  $scope.openMap = function() {\n    window.location.href = 'http://api.map.baidu.com/place/search?query=' + $scope.item.address + '&region=' + $scope.item.address + '&output=html';\n    // window.location.href = 'http://apis.map.qq.com/uri/v1/search?region=' + $scope.item.address + '&keyword=' + $scope.item.address;\n  };\n\n  // if($scope.card.address) {\n  //   $scope.location = {\n  //     latitude: 0, // 纬度，浮点数，范围为90 ~ -90\n  //     longitude: 0, // 经度，浮点数，范围为180 ~ -180。\n  //     name: $scope.card.corpname, // 位置名\n  //     address: $scope.card.address, // 地址详情说明\n  //     scale: 15, // 地图缩放级别,整形值,范围从1~28。默认为最大\n  //     infoUrl: '' // 在查看位置界面底部显示的超链接,可点击跳转\n  //   };\n\n  //   Namecard.getLocation($scope.card.address)\n  //   .success(function(res) {\n  //     if(res.status === 0) {\n  //       $scope.location.latitude = +res.result.location.lat;\n  //       $scope.location.longitude = +res.result.location.lng;\n  //     }\n  //   });\n\n  //   $scope.openLocation = function() {\n  //     External.openLocation($scope.location);\n  //   };\n  // }\n})\n\n// 活动报名/编辑报名数据\n.controller('ActivityCreateCtrl', function($scope, $state, $stateParams, $ionicLoading, IbPopup, User, Activity) {\n  $scope.fields = [];\n  $scope.form = {};\n  $scope.note = {};\n\n  // 获取报名字段\n  $ionicLoading.show();\n  Activity.formField($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.fields = res.data.formdata;\n      \n      // 填充表单模型的默认值\n      // 如果是报名，设置当前用户的姓名和手机为默认\n      if(!$stateParams.formdataid) {\n        $scope.form[$scope.fields[0].fieldname] = User.user.realname;\n        $scope.form[$scope.fields[1].fieldname] = User.user.mobile;\n\n        // 因为PC默认是关闭状态，统一“是否” 类型默认值为 false\n        angular.forEach($scope.fields, function(field) {\n          if(field.fieldtype == '3') {\n            $scope.form[field.fieldname] = false;\n          }\n        });\n      } else {\n        // 如果是编辑报名数据，则先还原原始值\n        angular.forEach($scope.fields, function(field) {\n          // “是否” 类型要特殊处理一下\n          if(field.fieldtype == '3') {\n            if(field.value === '0.') {\n              $scope.form[field.fieldname] = false;\n            } else {\n              $scope.form[field.fieldname] = true;\n              $scope.note[field.fieldname] = field.value.slice(2);\n            }\n          } else {\n            $scope.form[field.fieldname] = field.value;\n          }\n        });\n      }\n    } else {\n      IbPopup.alert({ title: res.msg });\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  // 保存\\更新报名数据\n  $scope.save = function() {\n    var data = angular.extend({}, $scope.form);\n    var method = 'createSignUp';\n\n    // 增加活动id，用户id等字段\n    data.moduleid = $stateParams.id;\n    if($stateParams.formdataid) {\n      method = 'updateSignUp';\n      data.formdataid = $stateParams.formdataid;\n    }\n\n    // 当开启“是否”开关时，将备注值作为该字段值保存下来\n    angular.forEach($scope.fields, function(field) {\n      // “是否”类型时\n      if(field.fieldtype == '3') {\n        if($scope.form[field.fieldname]) {\n          data[field.fieldname] = '1.' + ($scope.note[field.fieldname] || '');\n        } else {\n          data[field.fieldname] = '0.';\n        }\n      }\n    });\n\n    $ionicLoading.show();\n    Activity[method](data)\n    .success(function(res) {\n      if(res.isSuccess) {\n        $state.go('activity.info', $stateParams);\n      } else {\n        IbPopup.alert({ title: res.msg });\n      }\n    })\n    .finally($ionicLoading.hide);\n  };\n})\n\n// 查看报名详情\n.controller('ActivityInfoCtrl', function($scope, $stateParams, $ionicLoading, Utils, IbPopup, Activity) {\n  $scope.activityId = $stateParams.id;\n\n  $ionicLoading.show();\n  Activity.signUpList($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.infos = res.data;\n    } else {\n      IbPopup.alert({ title: res.msg });\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  // 删除报名数据\n  $scope.removeItem = function(info) {\n    IbPopup.confirm({ title: '确定要删除该报名信息？' })\n    .then(function(ok) {\n      if(ok) {\n        $ionicLoading.show();\n        Activity.deleteSignUp({\n          moduleid: $stateParams.id,\n          formdataid: info.formdataid\n        })\n        .success(function(res) {\n          if(res.isSuccess) {\n            Utils.eliminate($scope.infos, info);\n          } else {\n            IbPopup.alert({ title: res.msg });\n          }\n        })\n        .finally($ionicLoading.hide);\n      }\n    });\n  };\n})\n\n// 查看活动安排\n.controller('ActivityArrangeCtrl', function($scope, $stateParams, $ionicLoading, IbPopup, Activity) {\n\n  $ionicLoading.show();\n  Activity.arrangeList($stateParams)\n  .success(function(res) {\n    if(res.isSuccess) {\n      $scope.fields = res.data.formdata;\n      $scope.activity = res.data.activity;\n    } else {\n      IbPopup.alert({ title: res.msg });\n    }\n  })\n  .finally($ionicLoading.hide);\n\n});\n","/**\n * @ngdoc overview\n * @name  activity.services\n * @description\n *  活动模板服务\n */\nangular.module('activity.services', [])\n\n/**\n * @ngdoc service\n * @name  activity.services.Activity\n * @description\n *   任务模块接口服务\n */\n.factory('Activity', function($http, Utils, Settings) {\n  // 模块根目录\n  var moduleUrl = Settings.hostUrl + '?r=activity';\n\n  var Activity = {\n    /**\n     * @ngdoc service\n     * @name  activity.services.list\n     * @param    {object}       params\n     * @description\n     *    获取活动列表\n     *    - `params.type`  {string}  类型，all所有活动、me我参加的活动\n     *    - `params.page`  {number=} 页码，默认值为1\n     * \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    list: function(params) {\n      return $http.get(moduleUrl + '/activityapi/index', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.view\n     * @param    {object}    params\n     * @description\n     *    获取活动详情\n     *    - `params.id`  {string}  活动 id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    view: function(params) {\n      return $http.get(moduleUrl + '/activityapi/detail', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.formField\n     * @param    {object}    params\n     * @description\n     *    获取报名表单字段\n     *    - `params.id`  {string}  活动 id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    formField: function(params) {\n      return $http.get(moduleUrl + '/signupapi/create', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.createSignUp\n     * @param    {object}    params\n     * @description\n     *    保存报名数据\n     *    - `params.moduleid`  {string}  活动id\n     *    - `params.uid`       {string}  用户id\n     *    - `params.name`      {string}  用户名\n     *    - `params.phone`     {string}  手机\n     *    - `params.data1`     {string}  扩展字段\n     *    ...\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    createSignUp: function(params) {\n      return Utils.postJsonData(moduleUrl + '/signupapi/store', params);\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.updateSignUp\n     * @param    {object}    params\n     * @description\n     *    更新报名数据\n     *    - `params.moduleid`    {string}  活动id\n     *    - `params.formdataid`  {string}  报名数据id\n     *    - `params.name`        {string}  用户名\n     *    - `params.phone`       {string}  手机\n     *    - `params.data1`       {string}  扩展字段\n     *    ...\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    updateSignUp: function(params) {\n      return Utils.postJsonData(moduleUrl + '/signupapi/update', params);\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.deleteSignUp\n     * @param    {object}    params\n     * @description\n     *    删除报名数据\n     *    - `params.moduleid`    {string}  活动id\n     *    - `params.formdataid`  {string}  报名数据id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    deleteSignUp: function(params) {\n      return $http.post(moduleUrl + '/signupapi/del', params);\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.signUpList\n     * @param    {object}    params\n     * @description\n     *    获取所有报名数据\n     *    - `params.id`  {string}  活动id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    signUpList: function(params) {\n      return $http.get(moduleUrl + '/signupapi/detail', {\n        params: params\n      });\n    },\n\n    /**\n     * @ngdoc service\n     * @name  activity.services.arrangeList\n     * @param    {object}    params\n     * @description\n     *    获取我的活动安排\n     *    - `params.id`  {string}  活动id\n     *    \n     * @returns  {HttpPromise}  HttpPromise\n     */\n    arrangeList: function(params) {\n      return $http.get(moduleUrl + '/arrangementapi/detail', {\n        params: params\n      });\n    }\n  };\n\n  return Activity;\n})\n\n.factory('ActivityList', function(Activity, Utils) {\n  return function(defaultParams) {\n    var that = this;\n    this.loading = false;\n    this.hasMore = true;\n    this.page = 1;\n    this.list = [];\n    // 加载更多\n    this.load = function() {\n      var promise;\n\n      this.loading = true;\n\n      promise = Activity.list(angular.extend({}, defaultParams, {\n        page: that.page\n      }))\n      .success(function(res) {\n        if(res.isSuccess) {\n          that.list = that.list.concat(res.data);\n          that.hasMore = res.hasmore;\n          that.page++;\n          console.log(res)\n        } else {\n          Utils.promptNoPermission();\n        }\n      });\n\n      promise.finally(function() {\n        that.loading = false;\n      });\n\n      return promise;\n    };\n    // 重载\n    this.reload = function() {\n      this.page = 1;\n      this.list.length = 0;\n      this.hasMore = true;\n      return this.load();\n      // .finally(function() {\n      //   $scope.$broadcast('scroll.refreshComplete');\n      // });\n    }\n  }\n})\n\n/**\n * @ngdoc filter\n * @name activity.services.filter:phoneCrawler\n * @function\n * @description\n *  手机号码嗅探\n *  \n * @param   {string}  content  内容\n * @returns {string}  替换手机号码为可点击的内容\n */\n.filter('phoneCrawler', function(REGEXP_ENUM) {\n  var reg = /\\b1\\d{10}\\b/g ; //使用/1\\d{10}/g将图片名称解析成电话号码，导致无法正常解析图片；\n  return function(content) {\n    content = content || '';\n    return content.replace(reg, function(phone) {\n      return '<a href=\"tel:' + phone + '\">' + phone + '</a>'\n    });\n  }\n})","/**\n * @ngdoc module\n * @name assignment\n * @description\n *   任务指派模块\n */\n\nangular.module('assignment', ['ionic', 'assignment.controllers', 'assignment.services'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'assignment', title: '任务指派', route: '#/assignment', state: 'assignment.index', icon: 'img/modicon/assignment.png' })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/assignment', '/assignment/index');\n\n  $stateProvider\n  .state('assignment', {\n    url: '/assignment',\n    abstract: true,\n    template: '<ion-nav-view name=\"assignment\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  // 任务指派-首页\n  .state('assignment.index', {\n    url: '/index',\n    talkingDataLabel: '任务指派-首页',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-index.html',\n        controller: 'AssignmentIndexCtrl'\n      }\n    }\n  })\n\n  // 任务指派-未完成列表\n  .state('assignment.unfinished', {\n    url: '/unfinished?uid',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-unfinished.html',\n        controller: 'AssignmentUnfinishedCtrl'\n      }\n    }\n  })\n\n  // 任务指派-已完成列表\n  .state('assignment.finished', {\n    url: '/finished',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-finished.html',\n        controller: 'AssignmentFinishedCtrl'\n      }\n    }\n  })\n\n  // 任务指派-新建任务\n  .state('assignment.create', {\n    url: '/create',\n    talkingDataLabel: '任务指派-新建任务',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-create.html',\n        controller: 'AssignmentCreateCtrl'\n      }\n    }\n  })\n\n  // 任务指派-编辑任务\n  .state('assignment.edit', {\n    url: '/edit/:id',\n    talkingDataLabel: '任务指派-编辑任务',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-edit.html',\n        controller: 'AssignmentEditCtrl'\n      }\n    }\n  })\n\n  // 任务指派-查看任务\n  .state('assignment.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '任务指派-查看任务',\n    views: {\n      'assignment': {\n        templateUrl: 'templates/assignment/assignment-detail.html',\n        controller: 'AssignmentDetailCtrl'\n      }\n    }\n  })\n});","/**\n * @ngdoc module\n * @name assignment.controllers\n * @description\n *   任务指派模块控制器\n *   (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻\n *      (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻ (╯°Д°)╯ ┻━┻\n */\nangular.module('assignment.controllers', [])\n\n  .controller('AssignmentIndexCtrl', function($scope, $ionicModal, $ionicLoading, User, Assignment, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        //检查用户是否有权限使用该模块\n        if(res.data.assignment){\n          Assignment.getSubordinates({ uid: User.uid })\n            .success(function(res) {\n            });\n\n          // 下属列表 modal\n          $ionicModal.fromTemplateUrl('templates/assignment/subordinate-modal.html', {\n            scope: $scope,\n            animation: 'slide-in-up'\n          }).then(function(modal) {\n            $scope.modal = modal;\n          });\n\n          $scope.subordinates = [];\n\n          // 打开下属列表 modal\n          $scope.openSubordinateModal = function($event, uid) {\n            $event.stopPropagation();\n            $event.preventDefault();\n            if(!uid) {\n              return false;\n            }\n            Assignment.getSubordinates({ uid: uid })\n              .success(function(res) {\n                $scope.subordinates.push(res.users);\n              });\n            $scope.modal.show();\n          };\n\n          $scope.backSubordinateModal = function() {\n            $scope.subordinates.pop();\n          };\n\n          $scope.closeSubordinateModal = function() {\n            $scope.subordinates = [];\n            $scope.modal.hide();\n          };\n\n          $scope.$on('$ionicView.leave', function() {\n            $scope.subordinates = [];\n            $scope.modal.hide();\n          });\n\n        } else {\n          Utils.promptNoPermission();\n        }\n      }\n    }).finally($ionicLoading.hide)\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentUnfinishedCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-未完成列表页控制器\n */\n  .controller('AssignmentUnfinishedCtrl', function($scope, $state, $stateParams, $ionicActionSheet, $ionicLoading, $ionicModal, User, Utils, IbPopup, Assignment, AssignmentUnfinished) {\n    $ionicLoading.show();\n\n    if($stateParams.uid) {\n      $scope.userName = '（' + User.getUser($stateParams.uid).realname + '）'\n\n      AssignmentUnfinished.getSubList($stateParams)\n        .success(function(res) {\n          $scope.data = res;\n        })\n        .finally($ionicLoading.hide);\n    } else {\n      AssignmentUnfinished.get()\n        .success(function(res) {\n          $scope.data = res;\n        })\n        .finally($ionicLoading.hide);\n      $scope.myself = true;\n    }\n\n    $scope.isDateTimeLocalSupport = Utils.isDateTimeLocalSupport;\n\n    // 是否已过期\n    $scope.isOverdue = function(item) {\n      return item &&\n        item.endtime &&\n        Date.now() > item.endtime * 1000;\n    };\n\n    // 是否设置了提醒\n    $scope.haveRemind = function(item) {\n      return item &&\n          // 过期时不显示提醒\n        !$scope.isOverdue(item) &&\n        item.remindtime > 0;\n    };\n\n    // Modal: 延期申请\n    $ionicModal.fromTemplateUrl('templates/assignment/delay-apply-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.delayModal = modal;\n    });\n\n    // Modal: 取消申请\n    $ionicModal.fromTemplateUrl('templates/assignment/cancel-apply-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.cancelModal = modal;\n    });\n\n    // 打开任务延期申请 Modal\n    $scope.openDelayApplyModal = function(item) {\n      $scope.delayApplySubmitting = false;\n      $scope.delayData = {\n        id: item.assignmentid,\n        delayReason: '',\n        isDesignee: User.uid == item.designeeuid,\n        starttime: new Date(item.starttime * 1000),\n        endtime: new Date(item.endtime * 1000)\n      };\n\n      $scope.delayModal.show();\n      return true;\n    };\n\n    // 任务延期，负责人申请延期、指派人延期放在一起处理\n    $scope.applyDelay = function(isDesignee) {\n      // 是指派人时直接延期、负责人则需通过申请的方式\n      var func = isDesignee ? AssignmentUnfinished.delay : AssignmentUnfinished.applyDelay;\n      $scope.delayApplySubmitting = true;\n\n      func.call(AssignmentUnfinished, angular.extend({}, $scope.delayData, {\n        // 格式化日期\n        starttime: $scope.delayData.starttime ? Assignment.formatDatetime($scope.delayData.starttime) : '',\n        endtime: $scope.delayData.endtime ? Assignment.formatDatetime($scope.delayData.endtime) : ''\n      }))\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.delayModal.hide();\n          }\n        })\n        .finally(function() {\n          $scope.delayApplySubmitting = false;\n        });\n    };\n\n    // 打开任务取消申请 Modal\n    $scope.openCancelApplyModal = function(item) {\n      $scope.cancelApplySubmitting = false;\n      $scope.cancelData = {\n        id: item.assignmentid,\n        cancelReason: ''\n      };\n\n      $scope.cancelModal.show();\n      return true;\n    };\n\n    // 负责人申请任务取消\n    $scope.applyCancel = function() {\n      $scope.cancelApplySubmitting = true;\n      AssignmentUnfinished.applyCancel($scope.cancelData)\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.cancelModal.hide();\n          }\n        })\n        .finally(function() {\n          $scope.cancelApplySubmitting = false;\n        });\n    };\n\n    // 指派人取消任务\n    $scope.cancel = function(item) {\n      $ionicLoading.show();\n\n      AssignmentUnfinished.cancel({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            item.status = 4;\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    $scope.edit = function(item) {\n      $state.go('assignment.edit', { id: item.assignmentid });\n      return true;\n    };\n\n    // 删除任务\n    $scope.remove = function(item) {\n      IbPopup.confirm({ title: '确定要删除该任务？' })\n        .then(function(res) {\n          if(res) {\n            $ionicLoading.show();\n            Assignment.remove({ id: item.assignmentid })\n              .success(function(res) {\n                if(res.isSuccess) {\n                  item.isRemove = true;\n                }\n              })\n              .finally($ionicLoading.hide)\n          }\n        });\n      return true;\n    };\n\n    // 催办\n    $scope.urge = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.urge({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            IbPopup.tip(res.msg);\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    // 重启任务\n    $scope.restart = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.restart({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            item.status = 1;\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    // 完成任务\n    $scope.done = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.done({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            item.status = 2;\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    // 设置提醒 Modal\n    $ionicModal.fromTemplateUrl('templates/assignment/remind-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.remindModal = modal;\n    });\n\n    // 打开设置提醒 Modal\n    $scope.openRemingModal = function(item) {\n      $scope.remindSubmitting = false;\n\n      $scope.remindData = {\n        id: item.assignmentid,\n        remindContent: ''\n      };\n\n      // 如果已设置提醒，将获取之前提醒的数据\n      if(item.remindtime > 0) {\n        AssignmentUnfinished.getRemindData({ id: item.assignmentid })\n          .success(function(res) {\n            if(res.isSuccess) {\n              $scope.remindData.remindContent = res.data.content;\n              $scope.remindData.remindTime = Assignment.convertDateTime(res.data.reminddate + ' ' + res.data.remindtime);\n            }\n          });\n      }\n\n      $scope.remindModal.show();\n      return true;\n    };\n\n    $scope.remind = function(item) {\n      $scope.remindSubmitting = true;\n      AssignmentUnfinished.remind($scope.remindData)\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.remindModal.hide();\n          }\n        })\n        .finally(function() {\n          $scope.remindSubmitting = false;\n        });\n    }\n\n\n    var buttons = {\n      edit:        { text: '编辑', handler: $scope.edit },\n      remove:      { text: '删除', handler: $scope.remove },\n      cancel:      { text: '取消任务', handler: $scope.cancel },\n      applyCancel: { text: '申请取消', handler: $scope.openCancelApplyModal },\n      delay:       { text: '延期任务', handler: $scope.openDelayApplyModal },\n      applyDelay:  { text: '申请延期', handler: $scope.openDelayApplyModal },\n      remind:      { text: '设置提醒', handler: $scope.openRemingModal },\n      urge:        { text: '催办', handler: $scope.urge },\n      done:        { text: '完成', handler: $scope.done },\n      restart:     { text: '重启任务', handler: $scope.restart },\n      // stamp:       { text: '评价', handler: $scope.stamp }\n    };\n\n    function createMenuOptions(item) {\n      var roleText = Assignment.getRoleText(item);\n\n      var options = {\n        titleText: '任务操作' + (roleText ? '（' + roleText + '）' : ''),\n        buttons: [],\n        buttonClicked: function(index, opts) {\n          return opts.handler.call(null, item);\n        },\n        cancelText: '取消'\n      }\n\n      var ops = Assignment.getEnableOperation(item);\n      if(ops.length) {\n        angular.forEach(ops, function(op) {\n          // 删除按钮特殊处理\n          if(op == 'remove') {\n            options.destructiveText = buttons[op].text;\n            options.destructiveButtonClicked = function() {\n              return buttons[op].handler(item);\n            };\n          } else {\n            if(buttons[op]) {\n              options.buttons.push(buttons[op]);\n            }\n          }\n        });\n      }\n\n      return options;\n    }\n\n    $scope.showMenu = function(item) {\n      $scope.hideMenu = $ionicActionSheet.show(createMenuOptions(item));\n    };\n\n    $scope.$on('$ionicView.leave', function() {\n      $scope.delayModal.hide();\n      $scope.cancelModal.hide();\n      $scope.remindModal.hide();\n    });\n\n    $scope.$on('$destroy', function() {\n      $scope.delayModal.remove();\n      $scope.cancelModal.remove();\n      $scope.remindModal.remove();\n    });\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentFinishedCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-已完成列表页控制器\n */\n  .controller('AssignmentFinishedCtrl', function($scope, $filter, $ionicLoading, $ionicActionSheet, User, AssignmentFinished, AssignmentUnfinished) {\n    $scope.prop = {};\n\n    // 初始化列表，首次进来时自动加载数据\n    $scope.init = function() {\n      // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n      if(!$scope.list.hasItems()) {\n        $scope.list.refresh();\n      }\n    };\n\n    // 刷新列表\n    $scope.refresh = function() {\n      $scope.prop.keyword = '';\n      $scope.list.refresh()\n        .finally(function() {\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    };\n\n    $scope.list = AssignmentFinished;\n    $scope.init();\n\n    // 判断是否指派人\n    $scope.isDesignee = function(item) {\n      return item.designeeuid == User.uid;\n    };\n\n    var dateFilter = $filter('date');\n    // 根据“完成时间”分组\n    $scope.groupByFinishTime = function(items) {\n      var ret = [];\n      angular.forEach(items, function(item, index) {\n        var finishDate = dateFilter(item.finishtime * 1000, 'yyyy-MM-dd EEEE');\n        // 判断完成日期是否与前一条相同，若是则放进同一个组\n        if(ret.length && finishDate == ret[ret.length - 1].finishDate) {\n          ret[ret.length - 1].items.push(item);\n          // 若不是，则新建一个分组\n        } else {\n          ret.push({ finishDate: finishDate, items: [item] });\n        }\n      });\n      return ret;\n    };\n\n    $scope.$watchCollection('list.items', function(items) {\n      $scope.groupedItems = $scope.groupByFinishTime(items);\n    });\n\n    // 重启任务\n    $scope.restart = function(item){\n      $ionicLoading.show();\n\n      AssignmentUnfinished.restart({ id: item.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.list.remove(item.assignmentid);\n          }\n        })\n        .finally($ionicLoading.hide);\n\n      return true;\n    };\n\n    $scope.showMenu = function(item) {\n      var conf = {\n        titleText: '任务操作',\n        buttons: [\n          { text: '重启任务', handler: $scope.restart }\n        ],\n        buttonClicked: function(index, opts) {\n          return opts.handler.call(null, item);\n        },\n        cancelText: '取消'\n      };\n      $scope.hideMenu = $ionicActionSheet.show(conf);\n    };\n\n    // 获取图章路径\n    $scope.getStampPath = function(value) {\n      return Assignment.getStampPath(value, $scope.stamps);\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentCreateCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-新建任务页控制器\n */\n  .controller('AssignmentCreateCtrl', function($scope, $timeout, $state, $filter, $ionicLoading, Settings, Utils, User, Assignment, IbPopup) {\n\n    $scope.isDateTimeLocalSupport = Utils.isDateTimeLocalSupport;\n\n    var submitting = false;\n\n    // 重置表单项\n    function resetForm (){\n      var date = new Date();\n      $scope.form = {\n        chargeuid: User.uid,\n        starttime: date,\n        // 结束时间默认为 3 天后\n        endtime: new Date(+date + 259200000)\n      };\n      submitting = false;\n    }\n\n    $scope.isDisabledSubmit = function() {\n      return submitting || !($scope.assignmentForm && $scope.assignmentForm.$valid);\n    };\n\n    $scope.save = function() {\n      var form = Assignment.correctFormData($scope.form);\n\n      $ionicLoading.show();\n      submitting = true;\n\n      Assignment.create(form)\n        .success(function() {\n          resetForm();\n          IbPopup.confirm({ title: '新建任务成功', okText:'去看看' })\n            .then(function(res) {\n              if(res) {\n                $state.go('assignment.unfinished');\n              }\n            })\n        })\n        .error(Settings.requestError)\n        .finally(function() {\n          $ionicLoading.hide();\n          submitting = false;\n        })\n    };\n\n    resetForm();\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentEditCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-编辑任务页控制器\n */\n  .controller('AssignmentEditCtrl', function($scope, $stateParams, $timeout, $filter, $ionicLoading, $ionicHistory, Settings, Utils, User, IbPopup, Assignment) {\n\n    $scope.isDateTimeLocalSupport = Utils.isDateTimeLocalSupport;\n\n    var submitting = false;\n\n    $scope.isDisabledSubmit = function() {\n      return submitting || !($scope.assignmentForm && $scope.assignmentForm.$valid);\n    };\n\n    $scope.save = function() {\n      var form = Assignment.correctFormData($scope.form);\n\n      $ionicLoading.show();\n      submitting = true;\n\n      Assignment.update($stateParams.id, form)\n        .success(function() {\n          $ionicHistory.goBack();\n        })\n        .error(Settings.requestError)\n        .finally(function() {\n          $ionicLoading.hide();\n          submitting = false;\n        })\n    };\n\n    // 获取当前任务的相关信息\n    $ionicLoading.show();\n    Assignment.get($stateParams)\n      .success(function(res) {\n        // 获取成功后，添加数据到 form 对象上\n        if(res.isSuccess) {\n          $scope.form = {\n            subject: res.data.subject,\n            chargeuid: User.removePrefix(res.data.chargeuid),\n            participantuid: User.removePrefix(res.data.participantuid),\n            starttime: res.data.starttime ?\n              new Date(res.data.starttime) :\n              '',\n            endtime: new Date(res.data.endtime),\n            description: res.data.description\n          };\n          // 获取出错时，提示引导用户并返回上一页\n        } else {\n          IbPopup.alert({ title: res.msg })\n            .then(function() {\n              $ionicHistory.goBack();\n            });\n        }\n      })\n      .error(Settings.requestError)\n      .finally($ionicLoading.hide)\n  })\n\n/**\n * @ngdoc controller\n * @name AssignmentDetailCtrl\n * @module assignment.controllers\n * @description\n *   任务指派-查看任务页控制器\n */\n  .controller('AssignmentDetailCtrl', function($scope, $stateParams, $ionicLoading, $ionicHistory, $ionicModal, Settings, User, IbPopup, Assignment, AssignmentUnfinished) {\n    var assignment = {};\n    $scope.submitting = false;\n\n    // 是否已过期\n    $scope.isOverdue = function() {\n      return assignment &&\n        assignment.endtime &&\n        Date.now() > assignment.endtime * 1000;\n    };\n\n    // 是否设置了提醒\n    $scope.haveRemind = function() {\n      return assignment && assignment.remindtime > 0;\n    };\n\n    // 完成任务\n    $scope.done = function() {\n      $scope.submitting = true;\n\n      AssignmentUnfinished.done({ id: assignment.assignmentid })\n        .success(reloadInfo)\n        .finally(function() {\n          $scope.submitting = false;\n        });\n    };\n\n    // 重启任务\n    $scope.restart = function() {\n      $scope.submitting = true;\n\n      AssignmentUnfinished.restart({ id: assignment.assignmentid })\n        .success(reloadInfo)\n        .finally(function() {\n          $scope.submitting = false;\n        });\n    };\n\n    // 催办\n    $scope.urge = function() {\n      $scope.submitting = true;\n\n      AssignmentUnfinished.urge({ id: assignment.assignmentid })\n        .success(function(res) {\n          if(res.isSuccess) {\n            IbPopup.tip(res.msg);\n          }\n        })\n        .finally(function() {\n          $scope.submitting = false;\n        });\n    };\n\n    function _confirm(options, onresolve, onreject) {\n      options = angular.extend({\n        buttons: [\n          {\n            text: '拒绝',\n            onTap: onreject\n          },\n          {\n            text: '同意',\n            type: 'button-positive',\n            onTap: onresolve\n          }\n        ]\n      }, options);\n      return IbPopup.confirm(options)\n    }\n\n    function confirmDelayApply(data) {\n      return _confirm({\n        title: '任务延期申请',\n        templateUrl: 'templates/assignment/deal-delay-apply.html',\n        scope: $scope\n      }, function() {\n\n        AssignmentUnfinished.dealDelayApply({ id: assignment.assignmentid, agree: 1 })\n          .success(reloadInfo);\n\n      }, function() {\n        AssignmentUnfinished.dealDelayApply({ id: assignment.assignmentid, agree: 0 });\n      })\n    }\n\n    function confirmCancelApply(data){\n      return _confirm({\n        title: '任务取消申请',\n        templateUrl: 'templates/assignment/deal-cancel-apply.html',\n        scope: $scope\n      }, function() {\n\n        AssignmentUnfinished.dealCancelApply({ id: assignment.assignmentid, agree: 1 })\n          .success(reloadInfo);\n\n      }, function() {\n        AssignmentUnfinished.dealCancelApply({ id: assignment.assignmentid, agree: 0 });\n      });\n    }\n\n    // 获取当前任务的相关信息\n    function loadInfo() {\n      $ionicLoading.show();\n      Assignment.getFullInfo($stateParams)\n        .success(function(res) {\n          if(res.isSuccess) {\n            $scope.data = res.data;\n            $scope.assignment = assignment = res.data.assignment;\n            $scope.stamps = res.stamps;\n\n            $scope.isDesignee = (User.uid == assignment.designeeuid);\n            $scope.isCharge = (User.uid == assignment.chargeuid);\n\n            // 处理“延时申请”和“取消申请”\n            var applyData = res.data.applyData;\n            if($scope.isDesignee && applyData && applyData.id) {\n              // 有返回开始时间时，判断为“延时申请”\n              if(applyData.startTime) {\n                confirmDelayApply(applyData);\n                // 否则判断为“取消申请”\n              } else {\n                confirmCancelApply(applyData);\n              }\n            }\n            // 获取出错时，提示引导用户并返回上一页\n          } else {\n            IbPopup.alert({ title: res.msg })\n              .then(function() {\n                $ionicHistory.goBack();\n              });\n          }\n        })\n        .error(Settings.requestError)\n        .finally($ionicLoading.hide)\n    }\n\n    function reloadInfo(res) {\n      if(res.isSuccess) {\n        loadInfo();\n      }\n    }\n\n    loadInfo();\n\n    // 获取图章路径\n    $scope.getStampPath = function(value) {\n      return Assignment.getStampPath(value, $scope.stamps);\n    };\n\n    // 图章 Modal\n    $ionicModal.fromTemplateUrl('templates/assignment/stamp-modal.html', {\n      scope: $scope,\n      animation: 'slide-in-up'\n    }).then(function(modal) {\n      $scope.stampModal = modal;\n    });\n\n    $scope.selectStamp = function(value) {\n      Assignment.stamp({ id: $scope.assignment.assignmentid, stamp: value })\n        .success(reloadInfo);\n      $scope.stampModal.hide();\n    };\n\n    $scope.$on('$ionicView.leave', function() {\n      $scope.stampModal.hide();\n    });\n\n    $scope.$on('$destroy', function() {\n      $scope.stampModal.remove();\n    });\n  })\n","/**\n * @ngdoc module\n * @name assignment.services\n * @description\n *   任务指派模块服务\n */\n\nangular.module('assignment.services', [])\n\n\n/**\n * @ngdoc service\n * @name Assignment\n * @module assignment.services\n * @description\n *   任务指派通用服务\n */\n\n.factory('Assignment', function($rootScope, $http, $state, $filter, $ionicLoading, Settings, Utils, User) {\n  var moduleUrl = Settings.rootUrl + '/assignment';\n\n  var DATETIME_FORMAT = 'yyyy-MM-dd HH:mm';\n\n  // 状态对应 0 未读，1 进行中，2 已完成，3 已评价，4 已取消\n  var operation = {\n    // 指派人可用操作\n    designee: {\n      '0': ['edit', 'remove', 'urge', 'cancel', 'delay', 'remind'],\n      '1': ['edit', 'remove', 'done', 'cancel', 'delay', 'remind'],\n      '2': ['edit', 'remove', 'stamp', 'restart'],\n      '3': ['edit', 'remove', 'restart'],\n      '4': ['edit', 'remove', 'restart']\n    },\n    // 负责人可用操作\n    charge: {\n      '0': ['done', 'remind'],\n      '1': ['done', 'applyDelay', 'applyCancel', 'remind'],\n      '2': ['restart'],\n      '3': ['restart'],\n      '4': ['restart']\n    }\n    // 参与人从头到尾都只能评论，就是个打酱油的\n  };\n\n  return {\n    getRole: function(task) {\n      if(User.uid == task.designeeuid) {\n        return 'designee';\n      } else if(User.uid == task.chargeuid) {\n        return 'charge';\n      } else if(task.participantuid.split(',').indexOf(User.uid) !== -1) {\n        return 'participant';\n      }\n      return '';\n    },\n\n    getRoleText: function(task) {\n      var text = {\n        'charge': '负责人',\n        'designee': '指派人',\n        'participant': '参与人'\n      };\n      return text[this.getRole(task)] || '';\n    },\n\n    getStampPath: function(value, stamps) {\n      var path = '';\n      \n      angular.forEach(stamps, function(stamp) {\n        if(value == stamp.value) {\n          path = stamp.stampPath;\n        }\n        return false;\n      });\n\n      return path;\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#getEnableOperation\n     * @description \n     *    获取某条任务数据允许的操作\n     * @param {Object} task\n     * @returns {Array} 允许操作数组\n     */\n    getEnableOperation: function(task) {\n      var op = User.uid == task.designeeuid ? \n      operation.designee:\n      User.uid == task.chargeuid ?\n      operation.charge:\n      {};\n\n      return op[task.status] || [];\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#convertDateTime\n     * @description \n     *   将日期转为字符串\n     *   根据表单控件支持情况，当支持datetime-local时，格式为 yyyy-MM-ddThh:ii\n     *   否则格式为 yyyy-MM-dd hh:ii\n     * @param {Date} date 日期\n     * @returns {String}  时间字符串\n     */\n    convertDateTime: function(date) {\n      date = angular.isDate(date) ? date : new Date(date);\n\n      if(Utils.isDateTimeLocalSupport) {\n        date = new Date(+date - (date.getTimezoneOffset() * 60000));\n        return date.toJSON().slice(0, 16);\n      } else {\n        return $filter('date')(date, DATETIME_FORMAT);\n      }\n    },\n\n    formatDatetime: function(date) {\n      return $filter('date')(date, DATETIME_FORMAT);\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#correctDateTime\n     * @description \n     *   将 datetime-local 的值转为需要的格式\n     * @param {String} dateStr\n     * @returns {String}\n     */\n    correctDateTime: function(dateStr) {\n      var date = new Date(dateStr);\n\n      if(Utils.isDateTimeLocalSupport) {\n        date = new Date(+date + (date.getTimezoneOffset() * 60000));\n      }\n\n      return this.formatDatetime(date);\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#correctFormData\n     * @description \n     *   校正将要提交的数据\n     * @param {Object} form 表单数据\n     * @returns {Object}    校正后的表单数据\n     */\n    correctFormData: function(form) {\n      form = angular.extend({}, form);\n\n      form.chargeuid = User.addPrefix(form.chargeuid);\n      form.participantuid = User.addPrefix(form.participantuid) || '';\n\n      // form.starttime = this.correctDateTime(form.starttime) || '';\n      // form.endtime = this.correctDateTime(form.endtime);\n      form.starttime = this.formatDatetime(form.starttime);\n      form.endtime = this.formatDatetime(form.endtime);\n\n      form.description = form.description || '';\n      // 目前手机端没做附件，但由于后端有检验这一参数，所以加上\n      form.attachmentid = '';\n\n      return form;\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#get\n     * @description \n     *    获取某一条任务\n     * @param {Object}   params     参数，正常情况下只需要任务 id\n     * @returns {Object} promise\n     */\n    get: function(params) {\n      return $http.get(moduleUrl + '/edit', {\n        params: params\n      })\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#get\n     * @description \n     *    获取某一条任务及任务相关的数据\n     * @param {Object}   params     参数，正常情况下只需要任务 id\n     * @returns {Object} promise\n     */\n    getFullInfo: function(params) {\n      params = params || {};\n      params.assignmentId = params.id;\n      return $http.get(moduleUrl + '/show', {\n        params: params\n      })\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#create\n     * @description \n     *    创建一条新的任务\n     * @param {Object} data\n     * @returns {Object} promise\n     */\n    create: function(data) {\n      data.formhash = User.formhash\n      return $http.post(moduleUrl + '/add&addsubmit=1', data)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.create', data, res);\n      });\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#update\n     * @description \n     *   修改某一条任务\n     * @param {String}     id     该任务 id\n     * @param {Object}     data   任务新数据\n     * @returns {Object}   promise\n     */\n    update: function(id, data) {\n      return $http.post(moduleUrl + '/edit&id=' + id, data)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.update', id, data, res);\n      });\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#remove\n     * @description \n     *   删除任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    remove: function(params) {\n      return $http.post(moduleUrl + '/del', params)\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#getSubordinates\n     * @description \n     *   获取指定用户的下属数据\n     * @param {Object}   params   参数\n     *   params.uid            {String} 用户id\n     * @returns {Object} promise\n     */\n    getSubordinates: function(params) {\n      return $http.get(Settings.rootUrl + '/assignmentunfinished/subList&op=getsubordinates', {\n        params: params\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name Assignment#getSubordinates\n     * @description \n     *   评价任务\n     * @param {Object}   params   参数\n     *   params.id            {String} 任务id\n     *   params.stamp         {String} 图章值\n     * @returns {Object} promise\n     */\n    stamp: function(params) {\n      return $http.post(Settings.rootUrl + '/assignmentunfinished/ajaxEntrance&op=stamp', params)\n      .error(Settings.requestError);\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name AssignmentUnfinished\n * @module assignment.services\n * @description\n *   任务指派未完成列表数据\n */\n.factory('AssignmentUnfinished', function($rootScope, $http, Settings, IbPopup) {\n  var url = Settings.rootUrl + '/assignmentunfinished';\n\n  function serverError(res) {\n    if(!res.isSuccess) {\n      IbPopup.tip(res.msg);\n    }\n  }\n\n  var ret = {\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#get\n     * @description \n     *   获取未完成列表数据\n     * @returns {Object} promise\n     */\n    get: function() {\n      return $http.get(url).error(Settings.requestError);\n    },\n\n    getSubList: function(params) {\n      return $http.get(url + '/subList', {\n        params: params\n      })\n      .error(Settings.requestError);\n    },\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#urge\n     * @description \n     *   催办任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    urge: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=push', params)\n      .success(serverError)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.urge', params, res);\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#done\n     * @description \n     *   完成任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    done: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=toFinished', params)\n      .success(serverError)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.done', params, res);\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#restart\n     * @description \n     *   重启任务\n     * @param {Object}   params   参数\n     *   params.id  {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    restart: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=restart', params)\n      .success(serverError)\n      .success(function(res) {\n        $rootScope.$broadcast('assignment.restart', params, res);\n      })\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#applyDelay\n     * @description \n     *   申请任务延迟\n     * @param {Object}     params   参数\n     *   params.id            {String} 任务id，必须项\n     *   params.starttime     {String} 开始时间，格式为 yyyy-MM-dd HH:mm\n     *   params.endtime       {String} 结束时间，格式同上\n     *   params.delayReason   {String} 延迟原因\n     * @returns {Object} promise\n     */\n    applyDelay: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=applyDelay', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#applyCancel\n     * @description \n     *   申请任务取消\n     * @param {Object}     params   参数\n     *   params.id            {String} 任务id，必须项\n     *   params.cancelReason  {String} 取消原因\n     * @returns {Object} promise\n     */\n    applyCancel: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=applyCancel', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#dealDelayApply\n     * @description \n     *   延期申请处理\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     *   params.agree    {Number} 是否同意，0 表拒绝，1表同意\n     * @returns {Object} promise\n     */\n    dealDelayApply: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=runApplyDelayResult', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#dealCancelApply\n     * @description \n     *   延期取消处理\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     *   params.agree    {Number} 是否同意，0 表拒绝，1表同意\n     * @returns {Object} promise\n     */\n    dealCancelApply: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=runApplyCancelResult', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#delay\n     * @description \n     *   延期任务\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    delay: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=delay', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#cancel\n     * @description \n     *   取消任务\n     * @param {Object}   params   参数\n     *   params.id       {String} 任务id，必须项\n     * @returns {Object} promise\n     */\n    cancel: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=cancel', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc method\n     * @name AssignmentUnfinished#remind\n     * @description \n     *   设置提醒\n     * @param {Object}   params   参数\n     *   params.id            {String} 任务id，必须项\n     *   params.remindTime    {String} 提醒时间\n     *   params.remindContent {String} 提醒内容\n     * @returns {Object} promise\n     */\n    remind: function(params) {\n      return $http.post(url + '/ajaxEntrance&op=remind&remindsubmit=1', params)\n      .success(serverError)\n      .error(Settings.requestError);\n    },\n\n    getRemindData: function(params) {\n      return $http.get(url + '/ajaxEntrance&op=remind', { params: params })\n      .success(serverError)\n      .error(Settings.requestError);\n    }\n  };\n\n  return ret;\n})\n\n/**\n * @ngdoc service\n * @name AssignmentFinished\n * @module assignment.services\n * @description\n *   任务指派已完成列表数据\n */\n.factory('AssignmentFinished', function($rootScope, Settings, IbList) {\n  var assignmentFinished = new IbList(Settings.rootUrl + '/assignmentfinished', {\n    idAttr: 'assignmentid'\n  });\n  // 已完成列表搜索功能后端参数与其他模块不一样\n  // 需要重写 search 方法\n  // 后端泥垢了 (╯°Д°)╯︵ ┻━┻\n  assignmentFinished.search = function(keyword) {\n    if(keyword.trim() === '') {\n      return this.fetch({\n        offset: 0,\n      }, true);\n    } else {\n      return this.fetch({\n        offset: 0,\n        param: 'search',\n        keyword: keyword\n      }, true);\n    }\n\n  };\n\n  return assignmentFinished;\n})\n\n\n/**\n * @ngdoc filter\n * @name assignment.services.filter:asmStatusText\n * @function\n * @description\n *  将任务状态标识转化为文本\n *  \n * @param   {string}  status  任务状态标识\n * @returns {string}  任务状态文本\n */\n.filter('asmStatusText', function() {\n  var statusMap = {\n    0: '未读',\n    1: '进行中',\n    2: '已完成',\n    3: '已评价',\n    4: '已取消'\n  };\n\n  return function(status) {\n    return statusMap[+status] || '';\n  };\n})","/**\n * @ngdoc module\n * @name cabinet\n * @description\n *   文件柜模块入口\n */\n\nangular.module('cabinet', ['ionic', 'cabinet.controllers', 'cabinet.services', 'cabinet.filters'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'cabinet', title: '文件柜', route: '#/cabinet', state: 'cabinet.personal', icon: 'img/modicon/cabinet.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/cabinet', '/cabinet/personal');\n\n  $stateProvider\n  // setup an abstract state for the tabs directive\n  .state('cabinet', {\n    url: \"/cabinet\",\n    abstract: true,\n    templateUrl: \"templates/cabinet/cabinet.html\",\n    resolve: UserProvider.resolve\n  })\n\n  .state('cabinet.personal', {\n    url: '/personal?pid',\n    talkingDataLabel: '文件柜-我的网盘',\n    views: {\n      'cabinet-personal': {\n        templateUrl: 'templates/cabinet/cabinet-personal.html',\n        controller: 'CbPersionalCtrl'\n      }\n    }\n  })\n\n  .state('cabinet.company', {\n    url: '/company?pid',\n    talkingDataLabel: '文件柜-公司网盘',\n    views: {\n      'cabinet-company': {\n        templateUrl: 'templates/cabinet/cabinet-company.html',\n        controller: 'CbCompanyCtrl'\n      }\n    }\n  })\n\n  .state('cabinet.received', {\n    url: '/received',\n    talkingDataLabel: '文件柜-收到的共享',\n    views: {\n      'cabinet-received': {\n        templateUrl: 'templates/cabinet/cabinet-received.html',\n        controller: 'CbReceivedCtrl'\n      }\n    }\n  })\n\n  .state('cabinet.user', {\n    url: '/user?fromuid&pid',\n    views: {\n      'cabinet-received': {\n        templateUrl: 'templates/cabinet/cabinet-personal.html',\n        controller: 'CbReceiveUserCtrl'\n      }\n    }\n  })\n});","/**\n * @ngdoc module\n * @name cabinet.controllers\n * @description\n *   文件柜模块控制器\n */\nangular.module('cabinet.controllers', [])\n\n/**\n * @ngdoc controller\n * @name CbPersionalCtrl\n * @module cabinet.controllers\n * @description\n *   个人文件柜列表页控制器\n */\n.controller('CbPersionalCtrl', function($scope, $stateParams, $ionicLoading, Settings, Cabinet, User, Utils){\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        if(res.data.file){\n          $scope.cb = new Cabinet(Settings.rootUrl + '/file');\n          $scope.cb.fetch($stateParams)\n            .success(function(res) {\n              $scope.title = res.pDir.name;\n            });\n        } else {\n          Utils.promptNoPermission();\n        }\n      }\n    }).finally($ionicLoading.hide);\n\n})\n\n/**\n * @ngdoc controller\n * @name CbCompanyCtrl\n * @module cabinet.controllers\n * @description\n *   公司文件柜列表页控制器\n */\n.controller('CbCompanyCtrl', function($scope, $state, $stateParams, Settings, Cabinet, ACCESS){\n  $scope.cb = new Cabinet(Settings.rootUrl + '/companyfile');\n  $scope.cb.fetch($stateParams)\n  .success(function(res) {\n    $scope.title = res.pDir.name;\n  });\n\n  $scope.cb.openFolder = function(file){\n    $state.go('cabinet.company', { pid: file.fid });\n  }\n\n  var _showMenu = $scope.cb.showMenu;\n\n  $scope.cb.showMenu = function(file){\n    _showMenu.call($scope.cb, file, {\n      remove: !file.access || file.access == ACCESS.WRITABLE\n    });\n  }\n})\n\n\n/**\n * @ngdoc controller\n * @name CbReceiveCtrl\n * @module cabinet.controllers\n * @description\n *   收到的共享，人员列表控制器\n */\n.controller('CbReceivedCtrl', function($scope, CabinetReceived) {\n  \n  $scope.users = [];\n\n  CabinetReceived.fetch()\n  .success(function(res){\n    $scope.users = res.data;\n  });\n\n  $scope.search = function(keyword) {\n    CabinetReceived.fetch({\n      keyword: keyword,\n      normal_search: 1,\n      search: 1\n    })\n    .success(function(res){\n      $scope.users = res.data;\n    })\n  }\n})\n\n\n/**\n * @ngdoc controller\n * @name CbReceiveUserCtrl\n * @module cabinet.controllers\n * @description\n *   收到的共享，人员详细文件列表页控制器\n */\n.controller('CbReceiveUserCtrl', function($scope, $state, $stateParams, Settings, Cabinet){\n  $scope.cb = new Cabinet(Settings.hostUrl + '?r=file/fromshare');\n  $scope.cb.fetch($stateParams)\n  .success(function(res) {\n    if(res.breadCrumbs.length === 1) {\n      $scope.title = res.breadCrumbs[0].realname;\n    } else if(res.breadCrumbs.length > 1){\n      $scope.title = res.breadCrumbs[res.breadCrumbs.length - 1].name;\n    }\n  });\n\n  $scope.cb.openFolder = function(file){\n    $state.go('cabinet.user', { pid: file.fid });\n  }\n\n  var _showMenu = $scope.cb.showMenu;\n\n  $scope.cb.showMenu = function(file){\n    _showMenu.call($scope.cb, file, {\n      remove: false\n    });\n  }\n})\n\n","/**\n * @ngdoc module\n * @name cabinet.filters\n * @description\n *   文件柜模块过滤器\n */\n\nangular.module('cabinet.filters', [])\n","/**\n * @ngdoc module\n * @name cabinet.services\n * @description\n *   文件柜模块相关服务\n */\nangular.module('cabinet.services', [])\n\n.constant('ACCESS', {\n  WRITABLE: '2',\n  READABLE: '1'\n})\n\n.constant('FILETYPE', {\n  FOLDER: '1',\n  FILE: '0'\n})\n\n/**\n * @ngdoc service\n * @name Cabinet\n * @module cabinet.services\n * @description\n *   文件模块数据交互及处理\n */\n.factory('Cabinet', function($http, $state, $filter, $stateParams, $ionicLoading, $ionicPopup, $ionicActionSheet, fullUrlFilter, Settings, ImgViewer, Downloader, FILETYPE){\n\n  function Cabinet(moduleUrl){\n    this.moduleUrl = moduleUrl;\n    this.pid = 0;\n    this.files = [];\n  }\n\n  /**\n   *\n   * @ngdoc method\n   * @name Cabinet#fetch\n   * @description \n   *   获取文件列表数据\n   *   返回数据格式为\n   *   {\n   *     breadCrumbs: Array  // 面包屑\n   *     data: Array         // 文件列表\n   *     pDir: Object        // 父目录\n   *     page: Object        // 页码\n   *     pid: 0              // 父目录 id\n   *   }\n   * @param {Obejct} param 查询条件，可能包括 pid | keyword...\n   * @returns {Object} promise\n   */\n  Cabinet.prototype.fetch = function(param) {\n    var _this = this;\n\n    $ionicLoading.show();\n\n    param = param || {};\n\n    var httpPromise = $http.get(this.moduleUrl + '/getcate', {\n        params: angular.extend({\n          pid: this.pid,\n        }, param)\n      })\n      .success(function(res){\n        _this.files = res.data;\n        _this.pid = param.pid || _this.pid;\n      })\n      .error(Settings.requestError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n\n    return httpPromise;\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#search\n   * @description \n   *   通过关键字搜索文件\n   * \n   * @param {String} keyword  关键字\n   * @returns {Object} promise\n   */\n  Cabinet.prototype.search = function(keyword) {\n    return this.fetch(angular.extend({}, $stateParams, {\n      keyword: keyword,\n      normal_search: 1,\n      search: 1\n    }))\n  }\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#open\n   * @description \n   *   打开文件\\文件夹，根据文件类型进入对应打开方法\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.open = function(file) {\n    if(file.type == FILETYPE.FOLDER) {\n      this.openFolder(file)\n    // thumb属性指向图像缩略图，目前可根据此属性判断是否图像\n    // fileurl 指向文件源地址\n    } else if(file.thumb) {\n      this.openImage(file);\n    } else {\n      this.download(file);\n      // FileViewer.view(file.filetype, $filter('attachUrl')(file.fileurl))\n    }\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#openFolder\n   * @description \n   *   打开文件夹，实际行为是跳转到该文件夹对应路由\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.openFolder = function(file) {\n    $state.go('cabinet.personal', { pid: file.fid });\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#openImage\n   * @description \n   *   查看图片\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.openImage = function(file) {\n    var srcs = [];\n    angular.forEach(this.files, function(f) {\n      if(f.thumb) {\n        srcs.push(fullUrlFilter(f.fileurl));\n      }\n    });\n\n    ImgViewer.view(fullUrlFilter(file.fileurl), srcs);\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#download\n   * @description \n   *   下载文件\\文件夹\n   * \n   * @param {Object} file  文件对象\n   * @returns\n   */\n  Cabinet.prototype.download = function(file) {\n    Downloader.down(fullUrlFilter(file.entireattachurl || file.officereadurl));\n  };\n\n  /**\n   * @ngdoc method\n   * @name Cabinet#showMenu\n   * @description \n   *   显示操作菜单\n   * \n   * @param {Object} file  文件对象\n   * @param {Object} opt  菜单项配置\n   *   * 可配置项包括 remove(删除)、download(下载)、share(共享)\n   *   * 目前共享功能不可用\n   * @returns\n   */\n  Cabinet.prototype.showMenu = function(file, opt) {\n\n    var _this = this;\n    var buttons = [];\n    var handlers = [];\n\n    opt = angular.extend({\n      remove: true,\n      download: true,\n      share: false // 暂时屏蔽共享功能\n    }, opt)\n\n    // 下载按钮\n    if(opt.download) {\n      buttons.push({ text: '下载' });\n      handlers.push(function(file){\n        _this.download(file);\n      });\n    }\n\n    // 共享按钮\n    if(opt.share) {\n      buttons.push({ text: '共享' });\n      handlers.push(function(file){\n        _this.share(file);\n      })\n    }\n\n    var conf = {\n      titleText: '文件操作',\n      buttons: buttons,\n      buttonClicked: function(index) {\n        handlers[index](file);\n        return true;\n      },\n      cancelText: '取消'\n    }\n\n    // 删除按钮\n    if(opt.remove) {\n      conf.destructiveText = '删除';\n      conf.destructiveButtonClicked = function(){\n        _this.remove(file);\n      }\n    }\n\n    this.hideMenu = $ionicActionSheet.show(conf);\n  };\n\n  function removeFile(file, files) {\n    angular.forEach(files, function(f, i){\n      if(file.fid == f.fid) {\n        files.splice(i, 1);\n        return false;\n      }\n    });\n  }\n\n  /**\n   *\n   * @ngdoc method\n   * @name Cabinet#remove\n   * @description \n   *   删除指定 文件或文件夹至回收站\n   * @param {String} fid  文件标识符|索引\n   * @returns {Object} promise\n   */\n  Cabinet.prototype.remove = function(file) {\n    var _this = this;\n\n    $ionicPopup.confirm({\n      title: '提示',\n      template: '确定删除该文件/文件夹吗？',\n      okText: '确定',\n      cancelText: '取消'\n    })\n    .then(function(res) {\n      if(res) {\n        return $http.get(_this.moduleUrl + '/del&op=recycle', {\n          params: { fids: file.fid }\n        })\n        .error(Settings.requestError)\n        .success(function(res) {\n          if(res.isSuccess) {\n            removeFile(file, _this.files);\n            _this.hideMenu();\n          }\n        });\n      }\n    });\n    \n  };\n\n  return Cabinet;\n})\n\n.factory('CabinetReceived', function($http, $ionicLoading, Settings){\n\n  var url = Settings.hostUrl + '?r=file/fromshare/getcate';\n\n  function fetch(params) {\n    $ionicLoading.show();\n\n    return $http.get(url, {\n      params: params\n    })\n    .error(Settings.requestError)\n    .success($ionicLoading.hide)\n    .error($ionicLoading.hide)\n  }\n\n  return {\n    fetch: fetch\n  };\n})\n","/**\n * Calendar\n * 日程模块入口\n */\nangular.module('calendar', ['ionic', 'calendar.controllers', 'calendar.services', 'calendar.filters'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'calendar', title: '日程', route: '#/calendar', state: 'calendar', icon: 'img/modicon/calendar.png' });\n})\n\n.constant('DATE_FORMAT', 'yyyy-MM-dd')\n\n.constant('TIME_FORMAT', 'HH:mm')\n\n.constant('DAY_MILLISECOND', 86400000)\n\n.config(function($stateProvider, UserProvider) {\n\n  $stateProvider\n\n    .state('calendar', {\n      url: '/calendar',\n      templateUrl: 'templates/calendar/calendar.html',\n      talkingDataLabel: '日程-首页',\n      controller: 'CalendarCtrl',\n      resolve: UserProvider.resolve\n    })\n\n    .state('calendar-create', {\n      url: '/create',\n      templateUrl: 'templates/calendar/detail.html',\n      talkingDataLabel: '日程-创建',\n      controller: 'CalendarCreateCtrl',\n      resolve: UserProvider.resolve\n    })\n\n    .state('calendar-detail', {\n      url: '/calendar/:calendarId',\n      templateUrl: 'templates/calendar/detail.html',\n      talkingDataLabel: '日程-查看',\n      controller: 'CalendarDetailCtrl',\n      resolve: UserProvider.resolve\n    });\n\n});\n","/**\n * Calendar\n * calendar.controllers\n * 日程模块控制器\n * @P.s 日程模块用到的 cEvts 指代日程记录，跟 js 意义的事件没有任何关系\n */\n\nangular.module('calendar.controllers', [])\n\n/**\n * @ngdoc controller\n * @name CalendarCtrl\n * @module calendar.controllers\n * @description\n *   日程列表页页面控制器\n */\n  .controller('CalendarCtrl', function($scope, $ionicScrollDelegate, $ionicLoading, Calendar, CalendarUtil ,User, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        if(res.data.calendar){\n          $scope.title = '我的日程';\n\n          $scope.calendars = [];\n          $scope.calendars.loaded = false;\n\n          // 初始化控制器时，自动获取数据, 自动获取下月和本月的日程\n          Calendar.fetch(CalendarUtil.getDateRange())\n            .success(function(data){\n              $scope.calendars = CalendarUtil.groupEvents(data.events);\n              $scope.calendars.loaded = true;\n            });\n\n          $scope.$on('$ionicView.beforeLeave', function() {\n            $ionicScrollDelegate.scrollTop();\n          });\n        } else{\n          Utils.promptNoPermission();\n        }\n      }\n    }\n    ).finally($ionicLoading.hide)\n  })\n\n/**\n * @ngdoc controller\n * @name CalendarCreateCtrl\n * @module calendar.controllers\n * @description\n *   日程新建页页面控制器\n */\n  .controller('CalendarCreateCtrl', function($scope, $state, $ionicHistory, $ionicLoading, Calendar, CalendarUtil, DAY_MILLISECOND){\n\n    $scope.title = \"新建日程\";\n\n    var date = CalendarUtil.getCurrentDateTime();\n\n    // 日程默认数据\n    $scope.calendar = {\n      isalldayevent: false,\n      editable: true,\n      category: 0,\n\n      startDate: date,\n      endDate: new Date(+date + DAY_MILLISECOND),\n\n      startTime: date,\n      endTime: new Date(+date + DAY_MILLISECOND / 12)\n    };\n\n    //开启全天模式时，结束日期应比开始日期晚一天\n    $scope.$watch('calendar.startDate', function (newStartDate) {\n      if($scope.calendar.isalldayevent){\n        $scope.calendar.endDate = new Date( +newStartDate + DAY_MILLISECOND)\n      }\n    });\n\n    // 表示表单是否正处于提交状态\n    function resetSubmit(){\n      $scope.isSubmiting = false;\n      $ionicLoading.hide();\n    }\n\n    // 正在提交表单\n    function doSubmit() {\n      $scope.isSubmiting = true;\n      $ionicLoading.show({ delay: 300 });\n    }\n\n    $scope.submit = function(){\n      console.log($scope.calendar)\n      doSubmit();\n      Calendar.create(Calendar.formatSubmitData($scope.calendar))\n        .success(function(){\n          $ionicHistory.clearCache().then(function(){\n            $state.go('calendar');\n          });\n          // $state.go('calendar');\n        })\n        .finally(resetSubmit);\n    }\n  }\n)\n\n/**\n * @ngdoc controller\n * @name CalendarDetailCtrl\n * @module calendar.controllers\n * @description\n *   日程详情页, 日程模块详细页与编辑功能结合在一起\n */\n  .controller('CalendarDetailCtrl', function($scope, $state, $timeout, $stateParams, $ionicPopup, $ionicHistory, $ionicLoading, Calendar, CalendarUtil, IbPopup){\n\n    $scope.title = \"编辑日程\";\n\n    // 获取当前 id 对应的日程数据\n    Calendar.get($stateParams.calendarId)\n      .success(function(res){\n        if(res && res != 'null') {\n          // 所以目前要格式化为期望格式\n          $scope.calendar = CalendarUtil.parseTime(res);\n        } else {\n          $ionicPopup.alert({\n            title: '提示',\n            template: '找不到相关日程数据，将返回日程列表'\n          })\n            .then(function(){\n              $state.go('calendar')\n            })\n        }\n      });\n\n    // 表示表单是否正处于提交状态\n    function resetSubmit(){\n      $scope.isSubmiting = false;\n      $ionicLoading.hide();\n    }\n\n    // 正在提交表单\n    function doSubmit() {\n      $scope.isSubmiting = true;\n      $ionicLoading.show({ delay: 300 });\n    }\n\n    // 保存\n    $scope.submit = function(){\n      doSubmit();\n      Calendar.update(Calendar.formatSubmitData($scope.calendar))\n        .success(function(){\n          $ionicHistory.clearCache().then(function() {\n            $state.go('calendar');\n          });\n        })\n        .finally(resetSubmit);\n    }\n\n    // 删除\n    $scope.remove = function(){\n      doSubmit();\n      Calendar.removeOne($scope.calendar.calendarid)\n        .success(function(){\n          IbPopup.tip('删除成功!').then(function() {\n            $ionicHistory.clearCache().then(function() {\n              $state.go('calendar');\n            });\n          });\n        })\n        .finally(resetSubmit);\n    }\n\n    // 完成日程\n    $scope.finish = function(){\n      if($scope.calendar.status == '0') {\n        doSubmit();\n        var parsed = CalendarUtil.parseTime($scope.calendar);\n\n        Calendar.finish(Calendar.formatSubmitData(parsed))\n          .success(function(){\n            $ionicHistory.clearCache();\n            $scope.calendar.status = '1';\n          })\n          .finally(resetSubmit);\n      }\n\n    }\n\n    // 取消完成日程\n    $scope.unfinish = function(){\n      if($scope.calendar.status == '1') {\n        doSubmit();\n        var parsed = CalendarUtil.parseTime($scope.calendar);\n\n        Calendar.unfinish(Calendar.formatSubmitData(parsed))\n          .success(function(){\n            $ionicHistory.clearCache();\n            $scope.calendar.status = '0';\n          })\n          .finally(resetSubmit);\n      }\n    }\n  }\n)\n\n","/**\n * Calendar\n * 日程模块过滤器\n */\n\nangular.module('calendar.filters', [])\n\n.filter('calendarTheme', function(){\n  var themeSeries = ['#3497DB', '#A6C82F', '#F4C73B', '#EE8C0C', '#E76F6F', '#AD85CC', '#98B2D1', '#82939E']\n  return function(category){\n    // 由于在后台处理数据时，给予的默认值是 -1，对应的是主题数组中的第一个。\n    category = (category && category) != '-1' ? category : 0;\n    return themeSeries[category || 0];\n  };\n})\n\n.filter('dayFormToday', function(){\n\treturn function(day){\n\t\tswitch(day) {\n\t\t\tcase 0:\n\t\t\t\treturn '今天';\n\n\t\t\tcase 1:\n\t\t\t\treturn '明天';\n\n\t\t\tcase 2:\n\t\t\t\treturn '后天';\n\n\t\t\tcase -1:\n\t\t\t\treturn '昨天';\n\n\t\t\tcase -2:\n\t\t\t\treturn '前天';\n\n\t\t\tdefault:\n\t\t\t\treturn day > 0 ? day + '天后' : -day + '天前';\n\t\t}\n\t}\n})\n\n.filter('calendarDate', [\n\t'$filter',\n\t'DAY_MILLISECOND',\n\t'DATE_FORMAT',\n\n\tfunction($filter, DAY_MILLISECOND, DATE_FORMAT){\n\t\t/**\n\t\t * @ngdoc method\n\t\t * @name CalendarUtil#formatDate\n\t\t * @description\n\t\t *   使用 dateFilter 格式化日期为 yyyy-MM-dd 格式\n\t\t *   \n\t\t * @param {object|string|number} date  日期对象、合法的日期字符串、时间戳\n\t\t * @param {number} dayOffset  与传入日期的天数差\n\t\t * @returns {stirng}\n\t\t */\n\t\tfunction formatDate(date, dayOffset){\n\t\t  date = date || new Date();\n\n\t\t  if(dayOffset) {\n\t\t    date = +date + dayOffset * DAY_MILLISECOND;\n\t\t  }\n\n\t\t  return dateFilter(date, DATE_FORMAT);\n\t\t}\n\n\t\treturn formatDate;\n\t}\n])\n\n.filter('calendarTime', [\n\t'$filter',\n\t'DAY_MILLISECOND',\n\t'TIME_FORMAT',\n\n\tfunction($filter, DAY_MILLISECOND, TIME_FORMAT){\n\t\t/**\n\t\t * @ngdoc method\n\t\t * @name CalendarUtil#formatTime\n\t\t * @description\n\t\t *   使用 dateFilter 格式化日期为 HH:mm 格式\n\t\t *   \n\t\t * @param {object} date  日期对象\n\t\t * @param {number} minuteOffset  与传入日期的天数差\n\t\t * @returns {stirng}\n\t\t */\n\t\tfunction formatTime(date, minuteOffset){\n\t\t  date = date || new Date();\n\n\t\t  if(minuteOffset) {\n\t\t    date = +date + minuteOffset * DAY_MILLISECOND / 1440;\n\t\t  }\n\n\t\t  return dateFilter(date, TIME_FORMAT);\n\t\t}\n\t}\n])\n\n","/**\n * @!ngdoc module\n * @name calendar.services\n * @description\n *   Calendar\n *   日程模块相关服务\n */\nangular.module('calendar.services', [])\n\n/**\n * @ngdoc service\n * @name calendar.services.Calendar\n * @description\n * 日程模块的一些数据处理函数，数据持续化功能\n */\n.factory('Calendar', function($http, $filter, $ionicLoading, $cacheFactory, Settings, CalendarUtil){\n\n    var moduleUrl = Settings.rootUrl + \"/calendar\";\n    var cache = $cacheFactory('calendars');\n    var dateFilter = $filter('date');\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#fetch\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   获取日程列表数据，目前 fetch 获取的是由本月和下月日程的数据\n     * @returns {object}\n     */\n    function fetch(params){\n\n      $ionicLoading.show();\n\n      var httpPromise = $http.get(moduleUrl, {\n          params: params,\n          transformResponse: function(){\n            var data =  $http.defaults.transformResponse[0].apply(null, arguments);\n            data.events = CalendarUtil.parseEvents(data.events);\n            return data;\n          }\n        })\n        .success(function(data){\n          // if(data.events){\n          //   cache.put('events', data.events);\n          // }\n        })\n        .error(Settings.requestError)\n        .success($ionicLoading.hide)\n        .error($ionicLoading.hide)\n\n      return httpPromise;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#get\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   获取指定 ID 的日程数据\n     * @param {String|Number} id         日程 ID\n     * @param  {Boolean} fromCache       是否优先从缓存集合中读取\n     * @returns {object}                 日程数据\n     */  \n    function get(id, fromCache){\n      var ret;\n      // if(fromCache){\n\n      //   return;\n      // } \n      \n      $ionicLoading.show();\n      return $http.get(moduleUrl + '/show', {\n        params: { id: id },\n        transformResponse: function(){\n          var data =  $http.defaults.transformResponse[0].apply(null, arguments);\n          return CalendarUtil.parseEvent(data);\n        }\n      })\n      .error(Settings.requestError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    }\n    \n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#formatSubmitData\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   格式化表单数据为后端可用的数据格式\n     *   由于后端代码比较老旧，其命名规则及数据格式都不符合现在的规范\n     *   在重构之前需要使用此函数做转化\n     *\n     * @param {object} data 表单数据\n     * @returns {object}\n     */\n    function formatSubmitData(data){\n\n      // 全天日程时，不计算时分\n      if(data.isalldayevent == 1) {\n        data.startTime = data.endTime = \"00:00\";\n      // 非全天日程时，结束日期与开始日期相同\n      } else {\n        data.endDate = data.startDate;\n      }\n\n      var startDatetime = CalendarUtil.formatDate(data.startDate) + ' ' + CalendarUtil.formatTime(data.startTime);\n      var endDatetime =  CalendarUtil.formatDate(data.endDate) + ' ' + CalendarUtil.formatTime(data.endTime);\n\n      return {\n        calendarId:          data.calendarid,\n        CalendarTitle:       data.subject,\n        Subject:             data.subject,\n        Category:            data.category,\n        IsAllDayEvent:       +data.isalldayevent,\n        CalendarStartTime:   startDatetime,\n        CalendarStartTimeed: startDatetime,\n        CalendarEndTime:     endDatetime,\n        CalendarEndTimeed:   endDatetime\n      }\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.Calendar#create\n     * @methodOf  calendar.services.Calendar\n     * @description\n     *   创建一条日程并同步到持续层\n     * @param {object} data 日程相关数据，[必要字段包括CalendarTitle, Category, IsAllDayEvent, CalendarStartTime, CalendarEndTime]\n     * @returns {object} $http post 返回的 promise 对象\n     */\n    function create(data){\n      return $http.post(moduleUrl + '/add', data)\n      .error(Settings.requestError)\n    }\n\n    function update(data){\n      return $http.post(moduleUrl + '/edit', data)\n      .error(Settings.requestError)\n    }\n\n    function finish(calendar){\n      return $http.post(moduleUrl + '/edit&op=finish', calendar);\n    }\n\n    function unfinish(calendar){\n      return $http.post(moduleUrl + '/edit&op=nofinish', calendar);\n    }\n\n    function removeOne(id){\n      return $http.post(moduleUrl + '/del', {\n          calendarId: id,\n          doption: 'this'\n        }\n      )\n      .error(Settings.requestError)\n    }\n\n    return {\n      fetch: fetch,\n      get: get,\n      create: create,\n      update: update,\n      formatSubmitData: formatSubmitData,\n      finish: finish,\n      unfinish: unfinish,\n      removeOne: removeOne,\n      cache: cache\n    }\n})\n\n/**\n * @ngdoc service\n * @module calendar.services.CalendarUtil\n * @description\n *   日程相关工具函数\n */\n.factory('CalendarUtil', function($filter, DATE_FORMAT, TIME_FORMAT, DAY_MILLISECOND){\n    // 日程数据输入的时间格式形如/Date(1409803200000)/，需要匹配出正确的时间戳\n    var dateReg = /\\/Date\\((\\d+)\\)\\//;\n    var dateFilter = $filter('date');\n\n    function parseDateStr(dateStr){\n      var results = dateReg.exec(dateStr);\n      return results ? +results[1] : 0;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.CalendarUtil#parseEvents\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   格式化日程列表数据\n     *   目前后端返回日程数据时，列表的数据跟单条的数据格式差异太大\n     *   为避难混乱，以单条返回时的数据格式为准\n     *   {\n     *     calendarid:    \"9916\",\n     *     subject:       \"十六夜\"\n     *     isalldayevent: \"1\",\n     *     starttime:     \"1409500800000\",\n     *     endtime:       \"1409500800000\",\n     *     category:      \"4\",\n     *     status:        \"0\",\n     *     editable:      1\n     *   }\n     * @param {array} cEvts  原始日程数据\n     * @returns {array}\n     */\n    function parseEvents(cEvts){\n      var ret = [];\n      // 按日期分组，插入表示日期的数据\n      angular.forEach(cEvts, function(cEvt) {\n\n        // 由于周期性日程 id 具有特殊性，需要去除前11位字符\n        ret.push({\n          calendarid:     cEvt.type == '1' ? cEvt.id.substr(11) : cEvt.id,\n          // type == '1' 为周期性日程, '0' 为其他日程\n          instancetype:   cEvt.type,\n          subject:        cEvt.title,\n          isalldayevent:  cEvt.allDay,\n          starttime:      parseDateStr(cEvt.start),\n          endtime:        parseDateStr(cEvt.end),\n          category:       cEvt.category,\n          status:         cEvt.status,\n          editable:       cEvt.editable\n        })\n      });\n\n      return ret;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.CalendarUtil#parseEvent\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   格式化单条日程数据\n     *   主要处理时间戳不一致的问题\n     * @param {array} cEvt  原始日程数据\n     * @returns {array}\n     */\n    function parseEvent(cEvt){\n      return angular.extend(cEvt, {\n        starttime: cEvt.starttime ? +cEvt.starttime * 1000 : 0,\n        endtime: cEvt.endtime ? +cEvt.endtime * 1000: 0\n      });\n    }\n\n    function dayFormToday(date){\n      var now = new Date;\n        // 获取今天 0 时的 date 对象\n      var today = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n\n      var timeOffset = +date - +today;\n\n      return Math.floor(timeOffset / DAY_MILLISECOND);\n    }\n\n    // 将日程数据按日期排序并分组\n    function groupEvents(cEvts){\n      if(!cEvts || !cEvts.length) {\n        return cEvts;\n      }\n\n      var results = [];\n      var dateField = '';\n\n      // 排序，按开始时间倒序 \n      cEvts = cEvts.sort(function(a, b){\n        return b.starttime - a.starttime;\n      });\n\n      // 按日期分组，插入表示日期的数据\n      angular.forEach(cEvts, function(cEvt) {\n\n        var field = dateFilter(cEvt.starttime, DATE_FORMAT);\n\n        if(field !== dateField) {\n          results.push({\n            isDateField: true,\n            dateField: field,\n            startTime: cEvt.starttime,\n            dayFormToday: dayFormToday(cEvt.starttime)\n          });\n          dateField = field;\n        }\n\n        results.push(cEvt);\n      });\n\n      return results;\n    }\n\n    /**\n     * @ngdoc method\n     * @name      calendar.services.CalendarUtil#formatDate\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   使用 dateFilter 格式化日期为 yyyy-MM-dd 格式\n     *   \n     * @param {object|string|number} date  日期对象、时间戳\n     * @param {number} dayOffset  与传入日期的天数差\n     * @returns {stirng}\n     */\n    function formatDate(date, dayOffset){\n      \n      if(!date) {\n        return '';\n      }\n\n      if(dayOffset) {\n        date = +date + dayOffset * DAY_MILLISECOND;\n      }\n\n      return dateFilter(date, DATE_FORMAT);\n    }\n\n    /**\n     * @ngdoc     method\n     * @name      calendar.services.CalendarUtil#formatTime\n     * @methodOf  calendar.services.CalendarUtil\n     * @description\n     *   使用 dateFilter 格式化日期为 HH:mm 格式\n     *   \n     * @param {object} date  日期对象\n     * @param {number} minuteOffset  与传入日期的天数差\n     * @returns {stirng}\n     */\n    function formatTime(date, minuteOffset){\n      if(!date) {\n        return '';\n      }\n\n      if(minuteOffset) {\n        date = +date + minuteOffset * DAY_MILLISECOND / 1440;\n      }\n\n      return dateFilter(date, TIME_FORMAT);\n    }\n\n    function parseTime(calendarData){\n      var startTime = new Date(calendarData.starttime),\n          endTime = new Date(calendarData.endtime);\n\n      return angular.extend({}, calendarData, {\n        startDate: startTime,\n        endDate: endTime,\n        startTime: startTime,\n        endTime: endTime\n      })\n    }\n\n    /**\n     * @ngdoc     method\n     * @name      calendar.services.CalendarUtil#getDateRange\n     * @methodOf  calendar.services.CalendarUtil\n     * \n     * @description\n     *   日程默认显示本月及下月的安排\n     *   此方法获取本月的开始日期和及下月的结束日期\n     *   \n     * @returns   {Object}   包含 startDate 和 endDate 两个属性 格式为 yyyy-MM-dd\n     */\n    function getDateRange() {\n      var now = new Date();\n      var year = now.getFullYear();\n      var month = now.getMonth();\n\n      // 计算下月 1 号\n      // 考虑跨年的情况\n      var startDate = new Date(year, month, 1, 0, 0, 0);\n      // 计算下两月 1 号再减一天\n      var endDate = new Date(new Date(\n        month == 10 ? year + 1: year,\n        month == 10 ? 0 : month + 2,\n        1, 0, 0, 0\n      ) - DAY_MILLISECOND)\n\n      return {\n        startDate: dateFilter(startDate, DATE_FORMAT),\n        endDate: dateFilter(endDate, DATE_FORMAT)\n      }\n    }\n\n    \n    /**\n     * @ngdoc     method\n     * @name      calendar.services.CalendarUtil#getCurrentDateTime\n     * @methodOf  calendar.services.CalendarUtil\n     * @description \n     *   获取当前日期和时分\n     * \n     * @returns   {Date}  日期对象\n     */\n    function getCurrentDateTime() {\n      var date = new Date();\n      date.setSeconds(0);\n      date.setMilliseconds(0);\n      return date;\n    }\n\n    return {\n      parseEvents: parseEvents,\n      groupEvents: groupEvents,\n      formatDate: formatDate,\n      formatTime: formatTime,\n      parseTime: parseTime,\n      parseEvent: parseEvent,\n      getDateRange: getDateRange,\n      getCurrentDateTime: getCurrentDateTime\n    };\n})\n\n/**\n * @ngdoc directive\n * @name calendar.services.directive:calenderColorpicker\n * @element ANY\n * @restrict E\n * @function\n * \n * @description\n *    日程颜色选择器\n *    日程的选色器没有通用性，所以这里为减少复杂度不提供对外接口\n */\n.directive('calenderColorpicker', function($ionicModal) {\n\n  var modalTemplate = '<ion-modal-view>' +\n    '<ion-header-bar>' +\n      '<button type=\"button\" class=\"button button-icon icon\" ng-click=\"hideColorPicker()\">取消</button>' +\n      '<h1 class=\"title\">选择日程颜色</h1>' +\n    '</ion-header-bar>' +\n    '<ion-content>' +\n      '<ion-list>' +\n        '<ion-item ng-repeat=\"color in colors\" ng-click=\"selectColor($index)\" style=\"background-color: {{color}}\">&nbsp;</ion-item>' +\n      '</ion-list>' +\n      '</ion-content>' +\n  '</ion-modal-view>';\n\n  return {\n    restrict: 'E',\n    replace: true,\n    require: '?ngModel',\n    scope: true,\n    // transclude: true,\n    \n    template:\n      '<div class=\"calendar-colorpicker-toggle\">' +\n          '<input type=\"hidden\">' +\n      '</div>',\n\n    compile: function(element, attr) {\n      // 过继各种有效属性到内部的 input\n      var input = element.find('input');\n\n      angular.forEach({\n        'name': attr.name,\n        'ng-value': attr.ngValue,\n        'ng-model': attr.ngModel,\n        'ng-disabled': attr.ngDisabled,\n        'ng-change': attr.ngChange\n      }, function(value, name) {\n        if (angular.isDefined(value)) {\n          input.attr(name, value);\n        }\n      });\n\n      // Link\n      return function($scope, elem, attrs){\n        var modal = $ionicModal.fromTemplate(modalTemplate, {\n          scope: $scope,\n          animation: 'slide-in-up'\n        });\n\n        var ngModelController = angular.element(input).controller('ngModel');\n\n        elem.on('click', function(){\n          modal.show();\n        });\n\n        $scope.colors = ['#3497DB', '#A6C82F', '#F4C73B', '#EE8C0C', '#E76F6F', '#AD85CC', '#98B2D1', '#82939E'];\n\n        $scope.colorpickerModal = modal;\n\n        $scope.showColorPicker = function() {\n          $scope.colorpickerModal.show();\n        };\n\n        $scope.hideColorPicker = function() {\n          $scope.colorpickerModal.hide();\n        };\n\n        $scope.$on('$destroy', function() {\n          $scope.colorpickerModal.remove();\n        });\n\n        $scope.selectColor = function(index) {\n          ngModelController.$setViewValue(index);\n          $scope.hideColorPicker();\n        }\n      }\n    }\n  };\n})\n\n/**\n * @ngdoc directive\n * @name calendar.services.directive:currentDate\n * @element ANY\n * @restrict A\n * @function\n * \n * @description\n *    滚动至当前日期\n */\n.directive('currentDate', function($ionicPosition, $ionicScrollDelegate){\n\n  return {\n    restrict: 'A',\n\n    compile: function(element, attr) {\n      // Link\n      return function($scope, elem, attrs){\n        $ionicScrollDelegate.scrollTo(0, $ionicPosition.position(elem).top || 0)\n      }\n    }\n  };\n})\n","/**\n * @ngdoc module\n * @name contacts\n * @description\n *   通讯录模块入口\n */\n\nangular.module('contacts', ['ionic', 'contacts.controllers','contact.services'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'contacts', title: '通讯录', route: '#/contacts', state: 'contacts.list', icon: 'img/modicon/contacts.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider) {\n\n  $urlRouterProvider.when('/contacts', '/contacts/list/')\n\n  $stateProvider\n\n  .state('contacts', {\n    url: \"/contacts\",\n    abstract: true,\n    template: '<ion-nav-view name=\"contacts\"></ion-nav-view>',\n    resolve: {\n      user: function(User) {\n        if(!User.isLogin) return User.login();\n      }\n    }\n  })\n\n  .state('contacts.list', {\n    url: '/list/:deptid',\n    talkingDataLabel: '通讯录-首页',\n    views: {\n      'contacts': {\n        templateUrl: 'templates/contacts/contacts.html',\n        controller: 'ContactsCtrl',\n      }\n    }\n\n  })\n\n  .state('contacts.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '通讯录-查看页',\n    views: {\n      'contacts': {\n        templateUrl: 'templates/contacts/contacts-detail.html',\n        controller: 'ContactsDetailCtrl',        \n      }\n    }\n  })\n    .state('contacts.group', {\n      url: '/group/:id',\n      talkingDataLabel: '通讯录-分组查看页',\n      views: {\n        'contacts': {\n          templateUrl: 'templates/contacts/contact-group-detail.html',\n          controller: 'ContactsGroupDetailCtrl',\n        }\n      }\n    })\n\n});","/**\n * @ngdoc module\n * @name contacts.controllers\n * @description\n *   通讯录模块控制器\n */\nangular.module('contacts.controllers', [])\n\n/**\n * @ngdoc controller\n * @name ContactsCtrl\n * @module contacts.controllers\n * @description\n *   列表页控制器\n */\n  .controller('ContactsCtrl', function($scope, $ionicLoading, $stateParams, $ionicHistory, $ionicScrollDelegate, $ionicModal, $state, $q, IbPopup, SearchModal, Contact){\n    var $ionContent = angular.element(document.querySelector('ion-content'));\n    var popupPromise;\n    function getDeptList(params) {\n      $ionicLoading.show();\n      Contact.getDeptList(params).success(function(res) {\n        if(res.isSuccess) {\n          $scope.deptInfo = res.data;\n          $scope.categories  = res.data.depts;\n          $scope.currentCategory = $scope.deptInfo;\n          var deptid = res.data.deptid;\n          if(deptid == '0'){\n            $scope.currentCategory.title = '通讯录';\n          } else {\n            $scope.categorys = $scope.deptInfo.crumb;\n          }\n\n        } else {\n          if(popupPromise && popupPromise.$$state.status === 0) return;\n          popupPromise = IbPopup.alert({ title: res.msg }).then(function(){\n            $ionicHistory.goBack();\n          });\n        }\n      })\n        .finally($ionicLoading.hide)\n    }\n\n    function getUserList(params) {\n      $ionicLoading.show();\n      Contact.getUserList(params).success(function(res) {\n        if(res.isSuccess) {\n          $scope.users = res.data;\n        } else {\n          if(popupPromise && popupPromise.$$state.status === 0) return;\n          popupPromise = IbPopup.alert({ title: res.msg });\n        }\n      })\n        .finally($ionicLoading.hide)\n    }\n\n    var deptid = $stateParams.deptid || 0;\n\n    getDeptList({ deptid: deptid });\n    getUserList({ deptid: deptid });\n\n    $scope.enterCategory = function(category) {\n      $state.go('contacts.list', category);\n    };\n\n    //去到某一个分类\n    $scope.toCategory = function(category){\n      var page = category - ($scope.categorys.length );\n      $ionicHistory.goBack(page);\n    };\n\n    $scope.search = new SearchModal({\n      scope: $scope,\n      searchFunc: function(params){\n        return Contact.search({\n          search: params.key,\n          deptid: $scope.deptInfo.deptid\n        });\n      }\n    });\n\n    //滚动固定面包屑\n    $scope.showsearchbar = true;\n\n    function onScroll(evt) {\n      var distance = evt.detail.scrollTop;\n      $scope.$applyAsync(function() {\n        $scope.showsearchbar = distance > 44 ? false : true;\n      });\n    }\n\n    $scope.$on('$ionicView.enter', function() {\n      $ionContent.on('scroll', onScroll);\n    });\n    $scope.$on('$ionicView.leave', function() {\n      $ionContent.off('scroll', onScroll);\n    });\n\n    // 监听路径历史，自动将面包屑滚动到末端\n    var breadcrumbScrollInstance = $ionicScrollDelegate.$getByHandle('contact-breadcrumb-scroll');\n    $scope.$watchCollection('histories', function() {\n      breadcrumbScrollInstance.scrollBottom(true);\n    });\n\n  })\n\n  .controller('ContactsDetailCtrl', function($scope, $stateParams, $ionicLoading, $state, IbPopup, Contact){\n    $ionicLoading.show();\n    $scope.user = [];\n    Contact.getUserInfo($stateParams.id).success(function(res) {\n      res.isSuccess ? $scope.user = res.data : IbPopup.alert({ title: res.msg });\n    })\n      .finally($ionicLoading.hide)\n  })\n\n  .controller('ContactsGroupDetailCtrl', function($scope, $stateParams, $ionicLoading, IbPopup, Contact){\n    var deptId = $stateParams.id;\n\n    //deptId 当前部门 id，如果为公司，该值为 0；\n    if(deptId !== '0'){\n      $ionicLoading.show();\n      $scope.dept = [];\n      Contact.getDeptInfo(deptId).success(function(res) {\n        res.isSuccess ? $scope.dept = res.data : IbPopup.alert({ title: res.msg });\n      })\n        .finally($ionicLoading.hide)\n    } else {\n      $ionicLoading.show();\n      $scope.corp = [];\n      Contact.getCorpInfo().success(function(res) {\n        res.isSuccess ? $scope.corp = res.data : IbPopup.alert({ title: res.msg });\n      })\n        .finally($ionicLoading.hide);\n    }\n\n  });","/**\n * @ngdoc service\n * @name contact.services.Contact\n * @description\n *   通讯录通用服务\n */\n\nangular.module('contact.services', [])\n\n  .factory('Contact', function($http,$ionicLoading, Settings) {\n    var moduleUrl = Settings.hostUrl + '?r=contact/api';\n\n    return {\n      /*\n       * @ngdoc    method\n       * @name     contact.services.Contact#getDeptList\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取部门列表\n       *    `params.deptid`  {string}  部门 id\n       * @param   {object}         params  查询参数\n       * @returns {httppromise}    httppromise\n       */\n      getDeptList : function(params) {\n        return $http.get(moduleUrl + '/deptlist', { params: params })\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getUserList\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取用户列表\n       *    `params.deptid`  {string}  部门 id\n       * @param   {object}         params  查询参数\n       * @returns {httppromise}    httppromise\n       */\n      getUserList : function(params) {\n        return $http.get(moduleUrl + '/userlist', { params: params })\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#search\n       * @methodOf contact.services.Contact\n       * @description\n       *    搜索用户，包含子部门\n       *    `params.deptid`  {string}  部门 id\n       * @param   {object}         params  查询参数\n       * @returns {httppromise}    httppromise\n       */\n      search: function(params) {\n        return $http.get(moduleUrl + '/search', { params: params })\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getUserInfo\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取用户信息\n       * @param   {String}         userid  用户ID\n       * @returns {httppromise}    httppromise\n       */\n      getUserInfo : function(userid) {\n        return $http.get(moduleUrl + '/user', { params: { userid : userid }})\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getCorpInfo\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取公司信息\n       * @returns {httppromise}    httppromise\n       */\n      getCorpInfo : function() {\n        return $http.get(moduleUrl + '/corp')\n      },\n\n      /**\n       * @ngdoc    method\n       * @name     contact.services.Contact#getDeptInfo\n       * @methodOf contact.services.Contact\n       * @description\n       *    获取部门信息\n       * @param   {String}         deptid  部门ID\n       * @returns {httppromise}    httppromise\n       */\n      getDeptInfo : function(deptid) {\n        return $http.get(moduleUrl + '/dept',{ params: { deptid : deptid }})\n      }\n    }\n  })\n\n","/**\n * @ngdoc module\n * @name CRM.controllers\n * @description\n *  CRM模块控制器\n */\n\nangular.module('crm.controllers', [])\n\n//CRM首页\n.controller('CRMIndexCtrl', function($scope, $state, $ionicLoading, $ionicModal, User, Utils, IbPopup, CRM, CRM_REPORT_TIMETYPES) {\n  $scope.CRM_REPORT_TIMETYPES = CRM_REPORT_TIMETYPES\n\n  $scope.reload = function() {\n    $scope.now = new Date()\n\n    $ionicLoading.show()\n    // 检查是否有权限访问 CRM\n    return User.getAuthority().success(function(res) {\n      if (res.isSuccess) {\n        if (res.data.crm) {\n          $scope.target = {}\n          $scope.stage = {}\n          $scope.todayReport = {}\n          \n          $ionicModal.fromTemplateUrl('templates/crm/new-modal.html', {\n            scope: $scope,\n            animation: 'fade-in'\n          }).then(function(modal) {\n            modal.hideDelay = 1;\n            $scope.newModal = modal\n          })\n\n          var TIME_TODAY = 1\n\n          CRM.getReport({ time: TIME_TODAY }).success(function(res) {\n            if (res.isSuccess) {\n              $scope.todayReport = res.data\n            }\n          })\n\n          // 设置销售简报时间范围\n          $scope.setReportTimeType = function(timeType) {\n            $scope.reportTimeType = timeType;\n\n            CRM.getReport({ time: timeType }).success(function(res) {\n              if (res.isSuccess) {\n                $scope.report = res.data\n              }\n            })\n            .success(Utils.serverWarning)\n          };\n\n          $scope.setReportTimeType(CRM_REPORT_TIMETYPES[0].type);\n\n          var year = $scope.now.getFullYear()\n          var month = $scope.now.getMonth()\n\n          // 获取目标\n          // @Todo: 后端接口合并为一个\n          angular.forEach([\n            // 新增客户数\n            {\n              key: 'newClientCount',\n              type: 1\n            },\n            // 新增商机数\n            {\n              key: 'newOppCount',\n              type: 2\n            },\n            // 新增合同金额\n            {\n              key: 'newOppIncome',\n              type: 6\n            }\n          ], function(conf) {\n            CRM.getTarget({\n              uid: User.addPrefix(User.uid),\n              year: year,\n              type: conf.type\n            }).success(function(res) {\n              if(res.isSuccess && res.data && res.data.month && res.data.month.length) {\n                $scope.target[conf.key] = res.data.month[month]\n              }\n            })\n          })\n\n          // 获取商机详情\n          CRM.getOppSurvey().success(function(res) {\n            if(res.isSuccess) {\n              $scope.oppSurver = res.data\n              // $scope.stage.opportunity = res.data\n            }\n          })\n\n        } else {\n          Utils.promptNoPermission();\n        }\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally(function() {\n      $ionicLoading.hide()\n      $scope.$broadcast('scroll.refreshComplete')\n    })\n  }\n\n  // 业绩目标设置提示\n  $scope.showTargetSetupTip = function() {\n    IbPopup.alert({\n      title: '提示',\n      content: '<p class=\"text-center\" style=\"color:#666;\">业绩目标需在PC端进行设置<br>首页&gt;业绩目标&gt;设置业绩目标</p>'\n    })\n  }\n\n  $scope.reload()\n})\n\n//CRM联系人列表\n.controller('CRMContactCtrl', function($scope, dateFilter, groupByFilter, orderByFilter, Utils, SearchModal, CRMContact) {\n  $scope.tabs = [\n    {\n      text: '全部联系人',\n      value: 'all'\n    },\n    {\n      text: '我的联系人',\n      value: 'my'\n    },\n    {\n      text: '下属联系人',\n      value: 'sub'\n    },\n    {\n      text: '共享联系人',\n      value: 'share'\n    }\n  ];\n\n  $scope.onTab = function(tab) {\n    $scope.contactList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  // 按名字、时间、公司排序\n  $scope.orderType = 'letter';\n  $scope.orderDesc = false;\n\n  function addOrderFieldToList(list) {\n    return list.map(function(item) {\n      // 增加用于分组的字段\n      item.letter = item.firstCase.charAt(0).toUpperCase();\n      item.formattedDate = dateFilter(item.createtime * 1000, 'yyyy-MM-dd');\n      item.company = item.company || '暂无';\n      return item;\n    });\n  }\n\n  // 获取联系人标签\n  CRMContact.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n\n  $scope.contactList = {\n    queryParams: {\n      limit: 10000,\n      order: {\n        'name': 1\n      }\n    },\n    load: function() {\n      var that = this;\n      this.loading = true;\n      CRMContact.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            that.list = addOrderFieldToList(res.data.list)\n            that.total = res.data.total;\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  // 搜索联系人\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/contact-search-modal.html',\n    searchFunc: function(params) {\n      return CRMContact.list({\n        keyword: params.key\n      }).success(function(res) {\n        res.data.list = addOrderFieldToList(res.data.list)\n      });\n    }\n  });\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.contactList.reload();\n  };\n})\n\n.controller('CRMContactFormCtrl', function($scope, $state, $ionicHistory, $ionicScrollDelegate, $ionicModal, Utils, IbPopup, CRMContact, CRMUtils, CRM_CONTACT_EXTEND) {\n  $scope.form = {\n    extends: []\n  };\n  $scope.stateName = $state.current.name;\n  $scope.isContactInfoShowed = false\n\n  // 获取联系人标签\n  CRMContact.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  $scope.selectClient = function() {\n    CRMUtils.openClientModal({\n      cid: $scope.form.client ? $scope.form.client.cid : '',\n      callback: function(client) {\n        $scope.form.client = client;\n      }\n    });\n  };\n\n  $scope.showContactInfo = function() {\n    $scope.isContactInfoShowed = true;\n    $ionicScrollDelegate.resize();\n  };\n\n  // 添加联系方式\n  $scope.addContactWay = function(key) {\n    $scope.form.extends.push({\n      key: key,\n      value: ''\n    })\n  }\n\n  $scope.removeContactWay = function(index) {\n    $scope.form.extends.splice(index, 1)\n  }\n\n\n  $ionicModal.fromTemplateUrl('templates/crm/contact-way.html', {\n    scope: $scope\n  }).then(function(modal) {\n    modal.scope.contactWays = CRM_CONTACT_EXTEND\n    $scope.contactWayModal = modal\n    $scope.$on('$ionicView.leave', modal.hide.bind(modal))\n    $scope.$on('$destroyed', modal.remove.bind(modal))\n  })\n\n  $scope.onSubmitSuccess = function(contactid) {\n    $ionicHistory.clearCache(['crm.contact'])\n    IbPopup.tip($scope.stateName === 'crm.addContact' ? '新增成功' : '编辑成功', 'success')\n    .then(function() {\n      $scope.contactForm.$setPristine()\n      $state.go('crm.contactView', { contactid: contactid }, { location: 'replace' })\n    });\n  };\n\n  $scope.submit = angular.noop;\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'contactForm')\n})\n\n//CRM-添加联系人\n.controller('CRMAddContactCtrl', function($scope, $ionicHistory, $stateParams, $controller, $ionicLoading, Utils, CRMContact, CRMUtils) {\n\n  $controller('CRMContactFormCtrl', {\n    $scope: $scope\n  });\n\n  if ($stateParams.client) {\n    $scope.form.client = $stateParams.client;\n  }\n\n  $scope.form.gender = '0';\n  $scope.form.extends = [\n    { key: 'mobile', value: '' },\n    { key: 'email', value: '' }\n  ]\n  $scope.submit = function() {\n    $ionicLoading.show();\n    CRMContact.create(CRMUtils.buildContactFormData($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.onSubmitSuccess(res.data.contactid);\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .finally($ionicLoading.hide);\n  };\n})\n\n//CRM-编辑联系人\n.controller('CRMEditContactCtrl', function($scope, $controller, $stateParams, $ionicLoading, Utils, CRMContact, CRMUtils) {\n  $controller('CRMContactFormCtrl', {\n    $scope: $scope\n  });\n\n  // 获取联系人信息\n  $ionicLoading.show();\n  CRMContact.view($stateParams)\n    .success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        $scope.form.birthday = res.data.birthday == '0' ? '' : new Date(res.data.birthday * 1000);\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.submit = function() {\n    $ionicLoading.show();\n\n    CRMContact.update(CRMUtils.buildContactFormData($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.onSubmitSuccess($stateParams.contactid);\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .finally($ionicLoading.hide);\n  }\n\n  $scope.removeContact = function() {\n    CRMUtils.confirmRemoveContact($stateParams)\n  }\n})\n\n//CRM-联系人详情\n.controller('CRMContactViewCtrl', function($scope, $state, $stateParams, $ionicLoading, $ionicActionSheet, $ionicHistory, Utils, CRMContact, CRMUtils) {\n  $ionicLoading.show();\n  CRMContact.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.contact = res.data;\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n})\n\n//CRM客户\n.controller('CRMClientCtrl', function($scope, $ionicScrollDelegate, $stateParams, $controller, SearchModal, Utils, CRMClient) {\n  $scope.filterGroups = [\n    {\n      groupName: '创建时间',\n      groupKey: 'clientList.queryParams.createtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '跟进时间',\n      groupKey: 'clientList.queryParams.lasteventtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    }\n  ]\n  $scope.selectFilterItem = function(item, filterGroup) {\n    $scope.$eval(filterGroup.groupKey + '=\"' + item.value + '\"')\n    $scope.clientList.reload()\n  }\n  // 获取客户标签\n  // @Todo: 目前标签的过滤结果是合集，需要后端修改为交集\n  // CRMClient.tagList().success(function(res) {\n  //   if (res.isSuccess) {\n  //     angular.forEach(res.data, function(tagGroup, index) {\n  //       var groupKey = 'clientList.queryParams.tags[' + tagGroup.groupid + ']'\n  //       var items = tagGroup.taglist.map(function(tag) {\n  //         return {\n  //           text: tag.name,\n  //           value: tag.tagid\n  //         }\n  //       })\n  //       var filterGroup = {\n  //         groupName: tagGroup.name,\n  //         groupKey: groupKey,\n  //         items: items,\n  //         selected: 0\n  //       }\n\n  //       items.unshift({\n  //         text: '不限',\n  //         value: ''\n  //       })\n\n  //       $scope.filterGroups.splice(index, 0, filterGroup)\n  //     })\n  //   }\n  // });\n\n  $scope.clientList = {\n    list: [],\n    queryParams: {\n      range: 'all',\n      tags: {},\n      createtime: '0',\n      lasteventtime: '0'\n    },\n    hasMore: true,\n    load: function() {\n      var that = this;\n      that.loading = true;\n      that.queryParams.offset = that.list.length;\n\n      CRMClient.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            Utils.concatTo(that.list, res.data.list);\n            that.total = res.data.total;\n            that.hasMore = that.total > that.list.length;\n            $ionicScrollDelegate.resize();\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  // 搜索客户\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/client-search-modal.html',\n    searchFunc: function(params) {\n      return CRMClient.list({\n        keyword: params.key\n      });\n    }\n  });\n\n  $scope.tabs = [\n    {\n      text: '全部客户',\n      value: 'all'\n    },\n    {\n      text: '我的客户',\n      value: 'my'\n    },\n    {\n      text: '下属客户',\n      value: 'sub'\n    },\n    {\n      text: '久未联系',\n      value: 'estranged'\n    },\n    {\n      text: '共享客户',\n      value: 'share'\n    }\n  ]\n\n  $scope.onTab = function(tab) {\n    $scope.clientList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.clientList.reload();\n  };\n})\n\n//CRM-客户表单基础控制器\n.controller('CRMClientFormCtrl', function($scope, $state, $window, $ionicLoading, $ionicHistory, mapFilter, Utils, IbPopup, CRMContact, CRMClient, CRMUtils, DefaultBack) {\n  $scope.form = {};\n  $scope.stateName = $state.current.name;\n\n  $scope.$on('$ionicView.enter', function() {\n    var contact = JSON.parse($window.sessionStorage.getItem('crm.addcontact'));\n    if (contact) {\n      $window.sessionStorage.removeItem('crm.addcontact')\n      $scope.form.contacts = $scope.form.contacts || [];\n      $scope.form.contacts.push(contact);\n    }\n  })\n\n  function getContactIds() {\n    return $scope.form.contacts && $scope.form.contacts.length ? mapFilter($scope.form.contacts, 'contactid') : [];\n  }\n\n  // 绑定联系人\n  $scope.attachContact = function() {\n    CRMUtils.openContactModal({\n      params: {\n        type: 'client'\n      },\n      selected: getContactIds(),\n      callback: function(selected) {\n        $scope.form.contacts = selected;\n      }\n    })\n  };\n\n  // 解绑联系人\n  $scope.detachContact = function(contact) {\n    Utils.eliminate($scope.form.contacts, contact);\n  };\n\n  $scope.submitAttachContact = function(cid) {\n    return CRMContact.related({\n      type: 'client',\n      cid: cid,\n      contactid: getContactIds()\n    });\n  };\n\n  $scope.submitPromise = function(promise) {\n    $ionicLoading.show();\n    return promise.success(function(res) {\n        if (res.isSuccess) {\n          $ionicHistory.clearCache(['crm.client'])\n          $scope.submitAttachContact(res.data.cid)\n          $scope.clientForm.$setPristine()\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide);\n  };\n\n  // 获取客户标签\n  CRMClient.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'clientForm')\n})\n\n//CRM-添加客户信息\n.controller('CRMAddClientCtrl', function($scope, $state, $stateParams, $controller, $ionicScrollDelegate, IbPopup, CRMClient, $http, Settings) {\n  $controller('CRMClientFormCtrl', {\n    $scope: $scope\n  });\n  $scope.isClientInfoShowed = false;\n\n  $scope.addMoreInfo = function() {\n    $scope.isClientInfoShowed = true;\n    $ionicScrollDelegate.resize();\n  };\n  $scope.form.likefullnames = [];\n  $scope.likeFullNamesShowValue = false;\n  // 检查是否有相似的公司名称\n  $scope.checkLikeFullName = function (value) {\n      clearTimeout(this.timer);\n      this.timer = setTimeout(function () {\n          $http.post(Settings.hostUrl + '?r=crm/api/getlikeclient', {'fullname':value}).success(function (ret) {\n            $scope.form.likefullnames = ret.data\n            $scope.likeFullNamesShow();\n          });\n      }, 200);\n  };\n\n  $scope.likeFullNamesNotShow = function () {\n    $scope.likeFullNamesShowValue = false;\n  };\n\n  $scope.likeFullNamesShow = function () {\n    if ($scope.form.likefullnames.length != 0) {\n      $scope.likeFullNamesShowValue = true;\n    } else {\n      $scope.likeFullNamesShowValue = false;\n    }\n  };\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMClient.create($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          IbPopup.tip('新增成功', 'success').then(function() {\n            $state.go('crm.clientView', res.data, { location: 'replace' })\n          })\n        }\n      });\n  }\n})\n\n//CRM-编辑客户信息\n.controller('CRMEditClientCtrl', function($scope, $window, $controller, $ionicLoading, $stateParams, Utils, IbPopup, CRMClient, CRMUtils) {\n  $controller('CRMClientFormCtrl', {\n    $scope: $scope\n  });\n  $scope.isClientInfoShowed = true;\n\n  $ionicLoading.show();\n  CRMClient.view($stateParams)\n    .success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.removeClient = function() {\n    CRMUtils.confirmRemoveClient($stateParams);\n  }\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMClient.update($scope.form))\n      .success(function(res) {\n        if (res.isSuccess) {\n          IbPopup.tip('编辑成功', 'success').then(function() {\n            $window.history.back()\n          });\n        }\n      });\n  };\n})\n\n//CRM-客户详情页\n.controller('CRMClientViewCtrl', function($scope, $state, $stateParams, $ionicLoading, $ionicActionSheet, $ionicHistory, mapFilter, Utils, CRMClient, CRMEvent, CRMOpportunity, CRMUtils) {\n\n  $ionicLoading.show();\n  CRMClient.view($stateParams)\n    .success(function(res) {\n      if (res.isSuccess) {\n        $scope.client = res.data;\n        CRMUtils.setTagsToForm($scope.client, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  // 获取客户标签\n  CRMClient.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n\n  $scope.activeTab = 'survey';\n\n  function loadRelatedEvent() {\n    if ($scope.eventListLoaded) return;\n    $ionicLoading.show();\n    CRMEvent.list({\n        cid: $stateParams.cid,\n        limit: 10000\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.eventList = res.data.list;\n          $scope.eventListLoaded = true;\n        }\n      })\n      .success(Utils.serverWarning)\n      .finally($ionicLoading.hide);\n  }\n\n  function loadRelatedOpportunity() {\n    if ($scope.oppListLoaded) return;\n    $ionicLoading.show();\n    CRMOpportunity.list({\n        cid: $stateParams.cid,\n        limit: 10000\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.oppList = res.data.list;\n          $scope.oppListLoaded = true;\n        }\n      })\n      .success(Utils.serverWarning)\n      .finally($ionicLoading.hide);\n  }\n\n  $scope.setClientTab = function(type) {\n    $scope.activeTab = type || 'survey';\n    if (type == 'event') {\n      loadRelatedEvent();\n    } else if (type == 'opportunity') {\n      loadRelatedOpportunity();\n    }\n  };\n\n  // 打开新建关联数据窗口\n  $scope.openAttachModal = function() {\n    $scope.__attachOpts = {\n      params: {\n        client: $scope.client\n      }\n    };\n    CRMUtils.openAttachModal($scope);\n  };\n\n  // 关联联系人\n  $scope.selectContact = function() {\n    CRMUtils.selectContactToClient($stateParams.cid, $scope.client.contacts ? mapFilter($scope.client.contacts, 'contactid') : [], function(res) {\n      if (res.isSuccess) {\n        $ionicHistory.clearCache([$state.current.name]).then($state.reload);\n      }\n    });\n  };\n\n  // // 当选择标签时更新数据\n  // $scope.onTagChange = function() {\n  //   CRMClient.update($scope.client).success(function(res) {\n  //     if (res.isSuccess) {\n  //       $ionicHistory.clearCache(['crm.client']);\n  //     }\n  //   });\n  // };\n})\n\n//CRM-商机首页\n.controller('CRMOpportunityCtrl', function($scope, $ionicScrollDelegate, SearchModal, $stateParams, Utils, CRMOpportunity) {\n  $scope.filterGroups = [\n    {\n      groupName: '商机状态',\n      groupKey: 'oppList.queryParams.status',\n      items: [\n        {\n          text: '不限',\n          value: ''\n        },\n        {\n          text: '进行中',\n          value: '0'\n        },\n        {\n          text: '已成交',\n          value: '1'\n        },\n        {\n          text: '已失败',\n          value: '2'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '创建时间',\n      groupKey: 'oppList.queryParams.createtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '更新时间',\n      groupKey: 'oppList.queryParams.updatetime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    }\n  ]\n  $scope.selectFilterItem = function(item, filterGroup) {\n    $scope.$eval(filterGroup.groupKey + '=\"' + item.value + '\"')\n    $scope.oppList.reload()\n  }\n\n  $scope.tabs = [\n  {\n    text: '全部商机',\n    value: 'all'\n  },\n  {\n    text: '我的商机',\n    value: 'my'\n  },\n  {\n    text: '下属商机',\n    value: 'sub'\n  },\n  {\n    text: '共享商机',\n    value: 'share'\n  }\n  ];\n\n  // 搜索客户\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/opportunity-search-modal.html',\n    searchFunc: function(params) {\n      return CRMOpportunity.list({\n        keyword: params.key\n      });\n    }\n  });\n\n  $scope.oppList = {\n    list: [],\n    queryParams: {\n      tags: {},\n      range: 'all',\n      createtime: '0',\n      updatetime: '0',\n      status: ''\n    },\n    hasMore: true,\n    load: function() {\n      var that = this;\n      that.loading = true;\n      that.queryParams.offset = that.list.length;\n\n      CRMOpportunity.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            Utils.concatTo(that.list, res.data.list);\n\n            that.total = res.data.total;\n            that.hasMore = that.total > that.list.length;\n            \n            if ($stateParams.status) {\n              that.list = that.list.filter(function(item) {\n                return item.status === $stateParams.status\n              })\n            }\n            \n            $ionicScrollDelegate.resize();\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  if ($stateParams.tag) {\n    var tag = $stateParams.tag\n    var queryParams = $scope.oppList.queryParams\n    queryParams.range = 'my'\n    queryParams.tags[tag.groupid] = [tag.tagid];\n  }\n\n  $scope.onTab = function(tab) {\n    $scope.oppList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.oppList.reload();\n  };\n})\n\n//CRM-商机详情页\n.controller('CRMOpportunityViewCtrl', function($scope, $state, $stateParams, $ionicActionSheet, $ionicLoading, $ionicHistory, mapFilter, dateFilter, Utils, CRMOpportunity, CRMEvent, CRMUtils) {\n  $scope.activeTab = 'survey';\n\n  $ionicLoading.show();\n  CRMOpportunity.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.opp = res.data;\n        $scope.opp.cid = res.data.client && res.data.client.cid ? res.data.client.cid : '';\n        $scope.opp.contactid = res.data.contacts ? mapFilter(res.data.contacts, 'contactid') : [];\n        CRMUtils.setTagsToForm($scope.opp, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  function clearOpportunityCache(res) {\n    if (res.isSuccess) $ionicHistory.clearCache(['crm.opportunity']);\n  }\n\n  // 打开新建关联数据窗口\n  $scope.openAttachModal = function() {\n    $scope.__attachOpts = {\n      newOpp: false,\n      newContact: false,\n      attachContact: $scope.opp.cid ? true : false,\n      params: {\n        client: $scope.opp.client,\n        opportunity: $scope.opp\n      }\n    };\n    CRMUtils.openAttachModal($scope);\n  };\n  // 关联联系人\n  $scope.selectContact = function() {\n    CRMUtils.openContactModal({\n      selected: $scope.opp.contactid,\n      params: {\n        type: 'opp',\n        cid: $scope.opp.cid || ''\n      },\n      callback: function(selected) {\n        $ionicLoading.show();\n        $scope.opp.contacts = selected;\n        $scope.opp.contactid = mapFilter(selected, 'contactid');\n        CRMOpportunity.update($scope.opp).finally($ionicLoading.hide);\n      }\n    });\n  };\n\n  function loadRelatedEvent() {\n    if ($scope.eventListLoaded) return;\n    $ionicLoading.show();\n    CRMEvent.list({\n        oid: $stateParams.oid,\n        limit: 10000\n      })\n      .success(function(res) {\n        if (res.isSuccess) {\n          $scope.eventList = res.data.list;\n          $scope.eventListLoaded = true;\n        }\n      })\n      .success(Utils.serverWarning)\n      .finally($ionicLoading.hide);\n  }\n\n  $scope.setActiveTab = function(tag) {\n    $scope.activeTab = tag;\n    if (tag === 'event') loadRelatedEvent();\n  };\n\n  // 获取商机标签\n  CRMOpportunity.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n})\n\n//CRM-商机表单\n.controller('CRMOpportunityFormCtrl', function($scope, $state, $ionicLoading, $ionicHistory, mapFilter, Utils, IbPopup, CRMOpportunity, CRMUtils, DefaultBack) {\n  $scope.form = {\n    dealchance: 0,\n    createtime: new Date()\n  };\n\n  $scope.isOppFormMoreShowed = false\n  $scope.showOppFormMore = function() {\n    $scope.isOppFormMoreShowed = true\n  }\n\n  $scope.stateName = $state.current.name;\n\n  // 关联联系人\n  $scope.attachContact = function() {\n    CRMUtils.openContactModal({\n      params: {\n        type: 'opp',\n        cid: $scope.form.cid\n      },\n      selected: $scope.form.contactid || [],\n      client: $scope.client,\n      callback: function(contacts) {\n        $scope.contacts = contacts;\n        $scope.form.contactid = mapFilter(contacts, 'contactid');\n      }\n    });\n  };\n\n  $scope.detachContact = function(contact) {\n    Utils.toggle($scope.contacts, contact)\n    $scope.form.contactid = mapFilter($scope.contacts, 'contactid');\n  }\n\n  // 关联客户\n  $scope.attachClient = function() {\n    CRMUtils.openClientModal({\n      cid: $scope.form.cid || '',\n      callback: function(client) {\n        $scope.client = client;\n        $scope.form.cid = client.cid;\n        $scope.contacts = [];\n        $scope.form.contactid = [];\n      }\n    });\n  };\n\n  $scope.submitPromise = function(promise) {\n    $ionicLoading.show();\n    return promise.success(function(res) {\n        if (res.isSuccess) {\n          $ionicHistory.clearCache(['crm.opportunity'])\n          $scope.oppForm.$setPristine()\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide);\n  };\n\n  // 获取商机标签\n  CRMOpportunity.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'oppForm')\n})\n\n//CRM-添加商机页\n.controller('CRMAddOpportunityCtrl', function($scope, $state, $stateParams, $controller, IbPopup, CRMOpportunity, CRMUtils) {\n  $controller('CRMOpportunityFormCtrl', {\n    $scope: $scope\n  });\n  if ($stateParams.client) {\n    $scope.client = $stateParams.client;\n    $scope.form.cid = $stateParams.client.cid;\n  }\n  $scope.submit = function() {\n    $scope.submitPromise(CRMOpportunity.create(CRMUtils.buildOpportunityFormData($scope.form)))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('新增成功', 'success')\n        .then(function() {\n          $state.go('crm.opportunityView', res.data, { location: 'replace' })\n        })\n      }\n    })\n  };\n})\n\n//CRM-编辑商机页\n.controller('CRMEditOpportunityCtrl', function($scope, $window, $controller, $stateParams, $ionicLoading, Utils, mapFilter, currencyToNumberFilter, IbPopup, CRMOpportunity, CRMUtils) {\n  $controller('CRMOpportunityFormCtrl', {\n    $scope: $scope\n  });\n\n  $ionicLoading.show();\n  CRMOpportunity.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        $scope.form.createtime = new Date(res.data.createtime * 1000);\n        $scope.form.expectendtime = res.data.expectendtime && res.data.expectendtime != 0 ? new Date(res.data.expectendtime * 1000) : '';\n        // 格式化预计收入为数字\n        $scope.form.expectincome = $scope.form.expectincome ? currencyToNumberFilter($scope.form.expectincome) : ''\n        $scope.form.dealchance = +res.data.dealchance;\n        $scope.form.cid = res.data.client && res.data.client.cid ? res.data.client.cid : '';\n        $scope.form.contactid = res.data.contacts ? mapFilter(res.data.contacts, 'contactid') : [];\n        $scope.contacts = res.data.contacts;\n        $scope.client = res.data.client;\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMOpportunity.update(CRMUtils.buildOpportunityFormData($scope.form)))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('编辑成功', 'success')\n        .then(function() {\n          $window.history.back()\n        });\n      }\n    })\n  };\n\n  $scope.removeOpp = function() {\n    CRMUtils.confirmRemoveOpportunity($stateParams);\n  }\n})\n\n// 事件首页\n.controller('CRMEventCtrl', function($scope, $ionicScrollDelegate, SearchModal, Utils, CRMEvent) {\n  $scope.filterGroups = [\n    {\n      groupName: '来源',\n      groupKey: 'eventList.queryParams.source',\n      items: [\n        {\n          text: '不限',\n          value: ''\n        },\n        {\n          text: '客户',\n          value: 'client'\n        },\n        {\n          text: '机会',\n          value: 'opportunity'\n        },\n        {\n          text: '合同',\n          value: 'contract'\n        }\n      ],\n      selected: 0\n    },\n    {\n      groupName: '跟进时间',\n      groupKey: 'eventList.queryParams.eventtime',\n      items: [\n        {\n          text: '不限',\n          value: '0'\n        },\n        {\n          text: '今天',\n          value: '1'\n        },\n        {\n          text: '昨天',\n          value: '2'\n        },\n        {\n          text: '本周',\n          value: '3'\n        },\n        {\n          text: '上周',\n          value: '4'\n        },\n        {\n          text: '本月',\n          value: '5'\n        },\n        {\n          text: '上月',\n          value: '6'\n        }\n      ],\n      selected: 0\n    }\n  ]\n  $scope.selectFilterItem = function(item, filterGroup) {\n    $scope.$eval(filterGroup.groupKey + '=\"' + item.value + '\"')\n    $scope.eventList.reload()\n  }\n\n  $scope.tabs = [{\n    text: '全部跟进',\n    value: 'all'\n  }, {\n    text: '我的跟进',\n    value: 'my'\n  }, {\n    text: '下属跟进',\n    value: 'sub'\n  }];\n\n  $scope.onTab = function(tab) {\n    $scope.eventList.queryParams.range = tab.value\n    $scope.confirmFilters()\n  }\n\n  $scope.eventList = {\n    list: [],\n    queryParams: {},\n    hasMore: true,\n    load: function() {\n      var that = this;\n      that.loading = true;\n      that.queryParams.offset = that.list.length;\n      CRMEvent.list(that.queryParams).success(function(res) {\n          if (res.isSuccess) {\n            Utils.concatTo(that.list, res.data.list);\n            that.total = res.data.total;\n            that.hasMore = that.total > that.list.length;\n            $ionicScrollDelegate.resize();\n          }\n        })\n        .success(Utils.serverWarning)\n        .finally(function() {\n          that.loading = false;\n          $scope.$broadcast('scroll.refreshComplete');\n        });\n    },\n    reset: function() {\n      this.list = [];\n      this.total = 0;\n      this.loading = false;\n      this.hasMore = true;\n    },\n    reload: function() {\n      this.reset();\n      this.load();\n    }\n  };\n\n  // 搜索客户\n  $scope.search = new SearchModal({\n    scope: $scope,\n    templateUrl: 'templates/crm/event-search-modal.html',\n    searchFunc: function(params) {\n      return CRMEvent.list({\n        keyword: params.key\n      });\n    }\n  });\n\n  //确定归属分类\n  $scope.confirmFilters = function() {\n    $scope.eventList.reload();\n  };\n\n  // 获取事件标签\n  CRMEvent.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n    }\n  });\n})\n\n// 事件表单\n.controller('CRMEventFormCtrl', function($scope, $state, $ionicLoading, $ionicHistory, mapFilter, IbPopup, Utils, CRMEvent, CRMUtils, DefaultBack) {\n  $scope.form = {};\n\n  $scope.stateName = $state.current.name;\n\n  // 关联客户\n  $scope.selectClient = function() {\n    CRMUtils.openClientModal({\n      cid: $scope.form.client ? $scope.form.client.cid : '',\n      // 清空\n      callback: function(client) {\n        if (client !== $scope.form.client) {\n          $scope.form.client = client;\n          $scope.form.cid = client.cid;\n          $scope.form.opportunity = null;\n          $scope.form.oid = '';\n          $scope.form.contacts = [];\n          $scope.form.contactid = [];\n        }\n      }\n    });\n  };\n\n  // 关联商机\n  $scope.selectOpportunity = function() {\n    CRMUtils.openOpportunityModal({\n      selected: $scope.form.oid || '',\n      params: {\n        cid: $scope.form.cid || ''\n      },\n      callback: function(selected) {\n        if (selected !== $scope.form.opportunity) {\n          $scope.form.opportunity = selected;\n          $scope.form.oid = selected.oid;\n          $scope.form.contacts = [];\n          $scope.form.contactid = [];\n        }\n      }\n    });\n  };\n\n  // 关联联系人\n  $scope.attachContact = function() {\n    CRMUtils.openContactModal({\n      selected: $scope.form.contactid,\n      params: {\n        type: 'event',\n        cid: $scope.form.cid || '',\n        oid: $scope.form.oid || ''\n      },\n      callback: function(selected) {\n        $scope.form.contacts = selected;\n        $scope.form.contactid = mapFilter(selected, 'contactid');\n      }\n    });\n  };\n\n  $scope.detachContact = function(contact) {\n    Utils.eliminate($scope.form.contacts, contact);\n    $scope.form.contactid = mapFilter($scope.form.contacts, 'contactid');\n  }\n\n  // 作为 promise 的包装函数\n  $scope.submitPromise = function(promise) {\n    $ionicLoading.show();\n    return promise.success(function(res) {\n        if (res.isSuccess) {\n          $ionicHistory.clearCache(['crm.event'])\n          $scope.eventForm.$setPristine()\n        }\n      })\n      .success(CRMUtils.formValidateError)\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n  };\n\n  // 获取事件标签\n  CRMEvent.tagList().success(function(res) {\n    if (res.isSuccess) {\n      $scope.tagGroups = res.data;\n      CRMUtils.initTagsToForm($scope.form, $scope.tagGroups);\n    }\n  });\n\n  Utils.checkFormDirtyBeforeLeave($scope, 'eventForm')\n})\n\n// 添加事件页\n.controller('CRMAddEventCtrl', function($scope, $state, $stateParams, $controller, IbPopup, CRMEvent) {\n  $controller('CRMEventFormCtrl', {\n    $scope: $scope\n  });\n\n  // 如果从客户或商机中新建事件，则从 $stateParams 中传递这些数据过来\n  if ($stateParams.client) {\n    $scope.form.client = $stateParams.client;\n    $scope.form.cid = $stateParams.client.cid;\n  }\n  if ($stateParams.opportunity) {\n    $scope.form.opportunity = $stateParams.opportunity;\n    $scope.form.oid = $stateParams.opportunity.oid;\n  }\n\n  $scope.submit = function() {\n    $scope.submitPromise(CRMEvent.create($scope.form))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('新增成功', 'success')\n        .then(function(){\n          $state.go('crm.eventView', res.data, { location: 'replace' })\n        });\n      }\n    })\n  };\n})\n\n// 编辑事件页\n.controller('CRMEditEventCtrl', function($scope, $window, $controller, $stateParams, $ionicLoading, mapFilter, Utils, IbPopup, CRMEvent, CRMUtils) {\n  $controller('CRMEventFormCtrl', {\n    $scope: $scope\n  });\n\n  $ionicLoading.show();\n  CRMEvent.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.form = res.data;\n        $scope.form.cid = res.data.client ? res.data.client.cid : '';\n        $scope.form.oid = res.data.opportunity ? res.data.opportunity.oid : '';\n        $scope.form.contactid = res.data.contacts ? mapFilter(res.data.contacts, 'contactid') : [];\n        CRMUtils.setTagsToForm($scope.form, res.data.tags);\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n\n  $scope.submit = function() {\n    $scope.form.aid = [];\n    $scope.submitPromise(CRMEvent.update($scope.form))\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.tip('编辑成功', 'success')\n        .then(function(){\n          $window.history.back()\n        });\n      }\n    })\n  };\n\n  $scope.removeEvent = function() {\n    CRMUtils.confirmRemoveEvent($stateParams);\n  }\n})\n\n// 事件详情页\n.controller('CRMEventViewCtrl', function($scope, $state, $stateParams, $ionicLoading, $ionicActionSheet, Utils, CRMEvent, CRMUtils) {\n  $ionicLoading.show();\n  CRMEvent.view($stateParams).success(function(res) {\n      if (res.isSuccess) {\n        $scope.ev = res.data;\n      }\n    })\n    .success(Utils.serverWarning)\n    .finally($ionicLoading.hide);\n})","/**\n * @ngdoc module\n * @name crm\n * @description\n *   CRM模块\n */\n\nangular.module('crm', ['ionic', 'crm.controllers', 'crm.services'])\n\n.run(function(Apps) {\n  Apps.install({\n    name: 'crm',\n    title: 'CRM',\n    route: '#/crm',\n    state: 'crm.index',\n    icon: 'img/modicon/crm.png'\n  })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider, ResolversProvider) {\n\n  $urlRouterProvider.when('/crm', '/crm/index');\n\n  $stateProvider\n    .state('crm', {\n      url: '/crm',\n      abstract: true,\n      template: '<ion-nav-view name=\"crm\"></ion-nav-view>',\n      resolve: UserProvider.resolve\n    })\n\n  // CRM-门户\n  .state('crm.index', {\n    url: '/index',\n    talkingDataLabel: 'CRM-门户',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/index.html',\n        controller: 'CRMIndexCtrl'\n      }\n    }\n  })\n\n  // CRM-联系人-首页\n  .state('crm.contact', {\n    url: '/contact',\n    talkingDataLabel: 'CRM-联系人-首页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact.html',\n        controller: 'CRMContactCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-添加联系人\n  .state('crm.addContact', {\n    url: '/addcontact',\n    talkingDataLabel: 'CRM-联系人-添加',\n    params: { client: null },\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact-form.html',\n        controller: 'CRMAddContactCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '联系人',\n      state: 'crm.contact'\n    }\n  })\n\n  // CRM-编辑联系人\n  .state('crm.editContact', {\n    url: '/editcontact/:contactid',\n    talkingDataLabel: 'CRM-联系人-编辑',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact-form.html',\n        controller: 'CRMEditContactCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '联系人',\n      state: 'crm.contact'\n    }\n  })\n\n  // CRM-联系人详情页\n  .state('crm.contactView', {\n    url: '/contactview/:contactid',\n    talkingDataLabel: 'CRM-联系人-详情',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/contact-view.html',\n        controller: 'CRMContactViewCtrl'\n      }\n    }\n  })\n\n  // CRM-客户\n  .state('crm.client', {\n    url: '/client',\n    talkingDataLabel: 'CRM-客户-主页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client.html',\n        controller: 'CRMClientCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-添加客户\n  .state('crm.addClient', {\n    url: '/addclient',\n    talkingDataLabel: 'CRM-客户-添加',\n    params: { contact: null },\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client-form.html',\n        controller: 'CRMAddClientCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '客户',\n      state: 'crm.client'\n    }\n  })\n\n  // CRM-编辑客户\n  .state('crm.editClient', {\n    url: '/editclient/:cid',\n    talkingDataLabel: 'CRM-客户-编辑',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client-form.html',\n        controller: 'CRMEditClientCtrl'\n      }\n    },\n    resolve: ResolversProvider.get(['qqmap']),\n    defaultBack: {\n      title: '客户',\n      state: 'crm.client'\n    }\n  })\n\n  // CRM-查看客户\n  .state('crm.clientView', {\n    url: '/clientview/:cid',\n    talkingDataLabel: 'CRM-客户-查看',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/client-view.html',\n        controller: 'CRMClientViewCtrl'\n      }\n    }\n  })\n\n  // CRM-商机首页\n  .state('crm.opportunity', {\n    url: '/opportunity',\n    params: { tag: null , status: null },\n    talkingDataLabel: 'CRM-商机-首页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity.html',\n        controller: 'CRMOpportunityCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-商机详情页\n  .state('crm.opportunityView', {\n    url: '/opportunityview/:oid',\n    talkingDataLabel: 'CRM-商机-详情页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity-view.html',\n        controller: 'CRMOpportunityViewCtrl'\n      }\n    }\n  })\n\n  // CRM-添加商机\n  .state('crm.addOpportunity', {\n    url: '/addopportunity',\n    talkingDataLabel: 'CRM-商机-添加页',\n    params: { client: null },\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity-form.html',\n        controller: 'CRMAddOpportunityCtrl'\n      }\n    },\n    defaultBack: {\n      title: '商机',\n      state: 'crm.opportunity'\n    }\n  })\n\n  // CRM-编辑商机\n  .state('crm.editOpportunity', {\n    url: '/editopportunity/:oid',\n    talkingDataLabel: 'CRM-商机-编辑页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/opportunity-form.html',\n        controller: 'CRMEditOpportunityCtrl'\n      }\n    },\n    defaultBack: {\n      title: '商机',\n      state: 'crm.opportunity'\n    }\n  })\n\n  // CRM-事件首页\n  .state('crm.event', {\n    url: '/event',\n    talkingDataLabel: 'CRM-事件首页',\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event.html',\n        controller: 'CRMEventCtrl'\n      }\n    },\n    defaultBack: {\n      title: 'CRM',\n      state: 'crm.index'\n    }\n  })\n\n  // CRM-添加事件\n  .state('crm.addEvent', {\n    url: '/addevent',\n    talkingDataLabel: 'CRM-事件-添加页',\n    cache: false,\n    params: { client: null, opportunity: null, contact: null },\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event-form.html',\n        controller: 'CRMAddEventCtrl'\n      }\n    },\n    defaultBack: {\n      title: '事件',\n      state: 'crm.event'\n    }\n  })\n\n  // CRM-编辑事件\n  .state('crm.editEvent', {\n    url: '/editevent/:eventid',\n    talkingDataLabel: 'CRM-事件-编辑页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event-form.html',\n        controller: 'CRMEditEventCtrl'\n      }\n    },\n    defaultBack: {\n      title: '事件',\n      state: 'crm.event'\n    }\n  })\n\n  // CRM-事件详情\n  .state('crm.eventView', {\n    url: '/eventview/:eventid',\n    talkingDataLabel: 'CRM-事件-详情页',\n    cache: false,\n    views: {\n      'crm': {\n        templateUrl: 'templates/crm/event-view.html',\n        controller: 'CRMEventViewCtrl'\n      }\n    }\n  })\n\n});","/**\n * @ngdoc overview\n * @name crm.services\n * @description\n *   CRM模块服务\n */\n\nangular.module('crm.services', [])\n\n/**\n * @property\n * @type {Object}\n * @description\n *   销售简报时间取值\n */\n.constant('CRM_REPORT_TIMETYPES', [{\n  text: '本月',\n  type: 5\n}, {\n  text: '上月',\n  type: 6\n}, {\n  text: '本周',\n  type: 3\n}, {\n  text: '上周',\n  type: 4\n}])\n\n/**\n * @property\n * @todo 这里的值由后端统一管理会比较合适\n * @type Object\n * @description\n *   联系人扩展字段\n */\n.constant('CRM_CONTACT_EXTEND', {\n  'phone': '电话',\n  'email': '邮箱',\n  'mobile': '手机',\n  'address': '地址',\n  'weibo': '微博',\n  'qq': 'QQ',\n  'weixin': '微信'\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMContact\n * @description\n *   CRM 通用服务\n */\n.factory('CRM', function($http, Settings, Utils) {\n  return {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#tagList\n     * @methodOf  crm.services.CRM\n     * @description\n     *    获取标签设置\n     *    `params.module`  {string}  获取指定模块的标签，可选值有 client、contact、opportunity、event、contract、receipt\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/taglist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#getReport\n     * @methodOf  crm.services.CRM\n     * @param     {object}  [params]  查询参数\n     * @description\n     *    获取销售简报\n     *    `time`  {number}  时间范围，3本周，4上周，5本月，6上月\n     * \n     *    [接口文档](http://doc.ibos.cn/index.php?s=/2&page_id=247)\n     * @returns {HttpPromise}   HttpPromise\n     */\n    getReport: function(params) {\n      return $http.post(Settings.hostUrl + '?r=crm/api/getsalereport', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#getTarget\n     * @methodOf  crm.services.CRM\n     * @param     {object}  [params]  查询参数\n     * @description\n     *    获取个人业绩目标\n     *    `uid`   {string}  用户uid，如u_1\n     *    `year`  {string}  年份\n     *    `type`  {number}  1新增客户数 2新增商机数 3新增合同数 4新增收款金额 5新增合同金额 6新增商机金额\n     * \n     *    [接口文档](http://doc.ibos.cn/index.php?s=/2&page_id=185)\n     * @returns {HttpPromise}   HttpPromise\n     */\n    getTarget: function(params) {\n      return $http.post(Settings.hostUrl + '?r=crm/target/gettarget', params);\n    },\n    \n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRM#getOppSurvey\n     * @methodOf  crm.services.CRM\n     * @param     {object}  [params]  查询参数\n     * @description\n     *    获取商机概况\n     * \n     *    [接口文档](http://doc.ibos.cn/index.php?s=/2&page_id=248)\n     * @returns {HttpPromise}   HttpPromise\n     */\n    getOppSurvey: function(params) {\n      return $http.post(Settings.hostUrl + '?r=crm/api/getoppsurvey', params);\n    }\n\n  }\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMContact\n * @description\n *   CRM 联系人服务\n */\n.factory('CRMContact', function($http, Utils, Settings, CRM) {\n  var CRMContact = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#avatar\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    上传联系人头像\n     *\n     * @param   {File}          file  文件对象\n     * @returns {HttpPromise}   HttpPromise\n     */\n    avatar: function(file) {\n      var formData = new FormData();\n      formData.append('Filedata', file);\n      return Utils.postFormData(Settings.hostUrl + '?r=crm/api/contactavatar', formData);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#list\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *    - params.order    {object}  按公司company，姓名name，创建时间createtime排序，默认按名字正向排序，格式{'createtime':1}，1表示正向排序，0表示倒向排序，支持多个排序，放在前面的优先级高，不在说明里的字段会被忽略\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactlist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#create\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    创建联系人\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#create\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    更新联系人信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#view\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人详情\n     *    `params.contactid`  {string}  联系人 id\n     * @param   {Object}        params    请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#remove\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    删除联系人\n     *    `params.contactid`  {string}  联系人 id\n     * @param   {Object}        params    请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactremove', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#tagList\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'contact'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#tagList\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    获取联系人选择窗口数据\n     *    params.type  {string}  类型，可选 client、opp、event\n     *    params.cid\n     *    params.oid\n     *    params.eventid\n     * @param   {object}        params\n     * @returns {HttpPromise}   HttpPromise\n     */\n    select: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactselect', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMContact#related\n     * @methodOf  crm.services.CRMContact\n     * @description\n     *    关联联系人到客户、商机、事件\n     *    `params.type`       {string}  关联类型\n     *    `params.contactid`  {array}   联系人id\n     *    `params.cid`        {string}  关联目标数据，多选一\n     *    `params.oid`        {string}  关联目标数据，多选一\n     * @param   {Object}        params    请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    related: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/contactrelated', params);\n    }\n  };\n\n  return CRMContact;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMClient\n * @description\n *   CRM 客户服务\n */\n.factory('CRMClient', function($http, Utils, Settings, CRM) {\n  var CRMClient = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#tagList\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'client'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#list\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientlist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#create\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    创建客户\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#create\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    更新客户信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#view\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户详情\n     *    `params.cid`  {string}  客户 id\n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#remove\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    删除客户\n     *    `params.cid`  {string}  客户 id\n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientremove', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMClient#select\n     * @methodOf  crm.services.CRMClient\n     * @description\n     *    获取客户选择器数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    select: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/clientselect', params);\n    }\n  };\n\n  return CRMClient;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMOpportunity\n * @description\n *   CRM 商机服务\n */\n.factory('CRMOpportunity', function($http, Utils, Settings, CRM) {\n  var CRMOpportunity = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#tagList\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'opportunity'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#list\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/opplist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#create\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    创建商机\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#create\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    更新商机信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#view\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机详情\n     *    `params.oid`  {string}  商机id\n     *    \n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#remove\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    删除商机\n     *    `params.oid`  {string}  商机id\n     *    \n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppremove', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMOpportunity#select\n     * @methodOf  crm.services.CRMOpportunity\n     * @description\n     *    获取商机选择数据\n     *    `params.cid`  {string}  客户id\n     *    \n     * @returns {HttpPromise}   HttpPromise\n     */\n    select: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/oppselect', params);\n    }\n  };\n\n  return CRMOpportunity;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMEvent\n * @description\n *   CRM 事件服务\n */\n.factory('CRMEvent', function($http, Utils, Settings, CRM) {\n  var CRMEvent = {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#tagList\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    获取事件模块标签设置\n     * @returns {HttpPromise}   HttpPromise\n     */\n    tagList: function() {\n      return CRM.tagList({\n        module: 'event'\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#list\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    获取事件列表\n     *    \n     *    - params.range    {string}  筛选范围，my：我的|all：全部，默认all\n     *    - params.tags     {array}   标签条件，不填则没有限制\n     *    - params.keyword  {string}  联系人名字模糊搜索\n     *    - params.limit    {number}  每次获取条数\n     *    - params.offset   {number}  获取数据的起始点\n     *\n     * @param   {Object}        params  请求参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    list: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventlist', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#create\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    创建事件\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    create: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventadd', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#create\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    更新事件信息\n     *\n     * @param   {Object}        data    表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    update: function(data) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventedit', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#view\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    获取事件详情\n     * @returns {HttpPromise}   HttpPromise\n     */\n    view: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventdetail', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMEvent#remove\n     * @methodOf  crm.services.CRMEvent\n     * @description\n     *    删除事件\n     * @returns {HttpPromise}   HttpPromise\n     */\n    remove: function(params) {\n      return Utils.postJsonData(Settings.hostUrl + '?r=crm/api/eventremove', params);\n    }\n  };\n\n  return CRMEvent;\n})\n\n/**\n * @ngdoc service\n * @name  crm.services.CRMUtils\n * @description\n *   CRM 工具函数\n */\n.factory('CRMUtils', function($rootScope, $window, $ionicHistory, $ionicLoading, $ionicModal, $ionicViewSwitcher, dateFilter, mapFilter, Utils, IbPopup, CRMContact, CRMClient, CRMOpportunity, CRMEvent) {\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#buildContactFormData\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    预处理联系人表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    buildContactFormData: function(data) {\n      return angular.extend({}, data, {\n        birthday: dateFilter(data.birthday, 'yyyy-MM-dd'),\n        cid: data.client.cid,\n        client: null\n      });\n    },\n\n    // 移除包装函数\n    wrapRemovePromise: function(promise, clearState) {\n      $ionicLoading.show();\n      promise.success(function(res) {\n          if (res.isSuccess) {\n            $ionicHistory.clearCache([clearState]).then(function() {\n              //@Note: 此处不使用 history.go(-2) 是由于动画方向不同\n              $ionicViewSwitcher.nextDirection('back')\n              $window.history.go(-2)\n              // $ionicHistory.goBack(-2)\n            });\n          } else {\n            IbPopup.alert({\n              title: res.msg\n            });\n          }\n        })\n        .finally($ionicLoading.hide);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveContact\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除联系人\n     * @param   {object}  params  作为 CRMContact.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveContact: function(params) {\n      var that = this;\n      IbPopup.confirm({\n          title: '确定要删除当前联系人？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMContact.remove(params), 'crm.contact')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveClient\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除客户\n     * @param   {object}  params  作为 CRMClient.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveClient: function(params) {\n      var that = this;\n      return IbPopup.confirm({\n          title: '确定要删除当前客户？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMClient.remove(params), 'crm.client')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveClient\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除商机\n     * @param   {object}  params  作为 CRMOpportunity.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveOpportunity: function(params) {\n      var that = this;\n      return IbPopup.confirm({\n          title: '确定要删除当前商机？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMOpportunity.remove(params), 'crm.opportunity')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#confirmRemoveEvent\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    确认删除商机\n     * @param   {object}  params  作为 CRMEvent.remove 方法的参数直接调用\n     * @returns {HttpPromise}   HttpPromise\n     */\n    confirmRemoveEvent: function(params) {\n      var that = this;\n      return IbPopup.confirm({\n          title: '确定要删除当前事件？'\n        })\n        .then(function(ok) {\n          if (ok) {\n            that.wrapRemovePromise(CRMEvent.remove(params), 'crm.event')\n          }\n        });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#buildOpportunityFormData\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    预处理联系人表单数据\n     * @returns {HttpPromise}   HttpPromise\n     */\n    buildOpportunityFormData: function(data) {\n      return angular.extend({}, data, {\n        createtime: dateFilter(data.createtime, 'yyyy-MM-dd HH:mm:ss'),\n        expectendtime: dateFilter(data.expectendtime, 'yyyy-MM-dd HH:mm:ss')\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openClientModal\n     * @methodOf  crm.services.CRMUtils\n     * @todo  openClientModal、openOpportunityModal、openContactModal 有大量重复逻辑，可以整理\n     * @description\n     *    打开客户选择窗口\n     *    opts.cid       {string}    当前选中的客户id\n     *    opts.callback  {function}  确认后回调\n     * @param   {object}  opts  参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    openClientModal: function(opts) {\n      var that = this;\n      var scope = this.clientScope;\n\n      opts = opts || {};\n\n      function fetch() {\n        CRMClient.select().success(function(res) {\n          if (res.isSuccess) {\n            that.clientScope.clients = res.data;\n            that.clientScope.clients.forEach(function(client) {\n              client.firstLetter = client.firstCase.charAt(0).toUpperCase()\n            })\n          }\n        });\n      }\n\n      if (scope) {\n        scope.cid = opts.cid;\n        scope.opts = opts;\n        fetch()\n        return this.clientScope.modal.show();\n      }\n\n      scope = this.clientScope = $rootScope.$new(true);\n      scope.opts = opts;\n\n      $ionicModal.fromTemplateUrl('templates/crm/select-client.html', {\n        scope: scope\n      }).then(function(modal) {\n        fetch()\n        modal.show();\n        that.clientScope.cid = scope.opts.cid;\n        that.clientScope.select = function(client) {\n          scope.opts.callback && scope.opts.callback(client);\n          modal.hide();\n        };\n        that.clientScope.modal = modal;\n        that.clientScope.$on('$destroy', modal.remove.bind(modal));\n        $rootScope.$on('$stateChangeSuccess', modal.hide.bind(modal))\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openOpportunityModal\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    打开商机选择窗口\n     *    opts.selected   {string}    当前选中的商机id\n     *    opts.callback   {function}  确认后回调\n     * @param   {object}  opts  参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    openOpportunityModal: function(opts) {\n      var that = this;\n      var scope = this.oppScope;\n\n      opts = opts || {};\n\n      function fetch() {\n        CRMOpportunity.select(opts.params).success(function(res) {\n          if (res.isSuccess) {\n            scope.opps = res.data;\n          }\n        });\n      }\n\n      if (scope) {\n        scope.selected = opts.selected;\n        scope.opts = opts;\n        fetch();\n        return scope.modal.show();\n      }\n\n      scope = this.oppScope = $rootScope.$new(true);\n      scope.opts = opts;\n\n      $ionicModal.fromTemplateUrl('templates/crm/select-opportunity.html', {\n        scope: scope\n      }).then(function(modal) {\n        fetch()\n        modal.show();\n        scope.selected = scope.opts.selected;\n        scope.select = function(opp) {\n          scope.opts.callback && scope.opts.callback(opp);\n          modal.hide();\n        };\n        scope.modal = modal;\n        scope.$on('$destroy', modal.remove.bind(modal));\n        $rootScope.$on('$stateChangeSuccess', modal.hide.bind(modal))\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openClientModal\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    打开联系人选择窗口\n     *    opts.selected  {array}   当前选中的联系人数据\n     *    opts.callback  {function}  确认后回调\n     * @param   {object}  opts  参数\n     * @returns {HttpPromise}   HttpPromise\n     */\n    openContactModal: function(opts) {\n      var that = this;\n      var scope = this.contactScope;\n      opts = opts || {};\n\n      function fetch() {\n        CRMContact.select(scope.opts.params).success(function(res) {\n          if (res.isSuccess) {\n            scope.contacts = res.data.list;\n            scope.restoreSelected(scope.opts.selected);\n          }\n        });\n      }\n\n      if (scope) {\n        scope.opts = opts;\n        fetch();\n        return scope.modal.show();\n      }\n\n      scope = this.contactScope = $rootScope.$new(true);\n      scope.opts = opts;\n      // 获取选中值数组\n      scope.getSelected = function() {\n        if (this.contacts && this.contacts.length) {\n          return this.contacts.filter(function(contact) {\n            return contact.checked;\n          });\n        } else {\n          return [];\n        }\n      };\n      // 还原初始选中值\n      scope.restoreSelected = function(selectedIds) {\n        if (scope.contacts && scope.contacts.length) {\n          // 如果有传递初始值，则匹配还原\n          if (selectedIds && selectedIds.length) {\n            scope.contacts.forEach(function(contact) {\n              if (selectedIds.indexOf(contact.contactid) !== -1) {\n                contact.checked = true;\n              }\n            });\n            // 如果没有，则清空所有选中项\n          } else {\n            scope.contacts.forEach(function(contact) {\n              delete contact.checked;\n            });\n          }\n        }\n\n      };\n      scope.save = function() {\n        scope.opts.callback && scope.opts.callback(scope.getSelected());\n        scope.modal.hide();\n      };\n\n      $ionicModal.fromTemplateUrl('templates/crm/select-contact.html', {\n        scope: scope\n      }).then(function(modal) {\n        scope.modal = modal;\n        scope.$on('$destroy', modal.remove.bind(modal));\n        $rootScope.$on('$stateChangeSuccess', modal.hide.bind(modal))\n        fetch();\n        modal.show();\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#openAttachModal\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    打开客户关联数据窗口\n     */\n    openAttachModal: function(scope) {\n      var that = this;\n      scope.__attachOpts = scope.__attachOpts || {};\n      scope.__attachOpts = angular.extend({\n        newEvent: true,\n        newOpp: true,\n        newContact: true,\n        attachContact: true\n      }, scope.__attachOpts);\n\n      if (scope.clientAttachModal) return scope.clientAttachModal.show();\n\n      $ionicModal.fromTemplateUrl('templates/crm/attach-modal.html', {\n        scope: scope,\n        animation: 'fade-in'\n      }).then(function(modal) {\n        modal.hideDelay = 1;\n        modal.show();\n        scope.clientAttachModal = modal;\n        scope.$on('$ionicView.leave', modal.hide.bind(modal));\n        scope.$on('$destroy', modal.remove.bind(modal));\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#selectContactToClient\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    选择联系人并关联到客户\n     *    \n     * @param   {string}    cid       客户id\n     * @param   {array}     selected  当前默认选中的 contactid 组\n     * @param   {function}  selected  成功回调\n     */\n    selectContactToClient: function(cid, selected, onSuccess) {\n      this.openContactModal({\n        selected: selected,\n        params: {\n          type: 'client'\n        },\n        callback: function(selected) {\n          $ionicLoading.show();\n          CRMContact.related({\n              type: 'client',\n              cid: cid,\n              contactid: mapFilter(selected, 'contactid')\n            })\n            .success(onSuccess)\n            .success(Utils.serverWarning)\n            .finally($ionicLoading.hide);\n        }\n      });\n    },\n\n    initTagsToForm: function(form, tagGroups) {\n      form.tags = form.tags || {};\n      angular.forEach(tagGroups, function(tagGroup) {\n        if (!form.tags[tagGroup.groupid]) {\n          form.tags[tagGroup.groupid] = tagGroup.taglist[0].tagid;\n        }\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      crm.services.CRMUtils#setTagsToForm\n     * @methodOf  crm.services.CRMUtils\n     * @description\n     *    将后端返回的标签格式转化为表单可用格式\n     *    \n     * @param   {object}    form  表单模型\n     * @param   {object}    tags  标签信息\n     * @param   {function}  selected  成功回调\n     */\n    setTagsToForm: function(form, tags) {\n      if (form && tags && tags.length) {\n        form.tags = {};\n        angular.forEach(tags, function(tag) {\n          form.tags[tag.groupid] = tag.tag.tagid;\n        });\n      }\n      return form;\n    },\n\n    formValidateError: function(res) {\n      if (!res.isSuccess) {\n        if (res.data && res.data.error) {\n          IbPopup.alert({\n            title: mapFilter(res.data.error).join('<br>')\n          });\n        } else {\n          IbPopup.alert({\n            title: res.msg\n          });\n        }\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc filter\n * @name crm.services.filter:groupAndOrder\n * @function\n * @description\n *  分组并按分组索引排序，返回排序后的索引数组 arr，并在 arr.grouped 中引用分组数据\n *\n * @param   {array}             arr        需要分组排序的数组\n * @param   {string|function}   groupBy    分组依据字段\n * @param   {boolean}           orderDesc  是否倒序\n * @returns {array}   分组排序结果\n */\n.filter('groupAndOrder', function(groupByFilter) {\n  return function(arr, groupBy, orderDesc) {\n    var keys = []\n    if(arr && arr.length) {\n      var grouped = groupByFilter(arr, groupBy);\n      \n      keys = Object.keys(grouped);\n      keys.sort(function(a, b) {\n        return (orderDesc ? b > a : a > b) ? 1 : -1;\n      });\n      keys.grouped = grouped\n    }\n    return keys;\n  }\n})\n\n.filter('mapMultiply', function() {\n  return function(arr, multi) {\n    multi = multi || 10\n    return arr.map(function(num) {\n      return num * multi\n    })\n  }\n})\n\n/**\n * @ngdoc     directive\n * @name      crm.services.directive:crmContactItem\n * @restrict  E\n * @description\n *   CRM 联系人模板指令\n *   `mode`  {string}  支持 view|attach|edit 三种值，排版不一样，值为 edit 时支持 onRemove 回调\n * @param  {object}  contact  联系人数据\n */\n.directive('crmContactItem', function() {\n  return {\n    restrict: 'E',\n    scope: {\n      mode: '@',\n      onRemove: '&',\n      contact: '='\n    },\n    templateUrl: 'templates/crm/contact-item.html',\n    replace: true,\n    // transclude: true,\n    link: angular.noop\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      crm.services.directive:crmEventItem\n * @restrict  E\n * @description\n *   CRM 事件模板指令\n *  \n * @param  {object}  ev  事件\n */\n.directive('crmEventItem', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      ev: '='\n    },\n    templateUrl: 'templates/crm/event-item.html',\n    transclude: true,\n    link: angular.noop\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      crm.services.directive:crmOppItem\n * @restrict  E\n * @description\n *   CRM 商机模板指令\n *  \n * @param  {object}  opp  商机数据\n */\n.directive('crmOppItem', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      opp: '='\n    },\n    templateUrl: 'templates/crm/opportunity-item.html',\n    transclude: true,\n    link: angular.noop\n  };\n})\n\n/**\n * @ngdoc     directive\n * @name      ibosApp.directives.directive:clock\n * @element   ANY\n * @restrict  A\n * @description\n *  仪表盘进度\n *\n */\n.directive('clock', function($timeout) {\n  return {\n    restrict: 'A',\n    link: function($scope, $element, $attrs) {\n      var ele = $element[0],\n        attr = $attrs.$attr,\n        angle;\n\n      $scope.$watch('percent', function(percent) {\n        if (percent) {\n          //此处按旋转角度180º计算\n          if (attr.plus === 'plus') {\n            //角度从0度开始计算\n            angle = percent !== 0 ? percent * 1.8 : 0;\n          } else {\n            //角度从-45度开始计算\n            angle = percent === 0 ? -45 : (percent * 1.8 - 45);\n          }\n          ['transform', 'OTransform', 'msTransform', 'MozTransform', 'webkitTransform'].forEach(function(key) {\n            ele.style[key] = 'rotate(' + angle + 'deg)';\n          });\n        }\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:searchTabBar\n * @element  ionHeaderBar\n * @restrict A\n * @description\n *   tab 与 search 功能合并工具条\n *   @param tabs        `expression` tab 项数组\n *   @param searchModal `expression` SearchModal 实例\n *   @param onTab       `expression` tab 回调\n */\n.directive('searchTabBar', function(SearchModal) {\n  return {\n    templateUrl: 'templates/crm/search-tab-bar.html',\n    scope: {\n      tabs: '=searchTabBar',\n      searchModal: '=',\n      onTab: '&'\n    },\n    compile: function(element, attrs) {\n      element.addClass('search-tab-bar')\n\n      // link\n      return function($scope, $element, $attrs) {\n        $scope.tabTo = function($index) {\n          $scope.activeIndex = $index\n          $scope.onTab({\n            $tab: $scope.tabs[$index]\n          })\n        }\n        $scope.tabTo(0)\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:tagsSelector\n * @element  ANY\n * @restrict A\n * @description\n *   标签选择器\n */\n.directive('crmFilter', function($compile, $ionicTemplateLoader, Utils) {\n  return {\n    scope: {\n      filterGroups: '=',\n      onSelect: '='\n    },\n    replace: true,\n    templateUrl: 'templates/crm/crm-filter-menu.html',\n    compile: function(element) {\n      // @p.s 此处放置空 ng-click 是为了有点击效果\n      // element.attr('ng-click', '')\n\n      // link\n      return function($scope, $element, $attrs, $ngModelCtrl) {\n        $scope.filterShown = false\n        $scope.selectFilterItem = function(item, filterGroup) {\n          filterGroup.selected = filterGroup.items.indexOf(item)\n          $scope.onSelect(item, filterGroup)\n        }\n      }\n    }\n\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:crmUser\n * @element  ANY\n * @restrict ECMA\n * @description\n *   CRM 用户信息组\n */\n.directive('crmUser', function() {\n  return {\n    template: '<span class=\"crm-user\"> ' +\n      '<img avatar=\"{{ uid | avatar | defaultAvatar }}\"> ' +\n      '<span>{{ uid | userInfo:\\'realname\\' }}</span> ' +\n      '</span>',\n    replace: true,\n    scope: {\n      uid: '@'\n    },\n    link: angular.noop\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:crmTagsSection\n * @element  ANY\n * @restrict ECMA\n * @description\n *   CRM 标签组预览文本\n */\n.directive('crmTagsSection', function() {\n  return {\n    template: '<span class=\"crm-tags-section\"> ' +\n      '<i class=\"crm-icon-tag\"></i> ' +\n      '<span ng-repeat=\"tag in tags\">{{ tag.tag.name }}{{ $last ? \\'\\' : \\'；\\' }}</span> ' +\n      '</span>',\n    replace: true,\n    scope: {\n      tags: '='\n    },\n    link: angular.noop\n  }\n})\n\n.directive('crmEmptyTip', function() {\n  return {\n    template: '<div class=\"list-empty-tip\"> ' +\n      '<i class=\"news-icon-empty\"></i> ' +\n      '<p class=\"margin-top coyness\">{{ text }}</p> ' +\n      '</div>',\n    replace: true,\n    link: function($scope, $element, $attr) {\n      $scope.text = $attr.text || '这里空空如也'\n    }\n  }\n})\n\n/**\n * @ngdoc    directive\n * @name     crm.services.directive:processbar\n * @element  ANY\n * @restrict ECMA\n * @description\n *   进度条控件\n */\n.directive('processbar', function() {\n  return {\n    template: '<div class=\"processbar\"> ' +\n      '<div class=\"processbar-fill\" style=\"width: {{ percent || 0 }}%; background-color: {{ color || \\'red\\' }}\"></div>' +\n      '</div>',\n    replace: true,\n    scope: {\n      value: '@',\n      color: '@'\n    },\n    link: function($scope) {\n      $scope.$watch('value', function(val) {\n        val = isNaN(+val) ? 0 : +val\n        $scope.percent = Math.min(100, Math.max(val, 0))\n      })\n    }\n  }\n})\n\n/* @ngInject */\n.directive('ngCurrency', function($filter, $locale) {\n\n  return {\n    require: 'ngModel',\n    link: function(scope, element, attrs, controller) {\n      var hardCap, min, max, currencySymbol, ngRequired;\n      var active = true;\n      var fraction = 2;\n\n      attrs.$observe('ngCurrency', function(value) {\n        active = (value !== 'false');\n        if (active) {\n          reformat();\n        } else {\n          controller.$viewValue = controller.$$rawModelValue;\n          controller.$render();\n        }\n      });\n\n      attrs.$observe('hardCap', function(value) {\n        hardCap = (value === 'true');\n        revalidate();\n      });\n      attrs.$observe('min', function(value) {\n        min = value ? Number(value) : undefined;\n        revalidate();\n      });\n      attrs.$observe('max', function(value) {\n        max = value ? Number(value) : undefined;\n        revalidate();\n      });\n      attrs.$observe('currencySymbol', function(value) {\n        currencySymbol = value;\n        reformat();\n      });\n      attrs.$observe('ngRequired', function(value) {\n        ngRequired = value;\n        revalidate();\n      });\n      attrs.$observe('fraction', function(value) {\n        fraction = value || 2;\n        reformat();\n        revalidate();\n      });\n\n      controller.$parsers.push(function(value) {\n        if (active && [undefined, null, ''].indexOf(value) === -1) {\n          value = clearValue(value);\n          value = keepInRange(Number(value));\n          return value;\n        }\n        return value;\n      });\n\n      controller.$formatters.push(function(value) {\n        if (active && [undefined, null, ''].indexOf(value) === -1) {\n          return $filter('currency')(value, getCurrencySymbol(), fraction);\n        }\n        return value;\n      });\n\n      controller.$validators.min = function(value) {\n        if (!ngRequired && ([undefined, null, ''].indexOf(value) !== -1 || isNaN(value))) {\n          return true;\n        }\n        return !active ||\n          [undefined, null].indexOf(min) !== -1 || isNaN(min) ||\n          value >= min;\n      };\n\n      controller.$validators.max = function(value) {\n        if (!ngRequired && ([undefined, null, ''].indexOf(value) !== -1 || isNaN(value))) {\n          return true;\n        }\n        return !active ||\n          [undefined, null].indexOf(max) !== -1 || isNaN(max) ||\n          value <= max;\n      };\n\n      controller.$validators.fraction = function(value) {\n        return !active || !value || !isNaN(value);\n      };\n\n      function reformat() {\n        if (active) {\n          var value;\n          if (controller.$options && controller.$options.updateOn === 'blur') {\n            value = controller.$viewValue;\n            for (var i = controller.$parsers.length - 1; i >= 0; i--) {\n              value = controller.$parsers[i](value);\n            }\n          } else {\n            value = controller.$$rawModelValue;\n          }\n          for (var i = controller.$formatters.length - 1; i >= 0; i--) {\n            value = controller.$formatters[i](value);\n          }\n          controller.$viewValue = value;\n          controller.$render();\n        }\n      }\n\n      function revalidate() {\n        controller.$validate();\n        if (active) {\n          var value = keepInRange(controller.$$rawModelValue);\n          if (value !== controller.$$rawModelValue) {\n            controller.$setViewValue(value.toFixed(fraction));\n            controller.$commitViewValue();\n            reformat();\n          }\n        }\n      }\n\n      function keepInRange(value) {\n        if (hardCap) {\n          if (max !== undefined && value > max) {\n            value = max;\n          } else if (min !== undefined && value < min) {\n            value = min;\n          }\n        }\n        return value;\n      }\n\n      scope.$on('currencyRedraw', function() {\n        revalidate();\n        reformat();\n      });\n\n      element.bind('focus', function() {\n        if (active) {\n          var groupRegex = new RegExp('\\\\' + $locale.NUMBER_FORMATS.GROUP_SEP, 'g');\n          var value = [undefined, null, ''].indexOf(controller.$$rawModelValue) === -1 ? $filter('number')(controller.$$rawModelValue, fraction).replace(groupRegex, '') : controller.$$rawModelValue;\n          if (controller.$viewValue !== value) {\n            controller.$viewValue = value;\n            controller.$render();\n            element.triggerHandler('focus');\n          }\n        }\n      });\n\n      element.bind('blur', reformat);\n\n      // TODO: Rewrite this parsing logic to more readable.\n\n      function decimalRex(dChar) {\n        return RegExp('\\\\d|\\\\-|\\\\' + dChar, 'g');\n      }\n\n      function clearRex(dChar) {\n        return RegExp('\\\\-{0,1}((\\\\' + dChar + ')|([0-9]{1,}\\\\' + dChar + '?))&?[0-9]{0,' + fraction + '}', 'g');\n      }\n\n      function clearValue(value) {\n        value = String(value);\n        var dSeparator = $locale.NUMBER_FORMATS.DECIMAL_SEP;\n        var cleared = null;\n\n        if (value.indexOf($locale.NUMBER_FORMATS.DECIMAL_SEP) === -1 &&\n          value.indexOf('.') !== -1 &&\n          fraction > 0) {\n          dSeparator = '.';\n        }\n\n        // Replace negative pattern to minus sign (-)\n        var neg_dummy = $filter('currency')('-1', getCurrencySymbol(), fraction);\n        var neg_regexp = RegExp('[0-9.' + $locale.NUMBER_FORMATS.DECIMAL_SEP + $locale.NUMBER_FORMATS.GROUP_SEP + ']+');\n        var neg_dummy_txt = neg_dummy.replace(neg_regexp.exec(neg_dummy), '');\n        var value_dummy_txt = value.replace(neg_regexp.exec(value), '');\n\n        // If is negative\n        if (neg_dummy_txt === value_dummy_txt) {\n          value = '-' + neg_regexp.exec(value);\n        }\n\n        if (RegExp('^-[\\\\s]*$', 'g').test(value)) {\n          value = '-0';\n        }\n\n        if (decimalRex(dSeparator).test(value)) {\n          cleared = value.match(decimalRex(dSeparator))\n            .join('').match(clearRex(dSeparator));\n          cleared = cleared ? cleared[0].replace(dSeparator, '.') : null;\n        }\n\n        return cleared;\n      }\n\n      function getCurrencySymbol() {\n        return currencySymbol === undefined ? $locale.NUMBER_FORMATS.CURRENCY_SYM : currencySymbol;\n      }\n    }\n  };\n})\n\n.filter('crmFilterSelectedText', function() {\n  return function(filterGroups) {\n    var hasSelectedGroups = filterGroups.filter(function(g) {\n      return g.selected !== 0\n    })\n    return hasSelectedGroups.map(function(g) {\n      var text = g.items[g.selected].text\n      if(g.groupName === '创建时间') {\n        text += '创建'\n      } else if(g.groupName === '跟进时间') {\n        text += '跟进'\n      }\n      return text\n    }).join(' ● ')\n  }\n})\n\n.filter('crmContactExtendText', function(CRM_CONTACT_EXTEND) {\n  return function(key) {\n    return CRM_CONTACT_EXTEND[key] || ''\n  }\n})","/**\n * @ngdoc module\n * @name diary.controllers\n * @description\n *   工作日志模块控制器\n */\nangular.module('diary.controllers', [])\n\n/**\n * @ngdoc controller\n * @name DiaryIndexCtrl\n * @module diary.controllers\n * @description\n *   日志主页控制器\n */\n  .controller('DiaryIndexCtrl', function($scope, $ionicModal, $ionicLoading, $state, User, Utils, Diary) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n        if(res.isSuccess){\n          if(res.data.diary){\n            $scope.openSettingModel = function() {\n              $ionicModal.fromTemplateUrl('templates/diary/diary-setting.html', {\n                scope: $scope,\n                animation: 'slide-in-up'\n              })\n                .then(function(modal) {\n                  $scope.settingModel = modal;\n                  $scope.settingModel.show();\n\n                  $scope.formData = {\n                    defaultShareList: '',\n                    direct: 0,\n                    attentionList: ''\n                  };\n\n                  Diary.setting().success(function(res) {\n                    if(res.isSuccess) {\n                      $scope.dashboardConfig = res.dashboardConfig;\n                      angular.extend($scope.formData, res.data, {\n                        direct: +res.data.direct\n                      });\n                    }\n                  });\n\n                  $scope.submit = function() {\n                    $ionicLoading.show();\n                    Diary.savesetting({\n                      defaultShareList: User.addPrefix($scope.formData.defaultShareList),\n                      direct: $scope.formData.direct,\n                      attentionList: User.addPrefix($scope.formData.attentionList),\n                    }).success(function(res) {\n                      if (res.isSuccess === true) {\n                        $scope.settingModel.hide();\n                      }\n                    })\n                      .finally($ionicLoading.hide);\n                  }\n                })\n            };\n          } else{\n            Utils.promptNoPermission();\n          }\n        }\n      }\n    ).finally($ionicLoading.hide);\n  })\n/**\n * @ngdoc controller\n * @name DiaryPersionalCtrl\n * @module diary.controllers\n * @description\n *   我的日志列表页控制器\n */\n  .controller('DiaryPersionalCtrl', function($scope, $ionicListDelegate, $ionicScrollDelegate, $ionicLoading, dateFilter, Utils, IbPopup, Diary) {\n\n    $scope.list = [];\n    $scope.loadMore = function() {\n      return Diary.mine({\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n          $scope.list = $scope.list.concat(res.data);\n          $scope.pages = res.pages;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    }\n\n    $scope.groupByYearMonth = function(item) {\n      return dateFilter(item.diarytime * 1000, 'yyyy年M月');\n    };\n\n    $scope.remove = function(item) {\n      IbPopup.confirm({title: '确认删除日志？'}).then(function(flag) {\n        if (flag) {\n          $ionicListDelegate.closeOptionButtons();\n          $ionicLoading.show();\n          Diary.remove(item.diaryid)\n            .success(function(res) {\n              if(res.isSuccess) {\n                Utils.eliminate($scope.list, item);\n              } else {\n                IbPopup.alert({ title: res.msg });\n              }\n            })\n            .finally($ionicLoading.hide);\n        }\n      });\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryReviewCtrl\n * @module diary.controllers\n * @description\n *   日志评阅列表页控制器\n */\n  .controller('DiaryReviewCtrl', function($scope, $state, $stateParams, $filter, $ionicHistory, $ionicScrollDelegate, User, dateFilter, Diary) {\n    $scope.list = [];\n    $scope.loadMore = function() {\n      return Diary.allsubs({\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n\n          if(!res.diary || !res.diary.length) return;\n\n          angular.forEach(res.diary, function(item) {\n            item.isfavor = res.attentionList.indexOf(item.uid) !== -1;\n          });\n\n          $scope.list = $scope.list.concat(res.diary);\n          $scope.pages = res.pages;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    }\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.diarytime * 1000, 'EEEE MM-dd');\n    };\n\n    $scope.isToday = function(key) {\n      return key == dateFilter(new Date(), 'EEEE MM-dd');\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryFollowCtrl\n * @module diary.controllers\n * @description\n *   日志关注列表页控制器\n */\n  .controller('DiaryFollowCtrl', function($scope, $state, $stateParams, $filter, $ionicHistory, $ionicScrollDelegate, User, dateFilter, Diary ) {\n    $scope.list = [];\n    $scope.loadMore = function() {\n      return Diary.other({\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n          $scope.list = $scope.list.concat(res.data);\n          $scope.pages = res.pages;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    }\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.diarytime * 1000, 'EEEE MM-dd');\n    };\n\n    $scope.isToday = function(key) {\n      return key == dateFilter(new Date(), 'EEEE MM-dd');\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryDetailCtrl\n * @module diary.controllers\n * @description\n *   日志详细页控制器\n */\n  .controller('DiaryDetailCtrl', function($scope, $rootScope, $state, $stateParams, $ionicLoading, $ionicActionSheet, $ionicModal, $ionicScrollDelegate, Utils, User, IbPopup, Diary, Settings, userInfoFilter) {\n\n    // 上一篇、下一篇日志\n    // @Todo:\n    // 此处应该做路由跳转到新视图，但在目前 ionic 框架中，路由跳转会破坏历史视图导致无法直接返回列表页\n    // 所以现在暂时做成了在当前视图加载其他日志的数据\n    $scope.toDiary = function(id) {\n      loadDiary(id);\n      $ionicScrollDelegate.scrollTop();\n    };\n\n    $scope.showMore = function() {\n\n      $scope.hideMore = $ionicActionSheet.show({\n        buttons: [{\n          text: '编辑'\n        }],\n        buttonClicked: function() {\n          $state.go('diary.edit', {\n            id: $scope.diary.diaryid\n          })\n          return true;\n        },\n        destructiveText: '删除',\n        cancelText: '取消',\n        destructiveButtonClicked: function() {\n          IbPopup.confirm({title: '确认删除日志？'}).then(function(flag){\n            if(flag){\n              $ionicLoading.show();\n              Diary.remove($scope.diary.diaryid)\n                .success(function(res) {\n                  if(res.isSuccess) {\n                    Utils.clearStateCacheAndGo('diary.personal');\n                  } else {\n                    IbPopup.alert({ title: res.msg });\n                  }\n                })\n                .finally($ionicLoading.hide);\n            }\n          });\n          return true;\n        }\n      })\n    };\n\n    $scope.showCommentModal = function(type, cm) {\n      $ionicModal.fromTemplateUrl('templates/diary/diary-comment.html', {\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.commentModel = modal;\n          $scope.commentModel.show();\n\n          if (type === 'reply') {\n            $scope.comment.content = cm.touid ? '回复 @' + userInfoFilter(cm.uid, 'realname') + ' : ' : ''\n          }\n\n          modal.scope.commentType = type;\n        });\n\n      $scope.comment.submitting = false;\n      $scope.comment.submit = function() {\n        var that = this;\n        var params = {\n          content: this.content,\n          type: type\n        };\n\n        if (that.stamp) {\n          params.stamp = that.stamp.id;\n        }\n\n        if (type === 'comment') {\n          params.rowid = $scope.diary.diaryid;\n        } else if (type === 'reply') {\n          params.tocid = cm.cid;\n          // 如果直接回复评论，则\n          // 否则，如果回复评论下的回复，则\n          params.rowid = cm.tocid === '0' ? cm.cid : cm.rowid;\n        }\n        that.submitting = true;\n\n        return Diary.addComment(params)\n          .success(function(res) {\n            // 发送评论成功后，更新本地列表中的数据\n            that.content = '';\n            if (that.stamp) {\n              $scope.stampUrl = that.stamp.stamp;\n            }\n            $scope.commentModel.hide();\n\n            $ionicLoading.show();\n            Diary.get($scope.diary.diaryid).success(function(res) {\n              $scope.commentList = res.list.map(function(cm) {\n                return angular.extend({}, cm, {\n                  realname: cm.user_info.realname,\n                  avatar: cm.user_info.avatar_middle\n                });\n              });\n            })\n              .finally($ionicLoading.hide);\n          })\n          .finally(function() {\n            that.submitting = false;\n          });\n      }\n    };\n\n    function loadDiary(id) {\n      $ionicLoading.show();\n      Diary.show(id)\n        .success(function(res) {\n          $scope.diary = res.diary;\n          var imgReg = /<img[^>]+src=['\"](\\/data\\/ueditor\\/image[^'\"]+)['\"]+/g;\n\n          res.diary.content = res.diary.content.replace(imgReg, function(a, b) {\n            return a.replace(b, Settings.hostUrl + b);\n          });\n\n          $scope.today = $scope.diary.diarytime;\n          $scope.nextDay = $scope.diary.nextDiarytime;\n\n          $scope.planned = res.data.originalPlanList;\n          $scope.unplanned = res.data.outsidePlanList;\n          $scope.plans = res.data.tomorrowPlanList;\n          $scope.originalPlan = res.data.originalPlanList;\n\n          $scope.next = res.prevAndNextPK.nextPK;\n          $scope.prev = res.prevAndNextPK.prevPK;\n\n          $scope.attach = res.attach;\n          $scope.readers = $scope.diary.readeruid ? $scope.diary.readeruid.split(',') : [];\n          $scope.editable = $scope.diary.uid == User.uid;\n\n          $scope.isShare = res.isShare;\n          $scope.isSup = res.isSup;\n          $scope.dashboardConfig = res.dashboardConfig;\n\n          //图章\n          $scope.comment = {};\n          $scope.comment.stamps = res.allStamps;\n\n          // 过滤出需要使用的数据\n          $scope.commentList = res.list.map(function(cm) {\n            return angular.extend({}, cm, {\n              realname: cm.user_info.realname,\n              avatar: cm.user_info.avatar_middle\n            });\n          });\n          $scope.stampUrl = res.stampUrl;\n        })\n        .finally($ionicLoading.hide);\n    }\n\n    loadDiary($stateParams.id);\n  })\n\n  .controller('DiaryFormCtrl', function($scope, $ionicLoading, $ionicModal, IbPopup, Diary, DiaryUtils, SCHEDULE) {\n    $scope.formData = {\n      originalPlan: [],\n      planOutside: [],\n      plan: [],\n      uploadImagesPreviews: [],\n      attachmentid: '',\n      diaryContent: '',\n      todayDate: '',\n      plantime: ''\n    };\n\n    //获取默认分享人员\n    Diary.setting().success(function(res) {\n      if (res.isSuccess) {\n        $scope.formData.shareuid = res.data.defaultShareList\n      }\n    });\n\n    // 是否处于提交中的状态\n    $scope.isSubmitting = false;\n    $scope.SCHEDULE = SCHEDULE;\n\n    $scope.addUnplanned = function() {\n      $scope.formData.planOutside.push({\n        content: '',\n        schedule: '0'\n      });\n    };\n\n    // 移除一条计划外\n    $scope.removeUnplanned = function(index) {\n      $scope.formData.planOutside.splice(index, 1);\n    };\n\n    // 增加一条计划\n    $scope.addPlan = function() {\n      $scope.formData.plan.push({\n        content: ''\n      });\n    };\n\n    // 移除一条计划\n    $scope.removePlan = function(index) {\n      $scope.formData.plan.splice(index, 1)\n    };\n\n    $scope.allowSubmit = function() {\n      var fd = $scope.formData;\n      return ((fd.planOutside[0] && fd.planOutside[0].content) || ($scope.originalPlanList && $scope.originalPlanList.length)) &&\n        (fd.plan[0] && fd.plan[0].content) &&\n        fd.diaryContent;\n    };\n\n    $scope.planfromschedule = function(todayDate) {\n      $ionicLoading.show();\n      Diary.planfromschedule(todayDate).success(function(res) {\n        if (res.data.length > 0) {\n          $scope.formData.planOutside = $scope.formData.planOutside.concat(res.data.map(function(c) {\n            return {\n              content: c.subject,\n              schedule: '0'\n            }\n          }));\n        } else {\n          IbPopup.alert({\n            title: '抱歉，你今天没有日程计划！'\n          })\n        }\n      })\n        .finally($ionicLoading.hide)\n    };\n\n    $scope.selectedStartDate = function() {\n      DiaryUtils.selectedStartDate($scope)\n    }\n\n    $scope.selectedEndDate = function() {\n      DiaryUtils.selectedEndDate($scope)\n    };\n\n    $scope.setRemind = function(plan) {\n      DiaryUtils.setRemind($scope, plan)\n    };\n\n    $scope.delRemind = function(plan) {\n      DiaryUtils.delRemind(plan)\n    };\n\n    $scope.openSharingModel = function() {\n      $ionicModal.fromTemplateUrl('templates/diary/diary-sharing.html', {\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.sharingModel = modal;\n          $scope.sharingModel.show();\n\n        })\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryCreateCtrl\n * @module diary.controllers\n * @description\n *   日志新建页控制器\n */\n  .controller('DiaryCreateCtrl', function($scope, $controller, $state, $ionicLoading, $ionicHistory, dateFilter, IbPopup, Utils, Diary, DiaryUtils, SCHEDULE) {\n    $controller('DiaryFormCtrl', {\n      $scope: $scope\n    });\n\n    $scope.submit = function() {\n        // console.log($scope.formData)\n        // debugger\n      // 检查添加的所有内容\n      var msg = '';\n      if ($scope.formData.plan.length == 0 || !$scope.formData.plan[0].content) {\n        msg = '至少填写一条工作计划';\n      }\n      if (!$scope.formData.diaryContent) {\n        msg = '请填写工作总结'\n      }\n      var planOutside = $scope.formData.planOutside.length;\n      var originalPlan = $scope.formData.originalPlan;\n      if (planOutside <= 0 && angular.equals({}, originalPlan)) {\n          msg = '至少填写一条工作记录';\n      } else if (angular.equals({}, originalPlan) && ($scope.formData.planOutside[0].content == \"\" || $scope.formData.planOutside[0].content == undefined)) {\n          msg = '至少填写一条工作记录';\n      }\n      if (msg) {\n        IbPopup.alert({\n          title: msg\n        })\n      } else {\n        Diary.create(DiaryUtils.handleFormData($scope.formData))\n          .success(function() {\n              Utils.clearStateCacheAndGo('diary.personal');\n          })\n          .finally(function() {\n              $scope.isSubmitting = false;\n          });\n      }\n    }\n\n    // 获取原计划等数据\n    $scope.$watch('formData.todayDate', function(date, oldDate) {\n      if (date) {\n        $scope.formData.plantime = dateFilter(+new Date(date) + 86400000, 'yyyy-MM-dd');\n\n        $ionicLoading.show();\n        Diary.add(date).success(function(res) {\n          if (res.isSuccess) {\n            // 是否安装了日程模块，用于判断是否支持提醒功能\n            $scope.isInstallCalendar = res.isInstallCalendar;\n            // 工作时间段\n            $scope.workStart = res.workStart;\n            // 后台配置项\n            $scope.dashboardConfig = res.dashboardConfig;\n            $scope.originalPlanList = res.data.originalPlanList;\n\n            // 组合 formData 数据\n            $scope.formData.originalPlan = {};\n            angular.forEach(res.data.originalPlanList, function(item) {\n              $scope.formData.originalPlan[item.recordid] = item.schedule;\n            });\n            $scope.formData.plan = [{}];\n            $scope.formData.planOutside = [{ schedule: '10' }];\n          } else {\n            IbPopup.alert({title: res.msg }).then(function(){\n              $state.go('diary.index');\n            });\n            // $scope.formData.todayDate = oldDate;\n          }\n        })\n          .finally($ionicLoading.hide);\n      }\n    });\n\n    $scope.formData.todayDate = dateFilter(new Date(), 'yyyy-MM-dd');\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryEditCtrl\n * @module diary.controllers\n * @description\n *   日志编辑页控制器\n */\n  .controller('DiaryEditCtrl', function($scope, $controller, $state, $stateParams, $ionicLoading, $ionicHistory, Utils, User, IbPopup, Diary, DiaryUtils, SCHEDULE) {\n    $controller('DiaryFormCtrl', {\n      $scope: $scope\n    });\n\n    $scope.selectedStartDate = $scope.selectedEndDate = angular.noop;\n\n    $scope.submit = function() {\n      // 检查添加的所有内容\n      var msg = '';\n      if ($scope.formData.plan.length == 0 || !$scope.formData.plan[0].content) {\n        msg = '至少填写一条工作计划';\n      }\n      if (!$scope.formData.diaryContent) {\n        msg = '请填写工作总结'\n      }\n      var planOutside = $scope.formData.planOutside.length;\n      var originalPlan = $scope.formData.originalPlan;\n      if (planOutside <= 0 && angular.equals({}, originalPlan)) {\n        msg = '至少填写一条工作记录';\n      } else if (angular.equals({}, originalPlan) && $scope.formData.planOutside[0].content == \"\") {\n          msg = '至少填写一条工作记录';\n      }\n      if (msg) {\n        IbPopup.alert({\n          title: msg\n        })\n      } else {\n        Diary.update(DiaryUtils.handleFormData($scope.formData))\n          .success(function() {\n              Utils.clearStateCacheAndGo('diary.personal');\n          })\n          .finally(function() {\n              $scope.isSubmitting = false;\n          });\n      }\n    };\n\n    $ionicLoading.show();\n\n    Diary.edit($stateParams.id)\n      .success(function(res) {\n        if(!res.isSuccess) {\n          IbPopup.alert({ title: res.msg }).then(function() {\n            $ionicHistory.goBack();\n          });\n        } else {\n          // 是否安装了日程模块，用于判断是否支持提醒功能\n          $scope.isInstallCalendar = res.isInstallCalendar;\n          // 工作时间段\n          $scope.workStart = res.workStart;\n          // 后台配置项\n          $scope.dashboardConfig = res.dashboardConfig;\n          $scope.originalPlanList = res.data.originalPlanList;\n\n          $scope.formData.originalPlan = {};\n          angular.forEach(res.data.originalPlanList, function(item) {\n            $scope.formData.originalPlan[item.recordid] = item.schedule;\n          });\n          $scope.formData.planOutside = res.data.outsidePlanList;\n          $scope.formData.plan = res.data.tomorrowPlanList;\n          $scope.formData.id = res.diary.diaryid;\n          $scope.formData.diaryContent = res.diary.content;\n          $scope.formData.shareuid = User.removePrefix(res.diary.shareuid);\n\n          var today = res.diary.diarytime,\n            nextDay = res.diary.nextDiarytime;\n\n          $scope.formData.todayDate = today.year + '-' + today.month + '-' + today.day;\n          $scope.todayWeekday = today.weekday;\n          $scope.formData.plantime = nextDay.year + '-' + nextDay.month + '-' + nextDay.day;\n          $scope.tomorrowWeekday = nextDay.weekday;\n        }\n      })\n      .finally($ionicLoading.hide);\n  })\n\n/**\n * @ngdoc controller\n * @name DiaryUnderingCtrl\n * @module diary.controllers\n * @description\n *   日志下属日志控制器\n */\n  .controller('DiaryUnderingCtrl',function($scope, $stateParams, $ionicHistory, $ionicScrollDelegate, $state, userInfoFilter, dateFilter, Diary){\n    $scope.list = [];\n    $scope.title = userInfoFilter($stateParams.id, 'realname');\n\n    $scope.loadMore = function() {\n      return Diary.personal({\n        uid: $stateParams.id,\n        page: $scope.pages ? $scope.pages.page + 2 : 1\n      }).success(function(res) {\n        if (res.isSuccess) {\n          $ionicScrollDelegate.resize();\n          $scope.list = $scope.list.concat(res.diary);\n          $scope.pages = res.pages;\n          $scope.isattention = res.isattention;\n          $scope.dashboardConfig = res.dashboardConfig;\n        }\n      });\n    };\n    $scope.loadMore();\n\n    $scope.refresh = function() {\n      $scope.list.length = 0;\n      delete $scope.pages;\n      $scope.loadMore().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n    $scope.groupByMonth = function(item) {\n      return dateFilter(item.diarytime * 1000, 'M月');\n    };\n\n    $scope.attention = function() {\n      Diary.attention($stateParams.id).success(function() {\n        $scope.isattention = 1;\n      })\n    };\n\n    $scope.unattention = function() {\n      Diary.unattention($stateParams.id).success(function() {\n        $scope.isattention = 0;\n      })\n    };\n  });","/**\n * @ngdoc module\n * @name diary\n * @description\n *   工作日志模块\n */\n\nangular.module('diary', ['ionic', 'diary.controllers', 'diary.services', 'diary.filters'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'diary', title: '工作日志', route: '#/diary', state: 'diary.index', icon: 'img/modicon/diary.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/diary', '/diary/index');\n\n\n  $stateProvider\n    // setup an abstract state for the tabs directive\n    .state('diary', {\n      url: \"/diary\",\n      abstract: true,\n      template: '<ion-nav-view name=\"diary\"></ion-nav-view>',\n      resolve: UserProvider.resolve\n    })\n\n    .state('diary.index', {\n      url: '/index',\n      talkingDataLabel: '工作日志-主页',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-index.html',\n          controller: 'DiaryIndexCtrl'\n        }\n      }\n    })\n\n    .state('diary.personal', {\n      url: '/personal',\n      talkingDataLabel: '工作日志-我的日志',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-personal.html',\n          controller: 'DiaryPersionalCtrl'\n        }\n      }\n    })\n\n    .state('diary.create', {\n      url: '/create',\n      talkingDataLabel: '工作日志-写日志',\n      cache: false,\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-create.html',\n          controller: 'DiaryCreateCtrl'\n        }\n      }\n    })\n\n    .state('diary.edit', {\n      url: '/edit/:id',\n      talkingDataLabel: '工作日志-编辑日志',\n      cache: false,\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-edit.html',\n          controller: 'DiaryEditCtrl'\n        }\n      }\n    })\n\n    .state('diary.detail', {\n      url: '/detail/:id',\n      talkingDataLabel: '工作日志-查看日志',\n      cache: false,\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-detail.html',\n          controller: 'DiaryDetailCtrl'\n        }\n      }\n    })\n\n    .state('diary.review', {\n      url: '/review?date',\n      talkingDataLabel: '工作日志-点评下属',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-review.html',\n          controller: 'DiaryReviewCtrl'\n        }\n      }\n    })\n\n    .state('diary.follow', {\n      url: '/follow?date',\n      talkingDataLabel: '工作日志-交流日志',\n      views: {\n        'diary': {\n          templateUrl: 'templates/diary/diary-follow.html',\n          controller: 'DiaryFollowCtrl'\n        }\n      }\n    })\n\n    .state('diary.underling',{\n     url:'/underling/:id',\n     talkingDataLabel:'工作日志-下属日志',\n      views: {\n        'diary':{\n          templateUrl:'templates/diary/diary-underling.html',\n          controller:'DiaryUnderingCtrl'\n        }\n      }\n    })\n\n});","/**\n * @ngdoc module\n * @name diary.filters\n * @description\n *   工作日志模块过滤器\n */\n\nangular.module('diary.filters', [])\n\n/**\n * @ngdoc filter\n * @module diary.filters\n * @name diaryPercentage\n * @description\n *   将日志计划进度转化为百分比值\n */\n.filter('diaryPercentage', function() {\n\treturn function(val) {\n\t\treturn val * 10 + '%';\n\t}\n})\n\n/**\n * @ngdoc filter\n * @module diary.filters\n * @name numToHHmm\n * @description\n *   将数字转化为00:00格式的时间\n */\n.filter('numToHHmm', function() {\n\n\tfunction fillZero(num) {\n\t\treturn num >= 10 ? '' + num : '0' + num;\n\t}\n\n\tfunction formatTime(num) {\n\t\tvar hour = Math.floor(+num),\n\t\t\tminute = Math.floor((+num % 1) * 60);\n\t\treturn fillZero(hour) + ':' + fillZero(minute);\n\t}\n\n\treturn formatTime;\n})\n\n/**\n * @ngdoc filter\n * @module diary.filters\n * @name diaryTimeRemind\n * @description\n *   将数字段转化为00:00格式的时间段\n */\n.filter('diaryTimeRemind', function(numToHHmmFilter) {\n\t// input => '15.5,16'\n\t// output => '15:30-16:00'\n\treturn function(timeremind) {\n\t\tif(timeremind === '') return;\n\t\t\tvar timeArr = timeremind.split(','); // ['15.5', '16']\n\t\t\treturn numToHHmmFilter(timeArr[0]) + '-' + numToHHmmFilter(timeArr[1]);\n\t};\n})\n\n","/**\n * @ngdoc overview\n * @name diary.services\n * @description\n *   工作日志模块服务\n */\n\nangular.module('diary.services', [])\n\n.constant('SCHEDULE', [\n  { value: '0', percent: '0%' },\n  { value: '1', percent: '10%' },\n  { value: '2', percent: '20%' },\n  { value: '3', percent: '30%' },\n  { value: '4', percent: '40%' },\n  { value: '5', percent: '50%' },\n  { value: '6', percent: '60%' },\n  { value: '7', percent: '70%' },\n  { value: '8', percent: '80%' },\n  { value: '9', percent: '90%' },\n  { value: '10', percent: '100%' }\n])\n\n/**\n * @ngdoc service\n * @name diary.services.Diary\n * @description\n *   日志通用服务\n */\n.factory('Diary', function($http, Settings) {\n  var moduleUrl = Settings.rootUrl + '/diary';\n\n  function create(data) {\n    return $http.post(moduleUrl + '/save', data)\n  }\n\n  function remove(id) {\n    return $http.post(moduleUrl + '/del', {\n      diaryids: id\n    });\n  }\n\n  function get(id) {\n    return $http.get(moduleUrl + '/show', {\n      params: { id: id }\n    })\n  }\n\n  function update(data) {\n    return $http.post(moduleUrl + '/update', data)\n  }\n\n  return {\n    create: create,\n    get: get,\n    update: update,\n    remove: remove,\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#addComment\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   data    表单数据\n     *\n     * @description\n     *   新增一条日志评论\n     *\n     * - `diaryid` ：     日志ID\n     * - `content` ：     内容，可带html标签\n     * - `uid` ：         评论者UID\n     * - `tocid` ：       被回复的评论的ID\n     * - `touid` ：       被回复的评论的作者的UID\n     * - `from` ：        客户端类型，0：网站；1：手机网页版；2：android；3：iphone\n     * - `commentcount` ：该评论回复数，默认0\n     *\n     * @returns   {Object}  $q.defer.promise\n     */\n    addComment: function(data) {\n      data = angular.extend({\n        from: 1\n      }, data);\n\n      return $http.post(moduleUrl + '/addComment', data);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#index\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     * @description\n     *   获取我的日志列表\n     *\n     * @returns   {HttpPromise}   HttpPromise\n     */\n    mine: function(params){\n      return $http.get(moduleUrl, { params: params });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#allsubs\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     * @description\n     *   获取下属日志列表\n     *   \n     * @returns   {HttpPromise}   HttpPromise\n     */\n    allsubs: function(params){\n      return $http.get(moduleUrl + '/allsubs', { params: params });\n    },\n\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#other\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     * @description\n     *   获取其他日志列表\n     *   \n     * @returns   {HttpPromise}   HttpPromise\n     */\n    other: function(params){\n      return $http.get(moduleUrl + '/other', { params: params });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#show\n     * @methodOf  diary.services.Diary\n     * @param     {String}   id    日志id\n     * @description\n     *   获取单条日志数据\n     *   \n     * @returns   {HttpPromise}   HttpPromise\n     */\n    show: function(id){\n      return $http.get(moduleUrl + '/show', { params: { id : id } })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#add\n     * @methodOf  diary.services.Diary\n     * @param     {String}   diaryDate    格式为'yyyy-MM-dd'的日期\n     *\n     * @description\n     *   获取指定日期的原计划数据\n     */\n    add: function(diaryDate){\n      return $http.get(moduleUrl + '/add' + (diaryDate ? '&diaryDate=' + diaryDate: ''));\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#edit\n     * @methodOf  diary.services.Diary\n     * @param     {String}   id    日志 id\n     *\n     * @description\n     *   获取指定日志的编辑数据\n     */\n    edit: function(id) {\n      return $http.get(moduleUrl + '/edit&diaryid=' + id);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#personal\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   params    请求参数\n     *\n     * @description\n     *  查看某人日志\n     */\n    personal: function(params){\n      return $http.get(moduleUrl + '/personal',{ params: params });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#attention\n     * @methodOf  diary.services.Diary\n     * @param     {String}   auid    用户 id\n     *\n     * @description\n     *  关注用户\n     */\n    attention: function(auid){\n      return $http.get(moduleUrl + '/attention',{params: { auid : auid}})\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#unattention\n     * @methodOf  diary.services.Diary\n     * @param     {String}   auid    用户 id\n     *\n     * @description\n     *  取消关注用户\n     */\n    unattention: function(auid){\n      return $http.get(moduleUrl + '/unattention',{ params: { auid : auid}})\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#planfromschedule\n     * @methodOf  diary.services.Diary\n     * @param     {String}   todayDate    格式为'yyyy-MM-dd'的日期\n     *\n     * @description\n     *   获取指定日期的日程事件列表\n     */\n    planfromschedule: function(todayDate){\n      return $http.get(moduleUrl + '/planfromschedule',{ params: { todayDate : todayDate }})\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#setting\n     * @methodOf  diary.services.Diary\n     *\n     * @description\n     *   获取个人设置数据\n     */\n    setting: function(){\n      return $http.get(moduleUrl + '/setting')\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      diary.services.Diary#savesetting\n     * @methodOf  diary.services.Diary\n     * @param     {Object}   data    表单数据\n     *\n     * @description\n     *   保存个人设置\n     */\n    savesetting: function(data){\n      return $http.post(moduleUrl + '/savesetting', data)\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name diary.services.DiaryUtils\n * @description\n *   日志模块工具函数集\n */\n.factory('DiaryUtils', function($filter, $ionicPopup, $timeout, $state, dateFilter, IbPopup, User) {\n\n  return {\n    // 处理提交的表单\n    handleFormData: function(data) {\n      return angular.extend({}, data, {\n        plantime: $filter('date')(data.plantime, 'yyyy-MM-dd'),\n        shareuid: User.addPrefix(data.shareuid)\n      })\n    },\n\n    //设置时间提醒\n    setRemind: function($scope, plan){\n      $scope.remindConf = {\n        start: $scope.workStart.start,\n        continueTime: 0.5,\n        getStartHours: function() {\n          var ret = [];\n          for(var i = $scope.workStart.start; i < $scope.workStart.end; i += 0.5) {\n            ret.push(i);\n          }\n          return ret;\n        },\n        getContinueTimes: function() {\n          var ret = [];\n          for(var i = 0.5; i <= $scope.workStart.end - this.start; i += 0.5) {\n            ret.push(i);\n          }\n          return ret;\n        }\n      };\n\n      function popupContinueTime(plan){\n        $ionicPopup.show({\n          template: '<select class=\"col\" ng-model=\"remindConf.continueTime\" ng-options=\"(\\'持续 \\' + item + \\' 小时\\') for item in remindConf.getContinueTimes() track by item\"></select>',\n          title: '持续时间',\n          scope: $scope,\n          buttons: [{\n            text: '取消'\n          }, {\n            text: '确认',\n            type: 'button-positive',\n            onTap: function(ok) {\n              if(ok) {\n                plan.timeremind = $scope.remindConf.start + ',' + ($scope.remindConf.start + +$scope.remindConf.continueTime);\n              }\n            }\n          }]\n        })\n      }\n\n      $ionicPopup.show({\n        template: '<select class=\"col\" ng-model=\"remindConf.start\" ng-options=\"(item|numToHHmm) for item in remindConf.getStartHours() track by item\"></select>',\n        title: '开始时间',\n        scope: $scope,\n        buttons: [{\n          text: '取消'\n        }, {\n          text: '确认',\n          type: 'button-positive',\n          onTap: function(ok) {\n            if(ok) {\n              $timeout(function(){\n                popupContinueTime(plan);\n              }, 0);\n            }\n          }\n        }]\n      });\n    },\n\n    //取消时间提醒\n    delRemind: function(plan){\n      plan.timeremind = '';\n    },\n\n    //选择开始日期\n    selectedStartDate: function($scope){\n      $ionicPopup.show({\n        template: '<div class=\"diary-select\">' +\n          '<input type=\"date\" class=\"diary-item\" ng-model=\"formData.startDate\"  data-tap-disabled =\"true\" required >' +\n          '</div>',\n        title: '选择日期',\n        scope: $scope,\n        buttons: [{\n          text: '取消'\n        }, {\n          text: '确认',\n          type: 'button-positive',\n          onTap: function(e) {\n            var startDate = $scope.formData.startDate,\n              today = new Date;\n\n            if (!startDate) return;\n\n            $timeout(function() {\n              if (startDate > today) {\n                IbPopup.alert({\n                  title: '抱歉，选中的日期没有日志且没有新建权限！'\n                })\n              } else {\n                $scope.formData.originalPlan = '';\n                $scope.formData.todayDate = dateFilter(startDate, 'yyyy-MM-dd');\n                $scope.todayWeekday = dateFilter(startDate, 'EEEE')\n              }\n            }, 0);\n            return true;\n          }\n        }]\n      })\n    },\n\n    //选择结束日期\n    selectedEndDate: function($scope){\n      $ionicPopup.show({\n        template: '<div class=\"diary-select\">' +\n          '<input type=\"date\" class=\"diary-item\" ng-model=\"formData.endDate\"  data-tap-disabled =\"true\" required >' +\n          '</div>' +\n          '<div>' + '{{date}}' + '<div>',\n        title: '选择日期',\n        scope: $scope,\n        buttons: [{\n          text: '取消'\n        }, {\n          text: '确认',\n          type: 'button-positive',\n          onTap: function(e) {\n            var endDate = Date.parse(new Date($scope.formData.endDate));\n            if (!endDate) return;\n            $scope.formData.plantime = dateFilter(endDate, 'yyyy-MM-dd');\n            $scope.tomorrowWeekday = dateFilter(endDate, 'EEEE')\n          }\n        }]\n      })\n    }\n\n  }\n\n})\n\n\n\n","/**\n * @ngdoc module\n * @name docs.controllers\n * @description\n *   公文模块控制器\n */\nangular.module('docs.controllers', [])\n\n/**\n * @ngdoc controller\n * @name DocsPublishedCtrl\n * @module docs.controllers\n * @description\n *   已发布列表页控制器\n */\n.controller('DocsPublishedCtrl', function($scope, $state, Settings, DocsPublished){\n  $scope.list = DocsPublished;\n  $scope.title = '已发布';\n  $scope.$root.hideTabs = false;\n\n  $scope.checkNoData = function() {\n    return !$scope.list.docs.length && !$scope.list.hasMore;\n  }\n\n  $scope.open = function(n) {\n    $state.go('docs.detail', { id: n.docid });\n  }\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  if(!$scope.list.hasDocs() || $scope.list.params.search) {\n    $scope.list.fetch({\n      catid: 0,\n      page: 1,\n      search: ''\n    }, true)\n  }\n\n})\n\n/**\n * @ngdoc controller\n * @name DocsUnsignedCtrl\n * @module docs.controllers\n * @description\n *   未签收列表页控制器\n */\n.controller('DocsUnsignedCtrl', function($scope, $state, Settings, DocsUnsigned){\n  $scope.list = DocsUnsigned;\n  $scope.title = '未签收';\n  $scope.$root.hideTabs = false;\n\n  $scope.checkNoData = function() {\n    return !$scope.list.docs.length && !$scope.list.hasMore;\n  }\n\n  $scope.open = function(n) {\n    $state.go('docs.unsignedDetail', { id: n.docid });\n  }\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  if(!$scope.list.hasDocs() || $scope.list.params.search) {\n    $scope.list.fetch({\n      catid: 0,\n      page: 1,\n      search: ''\n    }, true)\n  }\n\n})\n\n\n/**\n * @ngdoc controller\n * @name DocsSignedCtrl\n * @module docs.controllers\n * @description\n *   已签收列表页控制器\n */\n.controller('DocsSignedCtrl', function($scope, $state, Settings, DocsSigned){\n  $scope.list = DocsSigned;\n  $scope.title = '已签收';\n  $scope.$root.hideTabs = false;\n\n  $scope.checkNoData = function() {\n    return !$scope.list.docs.length && !$scope.list.hasMore;\n  }\n\n  $scope.open = function(n) {\n    $state.go('docs.signedDetail', { id: n.docid });\n  }\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  if(!$scope.list.hasDocs() || $scope.list.params.search) {\n    $scope.list.fetch({\n      catid: 0,\n      page: 1,\n      search: ''\n    }, true)\n  }\n\n})\n\n/**\n * @ngdoc controller\n * @name DocsCategoryCtrl\n * @module docs.controllers\n * @description\n *   分类控制器\n */\n.controller('DocsCategoryCtrl', function($scope, $state, $stateParams, DocsPublished){\n  $scope.list = DocsPublished;\n  $scope.categorys = [];\n  $scope.title = '按分类';\n  $scope.rootDir = !($stateParams.cid && $stateParams.cid != 0);\n\n  $scope.checkNoData = function() {\n    return !$scope.list.news.length && !$scope.list.hasMore;\n  };\n\n  // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n  // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n  $scope.list.fetch({\n    catid: $stateParams.cid,\n    page: 1\n  }, true)\n  .success(function(res) {\n    $scope.categorys = res.category;\n  });\n\n})\n\n/**\n * @ngdoc controller\n * @name DocsPublishedCtrl\n * @module docs.controllers\n * @description\n *   新闻详细页控制器\n */\n.controller('DocsDetailCtrl', function($scope, $sce, $filter, $stateParams, Docs) {\n  $scope.docs = {};\n  $scope.signing = false;\n\n  $scope.sign = function(docid) {\n    $scope.signing = true;\n    Docs.sign(docid)\n    .success(function(){ \n      $scope.signing = false;\n      $scope.docs.issign = '1';\n    })\n    .error(function(){ $scope.signing = false; })\n  }\n\n  Docs.get($stateParams.id)\n  .success(function(res) {\n    $scope.docs = res.data;\n    $scope.attach = res.attach;\n    if($scope.docs.content) {\n      $scope.docs.content = $sce.trustAsHtml( $filter('editorContent')($scope.docs.content) );\n    }\n  }); \n})","/**\n * @ngdoc module\n * @name docs\n * @description\n *   公文模块入口\n */\n\nangular.module('docs', ['ionic', 'docs.controllers', 'docs.services'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'docs', title: '公文', route: '#/docs', state: 'docs.published', icon: 'img/modicon/docs.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/docs', '/docs/published');\n\n  $stateProvider\n  // setup an abstract state for the tabs directive\n  .state('docs', {\n    url: \"/docs\",\n    abstract: true,\n    templateUrl: \"templates/docs/docs.html\",\n    resolve: UserProvider.resolve\n  })\n\n  .state('docs.published', {\n    url: '/published',\n    talkingDataLabel: '公文-已发布',\n    views: {\n      'docs-published': {\n        templateUrl: 'templates/docs/docs-list.html',\n        controller: 'DocsPublishedCtrl'\n      }\n    }\n  })\n\n  .state('docs.unsigned', {\n    url: '/unsigned',\n    talkingDataLabel: '公文-未签收',\n    views: {\n      'docs-unsigned': {\n        templateUrl: 'templates/docs/docs-list.html',\n        controller: 'DocsUnsignedCtrl'\n      }\n    }\n  })\n\n  .state('docs.signed', {\n    url: '/signed',\n    talkingDataLabel: '公文-已签收',\n    views: {\n      'docs-signed': {\n        templateUrl: 'templates/docs/docs-list.html',\n        controller: 'DocsSignedCtrl'\n      }\n    }\n  })\n\n  .state('docs.category', {\n    url: '/category?cid',\n    talkingDataLabel: '公文-按分类',\n    views: {\n      'docs-category': {\n        templateUrl: 'templates/docs/docs-category.html',\n        controller: 'DocsCategoryCtrl'\n      }\n    }\n  })\n\n  .state('docs.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-published': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n  .state('docs.unsignedDetail', {\n    url: '/unsignedDetail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-unsigned': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n  .state('docs.signedDetail', {\n    url: '/signedDetail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-signed': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n  .state('docs.categoryDetail', {\n    url: '/categoryDetail/:id',\n    talkingDataLabel: '公文-查看公文',\n    views: {\n      'docs-category': {\n        templateUrl: 'templates/docs/docs-detail.html',\n        controller: 'DocsDetailCtrl'\n      }\n    }\n  })\n\n});","/**\n * @ngdoc module\n * @name news.filters\n * @description\n *   新闻模块过滤器\n */\n\nangular.module('news.filters', [])\n","/**\n * @ngdoc module\n * @name docs.services\n * @description\n *   公文模块相关服务\n */\nangular.module('docs.services', [])\n\n/**\n * @ngdoc service\n * @name Docs\n * @module docs.services\n * @description\n *   公文模块数据交互及处理\n */\n.factory('Docs', function($http, $ionicLoading, Settings){\n\n  var moduleUrl = Settings.rootUrl + '/docs';\n\n  return {\n\n    get: function(id) {\n      $ionicLoading.show();\n\n      return $http.get(moduleUrl + '/show', {\n        params: { id: id }\n      })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    sign: function(id) {\n      return $http.get(moduleUrl + '/sign', {\n        params: { docid: id }\n      })\n    }\n\n  }\n\n})\n\n.factory('DocsList', function($http, $ionicLoading, Settings, Utils ) {\n\n  var moduleUrl = Settings.rootUrl + '/docs';\n\n  function DocsList(url, options){\n    this.url = url;\n    this.options = options;\n\n    this.hasMore = true;\n    this.docs = [];\n\n    this.params = {};\n  }\n\n  angular.extend(DocsList.prototype, {\n    /**\n     * @ngdoc method\n     * @name Docs#fetch\n     * @description \n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { addtime, author, uid, subject, content, uptime, readstatus... }\n     *       ...\n     *     ],\n     *     pages: { page, pageCount, pageSize }\n     *   }\n     *   addtime: \"1409381646\"\n     * @param {Obejct} param 查询条件 catid | page | keyword...\n     * @returns {Object} promise\n     */\n\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if(reset) {\n        this.docs = [];\n        this.hasMore = true;\n      }\n\n      if(extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n      $ionicLoading.show();\n\n      return $http.get(this.url, {\n        params: this.params\n      })\n\n      .success(function(res){\n        if(res.pages.page < res.pages.pageCount) {\n          _this.docs = _this.docs.concat(res.datas);\n          // _this.params.page += 1;\n        }\n\n        // 判断是否还能加载更多\n        _this.hasMore = res.pages.page < res.pages.pageCount - 1\n      })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        page: 1,\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        page: this.params.page + 1\n      });\n    },\n\n    hasDocs: function() {\n      return !!this.docs.length;\n    }\n  });\n\n  return DocsList;\n})\n\n.factory('DocsPublished', function(DocsList, Settings) {\n  var list = new DocsList(Settings.rootUrl + '/docs');\n\n  return list;\n})\n\n.factory('DocsUnsigned', function(DocsList, Settings) {\n  var list = new DocsList(Settings.rootUrl + '/docs&type=nosign');\n\n  return list;\n})\n\n.factory('DocsSigned', function(DocsList, Settings) {\n  var list = new DocsList(Settings.rootUrl + '/docs&type=sign');\n\n  return list;\n})\n\n\n","/**\n * @ngdoc module\n * @name email.controllers\n * @description\n *   邮件中心模块控制器\n */\nangular.module('email.controllers', [])\n\n  .controller('EmailIndexCtrl',function($ionicLoading, User, Utils){\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n      if(res.isSuccess){\n        if(!res.data.email){\n          Utils.promptNoPermission();\n        }\n      }\n    }).finally($ionicLoading.hide)\n  })\n\n  .controller('EmailListCtrl', function($scope, $rootScope, $state, $ionicLoading, $ionicActionSheet, Email) {\n    $scope.prop = {};\n\n    // 初始化列表，首次进来时自动加载数据\n    $scope.init = function() {\n      // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n      if(!$scope.list.hasMails()) {\n        $scope.list.refresh();\n      }\n    };\n\n    // 刷新列表\n    $scope.refresh = function() {\n      $scope.prop.keyword = '';\n      $scope.list.refresh()\n        .finally(function() {\n          $scope.$broadcast('scroll.refreshComplete');\n        })\n    };\n\n    // 移动邮件至回收站\n    $scope.remove = function(mail) {\n      Email.remove(mail.emailid);\n    };\n\n    $scope.reply = function(mail) {\n      $state.go('email.create', { id: mail.emailid, type: 'reply' });\n      return true;\n    };\n\n    $scope.forward = function(mail) {\n      $state.go('email.create', { id: mail.emailid, type: 'forward' });\n      return true;\n    };\n\n    $scope.actionButtons = [\n      {\n        text: '转发',\n        handler: function(mail) {\n          return $scope.forward(mail);\n        }\n      },\n      {\n        text: '回复',\n        handler: function(mail) {\n          return $scope.reply(mail);\n        }\n      }\n    ];\n\n    $scope.showMenu = function(mail) {\n      $scope.hideMenu = $ionicActionSheet.show({\n        titleText: '邮件操作',\n        buttons: $scope.actionButtons,\n        buttonClicked: function(index, opts) {\n          return opts.handler.call(null, mail);\n        },\n        destructiveText: '删除',\n        destructiveButtonClicked: function() {\n          $scope.remove(mail);\n          return true;\n        },\n        cancelText: '取消'\n      });\n    };\n\n    $scope.sref = 'email.detail({ id: mail.emailid })';\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailInboxCtrl\n * @module email.controllers\n * @description\n *   收件箱页控制器\n */\n  .controller('EmailInboxCtrl', function($scope, $controller, Settings, EmailList, EmailInbox) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailInbox;\n    $scope.title = '收件箱';\n    $scope.init();\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailTodoCtrl\n * @module email.controllers\n * @description\n *   待办邮件列表页控制器\n */\n  .controller('EmailTodoCtrl', function($scope, $controller, EmailTodo) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailTodo;\n    $scope.title = '待办邮件';\n    $scope.init();\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailOutboxCtrl\n * @module email.controllers\n * @description\n *   已发送列表页控制器\n */\n  .controller('EmailOutboxCtrl', function($scope, $rootScope, $controller, EmailOutbox, Email) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailOutbox;\n    $scope.title = '已发送';\n    $scope.init();\n\n    $scope.sref = 'email.outboxDetail({ id: mail.emailid })';\n\n    // 重写列表删除邮件方法，已发送删除邮件为彻底删除，不移到回收站\n    $scope.remove = function(mail) {\n      Email.removeCompletelyConfirm(function() {\n        Email.removeOutbox(mail.emailid)\n      });\n    }\n\n  })\n\n/**\n * @ngdoc controller\n * @name EmailTrashCtrl\n * @module email.controllers\n * @description\n *   已删除列表页控制器\n */\n  .controller('EmailTrashCtrl', function($scope, $rootScope, $state, $controller, $ionicHistory, EmailTrash, Email) {\n\n    $controller('EmailListCtrl', { $scope: $scope });\n    $scope.list = EmailTrash;\n    $scope.title = '已删除';\n    $scope.init();\n\n    $scope.sref = 'email.trashDetail({ id: mail.emailid })';\n\n    // 替换 ActionSheet 菜单项\n    $scope.actionButtons[1] = {\n      text: '还原',\n      handler: function(mail) {\n        return $scope.recovery(mail);\n      }\n    };\n\n    // 重写列表删除邮件方法，回收站删除将彻底删除邮件\n    $scope.remove = function(mail) {\n      Email.removeCompletelyConfirm(function() {\n        Email.removeCompletely(mail.emailid)\n      });\n    }\n\n    $scope.recovery = function(mail) {\n      Email.recovery(mail.emailid);\n      $ionicHistory.clearCache(['email.inbox', 'email.todo', 'email.trash'])\n      return true;\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name EmailDetailCtrl\n * @module email.controllers\n * @description\n *   查看邮件页控制器\n */\n  .controller('EmailDetailCtrl', function($scope, $rootScope, $state, $stateParams, $sce, $filter, $ionicHistory, $ionicLoading, Email, EmailUtils) {\n    $ionicLoading.show();\n\n    Email.get($stateParams.id)\n      .success(function(res) {\n        $scope.mail = res;\n\n        // 判断返回的内容为可信 html 以保留样式\n        if($scope.mail.content) {\n          $scope.mail.content = $sce.trustAsHtml( $filter('editorContent')($scope.mail.content) );\n        }\n      })\n      .finally($ionicLoading.hide);\n\n    // 删除邮件\n    $scope.remove = function() {\n      Email.remove($scope.mail.emailid)\n        .success(function(res) {\n          if(res.isSuccess) {\n            EmailUtils.goBackOrHome();\n          }\n        });\n    };\n\n    // 待办、取消待办\n    $scope.toggleMark = function() {\n      var mark = $scope.mail.ismark != '1';\n\n      Email.mark($scope.mail.emailid, mark)\n        .success(function(res) {\n          $scope.mail.ismark = +mark + '';\n          $ionicHistory.clearCache(['email.inbox', 'email.outbox', 'email.todo', 'email.trash'])\n        })\n    };\n\n    $scope.reply = function() {\n      $state.go('email.create', { id: $scope.mail.emailid, type: 'reply' });\n    };\n\n    $scope.replyAll = function() {\n      $state.go('email.create', { id: $scope.mail.emailid, type: 'replyAll' });\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name EmailTrashDetailCtrl\n * @module email.controllers\n * @description\n *   已删除-查看邮件详细页控制器\n */\n  .controller('EmailTrashDetailCtrl', function($scope, $controller, Email, EmailUtils) {\n    $controller('EmailDetailCtrl', { $scope: $scope });\n\n    $scope.remove = function() {\n      Email.removeCompletelyConfirm(function() {\n        $ionicLoading.show();\n        Email.removeCompletely($scope.mail.emailid)\n          .success(function(res) {\n            if(res.isSuccess) {\n              EmailUtils.goBackOrHome();\n            }\n          })\n          .finally($ionicLoading.hide);\n      });\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name EmailOutboxDetailCtrl\n * @module email.controllers\n * @description\n *   已发送-查看邮件详细页控制器\n */\n  .controller('EmailOutboxDetailCtrl', function($scope, $ionicLoading, $rootScope, $controller, $state, Email, EmailUtils) {\n    $controller('EmailDetailCtrl', { $scope: $scope });\n\n    $scope.remove = function() {\n      Email.removeCompletelyConfirm(function() {\n        $ionicLoading.show();\n        Email.removeOutbox($scope.mail.emailid)\n          .success(function(res) {\n            if(res.isSuccess) {\n              EmailUtils.goBackOrHome();\n            }\n          })\n          .finally($ionicLoading.hide);\n      });\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name EmailCreateCtrl\n * @module email.controllers\n * @description\n *   写邮件页控制器\n */\n  .controller('EmailCreateCtrl', function($scope, $rootScope, $sce, $filter, $timeout, $state, $stateParams, $ionicLoading, $ionicHistory, Email, EmailUtils) {\n\n    $scope.form = {\n      toids: '',\n      ccids: '',\n      mcids: '',\n      subject: '',\n      content: ''\n    };\n\n    $scope.isSubmitting = false;\n\n    // 设置源邮件信息\n    function setSource(res) {\n      $scope.source = res;\n\n      // 回复\n      if($stateParams.type == 'reply') {\n        $scope.form.toids = res.fromid;\n        $scope.form.subject = '回复：' + res.subject;\n\n        // 回复全部（发件人、所以收件人及抄送人）\n      } else if($stateParams.type == 'replyAll') {\n        $scope.form.toids = EmailUtils.concatToids(res.fromid, res.toids, res.copytoids);\n        $scope.form.subject = '回复：' + res.subject;\n\n        // 转发\n      } else if($stateParams.type == 'forward') {\n        $scope.form.subject = '转发：' + res.subject;\n        $scope.form.attachmentid = res.attachmentid;\n      }\n\n      if(res.content) {\n        $scope.source.content = $sce.trustAsHtml( $filter('editorContent')(res.content) );\n      }\n    }\n\n    // 如果有 url 参数 id 和 type，判断此时为回复或转发邮件\n    if($stateParams.id && $stateParams.type) {\n      $ionicLoading.show();\n      Email.get($stateParams.id)\n        .success(setSource)\n        .finally($ionicLoading.hide)\n    }\n\n    $scope.showOther = function() {\n      $scope.isShowOther = true;\n    }\n\n    // 表单提交中或表单未通过验证时，禁止提交\n    $scope.isDisabledSubmit = function() {\n      return $scope.isSubmitting || !$scope.emailForm.$valid;\n    };\n\n    $scope.submit = function() {\n      $scope.isSubmitting = true;\n      $ionicLoading.show();\n\n      // 如果有原邮件（回复、转发的情况），则组合内容\n      var formData = angular.extend({}, $scope.form, {\n        content: $scope.source ?\n        $scope.form.content + document.getElementById('email_info').innerHTML + $scope.source.content :\n          $scope.form.content\n      })\n\n      Email.create(formData)\n        .success(function() {\n          $ionicHistory.clearCache(['email.inbox', 'email.outbox']);\n          EmailUtils.showSendedPopup($scope);\n        })\n        .finally($ionicLoading.hide);\n    }\n\n  })\n","/**\n * @ngdoc module\n * @name email\n * @description\n *   邮件中心模块\n */\n\nangular.module('email', ['ionic', 'email.controllers', 'email.services', /*'email.filters'*/])\n\n.run(function(Apps) {\n  Apps.install({ name: 'email', title: '邮件中心', route: '#/email', state: 'email.index', icon: 'img/modicon/email.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/email', '/email/index');\n\n  $stateProvider\n  .state('email', {\n    url: '/email',\n    abstract: true,\n    template: '<ion-nav-view name=\"email\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  $stateProvider\n  // 邮件中心-首页\n  .state('email.index', {\n    url: '/index',\n    talkingDataLabel: '邮件-首页',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-index.html',\n        controller: 'EmailIndexCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-收件箱\n  .state('email.inbox', {\n    url: '/inbox',\n    talkingDataLabel: '邮件-收件箱',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-inbox.html',\n        controller: 'EmailInboxCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-待办邮件\n  .state('email.todo', {\n    url: '/todo',\n    talkingDataLabel: '邮件-待办',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-inbox.html',\n        controller: 'EmailTodoCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-发件箱（已发送）\n  .state('email.outbox', {\n    url: '/outbox',\n    talkingDataLabel: '邮件-已发送',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-outbox.html',\n        controller: 'EmailOutboxCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-回收站（已删除）\n  .state('email.trash', {\n    url: '/trash',\n    talkingDataLabel: '邮件-已删除',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-inbox.html',\n        controller: 'EmailTrashCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-查看邮件\n  .state('email.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '邮件-查看邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-detail.html',\n        controller: 'EmailDetailCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-查看已发送邮件\n  .state('email.outboxDetail', {\n    url: '/outboxDetail/:id',\n    talkingDataLabel: '邮件-查看邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-detail.html',\n        controller: 'EmailOutboxDetailCtrl'\n      }\n    }\n  })\n\n  // 邮件中心-查看回收站邮件\n  .state('email.trashDetail', {\n    url: '/trashDetail/:id',\n    talkingDataLabel: '邮件-查看邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-detail.html',\n        controller: 'EmailTrashDetailCtrl'\n      }\n    }\n  })\n\n  // 邮件-写邮件\n  .state('email.create', {\n    url: '/create?id&type',\n    talkingDataLabel: '邮件-写邮件',\n    views: {\n      'email': {\n        templateUrl: 'templates/email/email-create.html',\n        controller: 'EmailCreateCtrl'\n      }\n    }\n  })\n});","/**\n * @!ngdoc module\n * @name email.services\n * @description\n *   邮件中心模块服务\n */\n\nangular.module('email.services', [])\n\n/**\n * @ngdoc service\n * @name email.services.EmailUtils\n * @description\n *   邮件中心工具函数集\n */\n.factory('EmailUtils', function($state, $ionicPopup, $ionicHistory) {\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      email.services.EmailUtils#showSendedPopup\n     * @methodOf  email.services.EmailUtils\n     * @param     {Object}   $scope         angular scope 对象\n     * \n     * @description \n     *   显示邮件发送成功后的弹窗提醒\n     * @returns   {Object}\n     */\n    showSendedPopup: function($scope) {\n      return $ionicPopup.show({\n        title: '邮件发送成功',\n        scope: $scope,\n        buttons: [\n          {\n            text: '返回主页',\n            onTap: function(){\n              $ionicHistory.nextViewOptions({\n                disableBack: true\n              });\n              $state.go('email.index');\n            }\n          },\n          {\n            text: '再写一封',\n            type: 'button-positive',\n            onTap: function(e) {\n              $state.reload();\n            }\n          },\n        ]\n      });\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      email.services.Email#concatToids\n     * @methodOf  email.services.Email\n     * @param     {String}   uid      用户 id\n     * @description \n     *   合并多个 uid 字符串，并去除相同的 uid\n     *   \n     * @returns   {String}   合并后的 uid 字符串\n     */\n    concatToids: function(){\n      var argu = arguments;\n      var ret = [];\n\n      angular.forEach(arguments, function(argu) {\n        var arr = angular.isArray(argu) ?\n          argu :\n          angular.isString(argu) && argu ?\n          argu.split(',') :\n          [];\n\n        if(!arr.length) {\n          return true;\n        }\n\n        angular.forEach(arr, function(a) {\n          if(ret.indexOf(a) == -1) {\n            ret.push(a);\n          }\n        })\n      });\n\n      return ret.length ? ret.join(',') : '';\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      email.services.Email#goBackOrHome\n     * @methodOf  email.services.Email\n     * @description \n     *   如果有后退页，则后退，没有则回邮件中心首页\n     *   \n     * @returns   {Undefined}\n     */\n    goBackOrHome: function() {\n      if($ionicHistory.backView()) {\n        $ionicHistory.goBack();\n      } else {\n        $state.go('email.index');\n      }\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name email.services.Email\n * @description\n *   邮件中心通用服务\n */\n.factory('Email', function($rootScope, $http, $state, $ionicLoading, IbPopup, Settings) {\n  var moduleUrl = Settings.rootUrl + '/mail';\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#create\n   * @methodOf  email.services.Email\n   * @param     {Object}   data           邮件数据\n   * @description \n   *    新建邮件\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function create(data) {\n    return $http.post(moduleUrl + '/edit', data)\n    .success(function(res) {\n      $rootScope.$broadcast('email.create', res);\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#remove\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   删除邮件，移动邮件至回收站\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function remove(emailid) {\n    $ionicLoading.show();\n\n    return $http.post(moduleUrl + '/del', {\n      emailid: emailid\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.remove', emailid);\n      } else {\n        IbPopup.alert({ template: res.errorMsg });\n      }\n    })\n    .error(Settings.requestError)\n    .success($ionicLoading.hide)\n    .error($ionicLoading.hide)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#removeCompletely\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   彻底删除邮件\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function removeCompletely(emailid) {\n    return $http.post(moduleUrl + '/delete', {\n      emailid: emailid\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.removeTrash', emailid);\n      } else {\n        IbPopup.alert({ template: res.errorMsg });\n      }\n    })\n    .error(Settings.requestError)\n  }\n\n  function removeOutbox(emailid) {\n    return $http.post(moduleUrl + '/delete', {\n      emailid: emailid\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.removeOutbox', emailid);\n      } else {\n        IbPopup.alert({ template: res.errorMsg });\n      }\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#removeCompletelyConfirm\n   * @methodOf  email.services.Email\n   * @param     {Function}   callback           回调函数\n   * @description \n   *   显示彻底删除邮件确认弹窗\n   *   \n   * @returns   {}\n   */\n  function removeCompletelyConfirm(callback) {\n    return IbPopup.confirm({\n      title: '确定彻底删除该邮件吗？'\n    })\n    .then(function(ok) {\n      if(ok && angular.isFunction(callback)) {\n        callback();\n      }\n    });\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#get\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   获取指定邮件的数据\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function get(emailid) {\n    return $http.get(moduleUrl + '/show', {\n      params: { id: emailid }\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#mark\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @param     {Boolean=} tomark              加星标还是取消星标\n   * @description \n   *   星标邮件或取消邮件星标\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function mark(emailid, tomark) {\n    return $http.get(moduleUrl + '/mark', {\n      params: { emailid: emailid, ismark: !!tomark }\n    })\n    .success(function() {\n      $rootScope.$broadcast('email.mark', emailid, !!tomark);\n    })\n    .error(Settings.requestError)\n  }\n\n  /**\n   * @ngdoc     method\n   * @name      email.services.Email#recovery\n   * @methodOf  email.services.Email\n   * @param     {String}   emailid           邮件id\n   * @description \n   *   还原回收站中的邮件\n   *   \n   * @returns   {Object}  $q.defer.promise\n   */\n  function recovery(emailid) {\n    return $http.get(moduleUrl + '/recovery', {\n      params: { emailid: emailid }\n    })\n    .success(function(res) {\n      if(res.isSuccess) {\n        $rootScope.$broadcast('email.recovery', emailid);\n      }\n    })\n    .error(Settings.requestError)\n  }\n\n  return {\n    create: create,\n    get: get,\n    remove: remove,\n    removeCompletely: removeCompletely,\n    removeOutbox: removeOutbox,\n    removeCompletelyConfirm: removeCompletelyConfirm,\n    mark: mark,\n    recovery: recovery\n  };\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailList\n * @description\n *   邮件中心列表类\n */\n\n.factory('EmailList', function($http, $ionicLoading, Settings) {\n\n  var moduleUrl = Settings.rootUrl + '/mail';\n\n  function EmailList(url, options){\n    this.url = url;\n    this.options = options;\n\n    this.hasMore = true;\n    this.mails = [];\n\n    this.params = {};\n  }\n\n  angular.extend(EmailList.prototype, {\n    /**\n     * @ngdoc method\n     * @name EmailList#fetch\n     * @description \n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { addtime, author, uid, subject, content, uptime, readstatus... }\n     *       ...\n     *     ],\n     *     lastid: ''\n     *   }\n     *   addtime: \"1409381646\"\n     *   \n     * @param {Obejct} param 查询条件\n     *    catid      {String}         分类 id\n     *    lastid     {String}         最后查询到的数据的 id\n     *    keyword    {String}         搜索关键词\n     * @returns {Object} promise\n     */\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if(reset) {\n        this.reset();\n      }\n\n      if(extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n      $ionicLoading.show();\n\n      return $http.get(this.url, {\n        params: this.params\n      })\n\n      .success(function(res){\n        _this.mails = _this.mails.concat(res.data);\n        // 判断是否还能加载更多\n        _this.hasMore = !!res.lastid;\n      })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    get: function(emailid) {\n      var ret = null;\n      \n      angular.forEach(this.mails, function(mail) {\n        if(mail.emailid == emailid) {\n          ret = mail;\n          return false;\n        }\n      });\n\n      return ret;\n    },\n\n    getLastId: function() {\n      return this.mails.length ? \n        this.mails[this.mails.length - 1].emailid || '' :\n        '';\n    },\n\n    view: function(emailid) {\n      var mail = this.get(emailid);\n      if(mail) {\n        mail.isread = '1';\n      }\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        lastid: '',\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        lastid: this.getLastId()\n      });\n    },\n\n    hasMails: function() {\n      return !!this.mails.length;\n    },\n\n    checkNoData: function() {\n      return !this.mails.length && !this.hasMore;\n    },\n\n    remove: function(id) {\n      var _this = this;\n\n      if(!this.mails.length) {\n        return;\n      }\n\n      angular.forEach(this.mails, function(mail, i) {\n        if(mail.emailid == id) {\n          _this.mails.splice(i, 1);\n          return false;\n        }\n      });\n    },\n\n    reset: function() {\n      this.mails = [];\n      this.hasMore = true;\n      this.params = {};\n    },\n\n    refresh: function() {\n      return this.fetch({}, true);\n    },\n\n    mark: function(emailid, ismark) {\n      var mail = this.get(emailid);\n      if(mail) {\n        mail.ismark = ismark ? '1' : '0';\n      }\n    }\n  });\n\n  return EmailList;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailInbox\n * @description\n *   收件箱列表数据\n */\n.factory('EmailInbox', function($rootScope, Settings, EmailList) {\n\n  var inbox = new EmailList(Settings.rootUrl + '/mail&type=inbox');\n\n  $rootScope.$on('email.create', function(evt) {\n    inbox.reset();\n  });\n\n  $rootScope.$on('email.recovery', function() {\n    inbox.reset();\n  });\n\n  $rootScope.$on('email.remove', function(evt, emailid) {\n    inbox.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    inbox.mark(emailid, ismark);\n  });\n\n  return inbox;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailTodo\n * @description\n *   待办邮件列表数据\n */\n.factory('EmailTodo', function($rootScope, Settings, EmailList) {\n\n  var todo = new EmailList(Settings.rootUrl + '/mail&type=todo');\n\n  $rootScope.$on('email.recovery', function() {\n    todo.reset();\n  });\n\n  $rootScope.$on('email.remove', function(evt, emailid) {\n    todo.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    todo.mark(emailid, ismark);\n  });\n\n  return todo;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailOutbox\n * @description\n *   发件箱列表数据\n */\n.factory('EmailOutbox', function($rootScope, Settings, EmailList) {\n\n  var outbox = new EmailList(Settings.rootUrl + '/mail&type=send');\n\n  $rootScope.$on('email.create', function(evt) {\n    outbox.reset();\n  });\n\n  $rootScope.$on('email.removeOutbox', function(evt, emailid) {\n    outbox.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    outbox.mark(emailid, ismark);\n  });\n\n  return outbox;\n})\n\n/**\n * @ngdoc service\n * @name email.services.EmailTrash\n * @description\n *   回收站数据\n */\n.factory('EmailTrash', function($rootScope, Settings, EmailList) {\n\n  var trash = new EmailList(Settings.rootUrl + '/mail&type=del');\n\n  $rootScope.$on('email.removeTrash', function(evt, emailid) {\n    trash.remove(emailid);\n  });\n\n  $rootScope.$on('email.recovery', function(evt, emailid) {\n    trash.remove(emailid);\n  });\n\n  $rootScope.$on('email.mark', function(evt, emailid, ismark) {\n    trash.mark(emailid, ismark);\n  });\n\n  $rootScope.$on('email.remove', function(){\n    trash.reset();\n  })\n\n  return trash;\n})\n\n","/**\n * @ngdoc module\n * @name news.controllers\n * @description\n *   新闻模块控制器\n */\nangular.module('news.controllers', [])\n\n/**\n * @ngdoc controller\n * @name NewsIndexCtrl\n * @module news.controllers\n * @description\n *   已发布列表页控制器\n */\n  .controller('NewsIndexCtrl', function($scope, NewsIndex, News){\n    $scope.list = NewsIndex;\n    $scope.title = '已发布';\n\n    $scope.refresh = function() {\n      $scope.list.fetch({\n        catid: 0,\n        page: 0,\n        search: ''\n      }, true).finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n\n    $scope.open = function(n) {\n      News.open(n, 'news.detail');\n    };\n\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n    if(!$scope.list.hasNews() || $scope.list.params.search) {\n      $scope.list.fetch({\n        catid: 0,\n        page: 0,\n        search: ''\n      }, true)\n    }\n\n  })\n\n/**\n * @ngdoc controller\n * @name NewsUnreadCtrl\n * @module news.controllers\n * @description\n *   未读列表页控制器\n */\n  .controller('NewsUnreadCtrl', function($scope, $ionicHistory, $state, IbPopup, NewsUnread, News){\n    $scope.list = NewsUnread;\n    $scope.title = '未读';\n\n    $scope.refresh = function() {\n      $scope.list.fetch({\n        catid: 0,\n        page: 0,\n        search: ''\n      }, true).finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n    $scope.open = function(n) {\n      News.open(n, 'news.detail');\n    };\n\n    $scope.markRead = function(){\n      IbPopup.confirm({\n        title:'确定要将此分类新闻全部标记成已读？',\n      }).then(function(flag){\n        if(flag){\n          News.readall().success($scope.refresh);\n        }\n      });\n    };\n\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    // 如果上一次的页面缓存为搜索结果，同样重置查询条件\n    if(!$scope.list.hasNews() || $scope.list.params.search) {\n      $scope.refresh();\n    }\n  })\n\n/**\n * @ngdoc controller\n * @name NewsUnapprovalCtrl\n * @module news.controllers\n * @description\n *   未审核列表页控制器\n */\n  .controller('NewsUnapprovalCtrl', function($scope, News){\n    function load(num) {\n      return  News.list({ type: 'notallow', page: num }).success(function(res){\n        $scope.news = res.data;\n        $scope.pages = res.pages;\n      });\n    }\n\n    load();\n\n    $scope.loadMore = function(){\n      load($scope.pages.page + 1);\n    };\n\n    $scope.refresh = function() {\n      load().finally(function() {\n        $scope.$broadcast('scroll.refreshComplete');\n      });\n    };\n\n    $scope.open = function(n) {\n      News.open(n, 'news.approval');\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name NewsCategoryCtrl\n * @module news.controllers\n * @description\n *   分组页控制器\n */\n  .controller('NewsCategoryCtrl', function($scope, $ionicScrollDelegate, News){\n    News.category().success(function(res){\n      var categoryList = res.data;\n      $scope.histories = [];\n\n      //加载新的列表；\n      function loadNewsList(catid) {\n        return News.list({ catid: catid }).success(function(res) {\n          $scope.list = res.data;\n        });\n      }\n\n      $scope.open = function(n) {\n        News.open(n, 'news.detail');\n      };\n\n      function getCategories(category){\n        var ret = [];\n        angular.forEach(categoryList, function(_category) {\n          if(_category.pid === category.catid) {\n            ret.push(_category);\n          }\n        });\n        return ret;\n      }\n\n      $scope.enterCategory = function(category){\n        // 把当前目录放入历史里\n        $scope.list = [];\n        if($scope.currentCategory) {\n          $scope.histories.push($scope.currentCategory);\n        }\n\n        if(category.catid !== '0'){\n          loadNewsList(category.catid)\n        }\n        $scope.currentCategory = category;\n        $scope.categories = getCategories(category);\n      };\n\n      //返回上一个\n      $scope.back = function(){\n        $scope.currentCategory = $scope.histories.pop();\n        loadNewsList($scope.currentCategory.catid);\n        $scope.categories = getCategories($scope.currentCategory);\n      };\n\n      $scope.toCategory = function(category){\n        $scope.currentCategory = category;\n        $scope.histories.splice($scope.histories.indexOf(category));\n        loadNewsList($scope.currentCategory.catid);\n        $scope.categories = getCategories($scope.currentCategory);\n      };\n\n      $scope.enterCategory({\n        catid: '0',\n        name: ' '\n      });\n\n      // 监听路径历史，自动将面包屑滚动到末端\n      var breadcrumbScrollInstance = $ionicScrollDelegate.$getByHandle('news-breadcrumb-scroll');\n      $scope.$watchCollection('histories', function() {\n        breadcrumbScrollInstance.scrollBottom(true);\n      });\n    });\n\n    // news-breadcrumb-scroll\n  })\n\n/**\n * @ngdoc controller\n * @name NewsDetailCtrl\n * @module news.controllers\n * @description\n *   新闻详细页控制器\n */\n  .controller('NewsDetailCtrl', function($scope, $sce, $filter, $stateParams, $ionicActionSheet, $ionicModal, $ionicLoading, $ionicHistory, $ionicPopup, $state, dateFilter, userInfoFilter, IbPopup, Utils, News, NewsIndex) {\n    $scope.news = {};\n\n    News.get($stateParams.id)\n      .success(function(res) {\n        $scope.news = res.data;\n      });\n\n    function getCommentParams(articleid){\n      return{\n        articleid: articleid,\n        isDesc: 1,\n        limit: 9999\n      }\n    }\n\n    News.getComments(getCommentParams($stateParams.id)).success(function(res){\n      $scope.commentList = res.data;\n    });\n\n    $scope.showMore = function(){\n      $scope.form = {};\n      $ionicActionSheet.show({\n        buttons:[\n          { text: $scope.news.istop == '0' ?  '置顶' : '取消置顶' },\n          { text: '移动' }\n        ],\n        buttonClicked:function(index){\n          if(index === 0 ){\n            var params ={\n              articleids: $stateParams.id,\n              topEndTime:  ''\n            };\n            if($scope.news.istop == '0'){\n              $ionicPopup.show({\n                template: ' <input type=\"date\" data-tap-disabled=\"true\" ng-model=\"form.topEndTime\">',\n                title: '过期时间',\n                scope: $scope,\n                buttons: [\n                  { text: '取消' },\n                  {\n                    text: '确认',\n                    type: 'button-positive',\n                    onTap: function(e) {\n                      if($scope.form.topEndTime){\n                        params.topEndTime = dateFilter($scope.form.topEndTime, 'yyyy-MM-dd');\n                        $ionicLoading.show();\n                        News.top(params)\n                          .success(function(res){\n                            $scope.news.istop = '1';\n                            NewsIndex.reset();\n                            $ionicHistory.clearCache(['news.published']);\n                          })\n                          .finally($ionicLoading.hide);\n                      }\n                    }\n                  }\n                ]\n              });\n            } else{\n              $ionicLoading.show();\n              News.top(params)\n                .success(function() {\n                  $scope.news.istop = '0';\n                })\n                .finally($ionicLoading.hide);\n            }\n          }\n\n          if(index === 1 ){\n            $ionicModal.fromTemplateUrl('templates/news/news-move.html',{\n              scope: $scope,\n              animation:'slide-in-up'\n            })\n              .then(function(modal) {\n                $scope.moveModel = modal;\n                $scope.moveModel.show();\n                $scope.catid = '';\n\n                News.category().success(function(res){\n                  $scope.categoryList = res.data;\n                  var currentPid = 0;\n\n                  //将分组整理成树结构\n                  function categoryTree(categoryList, pid) {\n                    var result = [], temp;\n                    for (var i = 0; i < categoryList.length; i++) {\n                      categoryList[i].checked = false;\n                      categoryList[i].showChildrenList = true;\n\n                      //首先找到pid 等于0的文件夹；\n                      if (categoryList[i].pid == pid) {\n                        temp = categoryTree(categoryList, categoryList[i].catid);\n                        if (temp.length > 0) {\n                          categoryList[i].childrenList = temp;\n                        }\n                        result.push(categoryList[i]);\n                      }\n                    }\n                    return result;\n                  }\n\n                  $scope.categorys = categoryTree($scope.categoryList, currentPid);\n\n                  $scope.selectCategory = function(item){\n                    if(item.checked === true){\n                      $scope.catid = item.catid\n                      angular.forEach($scope.categoryList, function(category){\n                        category.checked = false;\n                      });\n                      item.checked = true;\n                    } else {\n                      $scope.catid = '';\n                    }\n                  };\n\n                  $scope.submit = function(){\n                    var params = {\n                      articleids: $scope.news.articleid,\n                      catid: $scope.catid\n                    };\n                    $ionicLoading.show();\n                    News.move(params).success(function(res){\n                      $scope.moveModel.hide();\n                      $ionicLoading.hide();\n\n                      Utils.clearStateCacheAndGo('news.published');\n                    });\n                  }\n                })\n              })\n          }\n          return true;\n        },\n        destructiveText: '删除',\n        cancelText: '取消',\n        destructiveButtonClicked: function() {\n          var params = {\n            articleids:$scope.news.articleid\n          };\n          News.delete(params).success(function(res){\n            Utils.clearStateCacheAndGo('news.published');\n          })\n        }\n      })\n    };\n\n    $scope.openComment = function(type, cm){\n      $ionicModal.fromTemplateUrl('templates/news/news-comment.html',{\n        scope: $scope,\n        animation:'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.comment = {};\n          $scope.commentModal = modal;\n          $scope.commentModal.show();\n          if (type === 'reply'){\n            $scope.comment.content = cm.touid ? '回复 @' + userInfoFilter(cm.uid,'realname') + ' : ': ''\n          }\n\n          $scope.submit = function(){\n            var params = {\n              type:type ,\n              content: $scope.comment.content,\n            };\n\n            if(type === 'comment'){\n              params.rowid = $scope.news.articleid;\n            } else {\n              params.tocid = cm.cid;\n              // 如果直接回复评论，则\n              if(cm.tocid === '0') {\n                params.rowid = cm.cid;\n                // 否则，如果回复评论下的回复，则\n              } else {\n                params.rowid = cm.rowid;\n              }\n            }\n\n\n            News.addComment(params).success(function(res){\n              $scope.commentModal.hide();\n              $ionicLoading.show();\n              News.getComments(getCommentParams($scope.news.articleid)).success(function(res){\n                $ionicLoading.hide();\n                $scope.commentList = res.data;\n              });\n            })\n          };\n        })\n    };\n\n\n    $scope.openCommentDetail = function(){\n      $ionicModal.fromTemplateUrl('templates/news/news-comment-detail.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.commentTetailModal = modal;\n          $scope.commentTetailModal.show();\n\n            News.getComments(getCommentParams($scope.news.articleid)).success(function(res){\n              $ionicLoading.show();\n              if(res.isSuccess){\n                $scope.commentList = res.data\n              }\n            }).finally($ionicLoading.hide)\n        })\n    };\n\n    $scope.openReaderDetail = function(){\n      $ionicModal.fromTemplateUrl('templates/news/news-reader-detail.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal) {\n          $scope.readerTetailModal = modal;\n          $scope.readerTetailModal.show();\n          var params = {\n            articleid :$scope.news.articleid\n          };\n          News.getReaders(params).success(function(res){\n            $scope.readers = res.data;\n          })\n        })\n    };\n  })\n\n  .controller('NewsApprovalCtrl',function($scope, $stateParams, $sce, $filter, $ionicActionSheet, $ionicHistory, $ionicLoading, $ionicPopup, $state, IbPopup, News){\n    News.get($stateParams.id)\n      .success(function(res) {\n        $scope.news = res.data;\n      });\n\n    $scope.checkNews = function(){\n      $scope.form = {};\n      $ionicActionSheet.show({\n        buttons:[\n          { text: '通过'}\n        ],\n        buttonClicked:function(index){\n          if(index === 0 ){\n            $ionicLoading.show();\n            News.verify({ articleids: $scope.news.articleid })\n              .success(function(res){\n                $ionicLoading.hide();\n                if(res.isSuccess === false) {\n                  alert(res.msg);\n                } else {\n                  IbPopup.alert({ title : '审核通过'})\n                  $ionicHistory.clearCache([$ionicHistory.currentView().stateId]).then(function() {\n                    $state.reload();\n                  });\n                }\n              });\n\n            return true;\n          }\n        },\n        destructiveText: '退回',\n        cancelText: '取消',\n        destructiveButtonClicked: function() {\n          $ionicPopup.show({\n            template: '<input ng-model=\"form.reason\">',\n            title: '退回',\n            scope: $scope,\n            buttons: [\n              { text: '取消' },\n              {text: '确认',\n                type: 'button-positive',\n                onTap: function(e) {\n                  var params ={\n                    articleids: $scope.news.articleid,\n                    reason: $scope.form.reason\n                  };\n                  News.back(params).success(function(res){\n                    //判断当前的步骤是不是最后一步，如不是，剩下所有步骤的状态都设置成未审核；\n                    $ionicHistory.clearCache([$ionicHistory.currentView().stateId]).then(function() {\n                      $state.reload();\n                    })\n                  })\n                }\n              }\n            ]\n          });\n          return true;\n        }\n      })\n    }\n  });","/**\n * @ngdoc module\n * @name news.filters\n * @description\n *   新闻模块过滤器\n */\n\nangular.module('news.filters', [])\n","/**\n * @ngdoc module\n * @name news\n * @description\n *   信息中心模块入口\n */\n\nangular.module('news', ['ionic', 'news.controllers', 'news.services'/*, 'news.filters'*/])\n\n.run(function(Apps) {\n  Apps.install({ name: 'news', title: '新闻', route: '#/news', state: 'news.published', icon: 'img/modicon/news.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/news', '/news/published');\n\n  $stateProvider\n  // setup an abstract state for the tabs directive\n  .state('news', {\n    url: \"/news\",\n    abstract: true,\n    template:'<ion-nav-view name=\"news\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  .state('news.published', {\n    url: '/published',\n    talkingDataLabel: '新闻-已发布',\n    cache: false,\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-index.html',\n        controller: 'NewsIndexCtrl'\n      }\n    }\n  })\n\n  .state('news.unread', {\n    url: '/unread',\n    talkingDataLabel: '新闻-未读',\n    cache: false,\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-unread.html',\n        controller: 'NewsUnreadCtrl'\n      }\n    }\n  })\n\n    .state('news.unapproval', {\n      url: '/unapproval',\n      talkingDataLabel: '新闻-未审核',\n      cache: false,\n      views: {\n        'news': {\n          templateUrl: 'templates/news/news-unapproval.html',\n          controller: 'NewsUnapprovalCtrl'\n        }\n      }\n    })\n\n\n  .state('news.category', {\n    url: '/category?cid',\n    talkingDataLabel: '新闻-按分类',\n    cache: false,\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-category.html',\n        controller: 'NewsCategoryCtrl'\n      }\n    }\n  })\n\n  .state('news.detail', {\n    url: '/detail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n  .state('news.unreadDetail', {\n    url: '/unreadDetail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n  .state('news.readDetail', {\n    url: '/readDetail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n  .state('news.categoryDetail', {\n    url: '/categoryDetail/:id',\n    talkingDataLabel: '新闻-查看新闻',\n    views: {\n      'news': {\n        templateUrl: 'templates/news/news-detail.html',\n        controller: 'NewsDetailCtrl'\n      }\n    }\n  })\n\n    .state('news.approval', {\n      url: '/approval/:id',\n      talkingDataLabel: '新闻-审核新闻',\n      views: {\n        'news': {\n          templateUrl: 'templates/news/news-approval.html',\n          controller: 'NewsApprovalCtrl'\n        }\n      }\n    })\n\n\n});","/**\n * @ngdoc overview\n * @name  news.services\n * @description\n *   新闻模块相关服务\n */\nangular.module('news.services', [])\n\n/**\n * @ngdoc service\n * @name  news.services.News\n * @description\n *   新闻模块数据交互及处理\n */\n.factory('News', function($http, $state, $ionicLoading, Settings){\n\n  var moduleUrl = Settings.rootUrl + '/news';\n\n  return {\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#get\n     * @methodOf  news.services.News\n     * @description \n     *   获取单条新闻的数据\n     * @param   {String}       id       新闻 id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    get: function(id) {\n      $ionicLoading.show();\n\n      return $http.get(moduleUrl + '/show', { params: { articleid: id } })\n      .success($ionicLoading.hide)\n      .error($ionicLoading.hide)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#list\n     * @methodOf  news.services.News\n     * @description \n     *   获取新闻列表\n     *   - `catid`：（可选）新闻分类\n     *   - `search`：（可选）搜索\n     *   - `type`：（可选）内容类型。new：未读、old：已读、待审核：notallow、草稿：draft\n     *   - `page`：（可选）第几页，从0开始计算。默认值为0\n     *   - `pagesize`：（可选）每页文章个数，默认值为10\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    list: function(params) {\n      return $http.get(moduleUrl + '/index', { params: params })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News##read\n     * @methodOf  news.services.News\n     * @description \n     *   改变新闻的状态为已读\n     *   \n     * @param   {String}       id     新闻 id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    read: function(id) {\n      return $http.get(moduleUrl + '/read', { params: { articleid: id } })\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#open\n     * @methodOf  news.services.News\n     * @description \n     *   查看新闻详细\n     * @param   {Object}       news         新闻数据\n     * @param   {String}       detailState  详细页对应的 state\n     * @returns {HttpPromise}  HttpPromise\n     */\n    open: function(news, detailState) {\n      // 超链接类型\n      if(news.type == '2') {\n        window.open(news.url, '_blank', 'location=yes');\n      // 文章、图片类型\n      } else {\n        $state.go(detailState, { id: news.articleid });\n      }\n\n      if(!news.readstatus) {\n        this.read(news.articleid)\n        .success(function(res) {\n          if(res.isSuccess) news.readstatus = true;\n        });\n      }\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#category\n     * @methodOf  news.services.News\n     * @description\n     *   获取新闻分类\n     *   \n     * @returns {HttpPromise}  HttpPromise\n     */\n    category: function(){\n       return $http.get(moduleUrl+ '/category')\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#readall\n     * @methodOf  news.services.News\n     * @description\n     *    标识所有未读新闻为已读\n     *    \n     * @returns {HttpPromise}  HttpPromise\n     */\n    readall: function(){\n      return $http.post(moduleUrl+'/readall')\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#top\n     * @methodOf  news.services.News\n     * @description\n     *    置顶新闻/取消置顶新闻\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     *    - `topEndTime`：（可选）置顶过期时间。如果该值为空，则会取消置顶。\n     *    \n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    top: function(params){\n      return $http.post(moduleUrl+'/top', params)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#del\n     * @methodOf  news.services.News\n     * @description\n     *    删除新闻\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    delete: function(params){\n      return $http.post(moduleUrl+'/del', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#getReaders\n     * @methodOf  news.services.News\n     * @description\n     *    获取阅读人员列表\n     *    请求参数说明：\n     *    - `articleid`：新闻id\n     *    \n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    getReaders: function(params){\n      return $http.post(moduleUrl+ '/getReaders', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#verify\n     * @methodOf  news.services.News\n     * @description\n     *    审批通过\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    verify: function(params){\n      return $http.post(moduleUrl+ '/verify', params);\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#back\n     * @methodOf  news.services.News\n     * @description\n     *    审批退回\n     *    请求参数说明：\n     *    - `articleids`：新闻id。如果有多个，使用逗号分开。如：1,2,3\n     *    - `reason`：审批退回理由`\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    back: function(params){\n      return $http.post(moduleUrl+ '/back',params)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#addComment\n     * @methodOf  news.services.News\n     * @description\n     *    添加评论\n     *    请求参数说明：\n     *    - `type`：评论类型。comment：评论、reply：回复。\n     *    - `rowid`：如果是评论，则为新闻id；如果是回复评论，则为评论主体id。\n     *    - `content`：评论内容\n     *    - `tocid`：（可选）具体某条回复的id\n     *    - `url`：（可选）链接地址\n     *    - `detail`：（可选）详细来源信息描述\n     * @param   {Object}       params       请求参数\n     * @returns {HttpPromise}  HttpPromise\n     */\n    addComment: function(params){\n      return $http.post(moduleUrl+ '/addComment', params)\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#getComments\n     * @methodOf  news.services.News\n     * @description\n     *    获取评论列表\n     *    \n     * @param   {String}       articleid    新闻id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    getComments: function(params){\n      return $http.get(moduleUrl+ '/getComments', { params : params } )\n    },\n\n    /**\n     * @ngdoc     method\n     * @name      news.services.News#move\n     * @methodOf  news.services.News\n     * @description\n     *    移动新闻\n     *    请求参数说明：\n     *    - `articleids`：新闻id列表。如果有多个，使用逗号分开。如：1,2,3\n     *    - `catid`：分类id\n     * @param   {String}       articleid    新闻id\n     * @returns {HttpPromise}  HttpPromise\n     */\n    move: function(params){\n      return $http.post(moduleUrl+ '/move', params)\n    }\n  }\n})\n\n.factory('NewsList', function($http, $ionicLoading, Settings, Utils) {\n\n  var moduleUrl = Settings.rootUrl + '/news';\n\n  function NewsList(url, options){\n    this.url = url;\n    this.options = options;\n\n    this.hasMore = true;\n    this.news = [];\n\n    this.params = {};\n  }\n\n  angular.extend(NewsList.prototype, {\n    /**\n     * @ngdoc method\n     * @name NewsList#fetch\n     * @description\n     *   获取文件列表数据\n     *   返回数据格式为\n     *   {\n     *     datas: [\n     *       { addtime, author, uid, subject, content, uptime, readstatus... }\n     *       ...\n     *     ],\n     *     pages: { page, pageCount, pageSize }\n     *   }\n     *   addtime: \"1409381646\"\n     *\n     * @param {Obejct} param 查询条件\n     *    catid      {String}         分类 id\n     *    page       {Number}         页码\n     *    keyword    {String}         搜索关键词\n     * @returns {Object} promise\n     */\n\n    fetch: function(params, reset, extend) {\n      var _this = this;\n      if(reset) {\n        this.news = [];\n        this.hasMore = true;\n      }\n\n      if(extend === false) {\n        this.params = params;\n      } else {\n        angular.extend(this.params, params);\n      }\n\n      return $http.get(this.url, {\n        params: this.params\n      })\n\n      .success(function(res){\n          if(res.isSuccess){\n            if(res.pages.page < res.pages.pageCount) {\n              _this.news = _this.news.concat(res.data);\n              // _this.params.page += 1;\n            }\n            // 判断是否还能加载更多\n            _this.hasMore = res.pages.page < res.pages.pageCount - 1\n          } else {\n            Utils.promptNoPermission();\n          }\n      })\n    },\n\n    search: function(keyword) {\n      return this.fetch({\n        page: 1,\n        search: keyword\n      }, true);\n    },\n\n    loadMore: function() {\n      return this.fetch({\n        page: this.params.page + 1\n      });\n    },\n\n    hasNews: function() {\n      return !!this.news.length;\n    },\n\n    reset: function() {\n      this.news.length = 0;\n      this.hasMore = true;\n    }\n  });\n\n  return NewsList;\n})\n\n.factory('NewsIndex',function(NewsList,Settings){\n  var NEWS_APT_URL =　Settings.rootUrl + '/news';\n  var list = new NewsList(NEWS_APT_URL + '/index');\n\n  return list;\n})\n\n.factory('NewsUnread', function(NewsList, Settings) {\n  var list = new NewsList(Settings.rootUrl + '/news&type=new');\n\n  return list;\n})\n\n\n","/**\n * @ngdoc module\n * @name report.controllers\n * @description\n *  汇报模块控制器\n */\n\nangular.module('report.controllers', [])\n\n/**\n * @ngdoc controller\n * @name ReportIndexCtrl\n * @module report.controllers\n * @description\n *   汇报首页控制器\n */\n  .controller('ReportIndexCtrl', function($scope, $ionicModal, $ionicLoading, $localstorage, $state, $timeout, uniqueFilter, mapFilter, Utils, IbPopup, Report){\n    var LOCAL_SETTINGS_KEY = 'report.settings';\n    var localReportSettings = $localstorage.getObject(LOCAL_SETTINGS_KEY);\n\n    $scope.order = false;\n    $scope.loading = true;\n\n    //从远程数据筛选出本地所不包含的所有子项。\n    function filterItem(originTempArr, localTempArr) {\n       var localTids = mapFilter(localTempArr, 'tid');\n      return originTempArr\n        .filter(function (item) {\n          return localTids.indexOf(item.tid) === -1;\n        });\n    }\n\n    //模板排序\n    function orderTpl(originTemp, localTemp) {\n      //拿到新添加的数据\n      var diffArr = filterItem(originTemp, localTemp);\n      // 如果远程数据有本地数据没有的项目则返回本地数据和新数据合集\n      return diffArr.length ? localTemp.concat(diffArr) : localTemp;\n    };\n\n    // 获取未读数\n    function updateUnreadCount() {\n      Report.getUnreadCount().success(function(res){\n        if(res.isSuccess){\n          $scope.unreadCount = res.data.unread\n        }\n      })\n    }\n\n    //获取可用模板\n    function updateUserTemplate() {\n      $ionicLoading.show();\n      Report.getUserTemplate().success(function(res){\n        if(res.isSuccess){\n          $scope.loading = false;\n          if(localReportSettings){\n            $scope.templates = orderTpl(res.data, localReportSettings);\n          } else {\n            $scope.templates = res.data;\n          }\n\n          $scope.isSet = res.isSet\n        } else {\n          Utils.promptNoPermission();\n        }\n      }).finally($ionicLoading.hide)\n    }\n\n    //离开的时候关闭模板\n    function closeMode(scope, modal){\n      scope.$on('$ionicView.leave', modal.hide.bind(modal));\n      scope.$on('$destroy', modal.remove.bind(modal))\n    }\n\n    //打开管理模板\n    $scope.openManageModel = function(){\n      $ionicModal.fromTemplateUrl('templates/report/report-manage-modal.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.manageModel = modal;\n          $scope.manageModel.show();\n\n          //设置模板的数据\n          $scope.settingTpls = $scope.templates;\n\n          $scope.openOrderList = function(){\n            $scope.settingTpls = $scope.templates;\n            //模板排序\n            $scope.moveTpl = function(tpl, fromIndex, toIndex) {\n              //把该项移动到数组中\n              $scope.settingTpls.splice(fromIndex, 1);\n              $scope.settingTpls.splice(toIndex, 0, tpl);\n              $localstorage.setObject(LOCAL_SETTINGS_KEY, $scope.settingTpls)\n            };\n\n            $scope.orderFinish = function() {\n              $scope.manageModel.hide();\n              $scope.templates = $scope.settingTpls;\n            }\n          };\n\n          closeMode($scope, modal);\n        })\n    };\n\n    //打开设置模板\n    $scope.openSettingModel = function(tid){\n      $ionicModal.fromTemplateUrl('templates/report/report-setting-modal.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.settingModel = modal;\n          $scope.settingModel.show();\n          $scope.collection = [];\n          $scope.manageTypes  = [];\n          $scope.uptype = {};\n          $scope.formData = {};\n          var updateList = [];\n\n          //获取主管类型\n          Report.getcharge().success(function(res){\n            if(res.isSuccess){\n              $scope.managers = res.data;\n            }\n          });\n\n          //取消删除主管类型\n          $scope.outRemoveTypeMode = function(){\n            $scope.removeTypeMode = false;\n          };\n\n          $scope.removeTypeMode = false;\n          //删除主管类型\n          $scope.toRemoveTypeMode = function($event){\n            $scope.removeTypeMode = true;\n            $event.stopPropagation();\n          };\n\n\n          //打开选择主管列表\n          $scope.openSelectManagerModal = function(){\n            $ionicModal.fromTemplateUrl('templates/report/report-select-manager-modal.html',{\n              scope: $scope,\n              animation: 'slide-in-up'\n            })\n              .then(function(modal){\n                $scope.chargeModel = modal;\n                $scope.chargeModel.show();\n                var manageTypes;\n\n                // 判断是否已有选中的类型，如果是则自动选中；\n                if($scope.manageTypes.length > 0){\n                  manageTypes = ([].concat($scope.manageTypes.map(function(item){\n                    return item.uptype\n                  })));\n\n                  angular.forEach($scope.managers, function(type){\n                    for(var i = 0; i < manageTypes.length; i++){\n                      if(type.uptype == manageTypes[i]){\n                        $scope.uptype[type.uptype] = true;\n                      }\n                    }\n                  })\n                };\n\n                $scope.addManager = function(){\n                  $scope.chargeModel.hide();\n                  $scope.manageTypes = [];\n\n                  angular.forEach($scope.managers, function(type) {\n                    // 判断管理人员是否被选中\n                      if($scope.uptype[type.uptype]) {\n                        $scope.manageTypes.push(type);\n                        $scope.manageTypeids = ([].concat($scope.manageTypes.map(function(item){\n                          return item.uptype\n                        }))).join(',');\n                      }\n                  });\n                };\n\n                closeMode($scope, modal);\n              })\n          };\n\n          function alert(prompt){\n            IbPopup.alert({ title: prompt })\n              .then(function(flag){\n                if(flag){\n                  $scope.settingModel.hide();\n                  $state.go('report.index');\n                }\n              })\n          }\n\n          $scope.removeType = function($event, type) {\n            var index = $scope.manageTypes.indexOf(type);\n            $scope.manageTypes.splice(index, 1);\n            $scope.manageTypeids = ([].concat($scope.manageTypes.map(function(item){\n              return item.uptype\n            }))).join(',');\n\n            if(!$scope.manageTypes.length) $scope.removeTypeMode = false;\n            $event.stopPropagation();\n          };\n\n\n          //获取模板设置值\n          $ionicLoading.show();\n          Report.settemplate({ tid : tid } ).success(function(res){\n            if(res.isSuccess) {\n              $scope.formData.defaultShareList = res.data.uid;\n              $scope.manageTypes = res.data.uptype;\n              $scope.formData.defaultReceiveList = res.data.upuid;\n            }\n          }).finally($ionicLoading.hide);\n\n          //设置模板\n          $scope.setTemplate = function(){\n            var params = {\n              tid: tid,\n              uid: $scope.formData.defaultShareList || '',\n              uptype: $scope.manageTypeids || '',\n              upuid: $scope.formData.defaultReceiveList || ''\n            };\n\n            $ionicLoading.show();\n            Report.settemplate(params).success(function(res){\n              if(res.isSuccess){\n                IbPopup.alert({ title: '设置成功'}).then(function(){\n                  $scope.openManageModel();\n                })\n              } else {\n                alert('设置失败')\n              }\n            }).finally($ionicLoading.hide)\n          };\n\n          closeMode($scope, modal);\n        });\n    };\n\n    //添加模板\n    $scope.openAddModal = function() {\n      $ionicModal.fromTemplateUrl('templates/report/report-add-modal.html',{\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n        .then(function(modal){\n          $scope.addModel = modal;\n          $scope.addModel.show();\n          $ionicLoading.show();\n          Report.getShopList().success(function(res){\n            if(res.isSuccess){\n              $scope.templateData = res.data;\n              $scope.isAdd = res.isAdd;\n\n              $scope.addTemplate = function(tid){\n                $ionicLoading.show();\n                Report.addTemplate(tid).success(function(res){\n                  if(res.isSuccess){\n                    $scope.addModel.hide();\n                    $timeout(updateUserTemplate);\n                    $state.go('report.index');\n                  }\n                }).finally($ionicLoading.hide)\n              };\n            }\n          }).finally($ionicLoading.hide)\n\n          closeMode($scope, modal);\n        });\n    };\n\n    $scope.$on('$ionicView.enter', function() {\n      updateUnreadCount();\n      updateUserTemplate()\n    });\n  })\n\n/**\n * @ngdoc controller\n * @name ReportFormCtrl\n * @module report.controllers\n * @description\n *   汇报-表单（创建/编辑） 的控制器\n */\n  .controller('ReportFormCtrl', function($scope, $q, $stateParams, $ionicLoading, $ionicHistory, $state, Utils, External, CommonApi, IbPopup, mapFilter, fileSizeFilter, dateFilter, ReportUtils, Report){\n    var tid = $stateParams.tid,\n      repid = $stateParams.repid;\n    //如果有tid 是新建汇报，否则是编辑汇报；\n    var data =  tid ? { tid: tid } : { repid: repid };\n    $ionicLoading.show();\n    Report.getTemplateData(data).success(function(res){\n      $ionicLoading.show();\n      if(res.isSuccess){\n        $scope.formData = {\n          subject: '',\n          toid: '',\n          attachmentid: '',\n          remark: '',\n          place: '',\n          status: 1,\n          fields: []\n        };\n        var tpl = res.data.template;\n        $scope.subject = res.data.template.subject;\n        $scope.formData.tid = tpl.tid || '';\n        $scope.formData.fields = res.data.templateField || '';\n        $scope.formData.toid = tpl.defaultuid || '';\n        $scope.formData.remark = tpl.remark || '';\n        $scope.accessories = tpl.attach || [];\n        //编辑汇报时\n        if(repid){\n          $scope.formData.repid = tpl.repid || '';\n          angular.forEach($scope.formData.fields, function(item){\n            if(item.fieldtype == '4'|| item.fieldtype == '6'){\n              item.content = new Date(item.content);\n            } else if(item.fieldtype == '5'){\n              //因为只取时分的数据，new Date需要传入完整的格式；\n              item.content = new Date( \"1970-01-01 \" + item.content )\n            } else if(item.fieldtype == '3'){\n              if (!isNaN(Number(+item.content))){\n                item.content = +item.content\n              } else{\n                item.content = 0;\n              }\n            }\n          });\n        }\n\n        // 提交汇报\n        $scope.submit = function(){\n          // 图片id\n          $scope.formData.attachmentid = $scope.accessories\n            .map(function(annex) {\n              return annex.aid;\n            })\n            .join(',');\n          var formData = changeDataType($scope.formData);\n          $ionicLoading.show();\n          Report.saveReport(formData).success(function(res){\n            if(res.isSuccess){\n              tid ? $state.go('report.send'): $state.go('report.view',{ repid: repid });\n            } else {\n              alert(res.msg)\n            }\n          }).finally($ionicLoading.hide)\n        };\n\n        $scope.saveDraft = function(){\n          if($scope.reportForm.$dirty){\n            IbPopup.confirm({ title: '你还未发布汇报，是否保存' }).then(function(flag) {\n              if(flag){\n                $scope.formData.status = 0;\n                var formData = changeDataType($scope.formData);\n                $ionicLoading.show();\n                Report.saveReport(formData).success(function(res){\n                  if(res.isSuccess){\n                    $ionicHistory.goBack();\n                  }\n                }).finally($ionicLoading.hide)\n              } else{\n                $ionicHistory.goBack();\n              }\n            })\n          } else {\n            $ionicHistory.goBack();\n          }\n        }\n      }\n    }).finally($ionicLoading.hide);\n\n    function changeDataType (formData){\n      formData = angular.merge({}, formData);\n\n      //按后端要求提交前转数据格式\n      angular.forEach(formData.fields, function(item){\n        if(!item.content){\n          item.content = '';\n        }\n       //字段类型，1表示长文本，2表示短文本，3表示数字，4表示日期与时间，5表示时间，6表示日期，7表示下拉, 8表示富文本(目前用长文本替代)\n        if(item.fieldtype == 3){\n          item.content = '' + item.content;\n        } else if(item.fieldtype == 4){\n          item.content = dateFilter(item.content, 'yyyy-MM-dd HH:mm') || '';\n        } else if(item.fieldtype == 5){\n          item.content = dateFilter(item.content, 'HH:mm') || '';\n        } else if(item.fieldtype == 6){\n          item.content = dateFilter(item.content, 'yyyy-MM-dd') || '';\n        } else if(item.fieldtype == 7){\n          item.fieldvalue = item.fieldvalue.join(',');\n        }\n      });\n\n      return formData;\n    };\n\n    //添加图片\n    $scope.addImage = function(evt){\n      $scope.uploading = true;\n      angular.forEach(evt.target.files, function(file) {\n        var temp = {\n          name: file.name,\n          size: fileSizeFilter(file.size),\n          type: file.type.split('/')[1],\n          uploading: true,\n          cancel: null\n        };\n        temp.cancel = $q.defer();\n        temp.index = $scope.accessories.length;\n        $scope.accessories.push(temp);\n        $scope.$applyAsync();\n        var formData = new FormData();\n        formData.append('Filedata[]', file);\n        CommonApi.uploadAttach(formData, { timeout: temp.cancel.promise })\n          .then(function(res){\n            var data = res.data;\n            if(data.isSuccess){\n              // 上传成功补上aid信息\n              var uploadedImage = data.data[0];\n              temp.aid = uploadedImage.aid;\n            } else {\n              // 上传不成功删除\n              $scope.accessories.splice(temp.index, 1);\n            }\n          })\n          .catch(function(err) {\n            // 上传失败删除\n            $scope.accessories.splice(temp.index, 1);\n          })\n          .finally(function() {\n            temp.uploading = false;\n            // 正在上传的图片\n            var uploadingAccessories = $scope.accessories\n              .filter(function(annex) {\n                return annex.uploading;\n              });\n            // 没有了正在上传的图片关闭总loading\n            if (!uploadingAccessories.length) {\n              $scope.uploading = false;\n            }\n          });\n      });\n    };\n\n    // 移除图片\n    $scope.removeImage = function(index) {\n      IbPopup.confirm({ title: '确定要删除该图片吗？' }).then(function(flag) {\n        if(flag) {\n          $scope.accessories.splice(index, 1);\n        }\n      });\n    };\n  })\n\n/**\n * @ngdoc controller\n * @name ReportReceiveCtrl\n * @module report.controllers\n * @description\n *   汇报列表-我收到的控制器\n */\n  .controller('ReportReceiveCtrl', function($scope, $rootScope, $ionicScrollDelegate, $ionicLoading, dateFilter, IbPopup, SearchModal, ReportUtils, Report){\n    $scope.activeTab = 'unread';\n    $scope.loading = true;\n    var params = {\n      limit: 10 ,\n      offset: 0 ,\n      type:'unread'\n    };\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.addtime * 1000, 'EEEE');\n    };\n\n    $scope.readReport = function(report){\n      report.isreview = '1';\n    };\n\n    $scope.setTab = function(type) {\n      $ionicScrollDelegate.$getByHandle('reportReceiveListScroll').scrollTop();\n      $scope.list = [];\n      $scope.loading = true;\n      $scope.activeTab = type || 'unread';\n      params.offset = 0;\n      params.type = type === 'unread' ? 'unread':'receive';\n      ReportUtils.getList($scope, params);\n    };\n\n    $scope.addRead = function(){\n      $ionicLoading.show();\n      Report.allRead().success(function(res){\n        if(res.isSuccess){\n          params.type = 'receive';\n          $scope.activeTab = 'all';\n          ReportUtils.getList($scope, params);\n          IbPopup.alert({ title: '全部标记已读' });\n        }\n      }).finally($ionicLoading.hide);\n    };\n\n    $scope.loadMore = function(){\n      var type =  $scope.activeTab;\n      params.offset = $scope.list.length;\n      params.type = type === 'unread' ? 'unread':'receive';\n      $ionicLoading.show();\n      Report.getList(params).success(function(res){\n        if(res.isSuccess){\n          $scope.list = $scope.list.concat(res.data.list);\n        }\n      }).finally($ionicLoading.hide)\n    };\n\n    $scope.search = new SearchModal({\n      scope: $scope,\n      searchFunc: function(params){\n        return Report.getList({\n          type: 'receive',\n          limit: 99,\n          offset: 0,\n          keyword:{\n            subject: params.key\n          }\n        });\n      }\n    });\n\n    $scope.refresh = function(){\n      params.offset = 0;\n      ReportUtils.getList($scope, params);\n    };\n\n    ReportUtils.getList($scope, params);\n  })\n\n/**\n * @ngdoc controller\n * @name ReportSendCtrl\n * @module report.controllers\n * @description\n *   汇报列表-我发出的控制器\n */\n  .controller('ReportSendCtrl', function($scope, $rootScope, $ionicLoading, dateFilter, SearchModal, ReportUtils, Report){\n    $scope.loading = true;\n    var params = {\n      limit: 10 ,\n      offset: 0 ,\n      type:'send'\n    };\n\n    $scope.groupByTime = function(item) {\n      return dateFilter(item.addtime * 1000, 'EEEE');\n    };\n\n    $scope.loadMore = function(){\n      params.offset = $scope.list.length;\n      $ionicLoading.show();\n      Report.getList(params).success(function(res){\n        if(res.isSuccess){\n          $scope.list = $scope.list.concat(res.data.list);\n        }\n      }).finally($ionicLoading.hide)\n    };\n\n    $scope.search = new SearchModal({\n      scope: $scope,\n      searchFunc: function(params){\n        return Report.getList({\n          type: 'send',\n          limit: 99,\n          offset: 0,\n          keyword:{\n            subject: params.key\n          }\n        });\n      }\n    });\n\n    $scope.refresh = function(){\n      params.offset = 0;\n      ReportUtils.getList($scope, params);\n    };\n\n    ReportUtils.getList($scope, params);\n  })\n\n/**\n * @ngdoc controller\n * @name ReportViewCtrl\n * @module report.controllers\n * @description\n *   汇报详情页控制器\n */\n  .controller('ReportViewCtrl', function($scope, $rootScope, $stateParams, $ionicModal, $ionicLoading, $ionicActionSheet, $state, $ionicHistory, IbPopup, uniqueFilter, userInfoFilter, Report){\n    $scope.currentUserUid = $rootScope.user.uid;\n    $ionicLoading.show();\n    Report.showReport($stateParams.repid).success(function(res){\n      if(res.isSuccess){\n        $scope.report = res.data;\n        $scope.report.readers = res.data.reader;\n\n        //评论参数\n        var commentData = {\n          type: 'comment',\n          rowid: $scope.report.repid,\n          offset: 0,\n          limit: 999\n        };\n\n        //获取评论列表\n        function getCommentList(){\n          $ionicLoading.show();\n          Report.getComments(commentData).success(function(res){\n            $ionicLoading.hide();\n            $scope.commentList = res.data.lists;\n          });\n        }\n\n        $scope.openComment = function(type, cm){\n          $ionicModal.fromTemplateUrl('templates/report/report-comment.html',{\n            scope: $scope,\n            animation:'slide-in-up'\n          })\n            .then(function(modal){\n              $scope.comment = {};\n              $scope.commentModal = modal;\n              $scope.comment.isStampsBoxShow = false;\n              $scope.commentModal.show();\n\n              Report.getStamp().success(function(res){\n                if(res.isSuccess){\n                  $scope.report.stamps = res.data;\n                }\n              });\n\n              if (type === 'reply'){\n                $scope.comment.content = cm.touid ? '回复 @' + userInfoFilter(cm.uid,'realname') + ' : ': ''\n              }\n\n              $scope.submit = function(){\n                var params = {\n                  type:type ,\n                  content: $scope.comment.content,\n                  moduleuid: $scope.user.uid\n                };\n\n                if(type === 'comment'){\n                  params.rowid = $scope.report.repid;\n                } else {\n                  params.tocid = cm.cid;\n                  // 如果直接回复评论，则\n                  if(cm.tocid === '0') {\n                    params.rowid = cm.cid;\n                    // 否则，如果回复评论下的回复，则\n                  } else {\n                    params.rowid = cm.rowid;\n                  }\n                }\n\n                Report.addComment(params).success(function(res){\n                  if($scope.comment.stamp){\n                    var params = {\n                      repid: $stateParams.repid,\n                      stampid: $scope.comment.stamp.stampid\n                    };\n                    Report.setStamp(params)\n                  }\n                  Report.showReport($stateParams.repid).success(function(res) {\n                    if (res.isSuccess) {\n                      $scope.report.stamp = res.data.stamp;\n                    }\n                  });\n                  $scope.commentModal.hide();\n                  $ionicLoading.show();\n                  getCommentList()\n                })\n              };\n            })\n        };\n\n        $scope.openCommentDetail = function(){\n          $ionicModal.fromTemplateUrl('templates/report/report-comment-detail.html',{\n            scope: $scope,\n            animation: 'slide-in-up'\n          })\n            .then(function(modal) {\n              $scope.commentTetailModal = modal;\n              $scope.commentTetailModal.show();\n              getCommentList()\n            })\n        };\n\n        $scope.openReaderDetail = function(){\n          $ionicModal.fromTemplateUrl('templates/report/report-reader-detail.html',{\n            scope: $scope,\n            animation: 'slide-in-up'\n          })\n            .then(function(modal) {\n              $scope.readerTetailModal = modal;\n              $scope.readerTetailModal.show();\n            })\n        };\n\n        $scope.operateMore = function(){\n          var hideSheet = $ionicActionSheet.show({\n            buttons: [\n              { text: '编辑' }\n            ],\n            destructiveText: '删除',\n            cancelText: '取消',\n            buttonClicked: function(index) {\n              if(index === 0){\n                $state.go('report.form',{ repid: $scope.report.repid })\n              }\n            },\n            destructiveButtonClicked: function(){\n              IbPopup.confirm({ title: '确认删除汇报？'}).then(function(flag){\n                if(flag){\n                  $ionicLoading.show();\n                  Report.delReport($scope.report.repid).success(function(res){\n                    if(res.isSuccess){\n                      $ionicHistory.goBack();\n                    }\n                  }).finally($ionicLoading.hide);\n                }\n              });\n            }\n          });\n        };\n\n        getCommentList();\n      }\n    }).finally($ionicLoading.hide)\n  });\n","/**\n * @ngdoc module\n * @name report\n * @description\n *   汇报模块入口\n */\n\nangular.module('report', ['ionic', 'report.controllers', 'report.services'/*, 'report.filters'*/])\n\n  .run(function(Apps) {\n    Apps.install({ name: 'report', title: '汇报', route: '#/report', state: 'report.index', icon: 'img/modicon/report.png' });\n  })\n\n  .config(function($stateProvider, $urlRouterProvider, UserProvider, ResolversProvider) {\n\n    $urlRouterProvider.when('/report', '/report/index');\n\n    $stateProvider\n      // setup an abstract state for the tabs directive\n      .state('report', {\n        url: \"/report\",\n        abstract: true,\n        template: '<ion-nav-view name=\"report\"></ion-nav-view>',\n        resolve: UserProvider.resolve\n      })\n\n      .state('report.index', {\n        url: '/index',\n        talkingDataLabel: '汇报-首页',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-index.html',\n            controller: 'ReportIndexCtrl'\n          }\n        }\n      })\n\n      .state('report.form', {\n        url: '/form/:repid?tid',\n        talkingDataLabel: '汇报-表单（创建、编辑）',\n        resolve: ResolversProvider.get(['qqmap']),\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-form.html',\n            controller: 'ReportFormCtrl'\n          }\n        }\n      })\n\n      .state('report.receive', {\n        url: '/receive',\n        cache: false,\n        talkingDataLabel: '汇报列表-我收到的',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-receive.html',\n            controller: 'ReportReceiveCtrl'\n          }\n        }\n      })\n\n      .state('report.send', {\n        url: '/send',\n        cache: false,\n        talkingDataLabel: '汇报列表-我发出的',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-send.html',\n            controller: 'ReportSendCtrl'\n          }\n        }\n      })\n\n      .state('report.view', {\n        url: '/view/:repid',\n        cache: false,\n        talkingDataLabel: '汇报-详情',\n        views: {\n          'report': {\n            templateUrl: 'templates/report/report-view.html',\n            controller: 'ReportViewCtrl'\n          }\n        }\n      })\n\n  })","/**\n * @ngdoc overview\n * @name  report.services\n * @description\n *   汇报模块相关服务\n */\nangular.module('report.services', [])\n\n/**\n * @ngdoc service\n * @name report.services.Report\n * @description\n *   汇报通用服务\n */\n  .factory('Report', function($http, Settings, Utils) {\n    var moduleUrl = Settings.hostUrl + '?r=report/api';\n    return {\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#usertemplate\n       * @methodOf  report.services\n       * @description\n       *   获取用户可用模板\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getUserTemplate: function() {\n        return $http.get(moduleUrl + '/usertemplate')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#shoplist\n       * @methodOf  report.services\n       * @description\n       *   获取商城列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getShopList: function() {\n        return Utils.postJsonData(moduleUrl + '/shoplist')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#sorttemplate\n       * @methodOf  report.services\n       * @description\n       *   获取排序模板列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getSortTemplate: function() {\n        return Utils.postJsonData(moduleUrl + '/sorttemplate')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#addtemplate\n       * @methodOf  report.services\n       * @description\n       *   添加系统模板\n       * @returns {HttpPromise}  HttpPromise\n       */\n      addTemplate: function(tid){\n        return Utils.postJsonData(moduleUrl + '/addTemplate',{ tid: tid })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getManagerTemplate\n       * @methodOf  report.services\n       * @description\n       *   获取管理模板列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getManagerTemplate: function(){\n        return Utils.postJsonData(moduleUrl + '/managertemplate')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getcharge\n       * @methodOf  report.services\n       * @description\n       *   获取主管列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getcharge: function(){\n        return Utils.postJsonData(moduleUrl + '/getcharge')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getList\n       * @methodOf  report.services\n       * @description\n       *   获取汇报列表\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getList: function(params){\n        return Utils.postJsonData(moduleUrl + '/getlist',params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getTemplateData\n       * @methodOf  report.services\n       * @description\n       *   设置/获取模板设置值\n       * @returns {HttpPromise}  HttpPromise\n       */\n      settemplate: function(params){\n        return Utils.postJsonData(moduleUrl + '/settemplate',params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getTemplateData\n       * @methodOf  report.services\n       * @description\n       *   获取汇报模板信息（汇报添加页面信息）\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getTemplateData: function(data){\n        return $http.get(moduleUrl + '/formreport',{ params: data })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#savereport\n       * @methodOf  report.services\n       * @description\n       *   保存汇报信息\n       * @returns {HttpPromise}  HttpPromise\n       */\n      saveReport: function(params){\n        return Utils.postJsonData(moduleUrl + '/savereport', params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#showReport\n       * @methodOf  report.services\n       * @description\n       *   汇报详情\n       * @returns {HttpPromise}  HttpPromise\n       */\n      showReport:function(repid){\n        return $http.get(moduleUrl + '/showreport', { params:  { repid: repid } })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#delReport\n       * @methodOf  report.services\n       * @description\n       *   汇报详情\n       * @returns {HttpPromise}  HttpPromise\n       */\n      delReport:function(repid){\n        return Utils.postJsonData(moduleUrl + '/delreport', { repids: repid })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#allRead\n       * @methodOf  report.services\n       * @description\n       *   汇报详情\n       * @returns {HttpPromise}  HttpPromise\n       */\n      allRead:function(repid){\n        return Utils.postJsonData(moduleUrl + '/allread', { repids: 0 })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#addComment\n       * @methodOf  report.services\n       * @description\n       *   添加/回复评论\n       * @returns {HttpPromise}  HttpPromise\n       */\n      addComment: function(params){\n        return Utils.postJsonData(moduleUrl + '/addcomment', params )\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getCommentList\n       * @methodOf  report.services\n       * @description\n       *   获取评论\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getComments: function(params){\n        return Utils.postJsonData(moduleUrl + '/getcommentlist', params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getReaders\n       * @methodOf  report.services\n       * @description\n       *   获取已读成员\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getReaders: function(repid){\n        return Utils.postJsonData(moduleUrl + '/getreader', { repid : repid })\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getStamp\n       * @methodOf  report.services\n       * @description\n       *   获取图章\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getStamp:function(repid){\n        return $http.get(moduleUrl + '/getstamp')\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#setStamp\n       * @methodOf  report.services\n       * @description\n       *   获取图章\n       * @returns {HttpPromise}  HttpPromise\n       */\n      setStamp: function(params){\n        return Utils.postJsonData(moduleUrl + '/setstamp', params)\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      report.services.report#getUnreadCount\n       * @methodOf  report.services\n       * @description\n       *   获取列表未读数\n       * @returns {HttpPromise}  HttpPromise\n       */\n      getUnreadCount: function(){\n        return $http.get(moduleUrl + '/getcount')\n      }\n    }\n  })\n\n/**\n * @ngdoc service\n * @name report.services.ReportUtils\n * @description\n *   汇报通用工具函数集\n */\n  .factory('ReportUtils',function($state, External, IbPopup, dateFilter, CommonApi, Report){\n    return{\n      /**\n       * @ngdoc     method\n       * @name      report.services.getList#获取列表\n       * @methodOf  report.services.ReportUtils\n       * @param\n       * @description\n       * getList\n       */\n      getList: function(scope,params){\n        Report.getList(params).success(function(res){\n          if(res.isSuccess){\n            scope.loading = false;\n            scope.list = res.data.list;\n            scope.list.hasMore= res.data.hasMore;\n          }\n        }).finally(function(){\n          scope.$broadcast('scroll.refreshComplete');\n        });\n      }\n    }\n  })\n","/**\n * @ngdoc overview\n * @name thread.controllers\n * @description\n *   主线模块控制器\n */\nangular.module('thread.controllers', [])\n\n.controller('ThreadIndexCtrl', function($scope, $ionicLoading, User, Thread, ThreadUtils, ThreadProgress, User, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n        if(res.isSuccess){\n          if(res.data.thread){\n\n            // 过滤出已关注的主线\n            $scope.isAttention = function(th) {\n              return th.isAttention;\n            };\n\n            // 获取剩余天数\n            // 返回 0 时，表示未设置结束日期\n            // 返回 -1 时，表示已过期\n            $scope.getDayLeft = ThreadUtils.getDayLeft;\n\n            // 判断负责人是否自己\n            $scope.isInCharge = function(th) {\n              return th.chargeuid == User.uid;\n            };\n\n            // 初始化列表，首次进来时自动加载数据\n            $scope.init = function() {\n              // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n              if(!$scope.list.hasItems()) {\n                $scope.list.refresh();\n              }\n            };\n\n            // 刷新列表\n            $scope.refresh = function() {\n              $scope.refreshing = true;\n              $scope.list.refresh()\n                .finally(function() {\n                  $scope.$broadcast('scroll.refreshComplete');\n                  $scope.refreshing = false;\n                });\n            };\n\n            $scope.list = ThreadProgress;\n            $scope.init();\n          } else{\n            Utils.promptNoPermission();\n          }\n        }\n      }\n    ).finally($ionicLoading.hide);\n})\n\n// 主线已结束列表\n.controller('ThreadFinishedCtrl', function($scope, User, Thread, ThreadFinished) {\n  // 初始化列表，首次进来时自动加载数据\n  $scope.init = function() {\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    if(!$scope.list.hasItems()) {\n      $scope.list.refresh();\n    }\n  };\n\n  // 刷新列表\n  $scope.refresh = function() {\n    $scope.refreshing = true;\n    // $scope.prop.keyword = '';\n    $scope.list.refresh()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n      $scope.refreshing = false;\n    });\n  };\n\n  $scope.list = ThreadFinished;\n  $scope.init();\n\n  // 判断负责人是否自己\n  $scope.isInCharge = function(th) {\n    return th.chargeuid == User.uid;\n  };\n})\n\n// 主线详情页\n.controller('ThreadViewCtrl', function($scope, $stateParams, $ionicSlideBoxDelegate, Thread, ThreadUtils) {\n  $scope.thread = {\n    starttime: 0,\n    endtime: 0\n  };\n\n  // 获取主线本身数据\n  Thread.view($stateParams)\n  .success(function(res) {\n    $scope.thread = res.datas.thread;\n    $scope.dayLeft = ThreadUtils.getDayLeft($scope.thread.endtime);\n  });\n\n  // 幻灯切换\n  $scope.slideChanged= function(index){\n    $ionicSlideBoxDelegate.update();\n  }\n  $scope.$watch('thread.description', $scope.slideChanged.bind($scope));\n\n  // 获取团队成员数据\n  $scope.members = [];\n  Thread.view({ id: $stateParams.id, tab: 'team' })\n  .success(function(res) {\n    $scope.members = setChargeFirstInMembers(res.datas.members);\n  });\n\n  // 找出负责人，并插入到数组首位\n  function setChargeFirstInMembers(members) {\n    for(var i = 0; i < members.length; i++) {\n      if(members[i].isCharge) {\n        members.unshift(members.splice(i, 1)[0]);\n        break;\n      }\n    }\n    return members;\n  }\n\n  $scope.tab = 'assignment';\n\n  function ThreadRalatedList() {\n    this.loaded = false;\n    this.loading = false;\n    this.more = true;\n    this.list = [];\n\n    this.load = function(params) {\n      var that = this;\n      if(this.loaded) return;\n\n      this.loading = true;\n      Thread.view(params)\n      .success(function(res) {\n        that.list = res.datas;\n        that.loaded = true;\n      })\n      .finally(function() {\n        that.loading = false;\n      });\n    }\n  }\n\n  // 任务列表\n  $scope.assignment = new ThreadRalatedList();\n\n  // 动态列表\n  $scope.feed = new ThreadRalatedList();\n\n  // 邮件列表\n  $scope.email = new ThreadRalatedList();\n\n  // 审批列表\n  $scope.flow = new ThreadRalatedList();\n\n  // 文件列表\n  $scope.file = new ThreadRalatedList();\n\n  $scope.$watch('tab', function(val) {\n    $scope[val].load({ id: $stateParams.id, tab: val });\n  })\n\n  $scope.setTab = function(tab) {\n    $scope.tab = tab;\n  }\n\n});","/**\n * @ngdoc module\n * @name thread.services\n * @description\n *   主线模块服务\n */\n\nangular.module('thread.services', [])\n\n.factory('ThreadUtils', function() {\n  return {\n    // P.s. 此处的 time 是以秒为单位的时间戳\n    getDayLeft: function(time) { \n      time = +time;\n      if(!time) return 0;\n      return Math.ceil((time - Date.now() / 1000) / 86400);\n    }\n  };\n})\n\n\n/**\n * @ngdoc service\n * @name Thread\n * @module thread.services\n * @description\n *   主线数据服务\n */\n.factory('Thread', function($http, Settings) {\n  return {\n    list: function(params) {\n      return $http.get(Settings.rootUrl + '/thread/index', {\n        params: params\n      });\n    },\n\n    view: function(params) {\n      return $http.get(Settings.rootUrl + '/threaddetail/detail', {\n        params: params\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name AssignmentFinished\n * @module assignment.services\n * @description\n *   主线已完成列表数据\n */\n.factory('ThreadProgress', function(Settings, IbList) {\n  var list = new IbList(Settings.rootUrl + '/thread/index&status=0', {\n    idAttr: 'threadid'\n  });\n\n  list.showLoading = list.hideLoading = angular.noop;\n\n  return list;\n})\n\n\n/**\n * @ngdoc service\n * @name AssignmentFinished\n * @module assignment.services\n * @description\n *   主线已完成列表数据\n */\n.factory('ThreadFinished', function(Settings, IbList) {\n  var list = new IbList(Settings.rootUrl + '/thread/index&status=1', {\n    idAttr: 'threadid'\n  });\n  list.showLoading = list.hideLoading = angular.noop;\n\n  // assignmentFinished.search = function(keyword) {\n  //   if(keyword.trim() === '') {\n  //     return this.fetch({\n  //       offset: 0,\n  //     }, true);\n  //   } else {\n  //     return this.fetch({\n  //       offset: 0,\n  //       param: 'search',\n  //       keyword: keyword\n  //     }, true);\n  //   }\n\n  // };\n\n  return list;\n})\n","/**\n * @ngdoc module\n * @name thread\n * @description\n *   主线模块\n */\n\nangular.module('thread', ['ionic', 'thread.services', 'thread.controllers'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'thread', title: '主线', route: '#/thread/index', state: 'thread.index', icon: 'img/modicon/thread.png' });\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n  $urlRouterProvider.when('/thread', '/thread/index');\n\n  $stateProvider\n  .state('thread', {\n    url: '/thread',\n    abstract: true,\n    template: '<ion-nav-view name=\"thread\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  $stateProvider\n  // 主线首页\n  .state('thread.index', {\n    url: '/index',\n    talkingDataLabel: '主线-首页',\n    views: {\n      'thread': {\n        templateUrl: 'templates/thread/index.html',\n        controller: 'ThreadIndexCtrl'\n      }\n    }\n  })\n\n  // 主线 -已结束的主线\n  .state('thread.finished', {\n    url: '/finished',\n    talkingDataLabel: '主线-已结束',\n    views: {\n      'thread': {\n        templateUrl: 'templates/thread/finished.html',\n        controller: 'ThreadFinishedCtrl'\n      }\n    }\n  })\n\n  // 主线-详细页\n  .state('thread.view', {\n    url: '/view/:id',\n    talkingDataLabel: '主线-查看主线',\n    views: {\n      'thread': {\n        templateUrl: 'templates/thread/view.html',\n        controller: 'ThreadViewCtrl'\n      }\n    }\n  })\n});","/**\n * @ngdoc module\n * @name vote.controllers\n * @description\n *   投票模块控制器\n */\nangular.module('vote.controllers', [])\n\n/**\n * @ngdoc controller\n * @name VoteIndexCtrl\n * @module vote.controllers\n * @description\n *   投票主页控制器\n */\n.controller('VoteIndexCtrl', function($scope, $state, VoteUtils, Vote) {\n  $scope.statusTab = 'underway';\n  $scope.activeTab = 'nonparticipator';\n  $scope.stateName = $state.current.name;\n  $scope.loading = true;\n\n  var params = {};\n\n  $scope.setParticipationTab = function(type) {\n    $scope.list = [];\n    $scope.loading = true;\n    $scope.activeTab = type || 'nonparticipator';\n    params.type = $scope.activeTab === 'nonparticipator' ? 1 : 2;\n    VoteUtils.voteList($scope, params)\n  };\n\n  $scope.setStatusTab = function(type) {\n    $scope.statusTab = type || 'underway';\n    params.type = $scope.statusTab !== 'underway' ? 5 : 4;\n    VoteUtils.voteList($scope, params);\n  };\n\n\n  if($scope.stateName === 'vote.mine') {\n    $scope.statusTab = 'underway';\n    params.type = 4;\n  } else {\n    $scope.activeTab = 'nonparticipator';\n    params.type = 1;\n  }\n\n  $scope.refresh = function() {\n    if($scope.stateName === 'vote.index'){\n     params.type = $scope.activeTab === 'nonparticipator' ? 1 : 2;\n    } else {\n     params.type = $scope.statusTab === 'underway' ? 4 : 5;\n    }\n    VoteUtils.voteList($scope, params);\n  };\n\n  VoteUtils.voteList($scope, params);\n})\n\n/**\n * @ngdoc controller\n * @name VoteViewCtrl\n * @module vote.controllers\n * @description\n *   投票详情页控制器\n */\n.controller('VoteViewCtrl', function($scope, $timeout, $ionicModal, $ionicLoading, $stateParams, IbPopup, VoteUtils, Vote) {\n  $scope.isOpenMore = false;\n  $scope.openMore = function() {\n    $scope.isOpenMore = true;\n  };\n\n  $scope.openCrewModal = function() {\n    $ionicModal.fromTemplateUrl('templates/vote/vote-crew-modal.html', {\n        scope: $scope,\n        animation: 'slide-in-up'\n      })\n      .then(function(modal) {\n        $scope.crewModal = modal;\n        $scope.crewModal.show();\n        Vote.showvoteusers($stateParams.id).success(function(res) {\n            $ionicLoading.show()\n            if (res.isSuccess) {\n              $scope.voteUsers = res.data.users.joined;\n            }\n          })\n          .finally($ionicLoading.hide);\n      })\n  };\n\n  VoteUtils.showVote($scope, $stateParams.id);\n\n  var lastSelected = {};\n  $scope.checkMaxSelected = function(topicid, max, currentItemid) {\n    var topic = $scope.form.topics[topicid];\n    var checkedNum = 0;\n\n    // 获取当前选中的数目\n    angular.forEach(topic, function(isChecked, itemid) {\n      if (isChecked) checkedNum++;\n    });\n\n    if (checkedNum > max) {\n      var lastItemid = lastSelected[topicid];\n      topic[lastItemid] = false;\n    }\n    lastSelected[topicid] = currentItemid;\n  };\n\n  $scope.form = {\n    voteid: ''\n  };\n\n  // 检查表单是否可以提交\n  $scope.validForm = function() {\n    var topics = VoteUtils.mainConvert($scope.form.topics);\n    return topics.length === $scope.topics.length;\n  };\n\n  $scope.submit = function() {\n    Vote.vote({\n      vote: {\n        voteid: $stateParams.id,\n        topics: VoteUtils.arrayToObject(VoteUtils.mainConvert($scope.form.topics))\n      }\n    }).success(function(res) {\n      if (res.isSuccess) {\n        VoteUtils.showVote($scope, $stateParams.id);\n      } else {\n        IbPopup.alert({ title: res.msg });\n      }\n    })\n  };\n\n});","/**\n * @ngdoc overview\n * @name vote.services\n * @description\n *   投票模块服务\n */\n\nangular.module('vote.services', [])\n\n\n/**\n * @ngdoc service\n * @name vote.services.Diary\n * @description\n *   投票通用服务\n */\n\n  .factory('Vote', function($http, Settings) {\n    var moduleUrl = Settings.hostUrl + '?r=vote';\n\n    return {\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#VoteList\n       * @methodOf  diary.services.Vote\n       * @param     {Object}   params  type 1未参与，2已参与，3全部，4我发起的-进行中，5我发起的-已结束，6我发起的-全部。默认值3（全部）\n       *\n       * @description\n       *   获取投票列表\n       *\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      voteList: function (params) {\n        return $http.get(moduleUrl + '/default/fetchindexlist', { params : params})\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#showVote\n       * @methodOf  diary.services.Vote\n       * @param     {Object}   params\n       *             voteid  投票id\n       *\n       * @description\n       *   查看投票\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      showVote: function (id) {\n        return $http.get(moduleUrl + '/default/showvote', { params : { voteid : id }} )\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#vote\n       * @methodOf  diary.services.Vote\n       * @param     {Object}   params\n       *             voteid  投票id\n       *             topicid    投票话题id\n       *             itemid    \t投票选项id\n       *\n       * @description\n       *   查看投票\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      vote: function (params) {\n        return $http.post(moduleUrl + '/default/vote', params )\n      },\n\n      /**\n       * @ngdoc     method\n       * @name      diary.services.Vote#showvoteusers\n       * @methodOf  diary.services.showvoteusers\n       * @param     {Object}   params\n       *             voteid  投票id\n       *\n       *\n       * @description\n       *   查看投票用户\n       * @returns   {HttpPromise}   HttpPromise\n       */\n      showvoteusers: function (voteid) {\n        return $http.get(moduleUrl + '/default/showvoteusers', { params: { voteid : voteid }} )\n      },\n\n    }\n  })\n\n  .factory('VoteUtils', function($ionicLoading, Utils, Vote) {\n\n    return{\n      voteList: function(scope, params) {\n        $ionicLoading.show();\n        Vote.voteList(params).success(function(res) {\n          if(res.isSuccess){\n            scope.loading = false;\n            scope.list = res.data;\n          } else {\n            Utils.promptNoPermission();\n          }\n        }).finally(function(){\n          $ionicLoading.hide();\n          scope.$broadcast('scroll.refreshComplete');\n        })\n      },\n\n     showVote: function(scope,voteid) {\n       $ionicLoading.show();\n       Vote.showVote(voteid).success(function(res) {\n         if(res.isSuccess) {\n           scope.vote = res.data.vote;\n           scope.topics = res.data.topics;\n           //scope.voteUsers = res.data.users.joined;\n         }\n       })\n         .finally($ionicLoading.hide);\n     },\n      //子对象\n      convertSubItem: function(value) { // { 22: true, 23: false, 24: true } => [22, 24]\n        var result = [];\n        for (var key in value){\n          if(value[key]) {\n            result.push(key);\n          }\n        }\n        return result;\n      },\n\n      //转成数组\n      mainConvert: function(topicsObj) {\n        var result = [];\n        var that = this;\n        angular.forEach(topicsObj, function(value, topicid) {\n          var itemIds = typeof value === 'number' ? [value] : typeof value === 'object' ? that.convertSubItem(value) : [];\n          if(itemIds.length) {\n            result.push({\n              topicid: topicid,\n              itemids: itemIds\n            });\n          }\n        });\n        return result;\n      },\n\n      arrayToObject: function(arr) {\n        var ret = {};\n        angular.forEach(arr, function(value, key) {\n          ret[key] = value;\n        });\n        return ret;\n      }\n    }\n  })\n","\n/**\n * @ngdoc module\n * @name vote\n * @description\n *   投票\n */\n\nangular.module('vote', ['ionic', 'vote.controllers', 'vote.services'])\n\n  .run(function(Apps) {\n    Apps.install({ name: 'vote', title: '投票', route: '#/vote', state: 'vote.index', icon: 'img/modicon/vote.png' });\n  })\n\n  .config(function($stateProvider, $urlRouterProvider, UserProvider) {\n\n    $urlRouterProvider.when('/vote', '/vote/index');\n\n\n    $stateProvider\n      .state('vote', {\n        url: \"/vote\",\n        abstract: true,\n        template: '<ion-nav-view name=\"vote\"></ion-nav-view>',\n        resolve: UserProvider.resolve\n      })\n\n      .state('vote.index', {\n        url: '/index',\n        cache: false,\n        talkingDataLabel: '投票-主页',\n        views: {\n          'vote': {\n            templateUrl: 'templates/vote/vote-index.html',\n            controller: 'VoteIndexCtrl'\n          }\n        }\n      })\n\n      .state('vote.mine', {\n        url: '/mine',\n        cache: false,\n        talkingDataLabel: '投票-我的',\n        views: {\n          'vote': {\n            templateUrl: 'templates/vote/vote-index.html',\n            controller: 'VoteIndexCtrl'\n          }\n        }\n      })\n\n      //投票详情页\n      .state('vote.view', {\n        url: '/view/:id',\n        talkingDataLabel: '投票-详情页',\n        cache: false,\n        views: {\n          'vote': {\n            templateUrl: 'templates/vote/vote-view.html',\n            controller: 'VoteViewCtrl'\n          }\n        }\n      })\n\n  });","/**\n * @ngdoc module\n * @name workflow.controllers\n * @description\n *   工作流模块控制器\n */\nangular.module('workflow.controllers', [])\n\n.controller('FlowIndexCtrl', function($scope,$ionicLoading, User, Utils) {\n    $ionicLoading.show();\n    User.getAuthority().success(function(res){\n        if(res.isSuccess){\n          if(!res.data.workflow) {\n            Utils.promptNoPermission();\n          }\n        }\n      }\n    ).finally($ionicLoading.hide);\n  })\n\n.controller('FlowListCtrl', function($scope, $state, $ionicScrollDelegate, $ionicActionSheet) {\n  $scope.prop = {};\n  \n  // 初始化列表，首次进来时自动加载数据\n  $scope.init = function() {\n    // 若没有页面缓存，重置查询条件，直接加载第一页的数据\n    if(!$scope.list.hasItems()) {\n      $scope.list.refresh();\n    }\n  }\n\n  // 刷新列表\n  $scope.refresh = function() {\n    $scope.prop.keyword = '';\n    $scope.list.refresh()\n    .finally(function() {\n      $scope.$broadcast('scroll.refreshComplete');\n    })\n  }\n\n  $scope.sref = 'workflow.detail({ key: flow.key })';\n\n  $scope.actionButtons = [];\n  $scope.showMenu = function(flow) {\n    var conf = {\n      titleText: '工作流操作',\n      buttons: $scope.actionButtons,\n      buttonClicked: function(index, opts) {\n        return opts.handler.call(null, flow);\n      },\n      cancelText: '取消'\n    };\n\n    if(angular.isFunction($scope.remove)) {\n      conf.destructiveText = '删除';\n      conf.destructiveButtonClicked = function() {\n        return $scope.remove(flow);\n      }\n    }\n\n    $scope.hideMenu = $ionicActionSheet.show(conf);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowTodoCtrl\n * @module workflow.controllers\n * @description\n *   待办工作列表页控制器\n */\n.controller('FlowTodoCtrl', function($scope, $controller, $state, $ionicActionSheet, IbPopup, Flow, FlowTodo) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowTodo;\n  $scope.title = '待办工作';\n  $scope.init();\n\n  $scope.sref = 'workflow.handle({ key: flow.key })';\n\n  var _showMenu = $scope.showMenu;\n\n  $scope.showMenu = function(flow) {\n    $scope.actionButtons = [];\n\n    $scope.remove = flow.del ? function(flow) {\n      Flow.confirmRemove(flow);\n      return true;\n    } : false;\n\n    _showMenu(flow);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowTransCtrl\n * @module workflow.controllers\n * @description\n *   已办结列表页控制器\n */\n.controller('FlowTransCtrl', function($scope, $controller, Flow, FlowTrans) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowTrans;\n  $scope.title = '已办结';\n  $scope.init();\n\n  $scope.takeback = function(flow) {\n    Flow.confirmTakeback(flow);\n    return true;\n  };\n\n  var _showMenu = $scope.showMenu;\n  $scope.showMenu = function(flow) {\n    $scope.actionButtons = [];\n\n    // 若允许收回\n    if(flow.rollback) {\n      $scope.actionButtons.push({ \n        text: '收回',\n        handler: function(flow) {\n          return $scope.takeback(flow);\n        } \n      })\n    }\n    \n    _showMenu(flow);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowDoneCtrl\n * @module workflow.controllers\n * @description\n *   已完成列表页控制器\n */\n.controller('FlowDoneCtrl', function($scope, $controller, Flow, FlowDone) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowDone;\n  $scope.title = '已完成';\n  $scope.init();\n\n  var _showMenu = $scope.showMenu;\n\n  $scope.showMenu = function(flow) {\n    $scope.actionButtons = [];\n\n    $scope.remove = flow.del ? function(flow) {\n      Flow.confirmRemove(flow);\n      return true;\n    } : false;\n\n    _showMenu(flow);\n  }\n})\n\n/**\n * @ngdoc controller\n * @name FlowFollowCtrl\n * @module workflow.controllers\n * @description\n *   我的关注列表页控制器\n */\n.controller('FlowFollowCtrl', function($scope, $controller, FlowFollow) {\n\n  $controller('FlowListCtrl', { $scope: $scope });\n  $scope.list = FlowFollow;\n  $scope.title = '我的关注';\n  $scope.init();\n\n  $scope.showMenu = angular.noop;\n})\n\n/**\n * @ngdoc controller\n * @name FlowCreateCtrl\n * @module workflow.controllers\n * @description\n *   发起工作页控制器\n */\n.controller('FlowCreateCtrl', function($scope, $rootScope, $state, $ionicModal, $ionicLoading, $ionicHistory, IbPopup, Flow) {\n\n  $scope.processes = [];\n  $scope.categories = [];\n\n  $scope.create = function(flow) {\n    $ionicLoading.show();\n    return Flow.create(flow.flowid)\n    .success(function(res) {\n      if(res.isSuccess) {\n        $ionicHistory.clearCache(['workflow.todo']).then(function() {\n          $state.go('workflow.handle', { key: res.key });\n        });\n      } else {\n        IbPopup.alert({ title: res.msg });\n      }\n    })\n    .finally($ionicLoading.hide);\n  }\n\n  // 查看分类下的流程\n  var cateModal;\n  // 为 Modal 新建一个 scope\n  var cateModalScope = $rootScope.$new(true);\n  cateModalScope.processes = [];\n  cateModalScope.close = function() {\n    cateModal && cateModal.hide();\n  }\n  cateModalScope.create = $scope.create;\n\n  // 创建分类详细 Modal\n  $ionicModal.fromTemplateUrl('./templates/workflow/workflow-cate-modal.html', {\n    scope: cateModalScope,\n    animation: 'slide-in-up',\n  })\n  .then(function(modal) {\n    cateModal = modal;\n  })\n\n  // 查看分类下的流程\n  $scope.openCate = function(cate) {\n    cateModalScope.category = cate;\n    cateModal.show();\n  };\n\n  $scope.$on('$ionicView.leave', function() {\n    cateModal && cateModal.hide();\n  });\n  $scope.$on('$destroy', function() {\n    cateModal && cateModal.remove();\n  });\n\n  // 获取可用的流程列表\n  $scope.loading = true;\n  Flow.getProcess()\n  .success(function(res) {\n    $scope.processes = res.common;\n    $scope.categories = res.cate;\n  })\n  .finally(function() {\n    $scope.loading = false;\n  });\n})\n\n/**\n * @ngdoc controller\n * @name FlowHandleCtrl\n * @module workflow.controllers\n * @description\n *   办理工作页控制器\n */\n.controller('FlowHandleCtrl', function($scope, $state, $stateParams, $timeout, $window, $ionicLoading, $ionicPopup, $ionicHistory, $ionicModal, $q, $filter, IbPopup, Settings, User, Flow, FlowUtils, icFactory, FlowUpload, FileUtils, IbPopup) {\n\n  var flow = $scope.flow = {};\n  var form = $scope.form = {};\n\n  $scope.key = $stateParams.key;\n  $scope.formhash = User.formhash;\n\n  // 判断是否只读字段\n  $scope.isReadonly = function(item) {\n    if(flow.readonly) {\n      return flow.readonly.split(',').indexOf(item['data-id']) !== -1;\n    }\n    return false;\n  }\n\n  // 查看原表\n  $scope.viewSource = function() {\n    $window.open(Settings.hostUrl + '?r=workflow/form/index&key=' + $scope.key, '_blank', 'location=yes');\n  }\n\n  function validateTitle(formData) {\n    if (!formData.title.trim()) {\n      IbPopup.alert({ title: '请输入标题' })\n      return false\n    }\n    return true\n  }\n\n  function save() {\n    form.attachmentid = $scope.imageAttach.concat($scope.fileAttach)\n      .map(function(item) {\n        return item.aid;\n      })\n      .join(',');\n    var formData = icFactory.serialize(angular.extend({}, form), flow.enableArr);\n    \n    if (!validateTitle(formData)) return\n\n    $ionicLoading.show();\n    return Flow.saveFlow(formData)\n    .success($ionicLoading.hide)\n    .error($ionicLoading.hide);\n  }\n\n  // 保存表单数据\n  $scope.save = function() {\n    save()\n    .success(function() {\n      IbPopup.tip('保存成功');\n    });\n  };\n\n  // 转交下一步\n  $scope.handover = function() {\n    save()\n    .success(function() {\n      // 自由流程的转交与固定流程转交不一样\n      var state = $scope.flow.flow.type == '2' ? 'workflow.handoverFree' : 'workflow.handover';\n      $state.go(state, { key: $scope.key, topflag: $scope.flow.rp.topflag });\n    });\n  };\n\n  $scope.rollbackData = {};\n\n  function saveRollback(params) {\n    $ionicLoading.show();\n    Flow.rollback($scope.key, params)\n    .success(function(res) {\n      if(res.isSuccess) {\n        IbPopup.alert({ title: '成功退回' }).then(function(){\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans']).then(function() {\n            $ionicHistory.goBack();\n          });\n        });\n      } else {\n        IbPopup.alert({ title: res.msg }).then(function() {\n          $ionicHistory.goBack()\n        });\n      }\n    })\n    .finally($ionicLoading.hide);\n  }\n\n  function showRollBackModel(remind) {\n    if($scope.flow.backlist && $scope.flow.backlist.length) {\n\n      $scope.rollbackData.stepId = $scope.flow.backlist[0].id;\n\n      if($scope.rollbackModal) {\n        $scope.rollbackModal.show();\n      } else {\n        $ionicModal.fromTemplateUrl('templates/workflow/backstep-modal.html', {\n          scope: $scope,\n          animation: 'slide-in-up'\n        }).then(function(modal) {\n          modal.show();\n\n          $scope.rollbackModal = modal;\n          // 确定回退\n          $scope.rollbackModal.save = function () {\n            saveRollback({\n              remind: remind,\n              formhash: User.formhash,\n              id: $scope.rollbackData.stepId\n            });\n            modal.hide();\n          }\n          \n          $scope.$on('$destroy', function() {\n            modal.remove();\n            delete $scope.rollbackModal;\n          });\n\n          $scope.$on('$ionicView.leave', function() {\n            modal.hide();\n          });\n\n        });\n      }\n    } else {\n      // 没有可选回退步骤\n    }\n  }\n\n  // 回退，按后端设置可分为直接回退到上一步，跟回退到可选步骤两种\n  $scope.rollback = function() {\n    \n    $ionicPopup.show({\n      template: '<input type=\"text\" ng-model=\"rollbackData.remind\">',\n      title: '请输入回退原因',\n      scope: $scope,\n      buttons: [\n        { text: '取消' },\n        {\n          text: '确定',\n          type: 'button-positive',\n          onTap: function(e) {\n            if (!$scope.rollbackData.remind) {\n              e.preventDefault();\n            } else {\n              return $scope.rollbackData.remind;\n            }\n          }\n        },\n      ]\n    })\n    .then(function(res) {\n      if(res) {\n        // 回退到上一步\n        if ($scope.flow.process.allowback == '1') {\n          saveRollback({ remind: res, formhash: User.formhash });\n        } else if ($scope.flow.process.allowback == '2') {\n          // 回退到可选步骤\n          showRollBackModel(res);\n        }\n      }\n    });  \n    \n  }\n\n  // 经办人会签（办理完毕）\n  $scope.sign = function() {\n    IbPopup.confirm({ title: '确定该工作已经办结吗？'})\n    .then(function(res) {\n      if(res) {\n        $ionicLoading.show();\n        Flow.signFlow($scope.key, {\n            topflag: flow.rp.topflag,\n            opflag: flow.rp.opflag,\n            content: $scope.form.content\n        })\n        .success(function() {\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans']).then(function() {\n            FlowUtils.goBackOrHome();\n          });\n        })\n        .finally($ionicLoading.hide);\n      }\n    })\n  }\n\n  // 结束流程（自由流程）\n  $scope.end = function() {\n    IbPopup.confirm({ title: '确认要结束该工作流程吗？'})\n    .then(function(res) {\n      if(res) {\n        $ionicLoading.show();\n        Flow.signFlow($scope.key, {\n          topflag: flow.rp.topflag,\n          opflag: flow.rp.opflag\n        })\n        .success(function() {\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans']).then(function() {\n            FlowUtils.goBackOrHome();\n          });\n        })\n        .finally($ionicLoading.hide);\n      }\n    })\n  }\n\n  $scope.imageAttach = [];\n  $scope.fileAttach = [];\n\n  // 添加图片\n  $scope.addImage = function(e) {\n    var safeSize = 20;\n    var files = e.target.files;\n    if (FlowUpload.isSafeFile(FlowUpload.safeImgTypes, files) && FlowUpload.isSafeSize(safeSize, files)) {\n      FlowUpload.upload($scope, files, $scope.imageAttach, $scope.flow.process.processid);\n    } else {\n      IbPopup.alert({\n        title: '仅支持不超过'+safeSize+'M的以下类型文件：' + FlowUpload.safeImgTypes.join(',')\n      });\n    }\n  }\n\n  // 删除图片\n  $scope.removeImage = function(index) {\n    $scope.imageAttach.splice(index, 1);\n  }\n\n  // 添加文件\n  $scope.isIos = ionic.Platform.isIOS();\n  $scope.checkIos = function() {\n    if ($scope.isIos) {\n      return IbPopup.alert({\n        title: '抱歉，暂不支持苹果系统及部分安卓系统上传附件'\n      });\n    }\n  }\n\n  $scope.addFile = function(e) {\n    var files = e.target.files;\n    var safeSize = 20;\n    if (FlowUpload.hasEmptyFile(files)) {\n      return IbPopup.alert({\n        title: '上传的文件中不能包含空文件'\n      });\n    }\n    if (FlowUpload.isSafeFile(FlowUpload.safeFileTypes, files) && FlowUpload.isSafeSize(safeSize, files)) {\n      FlowUpload.upload($scope, files, $scope.fileAttach, $scope.flow.process.processid);\n    } else {\n      IbPopup.alert({\n        title: '仅支持不超过'+safeSize+'M的以下类型文件：' + FlowUpload.safeFileTypes.join(',')\n      });\n    }\n  }\n\n  // 删除文件\n  $scope.removeFile = function(index) {\n    $scope.fileAttach.splice(index, 1);\n  }\n\n  // 下载文件\n  $scope.downloadFile = function(item) {\n    if (item.entireattachurl) {\n      return FileUtils.download($filter('fullUrl')(item.entireattachurl));\n    }\n    if (item.url) {\n      FileUtils.workflowDownload(item.url);\n    }\n  }\n\n  // 将附件分成图片和文件\n  function classifyAttach(attachData) {\n    angular.forEach(attachData, function(attach) {\n      var type = attach.filename.split('.').pop().toLowerCase();\n      if (FlowUpload.safeImgTypes.indexOf(type) !== -1) {\n        attach.url = $filter('fullUrl')(attach.officereadurl);\n        $scope.imageAttach.push(attach);\n      } else {\n        $scope.fileAttach.push(attach);\n      }\n    });\n  }\n\n  // 对象转数组 \n  function obj2Arr(obj) {\n    var arr = [];\n    angular.forEach(obj, function(value) {\n      arr.push(value);\n    });\n    return arr;\n  }\n\n  $ionicLoading.show();\n\n  Flow.getFlow($stateParams.key)\n  .success(function(res) {\n    if(typeof res.isSuccess !== 'undefined' && !res.isSuccess) {\n\n      IbPopup.alert({ title: res.msg })\n      .then(function() {\n        $ionicHistory.goBack();\n      });\n\n    } else {\n      flow = $scope.flow = res;\n      // feedback没有数据的时候后端会返回空数组，有数据的时候会返回obj\n      if ($scope.flow.feedback && !($scope.flow.feedback instanceof Array)) {\n        $scope.flow.feedback = obj2Arr($scope.flow.feedback);\n      }\n      form.key = $scope.key;\n      form.title = flow.run.name\n      form.hidden = flow.hidden;\n      form.readonly = flow.readonly;\n      form.attachmentid = flow.run.attachmentid;\n      form.fbattachmentid = ''; // ?\n      form.topflag = flow.rp.topflag;\n      form.saveflag = '';\n      form.formhash = $scope.formhash;\n      form.enablefiled = flow.enablefiled + '';\n      $scope.ics = [].concat(flow.enableArr, flow.valueArr);\n      // 分类附件(分成图片和文件)\n      res.attachData && classifyAttach(res.attachData);\n    }\n  })\n  .finally($ionicLoading.hide);\n})\n\n/**\n * @ngdoc controller\n * @name FlowHandoverCtrl\n * @module workflow.controllers\n * @description\n *   转交工作页控制器\n */\n.controller('FlowHandoverCtrl', function($scope, $state, $stateParams, $timeout, $ionicLoading, IbPopup, Flow, FlowUtils) {\n  var data = $scope.data = {};\n  var form = $scope.form = {\n    'prcs_user_op': [],\n    'prcs_user': [],\n    'topflag': [],\n    'prcs_choose': {},\n    'remind': {\n      '1': true,\n      '2': false,\n      '3': false\n    }\n  };\n\n  $scope.save = function() {\n\n    // 转交前有未经办人员时确认\n    if(data.notAllFinished) {\n      var msg = '经办人 ' + data.notAllFinished + ' 未办理完毕';\n\n      // \n      // 没要所有经办人会签时, 提示确认。\n      if(data.process.turnpriv == '1') {\n        if(!window.confirm(msg + ', 是否确认转交？')) {\n          return false;\n        }\n      // 要求所有经办人会签时，给出消息提示，但不允许转交\n      } else if(data.process.turnpriv == '0') {\n        alert(msg);\n        return false;\n      }\n    }\n    \n    var formData = {\n      'runid': data.runid,\n      'flowid': data.flowid,\n      'processid': data.processid,\n      'flowprocess': data.flowprocess,\n      'processto': data.process.processto,\n      'prcsback': data.prcsback,\n\n      'message': form.message,\n      'remind': {},\n      'prcs_choose': []\n    };\n\n    // 格式化 scope 的数据以提交给服务器\n    angular.forEach(form.prcs_choose, function(v, i) {\n      if(v.checked) {\n        formData['prcs_user_op' + i] = form.prcs_user_op[i] || '';\n        formData['prcs_user' + i] = form.prcs_user[i] || '';\n        formData['topflag' + i] = form.topflag[i] || '0';\n\n        // 若非最后一步骤时，需要通过 prcs_choose 储存选中步骤信息\n        // 最后一步则保持 prcs_choose 为空保持后端判断的标准\n        // 给这逻辑跪下了...\n        if(!v.isover) {\n          formData.prcs_choose.push(v.value);\n        }\n      }\n    });\n\n    // 由于后端使用 isset 判断 remind，所有要清理 remind 值为 false 的 key\n    // 不然就算值为 false 后端也会判断为 true\n    angular.forEach(form.remind, function(v, i){\n      if(v) {\n        formData.remind[i] = v;\n      }\n    });\n\n    // 如果是最后一步，则需要用特殊的参数名...\n    // @ps. 在流程本身为子流程的情况下，就算是最后一步，也会有主办人和经办人选项\n    if(!formData.prcs_choose.length) {\n      formData.prcs_user_op = formData.prcs_user_op0;\n      formData.prcs_user = formData.prcs_user0;\n      delete formData.prcs_user_op0;\n      delete formData.prcs_user0;\n      delete formData.topflag0;\n    }\n    formData.topflag = $stateParams.topflag;\n    $ionicLoading.show();\n    Flow.handover(formData)\n    .success(FlowUtils.onHandoverSuccess)\n    .finally($ionicLoading.hide);\n  }\n\n  // 初始化步骤信息\n  $scope.initStep = function(index, step) {\n    form.prcs_choose[index] = {\n      checked: step.checked,\n      value: index,\n      isover: step.isover\n    }\n    if(index === 0 && step.isover === true){\n        $scope.selectStep(index, step);\n    }\n  };\n\n  // 点击其他步骤时，判断是否允许并发\n  // 允许时，判定为多选\n  // 不允许时，判定为切换步骤（仿单选功能）\n  $scope.selectStep = function(index, step) {\n    // 结束流程的提醒是特殊的默认选择\n    if(step.isover == true) {\n        form.remind[1] = false;\n        form.remind[2] = true;\n        $scope.form.message = '【' + $scope.data.run.name + '】流程已办理完毕，请在“流程结束”分类下查看该流程。谢谢。';\n    } else {\n        form.remind[1] = true;\n        form.remind[2] = false;\n        $scope.form.message = '办理工作【' + $scope.data.run.name + '】，谢谢';\n    }\n    if($scope.data.process.syncdeal != 0) {\n      return false;\n    }\n    if(form.prcs_choose[index].checked) {\n      angular.forEach(form.prcs_choose, function(s) {\n        s.checked = false;\n      });\n    }\n    form.prcs_choose[index].checked = true;\n  };\n\n  // 判断指定步骤是否子流程\n  $scope.notChildFlow = function(step) {\n    return step.process && \n      step.process.childflow &&\n      step.process.childflow == '0'\n  };\n\n  // 验证转交表单\n  $scope.validate = function() {\n    var ret = true;  \n    var prcs = form.prcs_choose;\n    \n    // 针对这种按顺序验证的情况, 先抽离所有已选的进行判断\n    var checked = []\n    for(var key in prcs){\n      if (prcs.hasOwnProperty(key) && prcs[key].checked) {\n        checked.push(key)\n      }\n    }\n\n    for (var i = 0; i < checked.length; i++) {\n      var key = checked[i]\n      if (prcs[key].isover) {\n        ret = true;\n        // 为子流程的情况\n        if (data.prcsback) {\n          ret = !!form.prcs_user_op[key];\n          if(!ret) break\n        }\n      } else {\n        // 当主办人选项为 ‘主办’时，要求主办人必填\n        if (form.topflag[key] == '0') {\n          ret = !!form.prcs_user_op[key];\n        } else {\n          // 否则主办人选项为 其他时，要求经办人必填\n          ret = !!form.prcs_user[key];\n        }\n        if (!ret) break\n      }\n    }\n\n    return ret;\n  };\n\n  $ionicLoading.show();\n\n  Flow.getNext($stateParams)\n  .success(function(res) {\n    if(typeof res == 'string') {\n      IbPopup.alert({ title: res})\n    } else {\n      data = $scope.data = res;\n      $scope.form.message = '请您及时办理工作【' + $scope.data.run.name + '】，谢谢';\n    }\n  })\n  .finally($ionicLoading.hide);\n})\n\n/**\n * @ngdoc controller\n * @name FlowHandoverFreeCtrl\n * @module workflow.controllers\n * @description\n *   转交自由流程页控制器\n */\n.controller('FlowHandoverFreeCtrl', function($scope, $state, $stateParams, $timeout, $ionicLoading, $ionicModal, $ionicScrollDelegate, IbPopup, User, Flow, FlowUtils) {\n  var run = $scope.run = {};\n  var form = $scope.form = {\n    'next': {\n      'topflag': '0'\n    },\n    'preset': [],\n    'field': []\n  };\n\n  // 增加预设步骤\n  $scope.addPreset = function() {\n    form.preset.push({\n      'topflag': '0',\n      'prcsUserOp': '',\n      'prcsUser': ''\n    })\n\n    $timeout(function() {\n      $ionicScrollDelegate.resize()\n    })\n  };\n\n  // 创建分类详细 Modal\n  $ionicModal.fromTemplateUrl('./templates/workflow/workflow-field-modal.html', {\n    scope: $scope,\n    animation: 'slide-in-up',\n  })\n  .then(function(modal) {\n    $scope.modal = modal;\n  })\n\n  // 移除预设步骤\n  $scope.removePreset = function($index) {\n    form.preset.splice($index, 1);\n  };\n\n  $scope.getPresetIndex = function($index, processid) {\n    return $index + 1 + +run.processid;\n  }\n\n  $scope.save = function() {\n    // 如果还有经办人未处理，则弹出提示\n    if(run.notAllFinished) {\n      var msg = '经办人 ' + run.notAllFinished + ' 未办理完毕';\n      if(!window.confirm(msg + ', 是否确认转交？')) {\n        return false;\n      }\n    }\n    \n    var formData = {\n      'op': run.op,\n      'key': run.key,\n      'topflagOld': run.topflag,\n      'freeItemOld': '',\n      'tmpCount': '',\n      'lineCount': form.preset.length,\n      'message': form.message,\n      'formhash': User.formhash\n    };\n\n    // 若下一步骤为预设步骤\n    if(run.preset != '') {\n      formData.preset = '1';\n      formData.prcsUserOp = '1';\n      formData.prcsUser = '1';\n      formData.topflag = '1';\n    // 否则手动指定下一步骤\n    } else {\n\n      // 拿到下一步骤的数据\n      formData.topflag = form.next.topflag;\n      formData.prcsUserOp = User.addPrefix(form.next.prcsUserOp);\n      formData.prcsUser = User.addPrefix(form.next.prcsUser);\n\n      // 拿到预设步骤的数据\n      angular.forEach(form.preset, function(preset, index) {\n        var flag = index + 1;\n        formData['topflag' + flag] = preset.topflag;\n        formData['prcsUserOp' + flag] = User.addPrefix(preset.prcsUserOp);\n        formData['prcsUser' + flag] = User.addPrefix(preset.prcsUser);\n      });\n  \n      // 拿到可写字段数据\n      angular.forEach(form.field, function(f) {\n        formData.freeItemOld += (formData.freeItemOld ?  ',' + f : f);\n      });\n    }\n\n    $ionicLoading.show();\n    Flow.handoverFree(formData)\n    .success(FlowUtils.onHandoverSuccess)\n    .finally($ionicLoading.hide);\n  }\n  \n  function valiStep (step) {\n    // 下一步骤主办人选项为“主办”，则要求主办人非空\n    if(step.topflag == '0' && !step.prcsUserOp) {\n      return false;\n    }\n\n    // 否则要求经办人非空\n    if(step.topflag != '0' && !step.prcsUser) {\n      return false;\n    }\n\n    return true;\n  }\n\n  // 验证转交表单\n  $scope.validate = function() {\n    // 如果是预设步骤可直接提交\n    if(run.preset != '') {\n      return true;\n    }\n\n    // 下一步骤主办人选项为“主办”，则要求主办人非空\n    if(!valiStep(form.next)) {\n      return false;\n    }\n\n    // 有预设步骤时，判断预设步骤数据是否合理，逻辑同上\n    var i = 0, len;\n    if(len = form.preset.length) {\n      for(; i < len; i++) {\n        if(!valiStep(form.preset[i])) {\n          return false;\n        }\n      }\n    }\n\n    return true;\n  };\n\n  $ionicLoading.show();\n  Flow.getFreeNext($stateParams.key)\n  .success(function(res) {\n    if(typeof res == 'string') {\n      IbPopup.alert({ title: res})\n    } else {\n      run = $scope.run = res;\n      $scope.form.message = '请您及时办理工作【' + run.runName + '】，谢谢';\n    }\n  })\n  .finally($ionicLoading.hide);\n\n  $scope.$on('$ionicView.leave', function() {\n    $scope.modal.hide();\n  });\n  $scope.$on('$destroy', function() {\n    $scope.modal.remove();\n  });\n})\n\n/**\n * @ngdoc controller\n * @name FlowDetailCtrl\n * @module workflow.controllers\n * @description\n *   查看工作页控制器\n */\n.controller('FlowDetailCtrl', function($scope, $state, $stateParams, $timeout, $window, $ionicLoading, $ionicPopup, $filter, IbPopup, Settings, User, Flow, FlowUtils, FileUtils, FlowUpload) {\n\n  $scope.flow = {};\n  $scope.key = $stateParams.key;\n  $scope.formhash = User.formhash;\n\n  // 查看原表\n  $scope.viewSource = function() {\n    $window.open(Settings.hostUrl + '?r=workflow/preview/print&key=' + $scope.key, '_blank', 'location=yes');\n  }\n\n  $ionicLoading.show();\n\n  $scope.imageAttach = [];\n  $scope.fileAttach = [];\n\n  // 将附件分成图片和文件\n  function classifyAttach(attachData) {\n    angular.forEach(attachData, function(attach) {\n      var type = attach.filename.split('.').pop().toLowerCase();\n      if (FlowUpload.safeImgTypes.indexOf(type) !== -1) {\n        attach.url = $filter('fullUrl')(attach.officereadurl);\n        $scope.imageAttach.push(attach);\n      } else {\n        $scope.fileAttach.push(attach);\n      }\n    });\n  }\n\n  // 对象转数组 \n  function obj2Arr(obj) {\n    var arr = [];\n    angular.forEach(obj, function(value) {\n      arr.push(value);\n    });\n    return arr;\n  }\n\n  $scope.downloadFile = function(item) {\n    if (item.entireattachurl) {\n      return FileUtils.download($filter('fullUrl')(item.entireattachurl));\n    }\n    if (item.url) {\n      FileUtils.workflowDownload(item.url);\n    }\n  }\n\n  Flow.getFlow($stateParams.key, { type: 'view' })\n  .success(function(res) {\n    if(typeof res.isSuccess !== 'undefined' && !res.isSuccess) {\n      IbPopup.alert({ title: '提示', template: res.msg })\n      .then(FlowUtils.goBackOrHome)\n    } else {\n      $scope.flow = res;\n      // feedback没有数据的时候后端会返回空数组，有数据的时候会返回obj\n      if ($scope.flow.feedback && !($scope.flow.feedback instanceof Array)) {\n        $scope.flow.feedback = obj2Arr($scope.flow.feedback);\n      }\n      res.attachData && classifyAttach(res.attachData);\n    }\n  })\n  .finally($ionicLoading.hide);\n})\n\n","// ------------ directive\n/**\n * @ngdoc overview\n * @name workflow.directives\n * @description\n *   工作流指令集\n */\nangular.module('workflow.directives', [])\n\n.directive('icErrorTip', function() {\n  return {\n    restrict: 'E',\n    template: \n      '<div ng-if=\"error.notempty\" class=\"assertive fss\">“{{ title }}”不能为空</div>' +\n      '<div ng-if=\"error.chinese\" class=\"assertive fss\">“{{ title }}”只能为中文</div>' +\n      '<div ng-if=\"error.letter\" class=\"assertive fss\">“{{ title }}”只能为英文</div>' +\n      '<div ng-if=\"error.num\" class=\"assertive fss\">“{{ title }}”只能为数字</div>' +\n      '<div ng-if=\"error.idcard\" class=\"assertive fss\">“{{ title }}”只能为身份证</div>' +\n      '<div ng-if=\"error.mobile\" class=\"assertive fss\">“{{ title }}”只能为手机号码</div>' +\n      '<div ng-if=\"error.money\" class=\"assertive fss\">“{{ title }}”只能为金额</div>' +\n      '<div ng-if=\"error.tel\" class=\"assertive fss\">“{{ title }}”只能为电话号码</div>' +\n      '<div ng-if=\"error.zipcode\" class=\"assertive fss\">“{{ title }}”只能为邮政编码</div>' +\n      '<div ng-if=\"error.email\" class=\"assertive fss\">“{{ title }}”只能为Email</div>',\n    scope: {\n      error: '=',\n      title: '='\n    }\n  }\n})\n\n.controller('icCtrl', function($scope, icPatternByTypeFilter) {\n\n  $scope.addPattern = function($ngModelCtrl, patternType) {\n    function icPatternValidator(value) {\n      var reg;\n      var validaty = true;\n\n      // 如果设置了验证规则\n      if (patternType) {\n        if (!value) {\n          validaty = false;\n        } else {\n          reg = new RegExp(icPatternByTypeFilter(patternType));\n          validaty = reg.test(value);\n        }\n      }\n\n      $ngModelCtrl.$setValidity(patternType, validaty);\n      return validaty ? value : undefined;\n    }\n\n    if($ngModelCtrl) {\n      //For DOM -> model validation\n      $ngModelCtrl.$parsers.unshift(icPatternValidator);\n      //For model -> DOM validation\n      $ngModelCtrl.$formatters.unshift(icPatternValidator);\n\n      $scope.$error = $ngModelCtrl.$error;\n    }\n  }\n\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:ic\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单控件指令\n *  目前 OA 支持工作流控件有以下类型：（目前移动端不支持列表控件、签章控件、进度条控件、图片上传控件、二维码控件）\n *  - 标签文本     label  \n *  - 单行输入框   text   \n *  - 多行输入框   textarea   \n *  - 下拉菜单     select   \n *  - 单选框       radio \n *  - 复选框       checkbox \n *  - 部门人员控件 user \n *  - 日历控件     data \n *  - 宏控件       auto \n *  - 计算控件     calc \n *  - 列表控件     listview\n *  - 签章控件     sign\n *  - 进度条控件   progressbar\n *  - 图片上传控件 imgupload\n *  - 文件上传控件 fileupload\n *  - 二维码控件   qrcode\n *\n *  控件通用字段说明：\n *  data-id:      控件 ID\n *  data-type:    控件类型\n *  data-title:   控件名（除标签外）\n *  data-value:   控件默认值\n *  origin-value: 控件保存的值\n *  各控件字段会有差别，具体看控件相关说明\n */\n.directive('ic', function ($parse, $rootScope, $location, $compile, icPatternByTypeFilter, icFactory) {\n  \n  $rootScope.icModelCtrls = {}\n\n  return {\n    restrict: 'E',\n\n    require: '?ngModel',\n\n    controller: 'icCtrl',\n\n    template: '<ic-error-tip error=\"$error\" title=\"ic[\\'data-title\\']\"></ic-error-tip>',\n\n    compile: function(element, attr) {\n      var absUrl = $location.absUrl()\n      var icModelCtrls\n      \n      if(!$rootScope.icModelCtrls[absUrl]) {\n        $rootScope.icModelCtrls[absUrl] = {}\n      }\n      \n      icModelCtrls = $rootScope.icModelCtrls[absUrl]\n    \n      return function($scope, $element, $attrs, $ngModelCtrl) {\n        var ic = $scope.ic = $parse(attr.data)($scope) || {};\n        var ics = $parse(attr.ics)($scope) || [];\n\n        $scope.getIc = function(icId) {\n          return ics.filter(function(_ic) {\n            return _ic['data-id'] == icId;\n          })[0];\n        };\n\n        $scope.setValue = function(icId, value) {\n          if (icModelCtrls[icId]) {\n            icModelCtrls[icId].$setViewValue(value);\n          }\n        }\n\n        $scope.getValue = function(icId) {\n          // 如果是可写字段，则直接返回 model 的值\n          if (icModelCtrls[icId]) {\n            return icModelCtrls[icId].$viewValue;\n          } else {\n            var _ic = $scope.getIc(icId);\n            return _ic ? _ic['origin-value'] : '';\n          }\n          return '';\n        };\n\n        if($ngModelCtrl) {\n          icModelCtrls[ic['data-id']] = $ngModelCtrl;\n          \n          // @NOTE 自定义表单 后端返回了 data-value 且为空字符串\n          // 进入ionic.bundle.js $watch方法 判断为false 所以需自定义undefined\n          \n          if (ic['data-type'] !== 'date') {\n            $ngModelCtrl.$setViewValue(ic['origin-value'] || ic['data-value'] || undefined);\n          }            \n\n          $scope.addPattern($ngModelCtrl, $attrs.patternType)\n        }\n\n        var template = icFactory.parse(ic, $attrs.ngModel, $scope);\n        var $content = $compile(template)($scope);\n\n        $element.addClass('wfic wfic-' + ic['data-type']);\n        $element.prepend($content);\n      };\n    }\n  };\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icLabel\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单标签控件\n * \n * @param  {expression}  data  控件数据\n */\n.directive('icLabel', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      data: '='\n    },\n    template: '<span ng-style=\"getStyle()\">{{ data[\"data-text\"]  }}</span>',\n    link: function($scope) {\n      $scope.getStyle = function() {\n        var ic = $scope.data\n        return {\n          'text-align': ic['data-align'],\n          'font-weight': ic['data-bold'] == 1 ? '700' : '400',\n          'font-size': ic['data-font-size'],\n          'font-style': ic['data-italic'] == 1 ? 'italic' : 'normal',\n          'text-decoration': ic['data-underline'] == 1 ? 'underline' : 'normal',\n          'color': ic['data-color']\n        }\n      }\n    }\n  }\n})\n\n.constant('ROW_SPLITTER', /\\n/g)\n\n.constant('COL_SPLITTER', '`')\n\n.constant('VAL_SPLITTER', ',')\n\n.controller('icListViewCtrl', function($scope, $timeout, $ionicScrollDelegate, ROW_SPLITTER, COL_SPLITTER, VAL_SPLITTER) {\n  var split = $scope.split = function(raw, splitter) {\n    if(angular.isString(raw)) {\n      return raw.split(splitter)\n    }\n    return []\n  }\n\n  // 以换行符分隔行，以`分隔列\n  var splitRaws = $scope.splitRaws = function(raw) {\n    var ret = []\n\n    if(angular.isString(raw)) {\n      var rawRows = $scope.split(raw, ROW_SPLITTER)\n      angular.forEach(rawRows, function(rawRow) {\n        if(rawRow) {\n          ret.push($scope.split(rawRow, COL_SPLITTER))\n        }\n      })\n    }\n\n    return ret\n  }\n\n  $scope.rows = []\n\n  // 拆分列配置\n  $scope.lvTitles = split($scope.data['data-lv-title'], COL_SPLITTER)\n  $scope.lvColtypes = split($scope.data['data-lv-coltype'], COL_SPLITTER)\n  $scope.lvColvalues = split($scope.data['data-lv-colvalue'], COL_SPLITTER)\n  $scope.lvSums = split($scope.data['data-lv-sum'], COL_SPLITTER)\n\n  Array.prototype.push.apply($scope.rows, splitRaws($scope.data['origin-value']))\n\n  $scope.scrollDeletage = $ionicScrollDelegate.$getByHandle('ic-listview-' + $scope.data['data-title'])\n\n  $timeout(function() {\n    var sv = $scope.scrollDeletage.getScrollView();\n    var container = sv.__container;\n\n    container.removeEventListener('touchstart', sv.touchStart);\n    container.removeEventListener('mousedown', sv.mouseDown);\n    document.removeEventListener('touchmove', sv.touchMove);\n    document.removeEventListener('mousemove', sv.mouseMove);\n\n    angular.forEach(\n      [\n        'touchStart',\n        'mouseDown',\n        'touchMove',\n        'mouseMove'\n      ],\n      function(eventName) {\n        var originalHandler = sv[eventName]\n        sv[eventName] = function(e) {\n          e.preventDefault = angular.noop\n          originalHandler && originalHandler.call(sv, e)\n        }\n      }\n    )\n\n    container.addEventListener(\"touchstart\", sv.touchStart, false);\n    container.addEventListener(\"mousedown\", sv.mouseDown, false);\n    document.addEventListener(\"touchmove\", sv.touchMove, false);\n    document.addEventListener(\"mousemove\", sv.mouseMove, false);\n  });\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListview\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单列表控件\n *  `data-lv-coltype`    列控件类型，多列间以 ` 分隔\n *  `data-lv-colvalue`   列值，多列间以 ` 分隔\n *  `data-lv-sum`        是否合计，1 为是，0为否，多列间以 ` 分隔\n *  `data-lv-title`      列标题，多列间以 ` 分隔\n * @param  {expression}  data  控件数据\n */\n  .directive('icListview', function ($ionicModal, $rootScope, $location, COL_SPLITTER, VAL_SPLITTER) {\n\n  return {\n    restrict: 'E',\n    replace: true,\n    require: 'ngModel',\n    controller: 'icListViewCtrl',\n    scope: {\n      data: '='\n    },\n    templateUrl: 'templates/workflow/ic-listview.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var icModelCtrls = $rootScope.icModelCtrls[$location.absUrl()]\n      if (icModelCtrls) {\n        icModelCtrls[$scope.data['data-id']] = $ngModelCtrl\n      }\n      $scope.modal = null\n      $scope.edittingRow = {}\n      // edittingRowIndex === -1 => 添加\n      // edittingRowIndex > -1 => 编辑某一行\n      $scope.edittingRowIndex = -1 \n\n      $ionicModal.fromTemplateUrl('templates/workflow/ic-listview-modal.html', {\n        scope: $scope\n      })\n      .then(function(modal) {\n        $scope.modal = modal\n      })\n\n      // 将多行的数据组合为字符串返回\n      $scope.joinRows = function(rows) {\n        return rows.map(function(row) {\n          return row.join(COL_SPLITTER)\n        }).join('\\n')\n      }\n\n      // 获取下拉选框类型的选项\n      $scope.splitValue = function(colIndex) {\n        return $scope.split($scope.lvColvalues[colIndex], VAL_SPLITTER)\n      }\n\n      // 添加一行\n      $scope.addRow = function() {\n        $scope.edittingRow = getRowDefalutValue()\n        $scope.edittingRowIndex = -1\n        $scope.modal && $scope.modal.show()\n      }\n\n      $scope.editRow = function(index) {\n        $scope.edittingRow = angular.copy($scope.rows[index])\n        $scope.edittingRowIndex = index\n        $scope.modal && $scope.modal.show()\n      }\n\n      // 移除一行\n      $scope.removeRow = function() {\n        $scope.rows.splice($scope.edittingRowIndex, 1)\n        // 没有行时重置回最左边\n        if(!$scope.rows.length) {\n          $scope.scrollDeletage.scrollTop(true)\n        }\n        $scope.modal && $scope.modal.hide()\n      }\n\n      $scope.save = function() {\n        $scope.modal && $scope.modal.hide()\n\n        if($scope.edittingRowIndex === -1) {\n          $scope.rows.push($scope.edittingRow)\n        } else {\n          $scope.rows.splice($scope.edittingRowIndex, 1, $scope.edittingRow)\n        }\n      \n        $scope.edittingRow = {}\n        $scope.edittingRowIndex = -1\n      }\n\n      function getDefaultValue(colIndex) {\n        var colType = $scope.lvColtypes[colIndex]\n        var colValue = $scope.lvColvalues[colIndex]\n\n        // 下拉选框、单选框转默认第一个\n        if(['select', 'radio'].indexOf(colType) !== -1) {\n          return colValue.split(VAL_SPLITTER)[0] || ''\n        } else if(['text', 'textarea', 'date'].indexOf(colType) !== -1) {\n          return colValue\n        } \n        return ''\n      }\n\n      function getRowDefalutValue() {\n        return $scope.lvColvalues.map(function(colValue, colIndex) {\n          return getDefaultValue(colIndex)\n        })\n      }\n\n      function updateViewValue(rows) {\n        var viewValue = ''\n\n        if(angular.isArray(rows) && rows.length) {\n          viewValue = $scope.joinRows(rows)\n        }\n\n        $ngModelCtrl.$setViewValue(viewValue)\n        $ngModelCtrl.$render()\n      }\n\n      $scope.$watch('rows', updateViewValue, true)\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListviewView\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单列表控件查看\n\n * @param  {expression}  data  控件数据\n */\n.directive('icListviewView', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    transclude: true,\n    controller: 'icListViewCtrl',\n    scope: {\n      data: '=',\n      onRowClick: '='\n    },\n    templateUrl: 'templates/workflow/ic-listview-view.html',\n    link: angular.noop\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListviewCalc\n * @element  ANY\n * @restrict A\n * @description\n *  工作流表单列表控件 - 计算类型\n *  \n * @param  {expression}  exp             计算公式\n * @param  {expression}  rowData         行数据\n */\n.directive('icListviewCalc', function() {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    replace: true,\n    template: '<input type=\"hidden\" />',\n    scope: {\n      exp: '=',\n      rowData: '='\n    },\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var reg = /[\\d+]/g\n\n      $scope.__parseInt = function(str) {\n        return parseInt(str, 10)\n      }\n      if(angular.isString($scope.exp)) {\n        var watchExp = $scope.exp.replace(/\\[(\\d+)\\]/g, function(match, num) {\n          // 下标=序号-1\n          return '__parseInt(rowData[' + (num - 1) + '])'\n        })\n\n        $scope.$watch(watchExp, function(val) {\n          if(angular.isUndefined(val)) {\n            val = watchExp\n          } else if(isNaN(val)) {\n            val = 0\n          }\n\n          $ngModelCtrl.$setViewValue(val)\n          $ngModelCtrl.$render()\n        })\n      } else {\n        throw new Error('列表控件计算公式出错')\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icListviewCalc\n * @element  ANY\n * @restrict A\n * @description\n *  工作流表单列表控件 - 复选框组\n *  \n * @param  {expression}  list            可选值列表  \n */\n.directive('icListviewCheckbox', function(VAL_SPLITTER) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    template: \n      '<label ng-repeat=\"item in list\" class=\"checkbox\"> ' +\n        '<input type=\"checkbox\" ng-model=\"item.checked\" ng-change=\"updateViewValue()\"> ' +\n        '{{ item.value }}' +\n      '</label>',\n    scope: {\n      values: '='\n    },\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      $scope.list = []\n\n      $scope.$watch('values', function(values) {\n        var viewValue = $ngModelCtrl.$viewValue\n        var checkedArr = angular.isString(viewValue) ? viewValue.split(VAL_SPLITTER) : []\n\n        values = values || ''\n\n        $scope.list = values.split(VAL_SPLITTER).map(function(val) {\n          return {\n            value: val,\n            checked: checkedArr.indexOf(val) !== -1\n          }\n        })\n      })\n\n      $scope.updateViewValue = function() {\n        var newValue = $scope.list.filter(function(item) {\n          return item.checked\n        }).map(function(item) {\n          return item.value\n        }).join(VAL_SPLITTER)\n\n        $ngModelCtrl.$setViewValue(newValue)\n      }\n    }\n  }\n})\n\n\n/**\n * @ngdoc controller\n * @name  workflow.directives.controller:IcImguploadCtrl\n * @description\n *   图片上传控件相关控制器\n */\n.controller('IcImguploadCtrl', function($scope, $window, attrFromTemplateFilter) {\n  // 图片最大宽适配节点宽度\n  $scope.setSizeAdjustWidth = function(parentElem) {\n    var dataWidth = $scope.data['data-width']\n    var dataHeight = $scope.data['data-height']\n    var clientWidth = parentElem.clientWidth\n\n    if(dataWidth && dataHeight) {\n      if(dataWidth > clientWidth) {\n        $scope.width = clientWidth\n        $scope.height = dataHeight / dataWidth * clientWidth\n      } else {\n        $scope.width = dataWidth\n        $scope.height = dataHeight\n      }\n    }\n  }\n\n  $scope.initAutoSizeAdjust = function(parentElem) {\n    $scope.setSizeAdjustWidth(parentElem)\n    $window.addEventListener('resize', function() {\n      $scope.setSizeAdjustWidth(parentElem)\n      $scope.$applyAsync()\n    }, false)\n  }\n\n  $scope.hasSrc = function() {\n    return $scope.localSrc || $scope.originSrc\n  }\n\n  try {\n    $scope.originSrc = attrFromTemplateFilter($scope.data.value, 'data-src')\n  } catch(e) {\n    $scope.originSrc = ''\n    console.error('ic-imgupload: 获取原始图片地址失败')\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icImgupload\n * @element  ANY\n * @restrict E\n * @todo 验证规则未实现\n * @description\n *  工作流表单图片上传控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icImgupload', function(Utils) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: {\n      data: '='\n    },\n    controller: 'IcImguploadCtrl',\n    replace: true,\n    templateUrl: 'templates/workflow/ic-imgupload.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      // 初始值设置为空文件对象\n      // 此处由于后端在做判断时，如果没有拿到文件对象会将字段清空，而导致没有编辑图片直接保存时\n      // 图片会被删除\n      // @Todo: 讨论现在这种处理方式是否不妥\n      $ngModelCtrl.$setViewValue(new File([], ''))\n\n      $scope.updateFile = function(e) {\n        var file = e.target.files[0]\n        if(file) {\n          $ngModelCtrl.$setViewValue(file)\n          Utils.getImagePreviewUrl(file, function(src) {\n            $scope.localSrc = src\n            $scope.$applyAsync()\n          })\n        }\n      }\n\n      $scope.initAutoSizeAdjust($element[0])\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icImguploadView\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单图片上传控件预览\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icImguploadView', function() {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '='\n    },\n    controller: 'IcImguploadCtrl',\n    replace: true,\n    templateUrl: 'templates/workflow/ic-imgupload-view.html',\n    link: function($scope, $element, $attr) {\n      $scope.initAutoSizeAdjust($element[0])\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icFileupload\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单文件上传控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icFileupload', function($window, FileUtils, fullUrlFilter) {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    controller: 'icCtrl',\n    scope: {\n      data: '=',\n      name: '='\n    },\n    replace: true,\n    templateUrl: 'templates/workflow/ic-fileupload.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      if($scope.data['origin-value'] && $scope.data.value) {\n        var dataset = angular.element($scope.data.value)[0].dataset\n        $scope.file = angular.extend({}, dataset)\n      }\n      $scope.selectFile = function(e) {\n        var file = e.target.files[0]\n        if(file) {\n          $ngModelCtrl.$setViewValue(file)\n          $scope.file = {\n            iseditable: '1',\n            read: '1',\n            name: file.name,\n            type: FileUtils.getExtname(file.name),\n            src: '',\n            value: ''\n          }\n          // 事件监听value值, 需在上传成功后清空, 防止删除后重新上传相同文件失败\n          e.target.value = ''\n          $ngModelCtrl.$setValidity('notempty', true)\n          $scope.$applyAsync()\n        }\n      }\n\n      $scope.removeFile = function() {\n        delete $scope.file\n        $ngModelCtrl.$setViewValue(null)\n        if ($attr.patternType == 'notempty') {\n            $ngModelCtrl.$error.notempty = true\n            $scope.addPattern($ngModelCtrl, $attr.patternType)\n        }\n      }\n\n      $scope.download = function() {\n        $window.location.href = fullUrlFilter($scope.file.src)\n      }\n\n      // 文件名为空，不能算有了吧\n      if ($scope.hasOwnProperty('file') && $scope.file.name == '') {\n          delete $scope.file\n      }\n\n      // 上传控件没必要去检查其他，检查为空就好了\n      if ($attr.patternType == 'notempty' && $scope.hasOwnProperty('file') && $scope.file.src != undefined && $scope.file.src != '') {\n        $ngModelCtrl.$setValidity('notempty', true)\n        $scope.$applyAsync()\n      } else {\n        $scope.addPattern($ngModelCtrl, $attr.patternType)\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icFileuploadView\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单图片上传控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icFileuploadView', function($window, FileUtils, fullUrlFilter) {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '='\n    },\n    replace: true,\n    templateUrl: 'templates/workflow/ic-fileupload-view.html',\n    link: function($scope, $element, $attr) {\n      if($scope.data['origin-value'] && $scope.data.value) {\n        var dataset = angular.element($scope.data.value)[0].dataset\n        $scope.file = angular.extend({}, dataset)\n      }\n\n      $scope.download = function() {\n        $window.location.href = fullUrlFilter($scope.file.src)\n      }\n    }\n  }\n})\n\n.directive('icFileuploadHidden', function() {\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    scope: {\n      data: '=',\n      file: '=',\n      name: '=',\n      value: '=ngModel'\n    },\n    replace: true,\n    template: '<div><input type=\"hidden\" value=\"{{ value }}\" name=\"{{ name }}\"/></div>',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      $scope.$watch(function() {\n        return $scope.data['origin-value']\n      }, function(val) {\n        $ngModelCtrl.$setViewValue(val)\n      })\n\n      $scope.$watch('file', function(file) {\n        if(file) {\n          $ngModelCtrl.$setViewValue(file.name)\n        } else if(file === null) {\n          $ngModelCtrl.$setViewValue('')\n        }\n      })\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icSign\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单签章手写控件\n *  \n * @param  {expression}  data            控件数据\n */\n.directive('icSign', function($q, $window, $ionicModal, $ionicLoading, IbPopup, CommonApi) {\n  var cid = 0\n\n  // 获取图片有效区域\n  function getDrawImageRect(cvs, rgba/* rgba a=a*255 */) { \n    var rgba = rgba || [0, 0, 0, 0]\n    var data = cvs.getContext('2d').getImageData(0, 0, cvs.width, cvs.height).data\n\n    var offsetLeft\n    var offsetRight\n    var offsetTop\n    var offsetBottom\n\n    for(var x = 0; x < cvs.width; x++) {\n      for(var y = 0; y < cvs.height; y++) {\n        var index = (cvs.width * y + x) * 4,\n            cr = data[index],\n            cg = data[index + 1]\n            cb = data[index + 2]\n            ca = data[index + 3]\n\n        if(rgba[0] !== cr || rgba[1] !== cg || rgba[2] !== cb || rgba[3] !== ca) {\n          if(typeof offsetLeft === 'undefined') {\n            offsetLeft = offsetRight = x\n            offsetTop = offsetBottom = y\n          } else {\n            offsetLeft = Math.min(x, offsetLeft)\n            offsetRight = Math.max(x, offsetRight)\n            offsetTop = Math.min(y, offsetTop)\n            offsetBottom = Math.max(y, offsetBottom)\n          }\n        }\n      }\n    }\n\n    return {\n      offsetLeft: offsetLeft,\n      offsetRight: offsetRight,\n      offsetTop: offsetTop,\n      offsetBottom: offsetBottom,\n      // 由于 offset 是下标，实现计算像素数时要 +1\n      width: offsetRight - offsetLeft + 1,\n      height: offsetBottom - offsetTop + 1\n    }\n  }\n\n  function getDataURI(id) {\n    var cvs = document.getElementById(id)\n    var PADDING = 10\n    var dataURL = ''\n\n    if(cvs) {\n      var rect = getDrawImageRect(cvs, [255, 255, 255, 255])\n      var tempCvs = document.createElement('canvas')\n      var tempCtx = tempCvs.getContext('2d')\n\n      tempCvs.width = rect.width + PADDING * 2\n      tempCvs.height = rect.height + PADDING * 2\n      tempCtx.drawImage(cvs, rect.offsetLeft, rect.offsetTop, rect.width, rect.height, PADDING, PADDING, rect.width, rect.height)\n      \n      dataURL = tempCvs.toDataURL()\n      tempCvs = tempCtx = null\n    }\n    return dataURL\n  }\n\n  return {\n    restrict: 'E',\n    require: 'ngModel',\n    controller: 'icCtrl',\n    scope: {\n      data: '=',\n      src: '=ngModel',\n      patternType: '@'\n    },\n    replace: true,\n    templateUrl: 'templates/workflow/ic-sign.html',\n    link: function($scope, $element, $attr, $ngModelCtrl) {\n      var customCanvasId = 'icSignCanvas' + cid++\n\n      // 全屏显示，所以用 window.innerWidth 及 innerHeight\n\n      $scope.pwCanvas = {\n        options: {\n          undo: true,\n          width: $window.innerWidth,\n          height: $window.innerHeight,\n          lineWidth: 5,\n          color: $scope.data['data-sign-color'] || '#000',\n          customCanvasId: customCanvasId\n        },\n        version: 0\n      }\n\n      $ionicModal.fromTemplateUrl('templates/workflow/ic-sign-modal.html', {\n        scope: $scope\n      })\n      .then(function(modal) {\n        $scope.modal = modal\n        $scope.modal.hideDelay = true\n      })\n\n      // 重置\n      $scope.reset = function() {\n        // 当版本为 0 时，此方法相当于取消功能，直接关闭窗口\n        if($scope.pwCanvas.version === 0) {\n          $scope.modal.hide()\n        } else {\n          $scope.pwCanvas.version = 0\n        }\n      }\n\n      // 完成\n      $scope.done = function() {\n        if($scope.pwCanvas.version !== 0) {\n          var dataURI = getDataURI(customCanvasId)\n          $ionicLoading.show()\n          CommonApi.uploadBase64Img(dataURI)\n          .success(function(res) {\n            if(res.isSuccess) {\n              $ngModelCtrl.$setViewValue(res.host + res.data)\n              $ngModelCtrl.$render()\n              $scope.modal.hide()\n            } else {\n              IbPopup.tip('手写签名保存失败，请重试')\n            }\n          })\n          .error(function() {\n            IbPopup.tip('手写签名保存失败，请重试')\n          })\n          .finally(function() {\n            $ionicLoading.hide()\n            $scope.reset()\n          })\n        } else {\n          $scope.modal.hide()\n        }\n      }\n\n      $scope.remove = function() {\n        $ngModelCtrl.$setViewValue('')\n        $ngModelCtrl.$render()\n      }\n\n      $scope.addPattern($ngModelCtrl, $attr.patternType)\n\n      if($scope.data['origin-value']) {\n        $ngModelCtrl.$setViewValue($scope.data['origin-value'])\n      }\n\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:icScript\n * @element  ANY\n * @restrict E\n * @description\n *  工作流表单自定义脚本执行\n *  \n * @param  {expression}  data            自定义脚本\n */\n.directive('icScript', function($document, IbPopup) {\n  return {\n    restrict: 'E',\n    scope: {\n      data: '='\n    },\n    link: function($scope) {\n      var document = $document[0]\n      var hasExec = false\n\n      $scope.$watch('data', function(data) {\n        if(data && !hasExec) {\n          try {\n            var script = document.createElement('script')\n            script.innerHTML = $scope.data\n            document.body.appendChild(script)\n          } catch(e) {\n            IbPopup.tip('自定义脚本执行出错')\n          }\n          hasExec = true\n        }\n      })\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:wfProcess\n * @element  ANY\n * @restrict E\n * @description\n *  工作流步骤列表\n *  \n * @param  {expression}  process         步骤数据\n */\n.directive('wfProcess', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      process: '='\n    },\n    templateUrl: 'templates/workflow/wf-process.html'\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:wfIcValueFields\n * @element  ANY\n * @restrict E\n * @description\n *  工作流有值字段显示\n *  \n * @param  {expression}  fields         工作流表单控件组\n * @param  {expression}  hidden         保密字段\n */\n.directive('wfIcValueFields', function() {\n  return {\n    restrict: 'E',\n    replace: true,\n    scope: {\n      fields: '=',\n      hiddenField: '='\n    },\n    templateUrl: 'templates/workflow/wf-ic-value-fields.html',\n    link: function($scope) {\n      // 判断是否保密字段\n      $scope.isHidden = function(item) {\n        if(angular.isString($scope.hiddenField) && $scope.hiddenField) {\n          return $scope.hiddenField.split(',').indexOf(item['data-id']) !== -1;\n        }\n        return false;\n      }\n    }\n  }\n})\n\n/**\n * @ngdoc directive\n * @name workflow.directives.directive:wfIcEmptyFields\n * @element  ANY\n * @restrict E\n * @description\n *  工作流空值字段显示\n *  \n * @param  {expression}  fields         工作流表单控件组\n * @param  {expression}  hidden         保密字段\n */\n.directive('wfIcEmptyFields', function($ionicScrollDelegate) {\n  return {\n    restrict: 'E',\n    // replace: true,\n    scope: {\n      fields: '='\n    },\n    templateUrl: 'templates/workflow/wf-ic-empty-fields.html',\n    link: function($scope) {\n      $scope.emptyFieldShown = false\n      $scope.toggleFieldShown = function() {\n        $scope.emptyFieldShown = !$scope.emptyFieldShown\n        $ionicScrollDelegate.resize()\n      }\n    }\n  }\n});\n\n//@Note:\n// issue: https://forum.ionicframework.com/t/when-using-horizontal-scroll-ion-scroll-page-cant-be-scrolled-down-in-y-direction/3833/22?u=andmar8\n// from: https://codepen.io/rajeshwarpatlolla/pen/xGWBja\n// -> https://github.com/ionic-team/ionic/pull/2606\n(function() {\n  var HorizontalScrollFix = (function() {\n    function HorizontalScrollFix($timeout, $ionicScrollDelegate) {\n      return {\n        restrict: 'A',\n        link: function(scope, element, attrs) {\n          var mainScrollID = attrs.horizontalScrollFix,\n              scrollID = attrs.delegateHandle;\n          \n          var getEventTouches = function(e) {\n            return e.touches && (e.touches.length ? e.touches : [\n              {\n                pageX: e.pageX,\n                pageY: e.pageY\n              }\n            ]);\n          };\n          \n          var fixHorizontalAndVerticalScroll = function() {\n            var mainScroll, scroll;\n            mainScroll = $ionicScrollDelegate.$getByHandle(mainScrollID).getScrollView();\n            scroll = $ionicScrollDelegate.$getByHandle(scrollID).getScrollView();\n            \n            // patch touchstart\n            scroll.__container.removeEventListener('touchstart', scroll.touchStart);\n            scroll.touchStart = function(e) {\n              var startY;\n              scroll.startCoordinates = ionic.tap.pointerCoord(e);\n              if (ionic.tap.ignoreScrollStart(e)) {\n                return;\n              }\n              scroll.__isDown = true;\n              if (ionic.tap.containsOrIsTextInput(e.target) || e.target.tagName === 'SELECT') {\n                scroll.__hasStarted = false;\n                return;\n              }\n              scroll.__isSelectable = true;\n              scroll.__enableScrollY = true;\n              scroll.__hasStarted = true;\n              scroll.doTouchStart(getEventTouches(e), e.timeStamp);\n              startY = mainScroll.__scrollTop;\n              \n              // below is our changes to this method\n              // e.preventDefault();\n             \n              // lock main scroll if scrolling horizontal\n              $timeout((function() {\n                var animate, yMovement;\n                yMovement = startY - mainScroll.__scrollTop;\n                if (scroll.__isDragging && yMovement < 2.0 && yMovement > -2.0) {\n                  mainScroll.__isTracking = false;\n                  mainScroll.doTouchEnd();\n                  animate = false;\n                  return mainScroll.scrollTo(0, startY, animate);\n                } else {\n                  return scroll.doTouchEnd();\n                }\n              }), 100);\n            };\n            scroll.__container.addEventListener('touchstart', scroll.touchStart);\n          };\n          $timeout(function() { fixHorizontalAndVerticalScroll(); });          \n        }\n      };\n    }\n\n    return HorizontalScrollFix;\n\n  })();\n\n  angular.module('workflow.directives')\n  .directive('horizontalScrollFix', ['$timeout', '$ionicScrollDelegate', HorizontalScrollFix]);\n\n}).call(this);\n","/**\n * @ngdoc overview\n * @name  workflow.filters\n * @description\n *   工作流模块过滤器\n */\n\nangular.module('workflow.filters', [])\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfStatus\n * @function\n * @description\n *  将工作流进行状态标识转化为对应中文\n *\n * @param   {string}  val   控件原始值\n * @param   {object}  item  控件源数据\n * @returns {string}  修正后的控件值\n */\n\n.filter('wfStatus', function() {\n  var flagMap = {\n    1: '未接收',\n    2: '办理中',\n    3: '转交下一步，下一步经办人无人接收',\n    5: '自由流程预设步骤',\n    4: '已办结',\n    6: '已挂起'\n  };\n\n  return function(flag) {\n    return flagMap[+flag] || '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfic\n * @function\n * @description\n *  修正表单控件的显示值\n *\n * @param   {string}  val   控件原始值\n * @param   {object}  item  控件源数据\n * @returns {string}  修正后的控件值\n */\n.filter('wfic', function(userInfoFilter, departmentInfoFilter, positionInfoFilter, User) {\n\n  var filters = {\n    'user': function(item) {\n      var val = item['origin-value']\n      switch(item['data-select-type']) {\n        case 'department':\n          return departmentInfoFilter(User.removeDepartmentPrefix(val), 'deptname');\n\n        case 'position':\n          return positionInfoFilter(User.removePositionPrefix(val), 'posname');\n\n        default:\n          return userInfoFilter(User.removePrefix(val), 'realname');\n      }\n    }\n  };\n\n  return function(item) {\n    var dataType = item['data-type']\n    return filters[dataType] ? \n      filters[dataType].call(null, item) :\n      item['origin-value'];\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:attrFromTemplate\n * @function\n * @description\n *  从 html 元素模板中获取属性值\n *\n * @param   {object}  flowItem     控件源数据\n * @param   {string}  checkItem   原始验证规则\n * @returns {string}  转换后的验证规则\n */\n.filter('attrFromTemplate', function() {\n\n  return function(template, attr) {\n    var $elem;\n    if(template) {\n      $elem = angular.element(template);\n      if($elem.length && attr) {\n        return $elem.attr(attr) || '';\n      }\n    }\n    return '';\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:icPattern\n * @function\n * @description\n *  返回表单控件的规则类型\n *\n * @param   {string}  icTitle     控件名称\n * @param   {string}  checkItem   原始验证规则\n * @returns {string}  规则类型\n */\n.filter('icPatternType', function() {\n  // 验证字段为如“字段1=type1,字段2=type2”这种格式的字符串\n  // 此方法用于将字符串解析成 key-value 的结构\n  function getCheckItemMap(str) {\n    var ret = {};\n\n    str.split(',').forEach(function(exp) {\n      var parts = exp.split('=');\n      ret[parts[0]] = parts[1];\n    });\n\n    return ret;\n  }\n\n  return function(icTitle, checkItem) {\n    var type = '';\n    var checkItemMap;\n\n    if(icTitle && checkItem) {\n      checkItemMap = getCheckItemMap(checkItem);\n      type = checkItemMap[icTitle] || ''\n    }\n\n    return type;\n  }\n})\n\n.filter('icPatternByType', function(icPatternTypeFilter, REGEXP_ENUM) {\n\n  return function(type) {\n    return REGEXP_ENUM[type] || '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:icPattern\n * @function\n * @description\n *  返回表单控件的具体验证规则\n *\n * @param   {object}  icTitle     控件名称\n * @param   {string}  checkItem   原始验证规则\n * @returns {string}  验证规则，Regex 字符串\n */\n.filter('icPattern', function(icPatternTypeFilter, REGEXP_ENUM) {\n\n  return function(icTitle, checkItem) {\n    return REGEXP_ENUM[icPatternTypeFilter(icTitle, checkItem)] || '';\n  };\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfFilenameFormat\n * @function\n * @description\n *  上传文件文件名显示格式为 【前14个字】...【后4个字】.【后缀名】\n * @param  {string}  str  文件名\n * @return {string}  处理后的文件名\n */\n.filter('wfFilenameFormat', function() {\n  // 解析html实体编号\n  var htmlDecode = function(str) {\n    return str.replace(/&#(x)?([^&]{1,5});?/g,function($,$1,$2) {\n      return String.fromCharCode(parseInt($2 , $1 ? 16:10));\n    });\n  }\n  return function(str) {\n    // 文件名后缀\n    var strArr = htmlDecode(str).split('.');\n    var ext = '.' + strArr.pop();\n    var filenameWithoutExt = strArr.join('.');\n    if (filenameWithoutExt.length > 18) {\n      return filenameWithoutExt.slice(0, 14) + '...' + filenameWithoutExt.slice(-4) + ext;\n    }\n    return str;\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:wfIsSponsor\n * @function\n * @description\n *  当前用户是否为流程主办人\n * @param  {object}  flow  流程数据\n * @return {boolean} 是否\n */\n.filter('wfIsSponsor', function() {\n  return function(flow) {\n    return flow && flow.rp && flow.rp.opflag == '1'\n  }\n})\n\n/**\n * @ngdoc filter\n * @name workflow.filters.filter:sumArrayBy\n * @function\n * @description\n *   合计多个数组里指定 index 的值\n *\n * @example\n *   {{ [[1, 2], [2, 3]] | sumArrayBy }} => 3\n *   {{ [[1, 2], [2, 3]] | sumArrayBy:1 }} => 5\n * @param  {array}   arrs       数组\n * @param  {number}  [index=0]  下标\n */\n.filter('sumArrayBy', function() {\n  return function(arrs, index) {\n    index = angular.isDefined(index) ? index : 0\n\n    var indexArr = arrs.map(function(arr) {\n      if(angular.isArray(arr) && angular.isDefined(arr)) {\n        return arr[index]\n      } else {\n        return 0\n      }\n    })\n\n    return indexArr.reduce(function(a, b) {\n      a = isNaN(+a) ? 0 : +a\n      b = isNaN(+b) ? 0 : +b\n      return a + b\n    }, 0)\n  }\n})","/**\n * @ngdoc overview\n * @name workflow.services\n * @description\n *   工作流模块服务\n */\nangular.module('workflow.services', [])\n\n/**\n * @ngdoc service\n * @name workflow.services.Flow\n * @description\n *   工作流通用服务\n */\n.factory('Flow', function($rootScope, $http, $ionicLoading, Utils, Settings, User, IbPopup) {\n  var moduleUrl = Settings.rootUrl + '/work';\n\n  var ret = {\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#create\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   新建工作流\n     *   res.isSuccess  {Boolean}\n     *   res.key        {String}\n     *\n     * @param       {String}   flowid    工作流程类型 id\n     * @returns     {Promise}\n     */\n    create: function(flowid) {\n      return $http.get(moduleUrl + '/add', {\n          params: {\n            flowid: flowid\n          }\n        })\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.create', flowid, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getFlow\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取工作流数据，包括表单数据、附件、会签、进度等信息\n     *\n     * @param       {String}   key     工作流 key\n     * @param       {Object}   param   额外参数\n     * @returns     {Promise}\n     */\n    getFlow: function(key, params) {\n      params = params || {};\n      params.key = key;\n      return $http.get(moduleUrl + '/form', {\n          params: params\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getProcess\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取流程列表及分类数据\n     *\n     * @returns     {Promise}\n     */\n    getProcess: function() {\n      return $http.get(moduleUrl + '/new')\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#saveFlow\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   保存工作流表单数据\n     *\n     * @param       {Object}   data   表单数据\n     * @returns     {Promise}\n     */\n    saveFlow: function(data) {\n      var formData = new FormData()\n      angular.forEach(data, function(value, key) {\n        formData.append(key, value)\n      })\n\n      return Utils.postFormData(moduleUrl + '/form', formData)\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.saveFlow', data, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getNext\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取转交所需的数据\n     *   params.key  {string}  流程 key\n     *   params.topflag  {string}  标识\n     * @param       {object}   params   参数\n     * @returns     {Promise}\n     */\n    getNext: function(params) {\n      return $http.get(moduleUrl + '/shownext', {\n          params: params\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#getFreeNext\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   获取自由流程转交所需的数据\n     *\n     * @param       {String}   key   流程 key\n     * @returns     {Promise}\n     */\n    getFreeNext: function(key) {\n      return $http.get(moduleUrl + '/freenext', {\n          params: {\n            key: key\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#rollback\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   回退工作流至上一步骤\n     *\n     * @param       {String}   key    流程 key\n     * @param       {Object}   data   参数\n     * @returns     {Promise}\n     */\n    rollback: function(key, data) {\n      return $http.post(moduleUrl + '/fallback&key=' + key, data)\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.rollback', key, data, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#takeback\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   在下一步骤被接收前，收回工作流\n     *\n     * @param       {String}   key    流程 key\n     * @returns     {Promise}\n     */\n    takeback: function(key) {\n      return $http.post(moduleUrl + '/takeback&key=' + key)\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.takeback', key, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#confirmTakeback\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   确认提示后收回工作流\n     *\n     * @param       {Object}   flow    流程数据\n     */\n    confirmTakeback: function(flow) {\n      var _this = this;\n\n      IbPopup.confirm({\n          title: '下一步骤尚未接收时可收回至本步骤重新办理，确认要收回吗？'\n        })\n        .then(function(res) {\n          if (res) {\n            $ionicLoading.show();\n            _this.takeback(flow.key)\n              .finally($ionicLoading.hide);\n          }\n        });\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#handover\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   转交工作流至下一步骤\n     *\n     * @param       {Object}   data    转交参数\n     * @returns     {Promise}\n     */\n    handover: function(data) {\n      return $http.post(moduleUrl + '/turnNextPost', data)\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.handover', data, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#handoverFree\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   转交自由流程至下一步骤\n     *\n     * @param       {Object}   data    转交参数\n     * @returns     {Promise}\n     */\n    handoverFree: function(data) {\n      return $http.post(moduleUrl + '/freenext', data)\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.handoverFree', data, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#signFlow\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   经办人会签（办理完毕）\n     *\n     * @param       {String}   key    流程 key\n     * @param       {Object}   data    会签参数\n     * @returns     {Promise}\n     */\n    signFlow: function(key, params) {\n      params = params || {};\n      params.key = key;\n      return $http.get(moduleUrl + '/complete', {\n          params: params\n        })\n        .success(function(res) {\n          $rootScope.$broadcast('workflow.signFlow', params, res);\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#remove\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   删除流程\n     *\n     * @param       {String}   id      工作流 id\n     * @returns     {Promise}\n     */\n    remove: function(id) {\n      return $http.post(moduleUrl + '/del', {\n          id: id\n        })\n        .success(function(res) {\n          if (res.isSuccess) {\n            $rootScope.$broadcast('workflow.remove', id, res);\n          }\n        })\n        .error(Settings.requestError);\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#confirmRemove\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   确认后删除流程\n     *\n     * @param       {String}   flow      工作流数据\n     * @returns     {Promise}\n     */\n    confirmRemove: function(flow) {\n      var _this = this;\n\n      IbPopup.confirm({\n          title: '确定要删除该工作吗？'\n        })\n        .then(function(res) {\n          if (res) {\n            // $ionicLoading.show();\n            _this.remove(flow.runid);\n            // .finally($ionicLoading.hide);\n          }\n        });\n    },\n\n  };\n\n  return ret;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowUtils\n * @description\n *   工作流通用工具函数\n */\n.factory('FlowUtils', function($timeout, $state, $ionicHistory, IbPopup) {\n  return {\n    /**\n     * @ngdoc     method\n     * @name      workflow.services.FlowUtils#goBackOrHome\n     * @methodOf  workflow.services.FlowUtils\n     * @description\n     *   如果有后退页，则后退，没有则回工作流首页\n     */\n    goBackOrHome: function() {\n      if ($ionicHistory.backView()) {\n        $ionicHistory.goBack();\n      } else {\n        $ionicHistory.nextViewOptions({\n          disableBack: true\n        });\n        $state.go('workflow.index');\n      }\n    },\n\n    /**\n     * @ngdoc       method\n     * @name        workflow.services.Flow#onHandoverSuccess\n     * @methodOf    workflow.services.Flow\n     * @description\n     *   转交成功后的回调\n     *\n     * @param       {Object}   res   转交成功后返回的数据\n     * @returns     {Promise}\n     */\n    onHandoverSuccess: function(res) {\n      if (res.isSuccess) {\n\n        var popup = IbPopup.alert({\n          title: '转交成功'\n        })\n\n        popup.then(function() {\n          $ionicHistory.clearCache(['workflow.todo', 'workflow.trans', 'workflow.done'])\n          $ionicHistory.nextViewOptions({\n            disableBack: true\n          });\n          var backViewStateId = $ionicHistory.backView().stateId\n          var currentViewStateId = $ionicHistory.currentView().stateId\n          $state.go('workflow.index').then(function() {\n            $ionicHistory.clearCache([backViewStateId, currentViewStateId])\n          })\n\n          // 成功后清缓存\n\n        });\n\n        $timeout(popup.close.bind(popup), 2000);\n\n      } else {\n        IbPopup.alert({\n          title: res.msg\n        });\n      }\n    }\n  }\n})\n\n.factory('FlowListUtil', function() {\n  return {\n\n    // 根据工作流 key 删除列表中对应的项\n    removeByKey: function(key) {\n      var _this = this;\n\n      if (!this.items.length) {\n        return;\n      }\n\n      angular.forEach(this.items, function(item, i) {\n        if (item.key == key) {\n          _this.items.splice(i, 1);\n          return false;\n        }\n      });\n    }\n  };\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowTodo\n * @description\n *   待办工作列表数据\n */\n.factory('FlowTodo', function($rootScope, Settings, IbList) {\n  var flowTodo = new IbList(Settings.rootUrl + '/work&type=todo', {\n    idAttr: 'runid'\n  });\n\n  var reset = angular.bind(flowTodo, flowTodo.reset);\n\n  $rootScope.$on('workflow.handover', reset);\n  $rootScope.$on('workflow.handoverFree', reset);\n  $rootScope.$on('workflow.signFlow', reset);\n  $rootScope.$on('workflow.create', reset);\n  $rootScope.$on('workflow.rollback', reset);\n  $rootScope.$on('workflow.takeback', reset);\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowTodo.remove(runid);\n  });\n\n  return flowTodo;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowTrans\n * @description\n *   已办结列表数据\n */\n.factory('FlowTrans', function($rootScope, Settings, IbList, FlowListUtil) {\n  var flowTrans = new IbList(Settings.rootUrl + '/work&type=trans', {\n    idAttr: 'runid'\n  });\n\n  angular.extend(flowTrans, FlowListUtil);\n\n  var reset = angular.bind(flowTrans, flowTrans.reset);\n\n  $rootScope.$on('workflow.handover', reset);\n  $rootScope.$on('workflow.handoverFree', reset);\n  $rootScope.$on('workflow.signFlow', reset);\n  $rootScope.$on('workflow.rollback', reset);\n\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowTrans.remove(runid);\n  });\n\n  $rootScope.$on('workflow.takeback', function(evt, key, res) {\n    flowTrans.removeByKey(key);\n  });\n\n  return flowTrans;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowDone\n * @description\n *   已完成列表数据\n */\n.factory('FlowDone', function($rootScope, Settings, IbList) {\n  var flowDone = new IbList(Settings.rootUrl + '/work&type=done', {\n    idAttr: 'runid'\n  });\n\n  var reset = angular.bind(flowDone, flowDone.reset);\n\n  $rootScope.$on('workflow.handover', reset);\n  $rootScope.$on('workflow.handoverFree', reset);\n  $rootScope.$on('workflow.signFlow', reset);\n  $rootScope.$on('workflow.rollback', reset);\n\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowDone.remove(runid);\n  });\n\n  return flowDone;\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.FlowFollow\n * @description\n *   我的关注列表数据\n */\n.factory('FlowFollow', function($rootScope, Settings, IbList) {\n  var flowFollow = new IbList(Settings.rootUrl + '/work/follow', {\n    idAttr: 'runid'\n  });\n\n  $rootScope.$on('workflow.remove', function(evt, runid) {\n    flowFollow.remove(runid);\n  });\n\n  return flowFollow;\n})\n\n/**\n * @ngdoc service\n * @name workflow.service.FlowUpload\n * @description\n *  工作流上传处理\n */\n.service('FlowUpload', function(Settings, FileUtils, IbPopup, UploadFile, fileSizeFilter, Utils) {\n  var This = this;\n  this.safeImgTypes = ['gif', 'jpg', 'jpeg', 'png'];\n  this.safeFileTypes = ['chm', 'pdf', 'zip', 'rar', 'tar', 'gz', 'bzip2', 'txt', 'doc', 'xls', 'ppt', 'docx', 'xlsx', 'pptx'];\n\n  // 检查是否是支持的文件类型\n  this.isSafeFile = function(types, files) {\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i];\n      var type = FileUtils.getExtname(file.name).toLowerCase();\n      if (types.indexOf(type) === -1) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  // 检查空文件\n  this.hasEmptyFile = function(files) {\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i];\n      if (file.size === 0) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  // 检查文件大小\n  this.isSafeSize = function(maxSize, files) {\n    for (var i = 0; i < files.length; i++) {\n      var file = files[i];\n      if (file.size > maxSize * 1024 * 1024) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  this.closeLoading = function($scope, tmp) {\n    $scope.$apply(function() {\n      tmp.uploading = false;\n      tmp.uploaded = true;\n    });\n  }\n\n  this.upload = function($scope, files, container, processid) {\n    angular.forEach(files, function(file) {\n      var tmp = {\n        filename: file.name,\n        filesize: fileSizeFilter(file.size),\n        filetype: file.type.split('/')[1],\n        delete: true,\n        xhr: null,\n        uploading: true,\n        uploaded: false\n      }\n      Utils.getImagePreviewUrl(file, function(url) {\n        tmp.url = url;\n      });\n      tmp.index = container.length;\n      $scope.$apply(function() {\n        container.push(tmp);\n      });\n      var formData = new FormData();\n      formData.append('Filedata[]', file);\n      tmp.xhr = UploadFile.upload({\n        data: formData,\n        params: {\n          type: 'workflow',\n          flowprocess: processid\n        },\n        onSuccess: function(res) {\n          This.closeLoading($scope, tmp);\n          if (res.isSuccess) {\n            tmp.aid = res.data[0].aid;\n          } else {\n            // 删除没上传成功的\n            container.splice(tmp.index, 1);\n            IbPopup.alert({\n              title: res.msg\n            });\n          }\n        },\n        onProgress: function(progress) {\n          // 进度\n          // console.log(progress)\n        },\n        onFail: function(err) {\n          // 删除没上传成功的\n          container.splice(tmp.index, 1);\n          if (err) {\n            var errMsg = err.msg || '上传失败';\n            IbPopup.alert({\n              title: errMsg\n            });\n          } else {\n            // 上传被取消\n          }\n        }\n      });\n    });\n  }\n})\n\n/**\n * @ngdoc service\n * @name workflow.services.icFactory\n * @description\n *   工作流表单控件处理\n *\n */\n.factory('icFactory', function($filter, $timeout, attrFromTemplateFilter, Utils, UserSelector, User) {\n  function removeStyle(str) {\n    return str ? str.replace(/\\s+style=['\"].*?['\"]/g, '') : '';\n  }\n\n  function getIc(id, scope) {\n    for (var i in scope.flow.enableArr) {\n      var ic = scope.flow.enableArr[i];\n      if (ic['data-id'] == id) {\n        return ic;\n      }\n    }\n    return null;\n  }\n\n  var ics = {\n    // 单行文本框\n    'text': function(ic, modelName) {\n      // 设置了隐藏\n      if (ic['data-hide'] == '1') {\n        return '<input type=\"hidden\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\">隐藏字段';\n      } else {\n        return '<input type=\"text\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\">';\n      }\n    },\n\n    // 多行文本框\n    'textarea': function(ic, modelName) {\n      // 富文本编辑框在手机端上显示为也普通 textarea\n      return '<textarea ng-model=\"' + modelName + ' \" name=\"data_' + ic['data-id'] + '\" rows=\"' + ic['data-rows'] + '\" style=\"width: 100%;\"></textarea>';\n    },\n\n    // 下拉菜单\n    'select': function(ic, modelName, scope) {\n      scope.options = ic['data-select-field'].split('`');\n\n      // 如果没有保存值，设置默认选中值\n      if (!ic['origin-value']) {\n        $timeout(function(){\n          scope.setValue(ic['data-id'], ic['data-select-check']);\n        }, 100)\n      }\n\n      return '<select ng-model=\"' + modelName + '\" ng-init=\"' + modelName + '= options[0]\"  name=\"data_' + ic['data-id'] + '\" size=\"' + ic['data-size'] + '\">' +\n        '<option ng-selected=\"op==' + modelName + '\"  value=\"{{op}}\" ng-repeat=\"op in options\">{{op}}</option>' +\n        '</select>';\n    },\n\n    // 单选\n    'radio': function(ic, modelName, scope) {\n      scope.radios = ic['data-radio-field'].split('`');\n\n      if (!ic['origin-value']) {\n        scope.setValue(ic['data-id'], ic['data-radio-check']);\n      }\n\n      // 添加手机端样式\n      return '<label class=\"checkbox\" ng-repeat=\"r in radios\">' +\n        '<input type=\"radio\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\" value=\"{{r}}\">' +\n        '{{r}}' +\n        '</label>';\n    },\n\n    // 复选\n    'checkbox': function(ic, modelName) {\n      return '<label class=\"checkbox\">' +\n        '<input type=\"checkbox\" ng-model=\"' + modelName + '\" ng-true-value=\"\\'on\\'\" ng-false-value=\"\" name=\"data_' + ic['data-id'] + '\">' +\n        ic['data-title'] +\n        '</label>';\n    },\n\n    // 日期选择器\n    'date': function(ic, modelName, scope) {\n      var dateFilter = $filter('date');\n      var isFormTypeSupported = Utils.isFormTypeSupported;\n      // 由于 pc 端日期格式为 yyyy-mm-dd hh:ii:ss\n      // 此处需要作格式转换\n      var dateFormat = ic['data-date-format'].replace('mm', 'MM')\n        .replace('hh', 'HH')\n        .replace('ii', 'mm'),\n        value = ic['origin-value'],\n        placeholder = '',\n        date,\n        type;\n\n      if (value) {\n        // 将初始值转换为日期对象\n        var dateArr = value.split(/[\\-\\s\\:]/);\n        date = new Date(\n          dateArr[0],\n          dateArr[1] ? +dateArr[1] - 1 : 0,\n          dateArr[2] ? +dateArr[2] : 1,\n          dateArr[3] ? +dateArr[3] : 0,\n          dateArr[4] ? +dateArr[4] : 0,\n          dateArr[5] ? +dateArr[5] : 0);\n      }\n\n      var isDateType = (dateFormat == 'yyyy-MM-dd' ||\n        dateFormat == 'yyyy-MM' ||\n        dateFormat == 'yyyy');\n\n      var isDatetimeType = (dateFormat == 'yyyy-MM-dd HH:mm:ss' ||\n        dateFormat == 'yyyy-MM-dd HH:mm' ||\n        dateFormat == 'yyyy-MM-dd HH');\n\n      // 如果是分类为日期类型且支持日期控件时\n      // 使用日期控件并将数据格式化为可用数据\n      if (isDateType && isFormTypeSupported('date')) {\n        type = 'date';\n        if (date) {\n          value = date;\n        }\n        // 如果是分类为日期时间类型且支持日期控件时\n      } else if (isDatetimeType && isFormTypeSupported('datetime-local')) {\n        type = 'datetime-local';\n        if (date) {\n          // 时区调整\n          value = date;\n        }\n      } else {\n        type = 'text';\n        placeholder = '格式为 ' + dateFilter(new Date(), dateFormat);\n      }\n\n      // 由于 html5 type 兼容性各种不同，只使用日期和日期时间类型控件来表现各种格式\n      // 其他直接使用 text 加 placeholder 提示\n      // @todo: 是否不使用原生控件考虑自实现\n      var tpl = '<input type=\"' + type + '\" ng-model=\"' + modelName + '\" placeholder=\"' + placeholder + '\" name=\"data_' + ic['data-id'] + '\"/>' +\n        '<span class=\"rp-icon-calendar\"></span>';\n\n      scope.setValue(ic['data-id'], value);\n\n      return tpl;\n    },\n\n    // 部门人员选择控件\n    'user': function(ic, modelName, scope) {\n      var selectType = ic['data-select-type'];\n      var single = ic['data-single'];\n      var userSelector;\n      var defaultValue;\n\n      function setModal(modal) {\n        userSelector = modal;\n      }\n\n      var options = {\n        maxSelection: single == 1 ? 1 : false\n      };\n\n      if (selectType == 'position') {\n        defaultValue = User.removePositionPrefix(scope.ic['origin-value']);\n        UserSelector.createPosition(options).then(setModal);\n\n      } else if (selectType == 'department') {\n        defaultValue = User.removeDepartmentPrefix(scope.ic['origin-value']);\n        UserSelector.createDepartment(options).then(setModal);\n\n      } else {\n        defaultValue = User.removePrefix(scope.ic['origin-value']);\n        UserSelector.create(options).then(setModal);\n      }\n\n      scope.select = function() {\n        defaultValue = scope.getValue(ic['data-id']);\n\n        userSelector.show({\n            values: defaultValue ? defaultValue.split(',') : [],\n          },\n          function(selected) {\n            scope.setValue(ic['data-id'], selected.join(','));\n            userSelector.hide();\n          });\n      };\n\n      scope.$on('$destroy', function() {\n        userSelector.remove();\n      });\n\n      scope.setValue(ic['data-id'], defaultValue);\n\n      return '<user-selector select-type=\"' + ic['data-select-type'] + '\" name=\"data_' + ic['data-id'] + '\" ng-model=\"' + modelName + '\"></user-selector> ' +\n        '<i class=\"icon ion-ios-plus positive\" ng-click=\"select()\"></i>';\n    },\n\n    // 宏控件\n    'auto': function(ic, modelName, scope) {\n      var template;\n\n      if (!ic['origin-value']) {\n        scope.setValue(ic['data-id'], attrFromTemplateFilter(ic.value, 'value'));\n      }\n\n      template = removeStyle(ic.value).replace(/<(input|select|textarea)\\s+/, function(match) {\n        return match + ' ' + 'ng-model=\"' + modelName + '\" ';\n      });\n\n\n      return ic['data-hide'] != 1 ? template : template + '隐藏字段';\n    },\n\n    // 计算控件\n    'calc': function(ic, modelName, scope) {\n      // 设置值精度\n      function setPrec(value) {\n        return (+value).toFixed(ic['data-prec']);\n      }\n\n      var calc = {\n        // 获取表单的值\n        getVal: function(id) {\n          var targetIc = scope.getIc(id);\n          var ret = 0;\n\n          if (targetIc && targetIc['data-type'] === 'date') {\n            ret = new Date(scope.getValue(id));\n          } else if (targetIc && targetIc['data-type'] === 'listview') {\n            ret = scope.getValue(id)\n          } else {\n            ret = parseFloat(scope.getValue(id));\n            if (isNaN(ret)) ret = 0;\n          }\n\n          return ret;\n        },\n\n        // 计算日期\n        date: function(value) {\n          value = value / 1000;\n          return (value >= 0) ?\n            Math.floor(value / 86400) + '天' +\n            Math.floor((value % 86400) / 3600) + '小时' +\n            Math.floor((value % 3600) / 60) + '分' +\n            Math.floor(value % 60) + '秒' :\n            '时间格式无效';\n        },\n\n        // 天数计算\n        day: function(val) {\n          return setPrec(val <= 0 ? 0 : Math.floor(val / 86400000));\n        },\n\n        // 小时\n        hour: function(val) {\n          return setPrec(val <= 0 ? 0 : Math.floor(val / 3600000));\n        },\n\n        sum: function() {\n          if (arguments.length === 0) {\n            return '';\n          }\n          var argu = arguments;\n          var total = 0;\n          for (var i = 0; i < argu.length; i++) {\n            total += argu[i]\n          }\n          return setPrec(parseFloat(total))\n        },\n\n        // 最大值\n        max: function() {\n          if (arguments.length === 0) {\n            return '';\n          }\n          return setPrec(parseFloat(Math.max.apply(null, arguments)));\n        },\n\n        // 最小值\n        min: function() {\n          if (arguments.length === 0) {\n            return '';\n          }\n          return setPrec(parseFloat(Math.min.apply(null, arguments)));\n        },\n\n        // 取模运算\n        mod: function() {\n          if (arguments.length === 0) {\n            return;\n          }\n          var firstNum = arguments[0];\n          var secondNum = arguments[1];\n          var result = firstNum % secondNum;\n          result = isNaN(result) ? \"\" : parseFloat(result);\n          return setPrec(result);\n        },\n\n        // 绝对值\n        abs: function(val) {\n          return setPrec(Math.abs(parseFloat(val)));\n        },\n\n        // 平均值\n        avg: function() {\n          var value = 0;\n          var len = arguments.length;\n\n          for (var i = 0; i < len; i++) {\n            value += parseFloat(arguments[i] || 0);\n          }\n\n          return setPrec(value / len);\n        },\n\n        // 人民币计算大写\n        rmb: function(currencyDigits) {\n          // Constants:\n          var MAXIMUM_NUMBER = 99999999999.99;\n          // Variables:\n          var integral; // Represent integral part of digit number.\n          var decimal; // Represent decimal part of digit number.\n          var outputCharacters; // The output result.\n          var parts;\n          var digits, radices, bigRadices, decimals;\n          var zeroCount;\n          var i, p, d;\n          var quotient, modulus;\n          // Validate input string:\n          currencyDigits = currencyDigits.toString();\n          if (currencyDigits == \"\") {\n            return \"\";\n          }\n          if (currencyDigits.match(/[^,.\\d]/) != null) {\n            return \"\";\n          }\n          if ((currencyDigits).match(/^((\\d{1,3}(,\\d{3})*(.((\\d{3},)*\\d{1,3}))?)|(\\d+(.\\d+)?))$/) == null) {\n            return \"\";\n          }\n          // Normalize the format of input digits:\n          currencyDigits = currencyDigits.replace(/,/g, \"\"); // Remove comma delimiters.\n          currencyDigits = currencyDigits.replace(/^0+/, \"\"); // Trim zeros at the beginning.\n          // Assert the number is not greater than the maximum number.\n          if (Number(currencyDigits) > MAXIMUM_NUMBER) {\n            return \"\";\n          }\n          // Process the coversion from currency digits to characters:\n          // Separate integral and decimal parts before processing coversion:\n          parts = currencyDigits.split(\".\");\n          if (parts.length > 1) {\n            integral = parts[0];\n            decimal = parts[1];\n            // Cut down redundant decimal digits that are after the second.\n            decimal = decimal.substr(0, 2);\n          } else {\n            integral = parts[0];\n            decimal = \"\";\n          }\n          // Prepare the characters corresponding to the digits:\n          digits = ['零', '壹', '贰', '叁', '肆', '伍', '陆', '柒', '捌', '玖'];\n          radices = ['', '拾', '佰', '仟'];\n          bigRadices = ['', '万', '亿'];\n          decimals = ['角', '分'];\n          // Start processing:\n          outputCharacters = \"\";\n          // Process integral part if it is larger than 0:\n          if (Number(integral) > 0) {\n            zeroCount = 0;\n            for (i = 0; i < integral.length; i++) {\n              p = integral.length - i - 1;\n              d = integral.substr(i, 1);\n              quotient = p / 4;\n              modulus = p % 4;\n              if (d == \"0\") {\n                zeroCount++;\n              } else {\n                if (zeroCount > 0) {\n                  outputCharacters += digits[0];\n                }\n                zeroCount = 0;\n                outputCharacters += digits[Number(d)] + radices[modulus];\n              }\n              if (modulus == 0 && zeroCount < 4) {\n                outputCharacters += bigRadices[quotient];\n              }\n            }\n            outputCharacters += '元';\n          }\n          // Process decimal part if there is:\n          if (decimal != \"\") {\n            for (i = 0; i < decimal.length; i++) {\n              d = decimal.substr(i, 1);\n              if (d != \"0\") {\n                outputCharacters += digits[Number(d)] + decimals[i];\n              }\n            }\n          }\n          // Confirm and return the final output string:\n          if (outputCharacters == \"\") {\n            outputCharacters = '零元';\n          }\n          if (decimal == \"\") {\n            outputCharacters += '整';\n          }\n          //outputCharacters = CN_SYMBOL + outputCharacters;\n          return outputCharacters;\n        },\n\n        // 列表控件计算\n        // @todo: 手机端暂时不支持列表控件\n        list: function(val, row) {\n          // console.log(val, row);\n          var output = 0\n          val.split(\"\\n\").map(function(item) {\n            item.split('`').map(function(_item, _index) {\n              if (_index === (row - 1)) {\n                output += parseFloat(_item)\n              }\n            })\n          })\n\n          return output\n        }\n      };\n\n      // 获取计算表达式\n      var exp = attrFromTemplateFilter(ic.value, 'data-exp');\n      var icIds = exp ? exp.match(/\\d+/g) : null;\n      if (icIds) {\n        // 监控计算控件相关的字段的变化情况\n        scope.$watch(function () {\n          return icIds.map(function(icId) {\n            return scope.getValue(icId);\n          }).join();\n        }, function() {\n          try {\n            var evalExp = eval(exp);\n            scope.setValue(ic['data-id'], typeof evalExp == \"number\" ? evalExp.toFixed(ic['data-prec']) : evalExp);\n          } catch (e) {\n\n          }\n        });\n      }\n\n      return '<input type=\"text\" ng-model=\"' + modelName + '\" name=\"data_' + ic['data-id'] + '\" />';\n    },\n\n    // 图片上传控件\n    'imgupload': function(ic, modelName) {\n      var src = attrFromTemplateFilter(ic.value, 'data-src');\n      //return src ? '<img src=\"' + $filter('fullUrl')(src) + '\" width=\"' + ic['data-width'] + '\" height=\"' + ic['data-height'] + '\"/>' : '<span>';\n      return '<span>暂不支持图片上传控件</span>';\n    },\n\n    // 列表控件\n    'listview': function(ic, modelName) {\n      return '<span>暂不支持列表控件</span>';\n    },\n\n    // 签章控件\n    'sign': function(ic, modelName) {\n      return '<span>暂不支持签章控件</span>';\n    },\n\n    // 进度条控件\n    'progressbar': function(ic, modelName) {\n      return '<span>暂不支持进度条控件</span>';\n    },\n\n    'qrcode': function(ic, modelName) {\n      return '<span>暂不支持二维码控件</span>';\n    }\n  };\n\n  var ret = {\n    parse: function(ic, scope, pattern) {\n      var type = ic && ic['data-type'];\n      if (!ics[type]) {\n        return ic.value || '';\n      }\n\n      return ics[type].call(null, ic, scope, pattern);\n    }\n  };\n\n  ret.serializes = {\n    // 日期控件\n    date: function(value, field) {\n      if (!value) {\n        return '';\n      }\n\n      var format = field['data-date-format'].replace('mm', 'MM')\n        .replace('hh', 'HH')\n        .replace('ii', 'mm');\n\n      var date;\n\n      if (\n        Utils.isFormTypeSupported('datetime-local') ||\n        Utils.isFormTypeSupported('date')\n      ) {\n        return $filter('date')(value, format);\n      }\n\n      return value;\n    },\n\n    // 部门人员控件\n    user: function(value, field) {\n      var selectType = field['data-select-type'];\n\n      if (selectType == 'user') {\n        return User.addPrefix(value);\n      } else if (selectType == 'position') {\n        return User.addPositionPrefix(value);\n      } else {\n        return User.addDepartmentPrefix(value);\n      }\n    },\n\n    //图片上传控件\n    //imgupload: function(value, field) {\n    //  if(!value) {\n    //    return '';\n    //  }\n    //\n    //  var formData = new FormData();\n    //  var file = value[0];\n    //  formData.append('data_' + field['data-id'], file);\n    //\n    //  return formData;\n    //}\n  };\n\n  // 标准化要提交的控件数据\n  ret.serialize = function(data, fields) {\n    if (!fields || !fields.length) {\n      return data;\n    }\n\n    angular.forEach(fields, function(field) {\n      var type = field['data-type'];\n      var id = field['data-id'];\n\n      if (ret.serializes[type]) {\n        data['data_' + id] = ret.serializes[type].call(null, data['data_' + id], field);\n      }\n    });\n\n    return data;\n  };\n\n  return ret;\n})\n","/**\n * @ngdoc module\n * @name workflow\n * @description\n *   工作流模块\n */\n\nangular.module('workflow', ['ionic', 'workflow.controllers', 'workflow.services', 'workflow.filters', 'workflow.directives'])\n\n.run(function(Apps) {\n  Apps.install({ name: 'workflow', title: '工作流', route: '#/workflow', state: 'workflow.index', icon: 'img/modicon/workflow.png' })\n})\n\n.config(function($stateProvider, $urlRouterProvider, UserProvider, ResolversProvider) {\n\n  $urlRouterProvider.when('/workflow', '/workflow/index');\n\n  $stateProvider\n  .state('workflow', {\n    url: '/workflow',\n    abstract: true,\n    template: '<ion-nav-view name=\"workflow\"></ion-nav-view>',\n    resolve: UserProvider.resolve\n  })\n\n  $stateProvider\n  // 工作流-首页\n  .state('workflow.index', {\n    url: '/index',\n    talkingDataLabel: '工作流-首页',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-index.html',\n        controller:'FlowIndexCtrl'\n      }\n    }\n  })\n\n  // 工作流-待办工作\n  .state('workflow.todo', {\n    url: '/todo',\n    talkingDataLabel: '工作流-待办工作',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-list.html',\n        controller: 'FlowTodoCtrl'\n      }\n    }\n  })\n\n\n  // 工作流-已办结（已转交）\n  .state('workflow.trans', {\n    url: '/trans',\n    talkingDataLabel: '工作流-已办结',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-list.html',\n        controller: 'FlowTransCtrl'\n      }\n    }\n  })\n\n  // 工作流-已完成\n  .state('workflow.done', {\n    url: '/done',\n    talkingDataLabel: '工作流-已完成',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-list.html',\n        controller: 'FlowDoneCtrl'\n      }\n    }\n  })\n\n  // 工作流-我的关注\n  .state('workflow.follow', {\n    url: '/follow',\n    talkingDataLabel: '工作流-我的关注',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-follow-list.html',\n        controller: 'FlowFollowCtrl'\n      }\n    }\n  })\n\n  // 工作流-新建\n  .state('workflow.create', {\n    url: '/create',\n    talkingDataLabel: '工作流-发布工作',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-create.html',\n        controller: 'FlowCreateCtrl'\n      }\n    }\n  })\n\n  // 工作流-主办\n  .state('workflow.handle', {\n    url: '/handle/:key?topflag',\n    talkingDataLabel: '工作流-主办',\n    resolve: ResolversProvider.get(['canvasPainter']),\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-handle.html',\n        controller: 'FlowHandleCtrl'\n      }\n    }\n  })\n \n  .state('workflow.handover', {\n    url: '/handover/:key?topflag',\n    talkingDataLabel: '工作流-转交',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-handover.html',\n        controller: 'FlowHandoverCtrl'\n      }\n    }\n  })\n\n  .state('workflow.handoverFree', {\n    url: '/handoverFree/:key',\n    talkingDataLabel: '工作流-转交自由流程',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-handover-free.html',\n        controller: 'FlowHandoverFreeCtrl'\n      }\n    }\n  })\n\n  // 工作流-详细\n  .state('workflow.detail', {\n    url: '/detail/:key',\n    talkingDataLabel: '工作流-查看工作流',\n    views: {\n      'workflow': {\n        templateUrl: 'templates/workflow/workflow-detail.html',\n        controller: 'FlowDetailCtrl'\n      }\n    }\n  })\n  \n})\n\n.run(function($rootScope, $ionicHistory) {\n\n  // function clearListCache() {\n  //   $ionicHistory.clearCache(['workflow.todo', 'workflow.trans', 'workflow.done']);\n  // }\n\n  // angular.forEach([\n  //   'workflow.handover',\n  //   'workflow.handoverFree',\n  //   'workflow.signFlow',\n  //   'workflow.takeback',\n  // ], function(eventName) {\n  //   $rootScope.$on(eventName, clearListCache);\n  // });\n})"],"sourceRoot":"./"}